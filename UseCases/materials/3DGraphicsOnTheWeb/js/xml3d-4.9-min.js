(function e$$0(j,e,a){function d(c,f){if(!e[c]){if(!j[c]){var k="function"==typeof require&&require;if(!f&&k)return k(c,!0);if(b)return b(c,!0);k=Error("Cannot find module '"+c+"'");throw k.code="MODULE_NOT_FOUND",k;}k=e[c]={exports:{}};j[c][0].call(k.exports,function(a){var b=j[c][1][a];return d(b?b:a)},k,k.exports,e$$0,j,e,a)}return e[c].exports}for(var b="function"==typeof require&&require,c=0;c<a.length;c++)d(a[c]);return d})({1:[function(h,j,e){(function(a){var d;"undefined"===typeof e?"function"==
typeof define&&"object"==typeof define.amd&&define.amd?(d={},define(function(){return d})):d="undefined"!==typeof window?window:a:d=e;(function(a){if(!c)var c=1.0E-6;if(!d)var d=typeof Float32Array!=="undefined"?Float32Array:Array;if(!f)var f=Math.random;var k={setMatrixArrayType:function(o){d=o}};if(typeof a!=="undefined")a.glMatrix=k;var i=Math.PI/180;k.toRadian=function(o){return o*i};var e={create:function(){var o=new d(2);o[0]=0;o[1]=0;return o},clone:function(o){var a=new d(2);a[0]=o[0];a[1]=
o[1];return a},fromValues:function(o,a){var b=new d(2);b[0]=o;b[1]=a;return b},copy:function(o,a){o[0]=a[0];o[1]=a[1];return o},set:function(o,a,b){o[0]=a;o[1]=b;return o},add:function(o,a,b){o[0]=a[0]+b[0];o[1]=a[1]+b[1];return o},subtract:function(o,a,b){o[0]=a[0]-b[0];o[1]=a[1]-b[1];return o}};e.sub=e.subtract;e.multiply=function(o,a,b){o[0]=a[0]*b[0];o[1]=a[1]*b[1];return o};e.mul=e.multiply;e.divide=function(o,a,b){o[0]=a[0]/b[0];o[1]=a[1]/b[1];return o};e.div=e.divide;e.min=function(o,a,b){o[0]=
Math.min(a[0],b[0]);o[1]=Math.min(a[1],b[1]);return o};e.max=function(o,a,b){o[0]=Math.max(a[0],b[0]);o[1]=Math.max(a[1],b[1]);return o};e.scale=function(o,a,b){o[0]=a[0]*b;o[1]=a[1]*b;return o};e.scaleAndAdd=function(o,a,b,c){o[0]=a[0]+b[0]*c;o[1]=a[1]+b[1]*c;return o};e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)};e.dist=e.distance;e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d};e.sqrDist=e.squaredDistance;e.length=function(a){var b=a[0],
a=a[1];return Math.sqrt(b*b+a*a)};e.len=e.length;e.squaredLength=function(a){var b=a[0],a=a[1];return b*b+a*a};e.sqrLen=e.squaredLength;e.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];return a};e.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];return a};e.normalize=function(a,b){var c=b[0],d=b[1],c=c*c+d*d;if(c>0){c=1/Math.sqrt(c);a[0]=b[0]*c;a[1]=b[1]*c}return a};e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};e.cross=function(a,b,c){b=b[0]*c[1]-b[1]*c[0];a[0]=a[1]=0;a[2]=b;return a};e.lerp=function(a,
b,c,d){var f=b[0],b=b[1];a[0]=f+d*(c[0]-f);a[1]=b+d*(c[1]-b);return a};e.random=function(a,b){var b=b||1,c=f()*2*Math.PI;a[0]=Math.cos(c)*b;a[1]=Math.sin(c)*b;return a};e.transformMat2=function(a,b,c){var d=b[0],b=b[1];a[0]=c[0]*d+c[2]*b;a[1]=c[1]*d+c[3]*b;return a};e.transformMat2d=function(a,b,c){var d=b[0],b=b[1];a[0]=c[0]*d+c[2]*b+c[4];a[1]=c[1]*d+c[3]*b+c[5];return a};e.transformMat3=function(a,b,c){var d=b[0],b=b[1];a[0]=c[0]*d+c[3]*b+c[6];a[1]=c[1]*d+c[4]*b+c[7];return a};e.transformMat4=function(a,
b,c){var d=b[0],b=b[1];a[0]=c[0]*d+c[4]*b+c[12];a[1]=c[1]*d+c[5]*b+c[13];return a};e.forEach=function(){var a=e.create();return function(b,c,d,f,g,i){c||(c=2);d||(d=0);for(f=f?Math.min(f*c+d,b.length):b.length;d<f;d=d+c){a[0]=b[d];a[1]=b[d+1];g(a,a,i);b[d]=a[0];b[d+1]=a[1]}return b}}();e.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};if(typeof a!=="undefined")a.vec2=e;var l={create:function(){var a=new d(3);a[0]=0;a[1]=0;a[2]=0;return a},clone:function(a){var b=new d(3);b[0]=a[0];b[1]=a[1];b[2]=
a[2];return b},fromValues:function(a,b,c){var f=new d(3);f[0]=a;f[1]=b;f[2]=c;return f},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,c,d){a[0]=b;a[1]=c;a[2]=d;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];return a},subtract:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];return a}};l.sub=l.subtract;l.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];return a};l.mul=l.multiply;l.divide=function(a,b,c){a[0]=
b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];return a};l.div=l.divide;l.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);return a};l.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);return a};l.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a};l.scaleAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;return a};l.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],f=b[2]-
a[2];return Math.sqrt(c*c+d*d+f*f)};l.dist=l.distance;l.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],f=b[2]-a[2];return c*c+d*d+f*f};l.sqrDist=l.squaredDistance;l.length=function(a){var b=a[0],c=a[1],a=a[2];return Math.sqrt(b*b+c*c+a*a)};l.len=l.length;l.squaredLength=function(a){var b=a[0],c=a[1],a=a[2];return b*b+c*c+a*a};l.sqrLen=l.squaredLength;l.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];return a};l.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];return a};l.normalize=
function(a,b){var c=b[0],d=b[1],f=b[2],c=c*c+d*d+f*f;if(c>0){c=1/Math.sqrt(c);a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c}return a};l.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};l.cross=function(a,b,c){var d=b[0],f=b[1],b=b[2],g=c[0],i=c[1],c=c[2];a[0]=f*c-b*i;a[1]=b*g-d*c;a[2]=d*i-f*g;return a};l.lerp=function(a,b,c,d){var f=b[0],g=b[1],b=b[2];a[0]=f+d*(c[0]-f);a[1]=g+d*(c[1]-g);a[2]=b+d*(c[2]-b);return a};l.random=function(a,b){var b=b||1,c=f()*2*Math.PI,d=f()*2-1,g=Math.sqrt(1-d*d)*b;a[0]=
Math.cos(c)*g;a[1]=Math.sin(c)*g;a[2]=d*b;return a};l.transformMat4=function(a,b,c){var d=b[0],f=b[1],b=b[2],g=c[3]*d+c[7]*f+c[11]*b+c[15],g=g||1;a[0]=(c[0]*d+c[4]*f+c[8]*b+c[12])/g;a[1]=(c[1]*d+c[5]*f+c[9]*b+c[13])/g;a[2]=(c[2]*d+c[6]*f+c[10]*b+c[14])/g;return a};l.transformMat3=function(a,b,c){var d=b[0],f=b[1],b=b[2];a[0]=d*c[0]+f*c[3]+b*c[6];a[1]=d*c[1]+f*c[4]+b*c[7];a[2]=d*c[2]+f*c[5]+b*c[8];return a};l.transformQuat=function(a,b,c){var d=b[0],f=b[1],g=b[2],b=c[0],i=c[1],k=c[2],c=c[3],e=c*d+
i*g-k*f,l=c*f+k*d-b*g,n=c*g+b*f-i*d,d=-b*d-i*f-k*g;a[0]=e*c+d*-b+l*-k-n*-i;a[1]=l*c+d*-i+n*-b-e*-k;a[2]=n*c+d*-k+e*-i-l*-b;return a};l.rotateX=function(a,b,c,d){var f=[],g=[];f[0]=b[0]-c[0];f[1]=b[1]-c[1];f[2]=b[2]-c[2];g[0]=f[0];g[1]=f[1]*Math.cos(d)-f[2]*Math.sin(d);g[2]=f[1]*Math.sin(d)+f[2]*Math.cos(d);a[0]=g[0]+c[0];a[1]=g[1]+c[1];a[2]=g[2]+c[2];return a};l.rotateY=function(a,b,c,d){var f=[],g=[];f[0]=b[0]-c[0];f[1]=b[1]-c[1];f[2]=b[2]-c[2];g[0]=f[2]*Math.sin(d)+f[0]*Math.cos(d);g[1]=f[1];g[2]=
f[2]*Math.cos(d)-f[0]*Math.sin(d);a[0]=g[0]+c[0];a[1]=g[1]+c[1];a[2]=g[2]+c[2];return a};l.rotateZ=function(a,b,c,d){var f=[],g=[];f[0]=b[0]-c[0];f[1]=b[1]-c[1];f[2]=b[2]-c[2];g[0]=f[0]*Math.cos(d)-f[1]*Math.sin(d);g[1]=f[0]*Math.sin(d)+f[1]*Math.cos(d);g[2]=f[2];a[0]=g[0]+c[0];a[1]=g[1]+c[1];a[2]=g[2]+c[2];return a};l.forEach=function(){var a=l.create();return function(b,c,d,f,g,i){c||(c=3);d||(d=0);for(f=f?Math.min(f*c+d,b.length):b.length;d<f;d=d+c){a[0]=b[d];a[1]=b[d+1];a[2]=b[d+2];g(a,a,i);b[d]=
a[0];b[d+1]=a[1];b[d+2]=a[2]}return b}}();l.angle=function(a,b){var c=l.fromValues(a[0],a[1],a[2]),d=l.fromValues(b[0],b[1],b[2]);l.normalize(c,c);l.normalize(d,d);c=l.dot(c,d);return c>1?0:Math.acos(c)};l.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};if(typeof a!=="undefined")a.vec3=l;var m={create:function(){var a=new d(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a},clone:function(a){var b=new d(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},fromValues:function(a,b,c,f){var i=new d(4);
i[0]=a;i[1]=b;i[2]=c;i[3]=f;return i},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,b,c,d,f){a[0]=b;a[1]=c;a[2]=d;a[3]=f;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];return a},subtract:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];return a}};m.sub=m.subtract;m.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];a[3]=b[3]*c[3];return a};m.mul=m.multiply;m.divide=function(a,
b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];a[3]=b[3]/c[3];return a};m.div=m.divide;m.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);a[3]=Math.min(b[3],c[3]);return a};m.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);a[3]=Math.max(b[3],c[3]);return a};m.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;return a};m.scaleAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;
a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;return a};m.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],f=b[2]-a[2],g=b[3]-a[3];return Math.sqrt(c*c+d*d+f*f+g*g)};m.dist=m.distance;m.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],f=b[2]-a[2],g=b[3]-a[3];return c*c+d*d+f*f+g*g};m.sqrDist=m.squaredDistance;m.length=function(a){var b=a[0],c=a[1],d=a[2],a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)};m.len=m.length;m.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],a=a[3];return b*b+c*c+d*d+a*a};m.sqrLen=
m.squaredLength;m.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=-b[3];return a};m.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];a[3]=1/b[3];return a};m.normalize=function(a,b){var c=b[0],d=b[1],f=b[2],g=b[3],c=c*c+d*d+f*f+g*g;if(c>0){c=1/Math.sqrt(c);a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c}return a};m.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};m.lerp=function(a,b,c,d){var f=b[0],g=b[1],i=b[2],b=b[3];a[0]=f+d*(c[0]-f);a[1]=g+d*(c[1]-g);a[2]=i+
d*(c[2]-i);a[3]=b+d*(c[3]-b);return a};m.random=function(a,b){b=b||1;a[0]=f();a[1]=f();a[2]=f();a[3]=f();m.normalize(a,a);m.scale(a,a,b);return a};m.transformMat4=function(a,b,c){var d=b[0],f=b[1],g=b[2],b=b[3];a[0]=c[0]*d+c[4]*f+c[8]*g+c[12]*b;a[1]=c[1]*d+c[5]*f+c[9]*g+c[13]*b;a[2]=c[2]*d+c[6]*f+c[10]*g+c[14]*b;a[3]=c[3]*d+c[7]*f+c[11]*g+c[15]*b;return a};m.transformQuat=function(a,b,c){var d=b[0],f=b[1],g=b[2],b=c[0],i=c[1],k=c[2],c=c[3],e=c*d+i*g-k*f,l=c*f+k*d-b*g,n=c*g+b*f-i*d,d=-b*d-i*f-k*g;
a[0]=e*c+d*-b+l*-k-n*-i;a[1]=l*c+d*-i+n*-b-e*-k;a[2]=n*c+d*-k+e*-i-l*-b;return a};m.forEach=function(){var a=m.create();return function(b,c,d,f,g,i){c||(c=4);d||(d=0);for(f=f?Math.min(f*c+d,b.length):b.length;d<f;d=d+c){a[0]=b[d];a[1]=b[d+1];a[2]=b[d+2];a[3]=b[d+3];g(a,a,i);b[d]=a[0];b[d+1]=a[1];b[d+2]=a[2];b[d+3]=a[3]}return b}}();m.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};if(typeof a!=="undefined")a.vec4=m;k={create:function(){var a=new d(4);a[0]=1;a[1]=0;a[2]=0;a[3]=
1;return a},clone:function(a){var b=new d(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},transpose:function(a,b){if(a===b){var c=b[1];a[1]=b[2];a[2]=c}else{a[0]=b[0];a[1]=b[2];a[2]=b[1];a[3]=b[3]}return a},invert:function(a,b){var c=b[0],d=b[1],f=b[2],g=b[3],i=c*g-f*d;if(!i)return null;i=1/i;a[0]=g*i;a[1]=-d*i;a[2]=-f*i;a[3]=c*i;return a},adjoint:function(a,b){var c=
b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];a[3]=c;return a},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},multiply:function(a,b,c){var d=b[0],f=b[1],g=b[2],b=b[3],i=c[0],k=c[1],e=c[2],c=c[3];a[0]=d*i+g*k;a[1]=f*i+b*k;a[2]=d*e+g*c;a[3]=f*e+b*c;return a}};k.mul=k.multiply;k.rotate=function(a,b,c){var d=b[0],f=b[1],g=b[2],b=b[3],i=Math.sin(c),c=Math.cos(c);a[0]=d*c+g*i;a[1]=f*c+b*i;a[2]=d*-i+g*c;a[3]=f*-i+b*c;return a};k.scale=function(a,b,c){var d=b[1],f=b[2],g=b[3],i=c[0],c=c[1];a[0]=b[0]*i;a[1]=d*
i;a[2]=f*c;a[3]=g*c;return a};k.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};k.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};k.LDU=function(a,b,c,d){a[2]=d[2]/d[0];c[0]=d[0];c[1]=d[1];c[3]=d[3]-a[2]*c[1];return[a,b,c]};if(typeof a!=="undefined")a.mat2=k;k={create:function(){var a=new d(6);a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a},clone:function(a){var b=new d(6);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=
a[4];b[5]=a[5];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a},invert:function(a,b){var c=b[0],d=b[1],f=b[2],g=b[3],i=b[4],k=b[5],e=c*g-d*f;if(!e)return null;e=1/e;a[0]=g*e;a[1]=-d*e;a[2]=-f*e;a[3]=c*e;a[4]=(f*k-g*i)*e;a[5]=(d*i-c*k)*e;return a},determinant:function(a){return a[0]*a[3]-a[1]*a[2]},multiply:function(a,b,c){var d=b[0],f=b[1],g=b[2],i=b[3],k=b[4],b=b[5],e=c[0],l=
c[1],n=c[2],m=c[3],h=c[4],c=c[5];a[0]=d*e+g*l;a[1]=f*e+i*l;a[2]=d*n+g*m;a[3]=f*n+i*m;a[4]=d*h+g*c+k;a[5]=f*h+i*c+b;return a}};k.mul=k.multiply;k.rotate=function(a,b,c){var d=b[0],f=b[1],g=b[2],i=b[3],k=b[4],b=b[5],e=Math.sin(c),c=Math.cos(c);a[0]=d*c+g*e;a[1]=f*c+i*e;a[2]=d*-e+g*c;a[3]=f*-e+i*c;a[4]=k;a[5]=b;return a};k.scale=function(a,b,c){var d=b[1],f=b[2],g=b[3],i=b[4],k=b[5],e=c[0],c=c[1];a[0]=b[0]*e;a[1]=d*e;a[2]=f*c;a[3]=g*c;a[4]=i;a[5]=k;return a};k.translate=function(a,b,c){var d=b[0],f=
b[1],g=b[2],i=b[3],k=b[4],b=b[5],e=c[0],c=c[1];a[0]=d;a[1]=f;a[2]=g;a[3]=i;a[4]=d*e+g*c+k;a[5]=f*e+i*c+b;return a};k.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};k.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};if(typeof a!=="undefined")a.mat2d=k;var h={create:function(){var a=new d(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},fromMat4:function(a,
b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a},clone:function(a){var b=new d(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(a===b){var c=b[1],d=b[2],
f=b[5];a[1]=b[3];a[2]=b[6];a[3]=c;a[5]=b[7];a[6]=d;a[7]=f}else{a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8]}return a},invert:function(a,b){var c=b[0],d=b[1],f=b[2],g=b[3],i=b[4],k=b[5],e=b[6],l=b[7],n=b[8],m=n*i-k*l,h=-n*g+k*e,r=l*g-i*e,p=c*m+d*h+f*r;if(!p)return null;p=1/p;a[0]=m*p;a[1]=(-n*d+f*l)*p;a[2]=(k*d-f*i)*p;a[3]=h*p;a[4]=(n*c-f*e)*p;a[5]=(-k*c+f*g)*p;a[6]=r*p;a[7]=(-l*c+d*e)*p;a[8]=(i*c-d*g)*p;return a},adjoint:function(a,b){var c=b[0],d=b[1],
f=b[2],g=b[3],i=b[4],k=b[5],e=b[6],l=b[7],n=b[8];a[0]=i*n-k*l;a[1]=f*l-d*n;a[2]=d*k-f*i;a[3]=k*e-g*n;a[4]=c*n-f*e;a[5]=f*g-c*k;a[6]=g*l-i*e;a[7]=d*e-c*l;a[8]=c*i-d*g;return a},determinant:function(a){var b=a[3],c=a[4],d=a[5],f=a[6],g=a[7],i=a[8];return a[0]*(i*c-d*g)+a[1]*(-i*b+d*f)+a[2]*(g*b-c*f)},multiply:function(a,b,c){var d=b[0],f=b[1],g=b[2],i=b[3],k=b[4],e=b[5],l=b[6],n=b[7],b=b[8],m=c[0],h=c[1],r=c[2],p=c[3],q=c[4],j=c[5],A=c[6],B=c[7],c=c[8];a[0]=m*d+h*i+r*l;a[1]=m*f+h*k+r*n;a[2]=m*g+h*e+
r*b;a[3]=p*d+q*i+j*l;a[4]=p*f+q*k+j*n;a[5]=p*g+q*e+j*b;a[6]=A*d+B*i+c*l;a[7]=A*f+B*k+c*n;a[8]=A*g+B*e+c*b;return a}};h.mul=h.multiply;h.translate=function(a,b,c){var d=b[0],f=b[1],g=b[2],i=b[3],k=b[4],e=b[5],l=b[6],n=b[7],b=b[8],m=c[0],c=c[1];a[0]=d;a[1]=f;a[2]=g;a[3]=i;a[4]=k;a[5]=e;a[6]=m*d+c*i+l;a[7]=m*f+c*k+n;a[8]=m*g+c*e+b;return a};h.rotate=function(a,b,c){var d=b[0],f=b[1],g=b[2],i=b[3],k=b[4],e=b[5],l=b[6],n=b[7],b=b[8],m=Math.sin(c),c=Math.cos(c);a[0]=c*d+m*i;a[1]=c*f+m*k;a[2]=c*g+m*e;a[3]=
c*i-m*d;a[4]=c*k-m*f;a[5]=c*e-m*g;a[6]=l;a[7]=n;a[8]=b;return a};h.scale=function(a,b,c){var d=c[0],c=c[1];a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=c*b[3];a[4]=c*b[4];a[5]=c*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};h.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};h.fromQuat=function(a,b){var c=b[0],d=b[1],f=b[2],g=b[3],i=c+c,k=d+d,e=f+f,c=c*i,l=d*i,d=d*k,n=f*i,m=f*k,f=f*e,i=g*i,k=g*k,g=g*e;a[0]=1-d-f;a[3]=l-g;a[6]=n+k;a[1]=l+
g;a[4]=1-c-f;a[7]=m-i;a[2]=n-k;a[5]=m+i;a[8]=1-c-d;return a};h.normalFromMat4=function(a,b){var c=b[0],d=b[1],f=b[2],g=b[3],i=b[4],k=b[5],e=b[6],l=b[7],n=b[8],m=b[9],h=b[10],r=b[11],p=b[12],q=b[13],j=b[14],A=b[15],B=c*k-d*i,G=c*e-f*i,E=c*l-g*i,F=d*e-f*k,I=d*l-g*k,L=f*l-g*e,M=n*q-m*p,N=n*j-h*p,n=n*A-r*p,O=m*j-h*q,m=m*A-r*q,h=h*A-r*j,r=B*h-G*m+E*O+F*n-I*N+L*M;if(!r)return null;r=1/r;a[0]=(k*h-e*m+l*O)*r;a[1]=(e*n-i*h-l*N)*r;a[2]=(i*m-k*n+l*M)*r;a[3]=(f*m-d*h-g*O)*r;a[4]=(c*h-f*n+g*N)*r;a[5]=(d*n-c*
m-g*M)*r;a[6]=(q*L-j*I+A*F)*r;a[7]=(j*E-p*L-A*G)*r;a[8]=(p*I-q*E+A*B)*r;return a};h.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};h.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};if(typeof a!=="undefined")a.mat3=h;var p={create:function(){var a=new d(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=
0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){var b=new d(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];
return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(a===b){var c=b[1],d=b[2],f=b[3],g=b[6],i=b[7],k=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=d;a[9]=g;a[11]=b[14];a[12]=f;a[13]=i;a[14]=k}else{a[0]=b[0];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=b[1];a[5]=b[5];a[6]=b[9];a[7]=b[13];a[8]=b[2];a[9]=b[6];a[10]=b[10];a[11]=b[14];a[12]=b[3];a[13]=b[7];
a[14]=b[11];a[15]=b[15]}return a},invert:function(a,b){var c=b[0],d=b[1],f=b[2],g=b[3],i=b[4],k=b[5],e=b[6],l=b[7],n=b[8],m=b[9],h=b[10],r=b[11],p=b[12],q=b[13],j=b[14],A=b[15],B=c*k-d*i,G=c*e-f*i,E=c*l-g*i,F=d*e-f*k,I=d*l-g*k,L=f*l-g*e,M=n*q-m*p,N=n*j-h*p,O=n*A-r*p,S=m*j-h*q,T=m*A-r*q,U=h*A-r*j,K=B*U-G*T+E*S+F*O-I*N+L*M;if(!K)return null;K=1/K;a[0]=(k*U-e*T+l*S)*K;a[1]=(f*T-d*U-g*S)*K;a[2]=(q*L-j*I+A*F)*K;a[3]=(h*I-m*L-r*F)*K;a[4]=(e*O-i*U-l*N)*K;a[5]=(c*U-f*O+g*N)*K;a[6]=(j*E-p*L-A*G)*K;a[7]=(n*
L-h*E+r*G)*K;a[8]=(i*T-k*O+l*M)*K;a[9]=(d*O-c*T-g*M)*K;a[10]=(p*I-q*E+A*B)*K;a[11]=(m*E-n*I-r*B)*K;a[12]=(k*N-i*S-e*M)*K;a[13]=(c*S-d*N+f*M)*K;a[14]=(q*G-p*F-j*B)*K;a[15]=(n*F-m*G+h*B)*K;return a},adjoint:function(a,b){var c=b[0],d=b[1],f=b[2],g=b[3],i=b[4],k=b[5],e=b[6],l=b[7],n=b[8],m=b[9],h=b[10],r=b[11],p=b[12],q=b[13],j=b[14],A=b[15];a[0]=k*(h*A-r*j)-m*(e*A-l*j)+q*(e*r-l*h);a[1]=-(d*(h*A-r*j)-m*(f*A-g*j)+q*(f*r-g*h));a[2]=d*(e*A-l*j)-k*(f*A-g*j)+q*(f*l-g*e);a[3]=-(d*(e*r-l*h)-k*(f*r-g*h)+m*(f*
l-g*e));a[4]=-(i*(h*A-r*j)-n*(e*A-l*j)+p*(e*r-l*h));a[5]=c*(h*A-r*j)-n*(f*A-g*j)+p*(f*r-g*h);a[6]=-(c*(e*A-l*j)-i*(f*A-g*j)+p*(f*l-g*e));a[7]=c*(e*r-l*h)-i*(f*r-g*h)+n*(f*l-g*e);a[8]=i*(m*A-r*q)-n*(k*A-l*q)+p*(k*r-l*m);a[9]=-(c*(m*A-r*q)-n*(d*A-g*q)+p*(d*r-g*m));a[10]=c*(k*A-l*q)-i*(d*A-g*q)+p*(d*l-g*k);a[11]=-(c*(k*r-l*m)-i*(d*r-g*m)+n*(d*l-g*k));a[12]=-(i*(m*j-h*q)-n*(k*j-e*q)+p*(k*h-e*m));a[13]=c*(m*j-h*q)-n*(d*j-f*q)+p*(d*h-f*m);a[14]=-(c*(k*j-e*q)-i*(d*j-f*q)+p*(d*e-f*k));a[15]=c*(k*h-e*m)-i*
(d*h-f*m)+n*(d*e-f*k);return a},determinant:function(a){var b=a[0],c=a[1],d=a[2],f=a[3],g=a[4],i=a[5],k=a[6],e=a[7],l=a[8],n=a[9],m=a[10],h=a[11],r=a[12],p=a[13],q=a[14],a=a[15];return(b*i-c*g)*(m*a-h*q)-(b*k-d*g)*(n*a-h*p)+(b*e-f*g)*(n*q-m*p)+(c*k-d*i)*(l*a-h*r)-(c*e-f*i)*(l*q-m*r)+(d*e-f*k)*(l*p-n*r)},multiply:function(a,b,c){var d=b[0],f=b[1],g=b[2],i=b[3],k=b[4],e=b[5],l=b[6],n=b[7],m=b[8],h=b[9],r=b[10],p=b[11],q=b[12],j=b[13],A=b[14],b=b[15],B=c[0],G=c[1],E=c[2],F=c[3];a[0]=B*d+G*k+E*m+F*q;
a[1]=B*f+G*e+E*h+F*j;a[2]=B*g+G*l+E*r+F*A;a[3]=B*i+G*n+E*p+F*b;B=c[4];G=c[5];E=c[6];F=c[7];a[4]=B*d+G*k+E*m+F*q;a[5]=B*f+G*e+E*h+F*j;a[6]=B*g+G*l+E*r+F*A;a[7]=B*i+G*n+E*p+F*b;B=c[8];G=c[9];E=c[10];F=c[11];a[8]=B*d+G*k+E*m+F*q;a[9]=B*f+G*e+E*h+F*j;a[10]=B*g+G*l+E*r+F*A;a[11]=B*i+G*n+E*p+F*b;B=c[12];G=c[13];E=c[14];F=c[15];a[12]=B*d+G*k+E*m+F*q;a[13]=B*f+G*e+E*h+F*j;a[14]=B*g+G*l+E*r+F*A;a[15]=B*i+G*n+E*p+F*b;return a}};p.mul=p.multiply;p.translate=function(a,b,c){var d=c[0],f=c[1],c=c[2],g,i,k,e,l,
n,m,h,r,p,q,j;if(b===a){a[12]=b[0]*d+b[4]*f+b[8]*c+b[12];a[13]=b[1]*d+b[5]*f+b[9]*c+b[13];a[14]=b[2]*d+b[6]*f+b[10]*c+b[14];a[15]=b[3]*d+b[7]*f+b[11]*c+b[15]}else{g=b[0];i=b[1];k=b[2];e=b[3];l=b[4];n=b[5];m=b[6];h=b[7];r=b[8];p=b[9];q=b[10];j=b[11];a[0]=g;a[1]=i;a[2]=k;a[3]=e;a[4]=l;a[5]=n;a[6]=m;a[7]=h;a[8]=r;a[9]=p;a[10]=q;a[11]=j;a[12]=g*d+l*f+r*c+b[12];a[13]=i*d+n*f+p*c+b[13];a[14]=k*d+m*f+q*c+b[14];a[15]=e*d+h*f+j*c+b[15]}return a};p.scale=function(a,b,c){var d=c[0],f=c[1],c=c[2];a[0]=b[0]*d;
a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;a[4]=b[4]*f;a[5]=b[5]*f;a[6]=b[6]*f;a[7]=b[7]*f;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};p.rotate=function(a,b,d,f){var g=f[0],i=f[1],f=f[2],k=Math.sqrt(g*g+i*i+f*f),e,l,n,m,h,r,p,q,j,R,A,B,G,E,F,I,L,M,N,O;if(Math.abs(k)<c)return null;k=1/k;g=g*k;i=i*k;f=f*k;e=Math.sin(d);l=Math.cos(d);n=1-l;d=b[0];k=b[1];m=b[2];h=b[3];r=b[4];p=b[5];q=b[6];j=b[7];R=b[8];A=b[9];B=b[10];G=b[11];E=g*g*n+l;F=i*g*n+
f*e;I=f*g*n-i*e;L=g*i*n-f*e;M=i*i*n+l;N=f*i*n+g*e;O=g*f*n+i*e;g=i*f*n-g*e;i=f*f*n+l;a[0]=d*E+r*F+R*I;a[1]=k*E+p*F+A*I;a[2]=m*E+q*F+B*I;a[3]=h*E+j*F+G*I;a[4]=d*L+r*M+R*N;a[5]=k*L+p*M+A*N;a[6]=m*L+q*M+B*N;a[7]=h*L+j*M+G*N;a[8]=d*O+r*g+R*i;a[9]=k*O+p*g+A*i;a[10]=m*O+q*g+B*i;a[11]=h*O+j*g+G*i;if(b!==a){a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}return a};p.rotateX=function(a,b,c){var d=Math.sin(c),c=Math.cos(c),f=b[4],g=b[5],i=b[6],k=b[7],e=b[8],l=b[9],n=b[10],m=b[11];if(b!==a){a[0]=b[0];a[1]=b[1];
a[2]=b[2];a[3]=b[3];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}a[4]=f*c+e*d;a[5]=g*c+l*d;a[6]=i*c+n*d;a[7]=k*c+m*d;a[8]=e*c-f*d;a[9]=l*c-g*d;a[10]=n*c-i*d;a[11]=m*c-k*d;return a};p.rotateY=function(a,b,c){var d=Math.sin(c),c=Math.cos(c),f=b[0],g=b[1],i=b[2],k=b[3],e=b[8],l=b[9],n=b[10],m=b[11];if(b!==a){a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}a[0]=f*c-e*d;a[1]=g*c-l*d;a[2]=i*c-n*d;a[3]=k*c-m*d;a[8]=f*d+e*c;a[9]=g*d+l*c;a[10]=i*d+n*c;a[11]=k*d+m*
c;return a};p.rotateZ=function(a,b,c){var d=Math.sin(c),c=Math.cos(c),f=b[0],g=b[1],i=b[2],k=b[3],e=b[4],l=b[5],n=b[6],m=b[7];if(b!==a){a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}a[0]=f*c+e*d;a[1]=g*c+l*d;a[2]=i*c+n*d;a[3]=k*c+m*d;a[4]=e*c-f*d;a[5]=l*c-g*d;a[6]=n*c-i*d;a[7]=m*c-k*d;return a};p.fromRotationTranslation=function(a,b,c){var d=b[0],f=b[1],g=b[2],i=b[3],k=d+d,e=f+f,l=g+g,b=d*k,n=d*e,d=d*l,m=f*e,f=f*l,g=g*l,k=i*k,e=i*e,i=i*l;a[0]=1-(m+g);
a[1]=n+i;a[2]=d-e;a[3]=0;a[4]=n-i;a[5]=1-(b+g);a[6]=f+k;a[7]=0;a[8]=d+e;a[9]=f-k;a[10]=1-(b+m);a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};p.fromQuat=function(a,b){var c=b[0],d=b[1],f=b[2],g=b[3],i=c+c,k=d+d,e=f+f,c=c*i,l=d*i,d=d*k,n=f*i,m=f*k,f=f*e,i=g*i,k=g*k,g=g*e;a[0]=1-d-f;a[1]=l+g;a[2]=n-k;a[3]=0;a[4]=l-g;a[5]=1-c-f;a[6]=m+i;a[7]=0;a[8]=n+k;a[9]=m-i;a[10]=1-c-d;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};p.frustum=function(a,b,c,d,f,g,i){var k=1/(c-b),e=1/(f-d),l=1/(g-i);
a[0]=g*2*k;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=g*2*e;a[6]=0;a[7]=0;a[8]=(c+b)*k;a[9]=(f+d)*e;a[10]=(i+g)*l;a[11]=-1;a[12]=0;a[13]=0;a[14]=i*g*2*l;a[15]=0;return a};p.perspective=function(a,b,c,d,f){var b=1/Math.tan(b/2),g=1/(d-f);a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(f+d)*g;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*f*d*g;a[15]=0;return a};p.ortho=function(a,b,c,d,f,g,i){var k=1/(b-c),e=1/(d-f),l=1/(g-i);a[0]=-2*k;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*e;a[6]=0;a[7]=0;a[8]=
0;a[9]=0;a[10]=2*l;a[11]=0;a[12]=(b+c)*k;a[13]=(f+d)*e;a[14]=(i+g)*l;a[15]=1;return a};p.lookAt=function(a,b,d,f){var g,i,k,e,l,n,m,h,r=b[0],q=b[1],b=b[2];k=f[0];e=f[1];i=f[2];m=d[0];f=d[1];g=d[2];if(Math.abs(r-m)<c&&Math.abs(q-f)<c&&Math.abs(b-g)<c)return p.identity(a);d=r-m;f=q-f;m=b-g;h=1/Math.sqrt(d*d+f*f+m*m);d=d*h;f=f*h;m=m*h;g=e*m-i*f;i=i*d-k*m;k=k*f-e*d;if(h=Math.sqrt(g*g+i*i+k*k)){h=1/h;g=g*h;i=i*h;k=k*h}else k=i=g=0;e=f*k-m*i;l=m*g-d*k;n=d*i-f*g;if(h=Math.sqrt(e*e+l*l+n*n)){h=1/h;e=e*h;
l=l*h;n=n*h}else n=l=e=0;a[0]=g;a[1]=e;a[2]=d;a[3]=0;a[4]=i;a[5]=l;a[6]=f;a[7]=0;a[8]=k;a[9]=n;a[10]=m;a[11]=0;a[12]=-(g*r+i*q+k*b);a[13]=-(e*r+l*q+n*b);a[14]=-(d*r+f*q+m*b);a[15]=1;return a};p.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};p.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],
2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};if(typeof a!=="undefined")a.mat4=p;var q={create:function(){var a=new d(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}};q.rotationTo=function(){var a=l.create(),b=l.fromValues(1,0,0),c=l.fromValues(0,1,0);return function(d,f,g){var i=l.dot(f,g);if(i<-0.999999){l.cross(a,b,f);l.length(a)<1.0E-6&&l.cross(a,c,f);
l.normalize(a,a);q.setAxisAngle(d,a,Math.PI);return d}if(i>0.999999){d[0]=0;d[1]=0;d[2]=0;d[3]=1;return d}l.cross(a,f,g);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=1+i;return q.normalize(d,d)}}();q.setAxes=function(){var a=h.create();return function(b,c,d,f){a[0]=d[0];a[3]=d[1];a[6]=d[2];a[1]=f[0];a[4]=f[1];a[7]=f[2];a[2]=-c[0];a[5]=-c[1];a[8]=-c[2];return q.normalize(b,q.fromMat3(b,a))}}();q.clone=m.clone;q.fromValues=m.fromValues;q.copy=m.copy;q.set=m.set;q.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=
1;return a};q.setAxisAngle=function(a,b,c){var c=c*0.5,d=Math.sin(c);a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=Math.cos(c);return a};q.add=m.add;q.multiply=function(a,b,c){var d=b[0],f=b[1],g=b[2],b=b[3],i=c[0],k=c[1],e=c[2],c=c[3];a[0]=d*c+b*i+f*e-g*k;a[1]=f*c+b*k+g*i-d*e;a[2]=g*c+b*e+d*k-f*i;a[3]=b*c-d*i-f*k-g*e;return a};q.mul=q.multiply;q.scale=m.scale;q.rotateX=function(a,b,c){var c=c*0.5,d=b[0],f=b[1],g=b[2],b=b[3],i=Math.sin(c),c=Math.cos(c);a[0]=d*c+b*i;a[1]=f*c+g*i;a[2]=g*c-f*i;a[3]=b*c-d*
i;return a};q.rotateY=function(a,b,c){var c=c*0.5,d=b[0],f=b[1],g=b[2],b=b[3],i=Math.sin(c),c=Math.cos(c);a[0]=d*c-g*i;a[1]=f*c+b*i;a[2]=g*c+d*i;a[3]=b*c-f*i;return a};q.rotateZ=function(a,b,c){var c=c*0.5,d=b[0],f=b[1],g=b[2],b=b[3],i=Math.sin(c),c=Math.cos(c);a[0]=d*c+f*i;a[1]=f*c-d*i;a[2]=g*c+b*i;a[3]=b*c-g*i;return a};q.calculateW=function(a,b){var c=b[0],d=b[1],f=b[2];a[0]=c;a[1]=d;a[2]=f;a[3]=Math.sqrt(Math.abs(1-c*c-d*d-f*f));return a};q.dot=m.dot;q.lerp=m.lerp;q.slerp=function(a,b,c,d){var f=
b[0],g=b[1],i=b[2],b=b[3],k=c[0],e=c[1],l=c[2],c=c[3],n,m,h;m=f*k+g*e+i*l+b*c;if(m<0){m=-m;k=-k;e=-e;l=-l;c=-c}if(1-m>1.0E-6){n=Math.acos(m);h=Math.sin(n);m=Math.sin((1-d)*n)/h;d=Math.sin(d*n)/h}else m=1-d;a[0]=m*f+d*k;a[1]=m*g+d*e;a[2]=m*i+d*l;a[3]=m*b+d*c;return a};q.invert=function(a,b){var c=b[0],d=b[1],f=b[2],g=b[3],i=c*c+d*d+f*f+g*g,i=i?1/i:0;a[0]=-c*i;a[1]=-d*i;a[2]=-f*i;a[3]=g*i;return a};q.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a};q.length=m.length;q.len=
q.length;q.squaredLength=m.squaredLength;q.sqrLen=q.squaredLength;q.normalize=m.normalize;q.fromMat3=function(a,b){var c=b[0]+b[4]+b[8];if(c>0){c=Math.sqrt(c+1);a[3]=0.5*c;c=0.5/c;a[0]=(b[5]-b[7])*c;a[1]=(b[6]-b[2])*c;a[2]=(b[1]-b[3])*c}else{var d=0;b[4]>b[0]&&(d=1);b[8]>b[d*3+d]&&(d=2);var f=(d+1)%3,g=(d+2)%3,c=Math.sqrt(b[d*3+d]-b[f*3+f]-b[g*3+g]+1);a[d]=0.5*c;c=0.5/c;a[3]=(b[f*3+g]-b[g*3+f])*c;a[f]=(b[f*3+d]+b[d*3+f])*c;a[g]=(b[g*3+d]+b[d*3+g])*c}return a};q.str=function(a){return"quat("+a[0]+
", "+a[1]+", "+a[2]+", "+a[3]+")"};if(typeof a!=="undefined")a.quat=q})(d)})(this)},{}],2:[function(h,j){function e(){if(!c){c=!0;for(var a,d=b.length;d;){a=b;b=[];for(var k=-1;++k<d;)a[k]();d=b.length}c=!1}}function a(){}var d=j.exports={},b=[],c=!1;d.nextTick=function(a){b.push(a);c||setTimeout(e,0)};d.title="browser";d.browser=!0;d.env={};d.argv=[];d.version="";d.on=a;d.addListener=a;d.once=a;d.off=a;d.removeListener=a;d.removeAllListeners=a;d.emit=a;d.binding=function(){throw Error("process.binding is not supported");
};d.cwd=function(){return"/"};d.chdir=function(){throw Error("process.chdir is not supported");};d.umask=function(){return 0}},{}],3:[function(h,j){j.exports=h("./lib/")},{"./lib/":4}],4:[function(h,j){j.exports=function(){function e(a,c){if(null==a)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!==typeof c)throw new TypeError("predicate must be a function");for(var d=Object(a),f=d.length>>>0,k,i=0;i<f;i++)if(k=d[i],c.call(null,k,i,d))return k}var a=h("performance-now"),
d=function(a){a=a||{};this._units=[];for(var c=0;c<(a.units||8);c++)this._units[c]={slot:c,use:0}};d.NOT_FOUND=-1;d.FULL=-2;d.prototype={_set:function(a,c){var d=this._units[a];d.dispose&&d.dispose(d,this);c?(this._units[a]=c,this._units[a].slot=a):this._units[a]={slot:a,use:0}},bind:function(b,c){var c=c||{},g=!!c.fixed,f="function"==typeof c.dispose?c.dispose:null,k=this.get(b);if(k!==d.NOT_FOUND)return k;k=this._units.filter(function(a){return!a.fixed});if(!k.length)return d.FULL;k=k.reduce(function(a,
b){return a?b.use<a.use?b:a:b},null).slot;this._set(k,{fixed:g,use:a(),id:b,dispose:f});return k},dispose:function(a){this._set(this.getEntry(a).slot,null)},has:function(a){return!!this.getEntry(a)},get:function(b){return(b=this.getEntry(b))?(b.use=a(),b.slot):d.NOT_FOUND},use:function(b){if(b=this.getEntry(b))b.use=a()},getEntry:function(a){return e(this._units,function(c){return c.id===a})}};return{SimpleTextureManager:d}}()},{"performance-now":5}],5:[function(h,j){(function(e){(function(){var a,
d,b;"undefined"!==typeof performance&&null!==performance&&performance.now?j.exports=function(){return performance.now()}:"undefined"!==typeof e&&null!==e&&e.hrtime?(j.exports=function(){return(a()-b)/1E6},d=e.hrtime,a=function(){var a;a=d();return 1E9*a[0]+a[1]},b=a()):Date.now?(j.exports=function(){return Date.now()-b},b=Date.now()):(j.exports=function(){return(new Date).getTime()-b},b=(new Date).getTime())}).call(this)}).call(this,h("_process"))},{_process:2}],6:[function(h,j){function e(a,b){this.message=
a;this.node=b}function a(b){b.srcAsset&&a(b.srcAsset);for(var c=[],d=0;d<b.children.length;++d){var f=b.children[d],g=f.name;if(g&&-1!=c.indexOf(g))throw new e("Two subdata elements with the same name: '"+g+"'",f.refNode);g&&c.push(g)}for(d=0;d<b.subAssets.length;++d)a(b.subAssets[d])}function d(a){a.assetResult&&(a.assetResult=null);for(var b=a.listener,c=0;c<b.length;++c)b[c].onAssetChange&&b[c].onAssetChange(this);for(c=a.parents.length;c--;)d(a.parents[c])}function b(a){var c=a.loading?a.loadLevel:
Infinity;c&&a.srcAsset&&(c=Math.min(c,Math.max(a.srcAsset.loadLevel,a.srcAsset.progressLevel)));for(var d=a.subAssets.length;c&&d--;)c=Math.min(c,Math.max(a.subAssets[d].loadLevel,a.subAssets[d].progressLevel));for(d=a.children.length;c&&d--;)c=Math.min(c,a.children[d].progressLevel);d=a.progressLevel;a.progressLevel=c;if(d!=a.progressLevel){a._callLoadListeners(a.progressLevel,d);for(d=0;d<a.parents.length;++d)b(a.parents[d])}}function c(a){a.assetParent&&d(a.assetParent)}function g(a,b){for(var c=
0;c<b.length;++c)f(a,b[c])}function f(a,b){var c=b.subdata;c.isMesh()==a.isMesh()&&b.filter.check(a)&&a.pushPostEntry(c)}function k(a,b,c){if(0<b.matchEntries.length)for(var d=a.allEntries.length;d--;){var f=a.allEntries[d];(!f.name||!b.namedEntries[f.name])&&g(f,b.matchEntries)}for(d=b.allEntries.length;d--;){var f=b.allEntries[d],k,e=!1;f.name&&a.namedEntries[f.name]?k=a.namedEntries[f.name]:(k=new m,e=!0,a.allEntries.push(k));k.pushTableEntry(f);e&&g(k,a.matchEntries);k.name&&(a.namedEntries[k.name]=
k)}a.matchEntries.push.apply(a.matchEntries,b.matchEntries);for(d=b.allSubResults.length;d--;)i(a,b.allSubResults[d]);c&&b.pickFilter?(a.pickFilter=new r,a.pickFilter.intersection(c,b.pickFilter)):a.pickFilter=c||b.pickFilter;b.shader&&(a.shader=b.shader);b.transform&&(a.transform=b.transform)}function i(a,b){var c;b.name&&a.namedSubResults[b.name]?c=a.namedSubResults[b.name]:(c=new u,c.parentResult=a,c.name=b.name,a.allSubResults.push(c),c.name&&(a.namedSubResults[c.name]=c));k(c,b,c.pickFilter)}
function n(a){for(var b={meshes:[],groups:[],transform:a.transform,shader:a.shader,postTransformXflowNode:null},c=0;c<a.allEntries.length;++c){var d=a.allEntries[c];if(d.meshType&&(!a.pickFilter||a.pickFilter.check(d)))l(a,d),b.meshes.push({xflowNode:d.accumulatedXflowNode,type:d.meshType,shader:d.shader,transform:d.transform,refNode:d.refNode})}if(c=a.namedEntries._postTransform)l(a,c),b.postTransformXflowNode=c.accumulatedXflowNode;for(c=0;c<a.allSubResults.length;++c)d=n(a.allSubResults[c]),b.groups.push(d);
return b}function l(a,b){if(b.outOfSync){b.accumulatedXflowNode?(b.accumulatedXflowNode.clearChildren(),b.accumulatedXflowNode.setCompute(""),b.accumulatedXflowNode.setFilter(""),b.accumulatedXflowNode.dataflowNode=null,b.accumulatedXflowNode.setLoading(!1)):b.accumulatedXflowNode=new q(!1);for(var c=1==b.postQueue.length?b.accumulatedXflowNode:new q(!1),d=0;d<b.postQueue.length;++d){for(var f=b.postQueue[d].includes,g=0;g<f.length;++g){for(var i=a,k=f[g],e=k.split("."),n=0;n<e.length-1;++n){var m=
e[n];if("parent"==m){if(!i.parentResult)throw Error("Includes entry '"+k+"' (token "+n+") accesses non existent parent.");i=i.parentResult}else{if(!i.namedSubResults[m])throw Error("Includes entry '"+k+"' (token "+n+") accesses non existent sub result '"+m+"'");i=i.namedSubResults[m]}}e=e[e.length-1];n=i.namedEntries[e];if(!n)throw Error("Includes entry '"+k+"' accesses non existent asset entry '"+e+"'");v.push(k);if(-1!=t.indexOf(n))throw d=v.join(" > "),Error("Recursive include dependencies detected: "+
d);t.push(n);l(i,n);t.pop();v.pop();c.appendChild(n.accumulatedXflowNode)}b.postQueue[d].xflowNode&&c.appendChild(b.postQueue[d].xflowNode)}f=null;for(d=0;d<b.postQueue.length;++d)g=b.postQueue[d],c||(c=d==b.postQueue.length-1?b.accumulatedXflowNode:new q(!1)),c.setCompute(g.compute),c.setFilter(g.filter),c.dataflowNode=g.dataflow,c.setLoading(g.dataflowLoading),f&&c.appendChild(f),f=c,c=null;b.outOfSync=!1}}function m(a){this.name=null;this.classNames=[];this.meshType=null;this.postQueue=[];this.accumulatedXflowNode=
this.transform=this.shader=null;this.outOfSync=!0;this.refNode=null;a&&(this.name=a.name,p.add(this.classNames,a.classNames))}function r(){this.all=!1;this.names=[];this.classNames=[]}var p=h("../xflow/utils/utils.js").set,q=h("../xflow/interface/graph.js").DataNode,o=function(a){this.srcAsset=this.name=null;this.children=[];this.subAssets=[];this.pickFilter=null;this.parents=[];this.listener=[];this.loading=!1;this.refNode=a||null;this.assetResult=this.transform=this.shader=null;this.loadLevel=0;
this.progressLevel=Infinity};o.prototype.checkValidity=function(){this.isSubtreeLoading()||a(this)};o.prototype.setLoading=function(a){a!=this.loading&&(this.loading=a,b(this),d(this))};o.prototype.isSubtreeLoading=function(){return 0==this.progressLevel};o.prototype.getProgressLevel=function(){return this.progressLevel};o.prototype.setName=function(a){this.name=a;d(this)};o.prototype.setShader=function(a){this.shader=a;d(this)};o.prototype.setTransform=function(a){this.transform=a;"model"!==this.refNode.localName.toLowerCase()&&
d(this)};o.prototype.appendChild=function(a){this.children.push(a);a.assetParent=this;b(this);d(this)};o.prototype.setPickFilter=function(a){"string"==typeof a?(this.pickFilter=new r,this.pickFilter.parse(a)):this.pickFilter=null;d(this)};o.prototype.appendSubAsset=function(a){a._addParent(this);this.subAssets.push(a);b(this);d(this)};o.prototype.setSrcAsset=function(a){this.srcAsset&&this.srcAsset._removeParent(this);(this.srcAsset=a)&&this.srcAsset._addParent(this);b(this);d(this)};o.prototype.clearChildren=
function(){for(var a=this.children.length;a--;)this.children[a].assetParent=null;this.children=[];b(this);d(this)};o.prototype.clearSubAssets=function(){for(var a=this.subAssets.length;a--;)this.subAssets[a]._removeParent(this);this.subAssets.length=0;b(this);d(this)};o.prototype._addParent=function(a){this.parents.push(a)};o.prototype._removeParent=function(a){a=this.parents.indexOf(a);-1!=a&&this.parents.splice(a,1)};o.prototype._callLoadListeners=function(a,b){for(var c=this.listener,d=0;d<c.length;++d)c[d].onAssetLoadChange&&
c[d].onAssetLoadChange(this,a,b)};o.prototype.addChangeListener=function(a){p.add(this.listener,a)};o.prototype.removeChangeListener=function(a){p.remove(this.listener,a)};o.prototype.getResult=function(){this.assetResult||(this.assetResult=new u,this.assetResult.construct(this));return this.assetResult};var s=function(a,b,c){this.xflowNodeOut=a;this.xflowNodeIn=b;this.refNode=c||null;this.matchFilter=this.name=null;this.classNames=[];this.postFilter=this.postCompute=this.postDataflow=null;this.includes=
[];this.assetParent=this.meshType=this.transform=this.shader=null;this.loading=!1;this.loadLevel=0;this.progressLevel=Infinity;b.addLoadListener(this.onXflowLoadEvent.bind(this));this._updateLoadingState()};s.prototype.setLoading=function(a){a!=this.loading&&(this.loading=a,this._updateLoadingState(),c(this))};s.prototype._updateLoadingState=function(){var a=this.loading?this.loadLevel:Infinity,a=Math.min(a,this.xflowNodeIn.getProgressLevel()),d=this.progressLevel;this.progressLevel=a;d!=this.progressLevel&&
(this.assetParent&&b(this.assetParent),c(this))};s.prototype.onXflowLoadEvent=function(){this._updateLoadingState()};s.prototype.isSubtreeLoading=function(){return this.loading};s.prototype.isMesh=function(){return!!this.meshType};s.prototype.setName=function(a){this.name=a;c(this)};s.prototype.setMatchFilter=function(a){"string"==typeof a?(this.matchFilter=new r,this.matchFilter.parse(a)):this.matchFilter=null;c(this)};s.prototype.setClassNames=function(a){this.classNames=a;c(this)};s.prototype.setClassNamesString=
function(a){if(a){for(var a=a.split(/\s+/),b=a.length;b--;)a[b]=a[b].trim();this.setClassNames(a)}else this.setClassNames([])};s.prototype.setPostDataflow=function(a){this.postDataflow=a;c(this)};s.prototype.setPostCompute=function(a){this.postCompute=a;c(this)};s.prototype.setPostFilter=function(a){this.postFilter=a;c(this)};s.prototype.setIncludes=function(a){this.includes=a;c(this)};s.prototype.setShader=function(a){this.shader=a;c(this)};s.prototype.setTransform=function(a){this.transform=a;c(this)};
s.prototype.setMeshType=function(a){this.meshType=a;c(this)};var u=function(){this.name=this.parentResult=null;this.namedEntries={};this.allEntries=[];this.matchEntries=[];this.namedSubResults={};this.allSubResults=[];this.pickFilter=this.transform=this.shader=null};u.prototype.construct=function(a){this.name=a.name;var b=a.srcAsset;b&&b.getResult()?k(this,b.getResult(),a.pickFilter):this.pickFilter=a.pickFilter;a.shader&&(this.shader=a.shader);a.transform&&(this.transform=a.transform);for(var c=
a.subAssets,b=c.length;b--;){var d=c[b].getResult();i(this,d)}c=[];a=a.children;for(b=0;b<a.length;++b){var d=a[b],e=d.name,l;d.name&&d.matchFilter&&XML3D.debug.logWarning("Asset entry defines both name and match attribute. Match attribute will be ignored",d.refNode);if(e)this.namedEntries[e]?l=this.namedEntries[e]:(l=new m(d),g(l,this.matchEntries),this.namedEntries[e]=l,this.allEntries.push(l));else if(d.matchFilter){c.push(d);continue}else l=new m(d),g(l,this.matchEntries),this.allEntries.push(l);
l.pushPostEntry(d)}for(b=0;b<c.length;++b){d=c[b];a={filter:d.matchFilter,subdata:d};this.matchEntries.push(a);for(d=0;d<this.allEntries.length;++d)f(this.allEntries[d],a)}};u.prototype.getDataTree=function(){return n(this)};var t=[],v=[];m.prototype.isMesh=function(){return!!this.meshType};m.prototype.pushTableEntry=function(a){this.name=a.name;p.add(this.classNames,a.classNames);a.meshType&&(this.meshType=a.meshType);a.transform&&(this.transform=a.transform);a.shader&&(this.shader=a.shader);this.postQueue.push.apply(this.postQueue,
a.postQueue)};m.prototype.pushPostEntry=function(a){this.name=a.name;this.postQueue.push({dataflow:a.postDataflow,dataflowLoading:a.loading,compute:a.postCompute,filter:a.postFilter,includes:a.includes,xflowNode:a.xflowNodeIn});this.refNode=a.refNode;this.accumulatedXflowNode=a.xflowNodeOut;p.add(this.classNames,a.classNames);a.meshType&&(this.meshType=a.meshType);a.shader&&(this.shader=a.shader);a.transform&&(this.transform=a.transform)};r.prototype.parse=function(a){for(var a=a.split(","),b=a.length;b--;){var c=
a[b].trim();if("*"==c)this.all=!0;else if(0==c.indexOf(".")){for(var c=c.split("."),d=c.length;d--;)c[d].trim()||c.splice(d,1);this.classNames.push(c)}else p.add(this.names,c)}};r.prototype.intersection=function(a,b){p.intersection(this.names,a.names,b.names);p.intersection(this.classNames,a.classNames,b.classNames)};r.prototype.check=function(a){if(this.all)return!0;if(0<a.classNames.length)for(var b=this.classNames.length;b--;)if(p.isSubset(this.classNames[b],a.classNames))return!0;return a.name&&
-1!=this.names.indexOf(a.name)};j.exports={Asset:o,SubData:s,AssetResult:u}},{"../xflow/interface/graph.js":138,"../xflow/utils/utils.js":187}],7:[function(h,j){function e(a){for(var c in this.connectedAdapterHandles)this.connectedAdapterHandles[c]==a.adapterHandle&&this.notifyChanged(new b.ConnectedAdapterNotification(a,c))}var a=h("./resourcemanager.js").registerFactory,d=h("./resourcemanager.js").Resource,b=h("../interface/notification.js"),c=h("../interface/elements.js").config,g=function(a){this.factory=
a};g.prototype.connectAdapterHandle=function(a,b){this.connectedAdapterHandles||(this.connectedAdapterHandles={},this._bindedAdapterHandleCallback=e.bind(this));this.disconnectAdapterHandle(a);b?(this.connectedAdapterHandles[a]=b,this.connectedAdapterHandles[a].addListener(this._bindedAdapterHandleCallback)):delete this.connectedAdapterHandles[a]};g.prototype.disconnectAdapterHandle=function(a){this.connectedAdapterHandles&&this.connectedAdapterHandles[a]&&(this.connectedAdapterHandles[a].removeListener(this._bindedAdapterHandleCallback),
delete this.connectedAdapterHandles[a])};g.prototype.clearAdapterHandles=function(){for(var a in this.connectedAdapterHandles)this.connectedAdapterHandles[a].removeListener(this._bindedAdapterHandleCallback);this.connectedAdapterHandles=null};g.prototype.getConnectedAdapterHandle=function(a){return this.connectedAdapterHandles&&this.connectedAdapterHandles[a]};g.prototype.getConnectedAdapter=function(a){return(a=this.getConnectedAdapterHandle(a))&&a.getAdapter()};g.prototype.onDispose=function(){};
var f=function(a,b){this.factory=a;this.node=b};XML3D.createClass(f,g);f.prototype.init=function(){};f.prototype.notifyChanged=function(){};f.prototype.getAdapterHandle=function(a,b,c){c=void 0===c?this.factory.canvasId:c;return d.getAdapterHandle(this.node.ownerDocument._documentURL||this.node.ownerDocument.URL,a,b||this.factory.aspect,c)};f.prototype.notifyOppositeAdapters=function(a){a=a||b.ADAPTER_HANDLE_CHANGED;return d.notifyNodeAdapterChange(this.node,this.factory.aspect,this.factory.canvasId,
a)};f.prototype.traverse=function(a){a(this);for(var b=this.node.firstElementChild;b;){var c=this.factory.getAdapter(b);c&&c.traverse(a);b=b.nextElementSibling}};var k=function(b,c,d){this.aspect=b;this.canvasId=d||0;this.mimetypes="string"==typeof c?[c]:c;a(this)};k.prototype.createAdapter=function(){return null};k.prototype.supportsMimetype=function(a){return-1!=this.mimetypes.indexOf(a)};g=function(a,b){k.call(this,a,["text/xml","application/xml"],b)};XML3D.createClass(g,k);g.prototype.getAdapter=
function(a){a&&void 0===a._configured&&c.element(a);if(!a||void 0===a._configured)return null;var b=a._configured,d=this.aspect+"_"+this.canvasId,f=b.adapters[d];if(void 0!==f)return f;if(f=this.createAdapter(a))b.adapters[d]=f,f.init();return f};XML3D.resource.AdapterFactory=k;j.exports={NodeAdapter:f,AdapterFactory:k,NodeAdapterFactory:g}},{"../interface/elements.js":34,"../interface/notification.js":36,"./resourcemanager.js":10}],8:[function(h,j){var e=h("../interface/notification.js");"use strict";
var a=function(a){this.url=a;this.adapter=null;this.listeners=[];this.status=0};a.STATUS={LOADING:0,NOT_FOUND:1,READY:2};a.prototype.hasAdapter=function(){return null!=this.adapter};a.prototype.getAdapter=function(){return this.adapter};a.prototype.setAdapter=function(a,b){this.adapter=a;this.status=b;this.notifyListeners(e.ADAPTER_HANDLE_CHANGED)};a.prototype.notifyListeners=function(a){for(var a=new e.AdapterHandleNotification(this,a),b=this.listeners.length;b--;)this.listeners[b](a)};a.prototype.addListener=
function(a){-1==this.listeners.indexOf(a)&&this.listeners.push(a)};a.prototype.removeListener=function(a){a=this.listeners.indexOf(a);-1!=a&&this.listeners.splice(a,1)};j.exports=a},{"../interface/notification.js":36}],9:[function(h,j){var e=h("./adapter.js").AdapterFactory,a=h("./resourcemanager.js").registerFormat,d=h("../interface/elements.js").config,b=function(){this.factoryClasses={};this.factoryCache={}};b.prototype.registerFactoryClass=function(a){if(!a.prototype.aspect||!XML3D.isSuperclassOf(e,
a))throw Error("factoryClass must be a subclass of XML3D.base.AdapterFactory");this.factoryClasses[a.prototype.aspect]=a};b.prototype.getFactoryClassByAspect=function(a){return this.factoryClasses[a]};b.prototype.getFactory=function(a,b){var b=b||0,c=a+"_"+b,d=this.factoryCache[c];if(!d){d=this.getFactoryClassByAspect(a);if(!d)return null;d=new d(b);this.factoryCache[c]=d}return d};b.prototype.isFormatSupported=function(){return!1};b.prototype.getFormatData=function(a,b,c,d){d(!0,a)};b.prototype.getFragmentData=
function(a,b){return!b?a:null};var c=function(){b.call(this)};XML3D.createClass(c,b);c.prototype.isFormatSupported=function(a,b,c){return a&&9===a.nodeType&&c.match(/xml/)};c.prototype.getFormatData=function(a,b,c,d){d(!0,a)};c.prototype.getFragmentData=function(a,b){return a.querySelectorAll("*[id='"+b+"']")[0]};var g=function(){b.call(this)};XML3D.createClass(g,c);g.prototype.isFormatSupported=function(a){var b=[];a instanceof XMLDocument&&(b=a.getElementsByTagName("xml3d"),b.length||(b=a.getElementsByTagNameNS(XML3D.xml3dNS,
"xml3d")));return 0!==b.length};g.prototype.getFormatData=function(a,b,c,f){b=a.querySelectorAll("xml3d");for(c=0;c<b.length;++c)d.element(b[c]);f(!0,a)};var f=function(){b.call(this)};XML3D.createClass(f,b);f.prototype.isFormatSupported=function(a,b,c){return"application/json"===c};var k=new g;a(k);XML3D.xml3dFormatHandler=k;XML3D.resource.FormatHandler=b;XML3D.resource.JSONFormatHandler=f;j.exports={JSONFormatHandler:f,XMLFormatHandler:c,XML3DFormatHandler:g,FormatHandler:b,xml3dFormatHandler:k}},
{"../interface/elements.js":34,"./adapter.js":7,"./resourcemanager.js":10}],10:[function(h,j){function e(a){var b=v[a];b||(b={counter:0,listeners:[]},v[a]=b);return b}function a(a){for(var a=a.listeners,b=a.length;b--;)a[b](this)}function d(b){if(b=v[b])XML3D.debug.assert(0<b.counter,"counter must be > 0"),b.counter--,0==b.counter&&a(b)}function b(a){for(var b in z)if(a==z[b])return!0;return!1}function c(a){for(var b in y)if(-1!==a.indexOf(y[b],a.length-y[b].length))return!0;return!1}function g(a){var d=
null;try{d=new XMLHttpRequest}catch(g){d=null}d&&(d._url=a,d._contentChecked=!1,d.open("GET",a,!0),c(a)&&(d.responseType="arraybuffer"),d.onreadystatechange=function(){if(!d._aborted){if(!d._contentChecked&&(d.readyState==2||d.readyState==3||d.readyState==4)&&d.status==200){d._contentChecked=true;var a=d.getResponseHeader("content-type");if(a){a=b(a);if(a!=(d.responseType=="arraybuffer")){d._aborted=true;var c=d.onreadystatechange;d.onreadystatechange=null;var g=d._url;d.abort();d=new XMLHttpRequest;
d._url=g;d._contentChecked=true;d.open("GET",g,true);if(a)d.responseType="arraybuffer";d.onreadystatechange=c;d.send(null);return}}}if(d.readyState==4)if(d.status==200){XML3D.debug.logDebug("Loaded: "+d._url);XML3D.xmlHttpCallback&&XML3D.xmlHttpCallback(d);a=d;if(c=a.getResponseHeader("content-type"))f(a,a._url,c);else{XML3D.debug.logError("Could not load external document because the server did not provide a content-type header: "+a._url);k(a._url)}}else{XML3D.debug.logError("Could not load external document '"+
d._url+"': "+d.status+" - "+d.statusText);k(d._url)}}},d.send(null))}function f(a,b,c){var d=s[b],f=d.mimetype=c;0<c.indexOf(";")&&(f=c.substr(0,c.indexOf(";")));var g=null;if("arraybuffer"==a.responseType)g=a.response;else if("application/json"==f)g=JSON.parse(a.responseText);else if(f.match(/xml/)){if(g=a.responseXML,g._documentURL=b,!g){XML3D.debug.logError("Invalid external XML document '"+a._url+"': XML Syntax error");return}}else"application/octet-stream"==f||"text/plain; charset=x-user-defined"==
c?XML3D.debug.logError("Possibly wrong loading of resource "+b+". Mimetype is "+c+" but response is not an ArrayBuffer"):"application/javascript"==f||"text/javascript"==c||XML3D.debug.logError("Unidentified response type (response = '"+a.response+"', responseType = '"+a.responseType+"')"),g=a.response;(c=x(g,a.responseType,f))?(d.format=c,c.getFormatData(g,a.responseType,f,function(a,c){if(a){d.response=c;var f=s[b],g=f.fragments;f.fragments=[];for(f=0;f<g.length;++f)i(b,g[f])}else k(b)})):(XML3D.debug.logError("No format handler for resource (response = '"+
g+"', responseType = '"+a.responseType+"')"),k(b))}function k(a){var b=s[a],c=b.fragments;b.fragments=[];for(b=0;b<c.length;++b)l(a+(c[b]?"#"+c[b]:""))}function i(a,b){var c=s[a].response,d=s[a].format,f=a+(b?"#"+b:"");c?(c=d.getFragmentData(c,b))?n(f,d,c):l(f):l(f)}function n(a,b,c,f){for(var g in t[a])for(var i in t[a][g]){var k=t[a][g][i];k.hasAdapter()||(m(k,g,+i,b,c),f||d(i))}}function l(a){for(var b in t[a])for(var c in t[a][b])t[a][b][c].setAdapter(null,r.STATUS.NOT_FOUND),d(c)}function m(a,
b,c,d,f){(c=d.getFactory(b,c))?(b=c.getAdapter?c.getAdapter(f):c.createAdapter(f))&&a.setAdapter(b,r.STATUS.READY):XML3D.debug.logError("Format does not support adapterType "+b)}var r=h("./adapterhandle.js"),p=h("../utils/uri.js").URIResolver,q=h("../utils/uri.js").URI,o=h("../utils/options.js");o.register("resource-crossorigin-attribute","anonymous");var s={},u={},t={},v={},w=[],z=["application/octet-stream","text/plain; charset=x-user-defined"],y=[".bin",".bson"],x=function(a,b,c){for(var d=0;d<
w.length;++d){var f=w[d];if(w[d].isFormatSupported(a,b,c))return f}return null},C={isLoadComplete:function(a){a=v[a];return!a||0==a.counter},addLoadCompleteListener:function(a,b){var c=e(a);-1==c.listeners.indexOf(b)&&c.listeners.push(b)},removeLoadCompleteListener:function(a,b){var c=v[a];if(c){var d=c.listeners.indexOf(b);-1!=d&&c.listeners.splice(d,1)}},addBinaryContentType:function(a){-1==z.indexOf(a)&&z.push(a)},removeBinaryContentType:function(a){a=z.indexOf(a);-1!=a&&z.splice(a,1)},addBinaryExtension:function(a){-1==
y.indexOf(a)&&y.push(a)},removeBinaryExtension:function(a){a=y.indexOf(a);-1!=a&&y.splice(a,1)},getAbsoluteURI:function(a,b){if(!b)return null;"string"==typeof b&&(b=new q(b));if(a!=document.URL||!b.isLocal())b=b.getAbsoluteURI(a);return b},getAdapterHandle:function(a,b,c,d){d=d||0;b=C.getAbsoluteURI(a,b);if(!b)return null;t[b]||(t[b]={});t[b][c]||(t[b][c]={});if(a=t[b][c][d])return a;a=new r(b);t[b][c][d]=a;b.isLocal()?(b=p.resolveLocal(b))?m(a,c,d,XML3D.xml3dFormatHandler,b):a.setAdapter(null,r.STATUS.NOT_FOUND):
(e(d).counter++,c=b.toStringWithoutFragment(),(d=s[c])&&d.response?i(c,b.fragment):(d||(g(c),s[c]=d={fragments:[]}),d.fragments.push(b.fragment)));return a},getAdapter:function(a,b,c){return(b=XML3D.xml3dFormatHandler.getFactory(b,c))?b.getAdapter(a):null},notifyNodeIdChange:function(a,b,c){for(var d=a;d.parentNode;)d=d.parentNode;if(d==window.document){if(b){var b="#"+b,f;for(f in t[b])for(var g in t[b][f])d=t[b][f][g],d.hasAdapter()&&d.setAdapter(null,r.STATUS.NOT_FOUND)}c&&n("#"+c,XML3D.xml3dFormatHandler,
a,!0)}},notifyNodeAdapterChange:function(a,b,c,d){c=c||0;a="#"+a.id;t[a]&&t[a][b]&&t[a][b][c]&&t[a][b][c].notifyListeners(d)},loadData:function(a,d,f){var g=null;try{g=new XMLHttpRequest}catch(i){g=null}g&&(g._url=a,g._contentChecked=!1,g.open("GET",a,!0),c(a)&&(g.responseType="arraybuffer"),g.onreadystatechange=function(){if(!g._aborted){if(!g._contentChecked&&(g.readyState==2||g.readyState==3||g.readyState==4)&&g.status==200){g._contentChecked=true;var a=g.getResponseHeader("content-type");if(a){a=
b(a);if(a!=(g.responseType=="arraybuffer")){g._aborted=true;var c=g.onreadystatechange;g.onreadystatechange=null;var i=g._url;g.abort();g=new XMLHttpRequest;g._url=i;g._contentChecked=true;g.open("GET",i,true);if(a)g.responseType="arraybuffer";g.onreadystatechange=c;g.send(null);return}}}if(g.readyState==4)if(g.status==200){XML3D.debug.logDebug("Loaded: "+g._url);a=g.getResponseHeader("content-type");c=null;if(g.responseType=="arraybuffer")c=g.response;else if(a=="application/json")c=JSON.parse(g.responseText);
else if(a=="application/xml"||a=="text/xml")c=g.responseXML;else if(a=="application/octet-stream"||a=="text/plain; charset=x-user-defined"){XML3D.debug.logError("Possibly wrong loading of resource "+i+". Mimetype is "+a+" but response is not an ArrayBuffer");c=g.responseText}d&&d(c)}else{XML3D.debug.logError("Could not load external document '"+g._url+"': "+g.status+" - "+g.statusText);f&&f(g)}}},g.send(null))},getImage:function(a,b,c){e(0).counter++;var f=new Image;f.onload=function(a){b(a,f);d(0)};
f.onerror=function(a){c(a,f);d(0)};a.hasSameOrigin(document.location.href)||(f.crossOrigin=o.getValue("resource-crossorigin-attribute"),XML3D.debug.logWarning("You are using an cross-origin image as texture. This might cause troubles cause the canvas is 'tainted'."));f.src=a.toString();return f},getVideo:function(a,b,c,f){function g(a){return function(b){a(b,i)}}e(0).counter++;var i=document.createElement("video"),k=function(){d(0);i.removeEventListener("canplay",k,!0);i.removeEventListener("error",
k,!0)};a.hasSameOrigin(document.location.href)||(i.crossOrigin=o.getValue("resource-crossorigin-attribute"),XML3D.debug.logWarning("You are using an cross-origin video as texture. This might cause troubles cause the canvas is 'tainted'.",a));i.autoplay=b;i.loop=c;for(var l in f)i.addEventListener(l,g(f[l]),!0);i.addEventListener("canplay",k,!0);i.addEventListener("error",k,!0);i.src=a.toString();return i}};j.exports={registerFactory:function(a){var b=a.canvasId;u[b]||(u[b]=[]);u[b].push(a)},registerFormat:function(a){a&&
w.push(a)},findFormat:x,Resource:C}},{"../utils/options.js":132,"../utils/uri.js":133,"./adapterhandle.js":8}],11:[function(h,j){var e=function(){};e.prototype={constructor:e,addEventListener:function(a,d){void 0===this._listeners&&(this._listeners={});var b=this._listeners;void 0===b[a]&&(b[a]=[]);-1===b[a].indexOf(d)&&b[a].push(d)},hasEventListener:function(a,d){if(void 0===this._listeners)return!1;var b=this._listeners;return void 0!==b[a]&&-1!==b[a].indexOf(d)?!0:!1},removeEventListener:function(a,
d){if(void 0!==this._listeners){var b=this._listeners,c=b[a].indexOf(d);-1!==c&&b[a].splice(c,1)}},dispatchEvent:function(a){if(void 0!==this._listeners){var d=this._listeners[a.type];if(void 0!==d){a.target=this;for(var b=0,c=d.length;b<c;b++)d[b].call(this,a)}}}};j.exports=e},{}],12:[function(h,j){var e={unProject:function(a,d,b,c,g,f,k){a=[a,d,b,1];d=[];e.multMatrices(c,g,d);if(!e.invertMatrix(d,d))return!1;a[0]=(a[0]-f[0])/f[2];a[1]=(a[1]-f[1])/f[3];a[0]=2*a[0]-1;a[1]=2*a[1]-1;a[2]=2*a[2]-1;c=
[];e.multMatrixVec(d,a,c);if(0===c[3])return!1;c[0]/=c[3];c[1]/=c[3];c[2]/=c[3];k[0]=c[0];k[1]=c[1];k[2]=c[2];return!0},multMatrixVec:function(a,d,b){for(var c=0;4>c;c+=1)b[c]=d[0]*a[0+c]+d[1]*a[4+c]+d[2]*a[8+c]+d[3]*a[12+c]},multMatrices:function(a,d,b){for(var c=0;4>c;c+=1)for(var g=0;4>g;g+=1)b[4*c+g]=a[4*c+0]*d[0+g]+a[4*c+1]*d[4+g]+a[4*c+2]*d[8+g]+a[4*c+3]*d[12+g]},invertMatrix:function(a,d){var b=[];b[0]=a[5]*a[10]*a[15]-a[5]*a[11]*a[14]-a[9]*a[6]*a[15]+a[9]*a[7]*a[14]+a[13]*a[6]*a[11]-a[13]*
a[7]*a[10];b[4]=-a[4]*a[10]*a[15]+a[4]*a[11]*a[14]+a[8]*a[6]*a[15]-a[8]*a[7]*a[14]-a[12]*a[6]*a[11]+a[12]*a[7]*a[10];b[8]=a[4]*a[9]*a[15]-a[4]*a[11]*a[13]-a[8]*a[5]*a[15]+a[8]*a[7]*a[13]+a[12]*a[5]*a[11]-a[12]*a[7]*a[9];b[12]=-a[4]*a[9]*a[14]+a[4]*a[10]*a[13]+a[8]*a[5]*a[14]-a[8]*a[6]*a[13]-a[12]*a[5]*a[10]+a[12]*a[6]*a[9];b[1]=-a[1]*a[10]*a[15]+a[1]*a[11]*a[14]+a[9]*a[2]*a[15]-a[9]*a[3]*a[14]-a[13]*a[2]*a[11]+a[13]*a[3]*a[10];b[5]=a[0]*a[10]*a[15]-a[0]*a[11]*a[14]-a[8]*a[2]*a[15]+a[8]*a[3]*a[14]+
a[12]*a[2]*a[11]-a[12]*a[3]*a[10];b[9]=-a[0]*a[9]*a[15]+a[0]*a[11]*a[13]+a[8]*a[1]*a[15]-a[8]*a[3]*a[13]-a[12]*a[1]*a[11]+a[12]*a[3]*a[9];b[13]=a[0]*a[9]*a[14]-a[0]*a[10]*a[13]-a[8]*a[1]*a[14]+a[8]*a[2]*a[13]+a[12]*a[1]*a[10]-a[12]*a[2]*a[9];b[2]=a[1]*a[6]*a[15]-a[1]*a[7]*a[14]-a[5]*a[2]*a[15]+a[5]*a[3]*a[14]+a[13]*a[2]*a[7]-a[13]*a[3]*a[6];b[6]=-a[0]*a[6]*a[15]+a[0]*a[7]*a[14]+a[4]*a[2]*a[15]-a[4]*a[3]*a[14]-a[12]*a[2]*a[7]+a[12]*a[3]*a[6];b[10]=a[0]*a[5]*a[15]-a[0]*a[7]*a[13]-a[4]*a[1]*a[15]+a[4]*
a[3]*a[13]+a[12]*a[1]*a[7]-a[12]*a[3]*a[5];b[14]=-a[0]*a[5]*a[14]+a[0]*a[6]*a[13]+a[4]*a[1]*a[14]-a[4]*a[2]*a[13]-a[12]*a[1]*a[6]+a[12]*a[2]*a[5];b[3]=-a[1]*a[6]*a[11]+a[1]*a[7]*a[10]+a[5]*a[2]*a[11]-a[5]*a[3]*a[10]-a[9]*a[2]*a[7]+a[9]*a[3]*a[6];b[7]=a[0]*a[6]*a[11]-a[0]*a[7]*a[10]-a[4]*a[2]*a[11]+a[4]*a[3]*a[10]+a[8]*a[2]*a[7]-a[8]*a[3]*a[6];b[11]=-a[0]*a[5]*a[11]+a[0]*a[7]*a[9]+a[4]*a[1]*a[11]-a[4]*a[3]*a[9]-a[8]*a[1]*a[7]+a[8]*a[3]*a[5];b[15]=a[0]*a[5]*a[10]-a[0]*a[6]*a[9]-a[4]*a[1]*a[10]+a[4]*
a[2]*a[9]+a[8]*a[1]*a[6]-a[8]*a[2]*a[5];var c=a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12];if(0===c)return!1;for(var c=1/c,g=0;16>g;g+=1)d[g]=b[g]*c;return!0}};j.exports=e},{}],13:[function(h,j){var e=function(a){var a=a||{guess:!0},d=a.e||null,a=!!a.guess,b=new e.implementation,d=b.run(d);return a?b.guessAnonymousFunctions(d):d};e.implementation=function(){};e.implementation.prototype={run:function(a,d){a=a||this.createException();d=d||this.mode(a);return"other"===d?this.other(arguments.callee):this[d](a)},
createException:function(){try{this.undef()}catch(a){return a}},mode:function(a){return a.arguments&&a.stack?"chrome":a.stack&&a.sourceURL?"safari":"string"===typeof a.message&&"undefined"!==typeof window&&window.opera?!a.stacktrace||-1<a.message.indexOf("\n")&&a.message.split("\n").length>a.stacktrace.split("\n").length?"opera9":!a.stack?"opera10a":0>a.stacktrace.indexOf("called from line")?"opera10b":"opera11":a.stack?"firefox":"other"},instrumentFunction:function(a,d,b){var a=a||window,c=a[d];
a[d]=function(){b.call(this,e().slice(4));return a[d]._instrumented.apply(this,arguments)};a[d]._instrumented=c},deinstrumentFunction:function(a,d){a[d].constructor===Function&&a[d]._instrumented&&a[d]._instrumented.constructor===Function&&(a[d]=a[d]._instrumented)},chrome:function(a){a=(a.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");
a.pop();return a},safari:function(a){return a.stack.replace(/\[native code\]\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},firefox:function(a){return a.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^[\(@]/gm,"{anonymous}()@").split("\n")},opera11:function(a){for(var d=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,a=a.stacktrace.split("\n"),b=[],c=0,g=a.length;c<g;c+=2){var f=d.exec(a[c]);if(f){var k=f[4]+":"+f[1]+":"+f[2],f=f[3]||"global code",f=f.replace(/<anonymous function: (\S+)>/,
"$1").replace(/<anonymous function>/,"{anonymous}");b.push(f+"@"+k+" -- "+a[c+1].replace(/^\s+/,""))}}return b},opera10b:function(a){for(var d=/^(.*)@(.+):(\d+)$/,a=a.stacktrace.split("\n"),b=[],c=0,g=a.length;c<g;c++){var f=d.exec(a[c]);f&&b.push((f[1]?f[1]+"()":"global code")+"@"+f[2]+":"+f[3])}return b},opera10a:function(a){for(var d=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,a=a.stacktrace.split("\n"),b=[],c=0,g=a.length;c<g;c+=2){var f=d.exec(a[c]);f&&b.push((f[3]||"{anonymous}")+
"()@"+f[2]+":"+f[1]+" -- "+a[c+1].replace(/^\s+/,""))}return b},opera9:function(a){for(var d=/Line (\d+).*script (?:in )?(\S+)/i,a=a.message.split("\n"),b=[],c=2,g=a.length;c<g;c+=2){var f=d.exec(a[c]);f&&b.push("{anonymous}()@"+f[2]+":"+f[1]+" -- "+a[c+1].replace(/^\s+/,""))}return b},other:function(a){for(var d=/function\s*([\w\-$]+)?\s*\(/i,b=[],c,g;a&&a.arguments&&10>b.length;)c=d.test(a.toString())?RegExp.$1||"{anonymous}":"{anonymous}",g=Array.prototype.slice.call(a.arguments||[]),b[b.length]=
c+"("+this.stringifyArguments(g)+")",a=a.caller;return b},stringifyArguments:function(a){for(var d=[],b=Array.prototype.slice,c=0;c<a.length;++c){var g=a[c];void 0===g?d[c]="undefined":null===g?d[c]="null":g.constructor&&(g.constructor===Array?d[c]=3>g.length?"["+this.stringifyArguments(g)+"]":"["+this.stringifyArguments(b.call(g,0,1))+"..."+this.stringifyArguments(b.call(g,-1))+"]":g.constructor===Object?d[c]="#object":g.constructor===Function?d[c]="#function":g.constructor===String?d[c]='"'+g+'"':
g.constructor===Number&&(d[c]=g))}return d.join(",")},sourceCache:{},ajax:function(a){var d=this.createXMLHTTPObject();if(d)try{return d.open("GET",a,!1),d.send(null),d.responseText}catch(b){}return""},createXMLHTTPObject:function(){for(var a,d=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=0;b<d.length;b++)try{return a=d[b](),this.createXMLHTTPObject=
d[b],a}catch(c){}},isSameDomain:function(a){return"undefined"!==typeof location&&-1!==a.indexOf(location.hostname)},getSource:function(a){a in this.sourceCache||(this.sourceCache[a]=this.ajax(a).split("\n"));return this.sourceCache[a]},guessAnonymousFunctions:function(a){for(var d=0;d<a.length;++d){var b=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,c=a[d],g=/\{anonymous\}\(.*\)@(.*)/.exec(c);if(g){var f=b.exec(g[1]);f&&(b=f[1],g=f[2],f=f[3]||0,b&&this.isSameDomain(b)&&g&&(b=this.guessAnonymousFunction(b,
g,f),a[d]=c.replace("{anonymous}",b)))}}return a},guessAnonymousFunction:function(a,d){var b;try{b=this.findFunctionName(this.getSource(a),d)}catch(c){b="getSource failed with url: "+a+", exception: "+c.toString()}return b},findFunctionName:function(a,d){for(var b=/function\s+([^(]*?)\s*\(([^)]*)\)/,c=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,g=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,f="",k,i=Math.min(d,20),e,l=0;l<i;++l)if(k=a[d-l-1],e=k.indexOf("//"),0<=e&&(k=k.substr(0,
e)),k)if(f=k+f,(k=c.exec(f))&&k[1]||(k=b.exec(f))&&k[1]||(k=g.exec(f))&&k[1])return k[1];return"(?)"}};j.exports=e},{}],14:[function(h,j){var e={VERSION:"2.2.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,ASYNC:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(a,d){var b="string"==typeof a.initial?{state:a.initial}:a.initial,c=d||a.target||{},g=a.events||[],f=a.callbacks||{},k={},i=function(a){var b=a.from instanceof Array?
a.from:a.from?[a.from]:[e.WILDCARD];k[a.name]=k[a.name]||{};for(var c=0;c<b.length;c++)k[a.name][b[c]]=a.to||b[c]};b&&(b.event=b.event||"startup",i({name:b.event,from:"none",to:b.state}));for(var n=0;n<g.length;n++)i(g[n]);for(var l in k)k.hasOwnProperty(l)&&(c[l]=e.buildEvent(l,k[l]));for(l in f)f.hasOwnProperty(l)&&(c[l]=f[l]);c.current="none";c.is=function(a){return this.current==a};c.can=function(a){return!this.transition&&(k[a].hasOwnProperty(this.current)||k[a].hasOwnProperty(e.WILDCARD))};
c.cannot=function(a){return!this.can(a)};c.error=a.error||function(a,b,c,d,f,g,i){throw i||g;};if(b&&!b.defer)c[b.event]();return c},doCallback:function(a,d,b,c,g,f){if(d)try{return d.apply(a,[b,c,g].concat(f))}catch(k){return a.error(b,c,g,f,e.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",k)}},beforeEvent:function(a,d,b,c,g){return e.doCallback(a,a["onbefore"+d],d,b,c,g)},afterEvent:function(a,d,b,c,g){return e.doCallback(a,a["onafter"+d]||a["on"+d],d,b,c,
g)},leaveState:function(a,d,b,c,g){return e.doCallback(a,a["onleave"+b],d,b,c,g)},enterState:function(a,d,b,c,g){return e.doCallback(a,a["onenter"+c]||a["on"+c],d,b,c,g)},changeState:function(a,d,b,c,g){return e.doCallback(a,a.onchangestate,d,b,c,g)},buildEvent:function(a,d){return function(){var b=this.current,c=d[b]||d[e.WILDCARD]||b,g=Array.prototype.slice.call(arguments);if(this.transition)return this.error(a,b,c,g,e.Error.PENDING_TRANSITION,"event "+a+" inappropriate because previous transition did not complete");
if(this.cannot(a))return this.error(a,b,c,g,e.Error.INVALID_TRANSITION,"event "+a+" inappropriate in current state "+this.current);if(!1===e.beforeEvent(this,a,b,c,g))return e.Result.CANCELLED;if(b===c)return e.afterEvent(this,a,b,c,g),e.Result.NOTRANSITION;var f=this;this.transition=function(){f.transition=null;f.current=c;e.enterState(f,a,b,c,g);e.changeState(f,a,b,c,g);e.afterEvent(f,a,b,c,g)};this.transition.cancel=function(){f.transition=null;e.afterEvent(f,a,b,c,g)};var k=e.leaveState(this,
a,b,c,g);if(!1===k)return this.transition=null,e.Result.CANCELLED;if("async"===k)return e.Result.ASYNC;this.transition&&this.transition();return e.Result.SUCCEEDED}}};window.StateMachine=e;j.exports=e},{}],15:[function(h,j){function e(a){a.asset.clearChildren();a.asset.clearSubAssets();for(var b=a.node.firstElementChild;null!==b;b=b.nextElementSibling){var c=a.factory.getAdapter(b);c&&c.getAsset&&a.asset.appendSubAsset(c.getAsset());c&&c.assetEntry&&a.asset.appendChild(c.assetEntry)}}function a(a,
b,c){var d=(c=a.getAdapterHandle(c))&&c.status;d===v.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find element of url '"+c.url+"' for "+b,a.node);a.connectAdapterHandle(b,c);a.connectedAdapterChanged(b,c?c.getAdapter():null,d)}function d(a){if(a.node.hasAttribute("pick")){var b=a.node.getAttribute("pick");a.asset.setPickFilter(b)}else a.asset.setPickFilter(null)}function b(a,b){b?a.setIncludes(b.trim().split(/\s*,\s*/)):a.setIncludes([])}function c(a){var b=a.node.getAttribute("class");a.assetEntry.setClassNamesString(b)}
function g(b){var c=b.node.getAttribute("compute"),d=m(c);d?a(b,"postDataflow",d):(b.disconnectAdapterHandle("postDataflow"),f(b));b.assetEntry.setPostCompute(c)}function f(a){var b=!1,c;(c=a.getConnectedAdapterHandle("postDataflow"))&&c.status===v.STATUS.LOADING&&(b=!0);a.assetEntry.setLoading(b)}function k(a,b){var c=a.node,d=c.getAttribute("shader");d?(c=s.getAbsoluteURI(c.ownerDocument._documentURL||c.ownerDocument.URL,d),b.setShader(c.toString())):b.setShader(null)}var i=h("../transform-fetcher.js"),
n=h("./data.js"),l=h("../../xflow/interface/graph.js").DataNode,m=h("../../xflow/interface/graph.js").getComputeDataflowUrl,r=h("../../asset/asset.js").Asset,p=h("../../asset/asset.js").SubData,q=h("../../interface/notification.js"),o=h("../../utils/misc.js").dispatchCustomEvent,s=h("../../base/resourcemanager.js").Resource,u=h("../../base/adapter.js").NodeAdapter,t=XML3D.createClass,v=h("../../base/adapterhandle.js"),w=function(a,b){u.call(this,a,b);this.asset=null;"model"!==b.localName.toLowerCase()&&
(this.transformFetcher=new i(this,"transform","transform"))};t(w,u);w.prototype.init=function(){this.asset=new r(this.node);this.asset.addChangeListener(this);this.asset.setName(this.node.getAttribute("name"));a(this,"src",this.node.getAttribute("src"));d(this);e(this);k(this,this.asset);this.transformFetcher&&this.transformFetcher.update()};w.prototype.onAssetLoadChange=function(a,b,c){Infinity==b?o(this.node,"load",!1,!0,null):b>c&&o(this.node,"progress",!1,!0,null)};w.prototype.getAssetComplete=
function(){return Infinity==this.asset.getProgressLevel()};w.prototype.getAssetProgressLevel=function(){return this.asset.getProgressLevel()};w.prototype.getAsset=function(){return this.asset};w.prototype.connectedAdapterChanged=function(a,b){"src"==a&&this.asset.setSrcAsset(b&&b.getAsset()||null);var c=!1,d;(d=this.getConnectedAdapterHandle("src"))&&d.status===v.STATUS.LOADING&&(c=!0);this.asset.setLoading(c)};w.prototype.onTransformChange=function(a,b){this.asset.setTransform(b)};w.prototype.notifyChanged=
function(b){if(b.type==q.ADAPTER_HANDLE_CHANGED)this.connectedAdapterChanged(b.key,b.adapter),b.handleStatus==v.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find <asset> element of url '"+b.url+"' for "+b.key);else if(b.type==q.NODE_INSERTED)e(this);else if(b.type==q.NODE_REMOVED)e(this);else if(b.type==q.VALUE_MODIFIED)switch(b.mutation.attributeName){case "name":this.asset.setName(this.node.getAttribute("name"));break;case "shader":k(this,this.asset);break;case "style":case "transform":this.transformFetcher&&
this.transformFetcher.update();break;case "src":a(this,"src",this.node.getAttribute("src"));break;case "pick":d(this)}else b.type==q.THIS_REMOVED&&this.clearAdapterHandles()};var z=function(a,b){this.assetData=!0;n.call(this,a,b);this.outputXflowNode=this.assetEntry=null};t(z,n);z.prototype.init=function(){n.prototype.init.call(this);this.outputXflowNode=new l(!1);this.assetEntry=new p(this.outputXflowNode,this.getXflowNode(),this.node);this.assetEntry.setName(this.node.getAttribute("name"));c(this);
g(this);this.assetEntry.setPostFilter(this.node.getAttribute("filter"));b(this.assetEntry,this.node.getAttribute("includes"))};z.prototype.connectedAdapterChanged=function(a,b){"postDataflow"==a?(this.assetEntry.setPostDataflow(b&&b.getXflowNode()||null),f(this)):n.prototype.connectedAdapterChanged.call(this,a,b)};z.prototype.notifyChanged=function(a){n.prototype.notifyChanged.call(this,a);if(a.type==q.VALUE_MODIFIED)switch(a.mutation.attributeName){case "name":this.assetEntry.setName(this.node.getAttribute("name"));
break;case "compute":g(this);break;case "class":c(this);break;case "filter":this.assetEntry.setPostFilter(this.node.getAttribute("filter"));break;case "includes":b(this.node.getAttribute("includes"))}};z.prototype.onTransformChange=function(a,b){this.assetEntry.setTransform(b)};var y=function(a,b){z.call(this,a,b);this.transformFetcher=new i(this,"transform","transform")};t(y,z);y.prototype.init=function(){z.prototype.init.call(this);k(this,this.assetEntry);this.assetEntry.setMeshType(this.node.getAttribute("type")||
"triangles");this.assetEntry.setMatchFilter(this.node.getAttribute("match"));this.transformFetcher.update()};y.prototype.notifyChanged=function(a){z.prototype.notifyChanged.call(this,a);if(a.type==q.VALUE_MODIFIED)switch(a.mutation.attributeName){case "shader":k(this,this.assetEntry);break;case "match":this.assetEntry.setMatchFilter(this.node.getAttribute("match"));break;case "style":case "transform":this.transformFetcher.update();break;case "type":this.assetEntry.setMeshType(this.node.getAttribute("type")||
"triangles")}};j.exports={AssetAdapter:w,AssetMeshAdapter:y,AssetDataAdapter:z}},{"../../asset/asset.js":6,"../../base/adapter.js":7,"../../base/adapterhandle.js":8,"../../base/resourcemanager.js":10,"../../interface/notification.js":36,"../../utils/misc.js":131,"../../xflow/interface/graph.js":138,"../transform-fetcher.js":28,"./data.js":18}],16:[function(h,j){var e=h("../../xflow/interface/request.js").ComputeRequest,a=h("../../xflow/processing/vs-connect.js").setShaderConstant,d=h("../../xflow/base.js").registerErrorCallback,
b=h("../../xflow/interface/constants.js"),c=h("../../utils/uri.js").URI,g=h("../../base/adapter.js").NodeAdapter,f=XML3D.createClass,k=function(a,b){g.call(this,a,b);this.xflowDataNode=null};f(k,g);k.prototype.getXflowNode=function(){return this.xflowDataNode};k.prototype.getComputeRequest=function(a,b){return new e(this.xflowDataNode,a,b)};k.prototype.getComputeResult=function(a){return this.xflowDataNode._getResult(b.RESULT_TYPE.COMPUTE,a)};k.prototype.getOutputNames=function(){return this.xflowDataNode.getOutputNames()};
k.prototype.getOutputChannelInfo=function(a){return this.xflowDataNode.getOutputChannelInfo(a)};a(b.SHADER_CONSTANT_KEY.OBJECT_ID,"objectID");a(b.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM,"modelViewProjectionMatrix");a(b.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM_NORMAL,"modelViewProjectionNormalMatrix");a(b.SHADER_CONSTANT_KEY.VIEW_TRANSFORM,"modelViewMatrix");a(b.SHADER_CONSTANT_KEY.VIEW_TRANSFORM_NORMAL,"modelViewMatrixN");a(b.SHADER_CONSTANT_KEY.WORLD_TRANSFORM,"modelMatrix");d(function(a,b){var a="Xflow: "+
a,d=b?b.userData:null;if(d&&d.ownerDocument)if(d.ownerDocument===document)XML3D.debug.logError(a,d);else if(d.id){var f=new c("#"+d.id),f=f.getAbsoluteURI(d.ownerDocument._documentURL||d.ownerDocument.URL);XML3D.debug.logError(a,"External Node: "+f)}else XML3D.debug.logError(a,"External Document: "+d.ownerDocument.URL);else"string"==typeof d?XML3D.debug.logError(a,d):XML3D.debug.logError(a)});j.exports=k},{"../../base/adapter.js":7,"../../utils/uri.js":133,"../../xflow/base.js":135,"../../xflow/interface/constants.js":136,
"../../xflow/interface/request.js":139,"../../xflow/processing/vs-connect.js":186}],17:[function(h,j){var e=h("../../interface/notification.js"),a=h("../../base/adapter.js").NodeAdapter,d=function(b,c){a.call(this,b,c)};XML3D.createClass(d,a);d.prototype.getComputeCode=function(){return this.node.value};d.prototype.notifyChanged=function(a){switch(a.type){case e.VALUE_MODIFIED:case e.NODE_INSERTED:case e.NODE_REMOVED:if(a=this.node.parentNode)(a=this.factory.getAdapter(a))&&a.updateXflowNode()}};
j.exports=d},{"../../base/adapter.js":7,"../../interface/notification.js":36}],18:[function(h,j){function e(a){var b=a._children,d;if(b&&0<b.length)for(d=b.length;d--;)b[d]instanceof c&&(b[d].setPlatform(a._platform),e(b[d]))}function a(a){var b=a.xflowDataNode;b.setCompute(a.node.getAttribute("compute"));b.computeDataflowUrl?a.updateAdapterHandle("dataflow",b.computeDataflowUrl):(a.disconnectAdapterHandle("dataflow"),d(a))}function d(a){var b=!1,c;(c=a.getConnectedAdapterHandle("src"))&&c.status===
i.STATUS.LOADING&&(b=!0);(c=a.getConnectedAdapterHandle("dataflow"))&&c.status===i.STATUS.LOADING&&(b=!0);for(var d in a.externalScripts)(c=a.getConnectedAdapterHandle(d))&&c.status===i.STATUS.LOADING&&(b=!0);a.xflowDataNode.setLoading(b)}var b=h("./base.js"),c=h("../../xflow/interface/graph.js").DataNode,g=h("../../xflow/interface/constants.js"),f=h("../../interface/notification.js"),k=h("../../utils/misc.js").dispatchCustomEvent,i=h("../../base/adapterhandle.js"),n=function(a,c){b.call(this,a,c);
this.xflowDataNode=null;this.externalScripts={}};XML3D.createClass(n,b);n.prototype.init=function(){this.xflowDataNode=new c(!1);this.xflowDataNode.addLoadListener(this.onXflowLoadEvent.bind(this));this.xflowDataNode.userData=this.node;this.xflowDataNode.setPlatform(this.node.getAttribute("platform"));this.updateAdapterHandle("src",this.node.getAttribute("src"));this.assetData||(this.xflowDataNode.setFilter(this.node.getAttribute("filter")),a(this));for(var b=this.node.firstElementChild;null!==b;b=
b.nextElementSibling){var d=this.factory.getAdapter(b);if(d){if(d.getXflowNode)this.xflowDataNode.appendChild(d.getXflowNode());else if(d.getScriptType){var f=d.node.name;f||(XML3D.debug.logError("Parsing error: Externally referenced operators must have a 'name' attribute matching the name they were registered with. ",d.node),f="unknown_operator");this.externalScripts[f]=d;d.connectedAdapterHandle&&this.connectAdapterHandle(f,d.connectedAdapterHandle);this.xflowDataNode.setLoading(!0)}null!==this.xflowDataNode._platform&&
e(this.xflowDataNode)}}};n.prototype.updateAdapterHandle=function(a,b){var c=this.getConnectedAdapterHandle(a),d=this.getAdapterHandle(b),f=d&&d.status;c!=d&&(f===i.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find element of url '"+d.url+"' for "+a,this.node),this.connectAdapterHandle(a,d),this.connectedAdapterChanged(a,d?d.getAdapter():null,f))};n.prototype.onXflowLoadEvent=function(a,b,c){Infinity==b?k(this.node,"load",!1,!0,null):b>c&&k(this.node,"progress",!1,!0,null)};n.prototype.getDataComplete=
function(){return Infinity==this.xflowDataNode.getProgressLevel()};n.prototype.getDataProgressLevel=function(){return this.xflowDataNode.getProgressLevel()};n.prototype.notifyChanged=function(b){if(b.type===f.ADAPTER_HANDLE_CHANGED)this.connectedAdapterChanged(b.key,b.adapter,b.handleStatus),b.handleStatus===i.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find <data> element of url '"+b.url+"' for "+b.key,this.node);else if(b.type===f.NODE_INSERTED){var c=b.affectedNode;if(b=this.factory.getAdapter(c)){var b=
b.getXflowNode(),d=null;do c=c.nextSibling;while(c&&!(d=this.factory.getAdapter(c)));d?this.xflowDataNode.insertBefore(b,d.getXflowNode()):this.xflowDataNode.appendChild(b)}}else b.type===f.NODE_REMOVED?(b=this.factory.getAdapter(b.affectedNode))&&this.xflowDataNode.removeChild(b.getXflowNode()):b.type===f.VALUE_MODIFIED?(b=b.mutation.attributeName,"filter"===b&&!this.assetData?this.xflowDataNode.setFilter(this.node.getAttribute(b)):"compute"===b&&!this.assetData?a(this):"src"===b?this.updateAdapterHandle(b,
this.node.getAttribute(b)):"platform"===b&&(b=this.xflowDataNode,b.setPlatform(this.node.getAttribute("platform")),e(b))):b.type===f.THIS_REMOVED&&this.clearAdapterHandles()};n.prototype.connectedAdapterChanged=function(a,b){"src"===a?this.xflowDataNode.sourceNode=b?b.getXflowNode():null:"dataflow"===a?this.xflowDataNode.dataflowNode=b?b.getXflowNode():null:this.externalScripts[a]&&(window.eval(b.script),this.xflowDataNode.notify(g.RESULT_STATE.CHANGED_STRUCTURE));this.xflowDataNode.setLoading(!0);
d(this)};n.prototype.toString=function(){return"DataAdapter"};j.exports=n},{"../../base/adapterhandle.js":8,"../../interface/notification.js":36,"../../utils/misc.js":131,"../../xflow/interface/constants.js":136,"../../xflow/interface/graph.js":138,"./base.js":16}],19:[function(h,j){function e(a,b,c){a._computeOperator===b&&a.setLoading(c);if(a._children)for(var d=a._children.length;d--;)e(a._children[d],b,c)}function a(a){var b=a.node.getAttribute("out");b?a.xflowDataNode.setFilter("keep("+b+")"):
a.xflowDataNode.setFilter("")}function d(b,d){var f=d.getAttribute("platform");b.xflowDataNode.clearChildren();b.xflowDataNode.setCompute("");b.clearAdapterHandles();b.dataflowRefs=[];b.externalScripts={};a(b);var g=d.lastElementChild,i=!0,k=null,h=b.xflowDataNode,j,u;do if(j=b.factory.getAdapter(g))if(j.getXflowNode)u=j.getXflowNode(),k?h.insertBefore(u,k):h.appendChild(u),k=u;else if(j.getComputeCode){j=j.getComputeCode().split(";");for(var t=j.length;t--;)if(j[t].trim()&&(i?i=!1:(u=new c(!1),k?
h.insertBefore(u,k):h.appendChild(u),h=u,k=null),h.userData=g,h.setPlatform(f),h.setCompute(j[t].trim()),h.computeDataflowUrl))u=b.dataflowRefs.length,b.dataflowRefs.push(h),b.updateAdapterHandle(u,h.computeDataflowUrl)}else j.getScriptType&&(t=j.node.name,t||(XML3D.debug.logError("Parsing error: Externally referenced operators must have a 'name' attribute matching the name they were registered with. ",j.node),t="unknown_operator"),b.externalScripts[t]=j,j.connectedAdapterHandle&&b.connectAdapterHandle(t,
j.connectedAdapterHandle));while(g=g.previousElementSibling);for(var v in b.externalScripts)e(b.xflowDataNode,v,!0)}var b=h("./base.js"),c=h("../../xflow/interface/graph.js").DataNode,g=h("../../xflow/interface/constants.js"),f=h("../../interface/notification.js"),k=h("../../base/adapterhandle.js"),i=function(a,c){b.call(this,a,c);this.xflowDataNode=null;this.externalScripts={}};XML3D.createClass(i,b);i.prototype.init=function(){this.xflowDataNode=new c(!1);this.dataflowRefs=[];d(this,this.node)};
i.prototype.updateAdapterHandle=function(a,b){var c=this.getConnectedAdapterHandle(a),d=this.getAdapterHandle(b),f=d&&d.status;c!=d&&(f===k.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find element of url '"+d.url+"' for "+a,this.node),this.connectAdapterHandle(a,d),this.connectedAdapterChanged(a,d?d.getAdapter():null,f))};i.prototype.notifyChanged=function(b){b.type===f.ADAPTER_HANDLE_CHANGED&&this.externalScripts[b.key]&&(window.eval(b.adapter.script),e(this.xflowDataNode,b.key,!1),this.xflowDataNode.notify(g.RESULT_STATE.CHANGED_STRUCTURE));
switch(b.type){case f.ADAPTER_HANDLE_CHANGED:this.connectedAdapterChanged(b.key,b.adapter,b.handleStatus);b.handleStatus===k.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find dataflow of url '"+b.url,this.node);break;case f.NODE_INSERTED:case f.NODE_REMOVED:d(this);break;case f.VALUE_MODIFIED:b=b.mutation.attributeName,"out"===b?a(this):"platform"===b&&d(this,this.node)}};i.prototype.updateXflowNode=function(){d(this,this.node)};i.prototype.connectedAdapterChanged=function(a,b,c){if(a=this.dataflowRefs[a])a.dataflowNode=
b?b.getXflowNode():null,a.setLoading(c===k.STATUS.LOADING)};j.exports=i},{"../../base/adapterhandle.js":8,"../../interface/notification.js":36,"../../xflow/interface/constants.js":136,"../../xflow/interface/graph.js":138,"./base.js":16}],20:[function(h,j){var e=h("../../base/adapter.js").NodeAdapterFactory,a=h("./asset.js"),d=h("./misc.js"),b=h("./script.js"),c=h("./texture.js"),g=h("./transform.js"),f=h("./values.js"),k=h("./data.js"),i=h("./compute.js"),n=h("./dataflow.js");h("./json/factory.js");
h("./javascript/factory.js");var l=function(){e.call(this,"data")};XML3D.createClass(l,e);l.prototype.aspect="data";var m={mesh:d.SinkDataAdapter,shader:d.SinkDataAdapter,lightshader:d.SinkDataAdapter,"float":f,float2:f,float3:f,float4:f,float4x4:f,"int":f,int4:f,bool:f,"byte":f,ubyte:f,img:d.ImgDataAdapter,texture:c,data:k,proto:k,dataflow:n,compute:i,video:d.VideoDataAdapter,script:b,transform:g,asset:a.AssetAdapter,assetdata:a.AssetDataAdapter,assetmesh:a.AssetMeshAdapter,model:a.AssetAdapter};
l.prototype.createAdapter=function(a){var b=m[a.localName];if(void 0!==b)return new b(this,a);XML3D.debug.logWarning("Not supported as data element: "+a.localName);return null};j.exports=l},{"../../base/adapter.js":7,"./asset.js":15,"./compute.js":17,"./data.js":18,"./dataflow.js":19,"./javascript/factory.js":21,"./json/factory.js":22,"./misc.js":23,"./script.js":24,"./texture.js":25,"./transform.js":26,"./values.js":27}],21:[function(h){var j=h("../../../base/resourcemanager.js").registerFormat,
e=h("../../../base/formathandler.js").FormatHandler,a=h("../../../base/adapter.js").AdapterFactory,h=function(){e.call(this)};XML3D.createClass(h,e);h.prototype.isFormatSupported=function(a,c,d){return"application/javascript"===d||"text/javascript"===d};h.prototype.getFormatData=function(a,c,d,f){f(!0,a)};h=new h;j(h);var d=function(a){this.script=a};d.prototype.getScriptType=function(){return"application/javascript"};d.prototype.getScript=function(){return this.script};j=function(){a.call(this,"data")};
XML3D.createClass(j,a);j.prototype.aspect="data";j.prototype.createAdapter=function(a){return new d(a)};h.registerFactoryClass(j)},{"../../../base/adapter.js":7,"../../../base/formathandler.js":9,"../../../base/resourcemanager.js":10}],22:[function(h){function j(b,f,g,i,k){k=new n[f](k);f=a.DATA_TYPE.fromString(f);f=new c(f,k);k=new d;k.data=f;k.name=g;k.key=i;b.appendChild(k)}function e(b,f,i){if(n[i.type])for(var k=0;k<i.seq.length;++k){var e=i.seq[k],h=e.value,m=e.key;if("Object"===Object.prototype.toString.call(h).slice(8,
-1)&&h.url){if(!l())throw Error("Big-endian binary data are not supported yet");g.loadData(h.url,function(g){var k=i.type,e=m,l=n[k],g=new l(g,h.byteOffset,h.byteLength/l.BYTES_PER_ELEMENT),k=a.DATA_TYPE.fromString(k),k=new c(k,g),g=new d;g.data=k;g.name=f;g.key=e;b.appendChild(g)},null)}else j(b,i.type,f,m,h)}}var a=h("../../../xflow/interface/constants.js"),d=h("../../../xflow/interface/graph.js").InputNode,b=h("../../../xflow/interface/graph.js").DataNode,c=h("../../../xflow/interface/data.js").BufferEntry,
g=h("../../../base/resourcemanager.js").Resource,f=h("../../../base/resourcemanager.js").registerFormat,k=h("../../../base/formathandler.js").JSONFormatHandler,i=h("../../../base/adapter.js").AdapterFactory,h=function(){k.call(this)};XML3D.createClass(h,k);h.prototype.isFormatSupported=function(a,b,c){return"application/json"===c&&"xml3d-json"==a.format&&"0.4.0"==a.version};h.prototype.getFormatData=function(a,c,d,f){try{if("xml3d-json"!=a.format)throw Error("Unknown JSON format: "+a.format);if("0.4.0"!=
a.version)throw Error("Unknown JSON version: "+a.version);var g=new b(!1);g.userData="External Json";var i=a.data,k;for(k in i)e(g,k,i[k]);f(!0,g)}catch(l){XML3D.debug.logException(l,"Failed to process XML3D json file"),f(!1)}};h=new h;f(h);var n={"int":Int32Array,int4:Int32Array,"float":Float32Array,float2:Float32Array,float3:Float32Array,float4:Float32Array,float4x4:Float32Array,bool:Uint8Array,"byte":Int8Array,ubyte:Uint8Array},l=function(){var a=new ArrayBuffer(4),b=new DataView(a);(new Int32Array(a))[0]=
16909060;var c=16909060===b.getInt32(0,!0);return function(){return c}}(),m=function(a){this.xflowDataNode=a};m.prototype.getXflowNode=function(){return this.xflowDataNode};f=function(){i.call(this,"data")};XML3D.createClass(f,i);f.prototype.aspect="data";f.prototype.createAdapter=function(a){return new m(a)};h.registerFactoryClass(f)},{"../../../base/adapter.js":7,"../../../base/formathandler.js":9,"../../../base/resourcemanager.js":10,"../../../xflow/interface/constants.js":136,"../../../xflow/interface/data.js":137,
"../../../xflow/interface/graph.js":138}],23:[function(h,j){var e=h("./data.js"),a=h("../../interface/notification.js"),d=h("../../utils/uri.js").URI,b=h("../../utils/misc.js"),c=h("../../base/resourcemanager.js").Resource,g=h("../../base/adapter.js").NodeAdapter,f=XML3D.createClass,k=function(a,b){e.call(this,a,b)};f(k,e);k.prototype.isSinkAdapter=function(){return!0};k.prototype.toString=function(){return"XML3D.data.SinkDataAdapter"};var i=function(a,b){g.call(this,a,b);this.image=this.textureEntry=
null;b.src&&this.createImageFromURL(b.src)};f(i,g);i.prototype.createImageFromURL=function(a){var b=this,a=(new d(a)).getAbsoluteURI(this.node.ownerDocument._documentURL||this.node.ownerDocument.URL);this.image=c.getImage(a,function(a,c){b.textureEntry&&b.textureEntry.setImage(c,!0)},function(a,b){XML3D.debug.logError("Could not load image URI="+b.src)});b.textureEntry&&b.textureEntry.setImage(this.image,!0)};i.prototype.setTextureEntry=function(a){this.textureEntry=a;this.image&&this.textureEntry.setImage(this.image,
!0)};i.prototype.notifyChanged=function(b){b.type==a.VALUE_MODIFIED&&"src"==b.mutation.attributeName&&this.createImageFromURL(this.node.src)};i.prototype.getValue=function(){return this.image};i.prototype.getOutputs=function(){return{image:this}};i.prototype.resolveScript=function(){return null};var n=function(a,b){e.call(this,a,b);this.video=this.textureEntry=null;this._ticking=!1;this._boundTick=this._tick.bind(this);b.src&&this.createVideoFromURL(b.src)};f(n,g);n.prototype.createVideoFromURL=function(a){var f=
this,a=(new d(a)).getAbsoluteURI(this.node.ownerDocument._documentURL||this.node.ownerDocument.URL);this.video=c.getVideo(a,this.node.autoplay,this.node.loop,{canplay:function(){b.dispatchCustomEvent(f.node,"canplay",!0,!0,null);f._startVideoRefresh()},ended:function(){b.dispatchCustomEvent(f.node,"ended",!0,!0,null)},load:function(){b.dispatchEvent(f.node,"load")},error:function(a,c){b.dispatchCustomEvent(f.node,"error",!0,!0,null);XML3D.debug.logError("Could not load video URI="+c.src)}});this.textureEntry&&
this.textureEntry.setImage(this.video,!0)};n.prototype.play=function(){this.video&&this.video.play()};n.prototype.pause=function(){this.video&&this.video.pause()};n.prototype._startVideoRefresh=function(){this._ticking||this._tick()};n.prototype._tick=function(){this._ticking=!0;window.requestAnimFrame(this._boundTick,30);this.textureEntry&&this.textureEntry.setImage(this.video)};n.prototype.setTextureEntry=function(a){this.textureEntry=a;this.video&&this.textureEntry.setImage(this.video,!0)};n.prototype.notifyChanged=
function(b){b.type==a.VALUE_MODIFIED&&"src"==b.mutation.attributeName&&this.createVideoFromURL(this.node.src)};n.prototype.getValue=function(){return this.video};n.prototype.getOutputs=function(){return{video:this}};j.exports={ImgDataAdapter:i,VideoDataAdapter:n,SinkDataAdapter:k}},{"../../base/adapter.js":7,"../../base/resourcemanager.js":10,"../../interface/notification.js":36,"../../utils/misc.js":131,"../../utils/uri.js":133,"./data.js":18}],24:[function(h,j){var e=h("../../interface/notification.js"),
a=XML3D.createClass,d=h("../../base/adapter.js").NodeAdapter,b=function(a,b){d.call(this,a,b);this.connectedAdapterHandle=null;b.src&&(this.connectedAdapterHandle=this.getAdapterHandle(b.src),this.connectAdapterHandle(b.name,this.connectedAdapterHandle))};a(b,d);b.prototype.getScriptType=function(){return this.node.type};b.prototype.getScript=function(){return this.node.src?this.externalScript:this.node.value};b.prototype.notifyChanged=function(a){switch(a.type){case e.VALUE_MODIFIED:case e.NODE_INSERTED:case e.NODE_REMOVED:this.notifyOppositeAdapters();
break;case e.ADAPTER_HANDLE_CHANGED:this.externalScript=a.adapter.script,this.notifyOppositeAdapters()}};j.exports=b},{"../../base/adapter.js":7,"../../interface/notification.js":36}],25:[function(h,j){var e=h("../../xflow/interface/data.js").TextureEntry,a=h("../../xflow/interface/graph.js").InputNode,d=h("../../xflow/interface/constants.js"),b=h("../../interface/notification.js"),c=h("../../base/adapter.js").NodeAdapter,g=function(a){if("clamp"==a)return WebGLRenderingContext.CLAMP_TO_EDGE;if("repeat"==
a)return WebGLRenderingContext.REPEAT},f=function(a){if("nearest"==a)return WebGLRenderingContext.NEAREST;if("linear"==a)return WebGLRenderingContext.LINEAR;if("nearest-mipmap-nearest"==a)return WebGLRenderingContext.NEAREST_MIPMAP_NEAREST;if("linear-mipmap-nearest"==a)return WebGLRenderingContext.LINEAR_MIPMAP_NEAREST;if("nearest-mipmap-linear"==a)return WebGLRenderingContext.NEAREST_MIPMAP_LINEAR;if("linear-mipmap-linear"==a)return WebGLRenderingContext.LINEAR_MIPMAP_LINEAR},k=function(a,b){c.call(this,
a,b)};XML3D.createClass(k,c);k.prototype.init=function(){this.xflowInputNode=this.createXflowNode();this.xflowInputNode.data=this.createTextureEntry()};k.prototype.createTextureEntry=function(){var a=this.node,b=new e(null),c=b.getSamplerConfig();c.wrapS=g(a.wrapS);c.wrapT=g(a.wrapT);c.minFilter=f(a.filterMin);c.magFilter=f(a.filterMag);c.textureType=d.TEX_TYPE.TEXTURE_2D;c.generateMipMap=this.shouldGenerateMipMaps(c.minFilter,c.magFilter);(a=this.factory.getAdapter(this.node.firstElementChild))&&
a.setTextureEntry(b);return b};k.prototype.shouldGenerateMipMaps=function(a,b){return a!=WebGLRenderingContext.NEAREST&&a!=WebGLRenderingContext.LINEAR||b!=WebGLRenderingContext.NEAREST&&b!=WebGLRenderingContext.LINEAR};k.prototype.createXflowNode=function(){var b=new a;b.name=this.node.name;b.paramName=this.node.param?this.node.name:null;b.key=this.node.key;return b};k.prototype.setScriptValue=function(){XML3D.debug.logError("Texture currently does not support setScriptValue()")};k.prototype.getOutputs=
function(){var a={};a[this.node.name]=this;return a};k.prototype.getValue=function(){return this.value};k.prototype.notifyChanged=function(a){a.type==b.VALUE_MODIFIED&&(a=a.mutation.attributeName,"name"==a?this.xflowInputNode.name=this.node.name:"key"==a?this.xflowInputNode.key=this.node.key:"param"==a&&(this.xflowInputNode.paramName=this.node.param?this.node.name:null))};k.prototype.getXflowNode=function(){return this.xflowInputNode};k.prototype.toString=function(){return"XML3D.data.TextureDataAdapter"};
j.exports=k},{"../../base/adapter.js":7,"../../interface/notification.js":36,"../../xflow/interface/constants.js":136,"../../xflow/interface/data.js":137,"../../xflow/interface/graph.js":138}],26:[function(h,j){var e=h("../../interface/notification.js"),a=h("../../base/adapter.js").NodeAdapter,d=function(b,d){a.call(this,b,d);this.needsUpdate=this.isValid=!0};XML3D.createClass(d,a);var b=XML3D.math.mat4.identity(XML3D.math.mat4.create());d.prototype.init=function(){this.matrix=XML3D.math.mat4.create();
this.transform={translate:XML3D.math.mat4.create(),scale:XML3D.math.mat4.create(),scaleOrientation:XML3D.math.mat4.create(),scaleOrientationInv:XML3D.math.mat4.create(),center:XML3D.math.mat4.create(),centerInverse:XML3D.math.mat4.create(),rotation:XML3D.math.mat4.create()};this.needsUpdate=!0;this.checkForImproperNesting()};d.prototype.updateMatrix=function(){var a=this.node,d=this.transform,f=a.center._data;XML3D.math.mat4.fromQuat(d.scaleOrientation,a.scaleOrientation._data);XML3D.math.mat4.fromQuat(d.rotation,
a.rotation._data);XML3D.math.mat4.translate(d.translate,b,a.translation._data);XML3D.math.mat4.translate(d.center,b,f);XML3D.math.mat4.translate(d.centerInverse,b,XML3D.math.vec3.negate(f,f));XML3D.math.mat4.scale(d.scale,b,a.scale._data);XML3D.math.mat4.invert(d.scaleOrientationInv,d.scaleOrientation);a=this.matrix;XML3D.math.mat4.multiply(a,d.translate,d.center);XML3D.math.mat4.multiply(a,a,d.rotation);XML3D.math.mat4.multiply(a,a,d.scaleOrientation);XML3D.math.mat4.multiply(a,a,d.scale);XML3D.math.mat4.multiply(a,
a,d.scaleOrientationInv);XML3D.math.mat4.multiply(a,a,d.centerInverse);this.needsUpdate=!1};d.prototype.getMatrix=function(){this.needsUpdate&&this.updateMatrix();return this.matrix};d.prototype.notifyChanged=function(a){a.type==e.VALUE_MODIFIED?(this.needsUpdate=!0,this.notifyOppositeAdapters(e.ADAPTER_VALUE_CHANGED)):a.type==e.NODE_REMOVED&&(this.dispose(),this.notifyOppositeAdapters(e.ADAPTER_HANDLE_CHANGED))};d.prototype.dispose=function(){this.isValid=!1};d.prototype.checkForImproperNesting=
function(){for(var a=0;a<this.node.childNodes.length;a++)"transform"===this.node.childNodes[a].localName&&XML3D.debug.logError("Parsing error: Transform elements cannot be nested!",this.node)};j.exports=d},{"../../base/adapter.js":7,"../../interface/notification.js":36}],27:[function(h,j){var e=h("../../xflow/interface/data.js").BufferEntry,a=h("../../xflow/interface/graph.js").InputNode,d=h("../../xflow/interface/constants.js"),b=h("../../interface/notification.js"),c=h("../../base/adapter.js").NodeAdapter,
g=function(a,b){c.call(this,a,b);this.xflowInputNode=null};XML3D.createClass(g,c);g.prototype.init=function(){var b=this.node._configured;"[value set by script]"==this.node.textContent?b=b.scriptValue:(delete b.scriptValue,b=this.node.value);var c=d.DATA_TYPE.fromString(this.node.localName),b=new e(c,b);this.xflowInputNode=new a(null);this.xflowInputNode.name=this.node.name;this.xflowInputNode.data=b;this.xflowInputNode.key=this.node.key;this.xflowInputNode.paramName=this.node.param?this.node.name:
null;this.checkForImproperNesting()};g.prototype.getXflowNode=function(){return this.xflowInputNode};g.prototype.notifyChanged=function(a){a.type==b.VALUE_MODIFIED&&((a=a.mutation.attributeName)?"name"==a?this.xflowInputNode.name=this.node.name:"key"==a?this.xflowInputNode.key=this.node.key:"param"==a&&(this.xflowInputNode.paramName=this.node.param?this.node.name:null):(delete this.node._configured.scriptValue,this.xflowInputNode.data.setValue(this.node.value)))};g.prototype.setScriptValue=function(a){this.xflowInputNode.data.setValue(a)};
g.prototype.toString=function(){return"XML3D.data.ValueDataAdapter"};g.prototype.checkForImproperNesting=function(){for(var a=0;a<this.node.childNodes.length;a++)d.DATA_TYPE.fromString(this.node.childNodes[a].localName)&&XML3D.debug.logError("Parsing error: Value elements cannot be nested!",this.node)};j.exports=g},{"../../base/adapter.js":7,"../../interface/notification.js":36,"../../xflow/interface/constants.js":136,"../../xflow/interface/data.js":137,"../../xflow/interface/graph.js":138}],28:[function(h,
j){var e=h("../xflow/interface/request.js").ComputeRequest,a=h("../interface/notification.js"),d=h("../utils/css.js"),b=function(a,b,d,k){this.owner=a;this.node=a.node;this.attrName=b;this.dataName=d;this.xflowRequest=this.adapterHandle=null;this.onlyDataTransform=k||!1;this._bindedCallback=this._onChange.bind(this)};b.prototype.clear=function(){this.xflowRequest&&this.xflowRequest.clear();this.xflowRequest=null;this.adapterHandle&&this.adapterHandle.removeListener(this._bindedCallback)};b.prototype.update=
function(){var a=this.owner.getAdapterHandle(this.node.getAttribute(this.attrName),"data",0);a!=this.adapterHandle&&(this.clear(),(this.adapterHandle=a)&&a.addListener(this._bindedCallback));this.updateMatrix()};b.prototype.updateMatrix=function(){this.owner.onTransformChange(this.attrName,this.getMatrix())};b.prototype.getMatrix=function(){var a=XML3D.math.mat4.create();return function(){if(!this.onlyDataTransform){var b=d.getCSSMatrix(this.node);if(b)return d.convertCssToMat4(b)}var f;if(this.adapterHandle&&
(f=this.adapterHandle.getAdapter())){if(f.getXflowNode&&(this.xflowRequest||(this.xflowRequest=new e(f.getXflowNode(),[this.dataName],this._bindedCallback)),b=this.xflowRequest.getResult(),b=b.getOutputData(this.dataName)&&b.getOutputData(this.dataName).getValue()))return b;if(f.getMatrix)return f.getMatrix()}return this.onlyDataTransform?null:a}}();b.prototype._onChange=function(b){if(b.type==a.ADAPTER_VALUE_CHANGED)this.owner.onTransformChange(this.attrName,b.adapterHandle.getAdapter().getMatrix());
else this.updateMatrix()};j.exports=b},{"../interface/notification.js":36,"../utils/css.js":128,"../xflow/interface/request.js":139}],29:[function(h,j){if(void 0!==window.XML3D)throw Error("Tried to define the XML3D namespace a second time. Please ensure xml3d.js is only loaded once!");var e=e||{},a=a||{};window.XML3D=e;window.Xflow=a;e.version="4.9.0";e.xml3dNS="http://www.xml3d.org/2009/xml3d";e.xhtmlNS="http://www.w3.org/1999/xhtml";e.webglNS="http://www.xml3d.org/2009/xml3d/webgl";e._xml3d=document.createElementNS(e.xml3dNS,
"xml3d");e._parallel=void 0!=e._parallel?e._parallel:!1;e.xhtml=!(!document.doctype||!(new XMLSerializer).serializeToString(document.doctype).match(/xhtml/i));e.createElement=function(a){return document.createElementNS(e.xml3dNS,a)};e.extend=function(a,b){for(var c in b){var g=b.__lookupGetter__(c),f=b.__lookupSetter__(c);if(g||f)g&&a.__defineGetter__(c,g),f&&a.__defineSetter__(c,f);else if(void 0===b[c])delete a[c];else if("constructor"!==c||a!==window)a[c]=b[c]}return a};e.isSuperclassOf=function(a,
b){for(;b&&b.superclass;){if(b.superclass===a.prototype)return!0;b=b.superclass.constructor}return!1};e.createClass=function(a,b,c){c=c||{};if(b){var g=function(){};g.prototype=b.prototype;a.prototype=new g;a.prototype.constructor=a;a.superclass=b.prototype}a.isSuperclassOf=e.isSuperclassOf.bind(a,a);for(var f in c)a.prototype[f]=c[f];return a};e.debug=h("./utils/debug.js");e.util=h("./utils/misc.js");e.options=h("./utils/options.js");e.shaders=h("./renderer/webgl/materials/urn/shaders.js");e.resource=
h("./base/resourcemanager.js").Resource;e.resource.registerFormat=h("./base/resourcemanager.js").registerFormat;e.webcl=h("./utils/webcl.js").webcl;e.math=h("gl-matrix");e.math.bbox=h("./math/bbox.js");h("./math/math.js")(e.math);window.XML3DBox=h("./types/box.js");e.extend(window,h("./types/data-observer.js"));window.XML3DMatrix=h("./types/matrix.js");window.XML3DRay=h("./types/ray.js");window.XML3DRotation=h("./types/rotation.js");window.XML3DVec3=h("./types/vec3.js");a.registerOperator=h("./xflow/operator/operator.js").registerOperator;
a.constants=h("./xflow/interface/constants.js");e.extend(a,h("./xflow/interface/graph.js"));e.extend(a,h("./xflow/interface/data.js"));a.ComputeRequest=h("./xflow/interface/request.js").ComputeRequest;h("./xflow/operator/default");j.exports={XML3D:e,Xflow:a}},{"./base/resourcemanager.js":10,"./math/bbox.js":38,"./math/math.js":39,"./renderer/webgl/materials/urn/shaders.js":94,"./types/box.js":121,"./types/data-observer.js":122,"./types/matrix.js":123,"./types/ray.js":124,"./types/rotation.js":125,
"./types/vec3.js":126,"./utils/debug.js":130,"./utils/misc.js":131,"./utils/options.js":132,"./utils/webcl.js":134,"./xflow/interface/constants.js":136,"./xflow/interface/data.js":137,"./xflow/interface/graph.js":138,"./xflow/interface/request.js":139,"./xflow/operator/default":156,"./xflow/operator/operator.js":176,"gl-matrix":1}],30:[function(h,j){function e(a){if(!(-1<p.indexOf(a))){p.push(a);var b=f.debug.setup();if(r()){f.debug.logInfo("Configuring",a.querySelectorAll("*").length,"elements");
try{k.configure(a)}catch(c){b&&f.debug.logException(c);p.splice(p.indexOf(a),1);return}try{m(a)}catch(d){b&&f.debug.logException(d);p.splice(p.indexOf(a),1);return}i(a,{onConfigured:[]});p.splice(p.indexOf(a),1);o&&o.takeRecords()}else{b&&f.debug.logWarning("Could not initialise WebGL, sorry :-(");a.hasAttribute("onunsupported")&&(b=new Function("event",a.getAttribute("onunsupported")),a.addEventListener("unsupported",b,!1));if(f.util.dispatchCustomEvent(a,"unsupported",!1,!0,null)){b=document.createElementNS(f.xhtmlNS,
"div");a.parentNode.insertBefore(b,a);b.appendChild(a);b.style.display="none";var g=document.createElementNS(f.xhtmlNS,"div");a.hasAttribute("class")&&g.setAttribute("class",a.getAttribute("class"));g.setAttribute("style",a.getAttribute("style"));g.style.border="2px solid red";g.style.fontFamily="verdana,sans-serif";g.style.color="red";g.style.padding="10px";g.style.backgroundColor="rgba(255, 0, 0, 0.3)";var e=a.getAttribute("width");null!==e&&(g.style.width=e);e=a.getAttribute("height");null!==e&&
(g.style.height=e);var e=document.createElement("h3"),l=document.createTextNode("Sorry, your browser doesn't appear to support XML3D.");e.appendChild(l);l=document.createElement("p");l.appendChild(document.createTextNode("Please visit "));var n=document.createElement("a");n.setAttribute("href","http://www.xml3d.org/help");n.appendChild(document.createTextNode("http://www.xml3d.org/help"));l.appendChild(n);l.appendChild(document.createTextNode(" for more information."));g.appendChild(e);g.appendChild(l);
b.parentNode.insertBefore(g,b)}p.splice(p.indexOf(a),1)}}}function a(a){if(!(-1<p.indexOf(a))&&(a._configured=void 0,a.parentNode)){var b=a.parentNode.previousElementSibling,c=a.parentNode.parentNode;c&&b&&"canvas"===b.tagName&&(c.removeChild(a.parentNode),c.removeChild(b))}}function d(a){"xml3d"===a.target.tagName&&e(a.target)}function b(b){"xml3d"===b.target.tagName&&a(b.target)}function c(){if(f.document)f.document.onunload()}function g(b){for(var c=0;c<b.length;++c){var d=b[c];if("childList"==
d.type){for(var f=d.addedNodes,g=f.length;g--;)"xml3d"==f[g].tagName&&e(f[g]);d=d.removedNodes;for(g=d.length;g--;)"xml3d"==d[g].tagName&&a(d[g])}}}var f=h("./global.js").XML3D,k=h("./interface/elements.js").config,i=h("./utils/misc.js").sendAdapterEvent,n=h("./utils/options.js"),l=h("./utils/css.js"),m=h("./renderer/renderer/configure.js"),r=h("./renderer/webgl/base/utils.js").supported;h("./interface/dom.js");h("./utils/debug.js");(function(){if(navigator.userAgent.match(/(iPad|iPhone|iPod touch)/i)){var a=
document.createElement("meta");a.name="format-detection";a.content="telephone=no";document.head.appendChild(a)}})();var p=[],q=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,o=null;document.addEventListener("DOMContentLoaded",function(){n.setOptionsFromQuery();l.init();var a=f.debug.setup();a&&f.debug.logInfo("xml3d.js version: "+f.version);var c=document.querySelectorAll("xml3d");a&&f.debug.logInfo("Found "+c.length+" xml3d node(s)");for(a=0;a<c.length;a++)e(c[a]);
q?(o=new q(g),o.observe(document.documentElement,{childList:!0,subtree:!0})):(document.addEventListener("DOMNodeInserted",d,!1),document.addEventListener("DOMNodeRemoved",b,!1))},!1);window.addEventListener("unload",c,!1);window.addEventListener("reload",c,!1);j.exports=f},{"./global.js":29,"./interface/dom.js":33,"./interface/elements.js":34,"./renderer/renderer/configure.js":53,"./renderer/webgl/base/utils.js":79,"./utils/css.js":128,"./utils/debug.js":130,"./utils/misc.js":131,"./utils/options.js":132}],
31:[function(h,j){h("../utils/array.js");var e=h("../base/resourcemanager.js").Resource,a=function(a){if(!a)return!1;switch(a.toLowerCase()){case "true":case "1":return!0;case "false":case "0":return!1;default:return Boolean(a)}},d={},b=function(){};d.IDHandler=function(a){this.setFromAttribute=function(a,b,c){e.notifyNodeIdChange(c,b,a)};this.desc={get:function(){return this.getAttribute(a)||""},set:function(b){this.setAttribute(a,b)}}};d.StringAttributeHandler=function(a){this.desc={get:function(){return this.getAttribute(a)||
""},set:function(b){this.setAttribute(a,b)}}};d.EnumAttributeHandler=function(a,b){this.init=function(c,d){d[a]=b.d;c.hasAttribute(a)&&this.setFromAttribute(c.getAttribute(a),null,c,d)};this.setFromAttribute=function(c,d,g,e){c=c.toLowerCase();e[a]=c&&void 0!==b.e[c]?b.e[c]:b.d;return!1};this.desc={get:function(){XML3D.flushDOMChanges();return b.e[this._configured.storage[a]]},set:function(c){this.setAttribute(a,c);var d=this._configured.storage,c="string"==typeof c?c.toLowerCase():void 0;d[a]=c&&
void 0!==b.e[c]?b.e[c]:b.d}}};d.EnumAttributeHandler.prototype=new b;d.EnumAttributeHandler.prototype.constructor=d.EnumAttributeHandler;d.EventAttributeHandler=function(a){var b=a.substring(2);this.init=function(b,c){c[a]=null;b.hasAttribute(a)&&this.setFromAttribute(b.getAttribute(a),null,b,c)};this.setFromAttribute=function(c,d,g,e){null!=e[a]&&g.removeEventListener(b,e[a]);c?(e[a]=eval("crx = function "+a+"(event){\n  "+c+"\n}"),XML3D.xhtml&&g.addEventListener(b,e[a],!1)):e[a]=null;return!1};
this.desc={get:function(){XML3D.flushDOMChanges();return this._configured.storage[a]},set:function(c){var d=this._configured.storage;XML3D.xhtml&&d[a]&&this.removeEventListener(b,d[a]);d[a]="function"==typeof c?c:void 0;XML3D.xhtml&&d[a]&&this.addEventListener(b,d[a],!1);return!1}}};d.EventAttributeHandler.prototype=new b;d.EventAttributeHandler.prototype.constructor=d.EventAttributeHandler;d.IntAttributeHandler=function(a,b){this.init=function(c,d){d[a]=b;c.hasAttribute(a)&&this.setFromAttribute(c.getAttribute(a),
null,c,d)};this.setFromAttribute=function(c,d,g,e){var h=c.match(/^\d+/);!h||isNaN(+h[0])?(XML3D.debug.logWarning("Invalid attribute ["+a+"] value: "+c,g),g.setAttribute(a,d),e[a]=b):e[a]=+h[0];g._configured.canvas&&(g._configured.canvas[a]=e[a]);return!1};this.desc={get:function(){XML3D.flushDOMChanges();return this._configured.storage[a]},set:function(c){var d=this._configured.storage,g=+c;isNaN(g)?(XML3D.debug.logWarning("Invalid attribute ["+a+"] value: "+c,this),d[a]=b):d[a]=Math.floor(g);this.setAttribute(a,
d[a]+"")}}};d.IntAttributeHandler.prototype=new b;d.IntAttributeHandler.prototype.constructor=d.IntAttributeHandler;d.FloatAttributeHandler=function(a,b){this.init=function(c,d){d[a]=b;c.hasAttribute(a)&&this.setFromAttribute(c.getAttribute(a),null,c,d)};this.setFromAttribute=function(c,d,g,e){var h=+c;isNaN(h)?(XML3D.debug.logWarning("Invalid attribute value: "+c,g),g.setAttribute(a,d),e[a]=b):e[a]=h;return!1};this.desc={get:function(){XML3D.flushDOMChanges();return this._configured.storage[a]},
set:function(c){var d=this._configured.storage,g=+c;isNaN(g)?(XML3D.debug.logWarning("Invalid attribute ["+a+"] value: "+c,this),d[a]=b):d[a]=g;this.setAttribute(a,d[a]+"")}}};d.BoolAttributeHandler=function(b,c){this.init=function(a,d){d[b]=c;a.hasAttribute(b)&&this.setFromAttribute(a.getAttribute(b),null,a,d)};this.setFromAttribute=function(c,d,g,e){e[b]=a(c);return!1};this.desc={get:function(){XML3D.flushDOMChanges();return this._configured.storage[b]},set:function(a){var c=this._configured.storage;
c[b]=Boolean(a);this.setAttribute(b,c[b]+"")}}};d.XML3DVec3AttributeHandler=function(a,b){var c=this;this.init=function(b,c){c[a]=null};this.initVec3=function(b,c,d,g,e){c[a]=new window.XML3DVec3(d,g,e,function(c){b.setAttribute(a,c.x+" "+c.y+" "+c.z)})};this.setFromAttribute=function(c,d,g,e){if(!e[a]){var i=!0;this.initVec3(g,e,0,0,0)}d=e[a];e=/^\s*(\S+)\s+(\S+)\s+(\S+)\s*$/.exec(c);!e||isNaN(+e[1])||isNaN(+e[2])||isNaN(+e[3])?(d._data.set(b),!i&&XML3D.debug.logWarning("Invalid attribute ["+a+"] value: "+
c,g)):(d._data[0]=+e[1],d._data[1]=+e[2],d._data[2]=+e[3]);return!1};this.desc={get:function(){XML3D.flushDOMChanges();var b=this._configured.storage;b[a]||c.setFromAttribute(this.getAttribute(a),null,this,b);return b[a]},set:function(){throw Error("Can't set "+this.nodeName+"::"+a+": it's readonly");}}};d.XML3DRotationAttributeHandler=function(a,b){var c=this;this.init=function(b,c){c[a]=null};this.initRotation=function(b,c){c[a]=new window.XML3DRotation(null,null,function(c){b.setAttribute(a,c.axis.x+
" "+c.axis.y+" "+c.axis.z+" "+c.angle)})};this.setFromAttribute=function(c,d,g,e){if(!e[a]){var i=!0;this.initRotation(g,e)}d=e[a];e=/^\s*(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s*$/.exec(c);!e||isNaN(+e[1])||isNaN(+e[2])||isNaN(+e[3])||isNaN(+e[4])?(d._axis._data[0]=b[0],d._axis._data[1]=b[1],d._axis._data[2]=b[2],d._angle=b[3],d._updateQuaternion(),!i&&XML3D.debug.logWarning("Invalid attribute ["+a+"] value: "+c,g)):(d._axis._data[0]=+e[1],d._axis._data[1]=+e[2],d._axis._data[2]=+e[3],d._angle=+e[4],d._updateQuaternion());
return!1};this.desc={get:function(){XML3D.flushDOMChanges();var b=this._configured.storage;b[a]||c.setFromAttribute(this.getAttribute(a),null,this,b);return b[a]},set:function(){throw Error("Can't set "+this.nodeName+"::"+a+": it's readonly");}}};var c=function(a){a.init=function(a){a._configured.registerMixed()};a.desc={get:function(){XML3D.flushDOMChanges();var b=this._configured.storage;b.value||(b.value=a.parse(this));return b.value},set:function(){throw Error("Can't set "+this.nodeName+"::value: it's readonly");
}};a.resetValue=function(a){a.value=null}},g=function(a){for(var b="",a=a.firstChild;a;)b+=3==a.nodeType?a.textContent:" ",a=a.nextSibling;return b};d.FloatArrayValueHandler=function(){c(this)};d.FloatArrayValueHandler.prototype.parse=function(a){return(a=g(a).match(/([+\-0-9eE\.]+)/g))?new Float32Array(a):new Float32Array};d.Float2ArrayValueHandler=d.FloatArrayValueHandler;d.Float3ArrayValueHandler=d.FloatArrayValueHandler;d.Float4ArrayValueHandler=d.FloatArrayValueHandler;d.Float4x4ArrayValueHandler=
d.FloatArrayValueHandler;d.IntArrayValueHandler=function(){c(this)};d.IntArrayValueHandler.prototype.parse=function(a){return(a=g(a).match(/([+\-0-9]+)/g))?new Int32Array(a):new Int32Array};d.BoolArrayValueHandler=function(){c(this)};d.BoolArrayValueHandler.prototype.parse=function(b){b=g(b).match(/(true|false|0|1)/ig);return!b?new Uint8Array:(b=Array.map(b,a))?new Uint8Array(b):new Uint8Array};d.StringValueHandler=function(){c(this)};d.StringValueHandler.prototype.parse=function(a){return a.textContent};
d.CanvasStyleHandler=function(a){this.init=function(b,c){b.hasAttribute(a)&&this.setFromAttribute(b.getAttribute(a),null,b,c)};this.setFromAttribute=function(b,c,d){d._configured.canvas.setAttribute(a,b)};this.desc={get:function(){return this._configured.canvas.style},set:function(){}}};d.CanvasClassHandler=function(a){this.init=function(b,c){b._configured.canvas.className="_xml3d";b.hasAttribute(a)&&this.setFromAttribute(b.getAttribute(a),null,b,c)};this.setFromAttribute=function(b,c,d){d._configured.canvas.setAttribute(a,
b+" _xml3d")};this.desc={get:function(){return this._configured.canvas.className},set:function(a){this._configured.canvas.className=a}}};j.exports=d},{"../base/resourcemanager.js":10,"../utils/array.js":127}],32:[function(h,j){var e=h("./methods.js"),a=h("./attributes.js"),d=h("./properties.js"),b={triangles:0,"0":"triangles",trianglestrips:1,1:"trianglestrips",lines:2,2:"lines",linestrips:3,3:"linestrips",points:4,4:"points"},c={"2d":0,"0":"2d","1d":1,1:"1d","3d":2,2:"3d"},g={nearest:1,1:"nearest",
linear:2,2:"linear","nearest-mipmap-nearest":3,3:"nearest-mipmap-nearest","linear-mipmap-nearest":4,4:"linear-mipmap-nearest","nearest-mipmap-linear":5,5:"nearest-mipmap-linear","linear-mipmap-linear":6,6:"linear-mipmap-linear"},f={clamp:0,"0":"clamp",repeat:1,1:"repeat",border:2,2:"border"},k={auto:1,1:"auto",js:2,2:"js",gl:3,3:"gl",cl:4,4:"cl"},i={};i.xml3d={id:{a:a.IDHandler},className:{a:a.CanvasClassHandler,id:"class"},style:{a:a.CanvasStyleHandler},onclick:{a:a.EventAttributeHandler},ondblclick:{a:a.EventAttributeHandler},
onmousedown:{a:a.EventAttributeHandler},onmouseup:{a:a.EventAttributeHandler},onmouseover:{a:a.EventAttributeHandler},onmousemove:{a:a.EventAttributeHandler},onmouseout:{a:a.EventAttributeHandler},onkeypress:{a:a.EventAttributeHandler},onkeydown:{a:a.EventAttributeHandler},onkeyup:{a:a.EventAttributeHandler},onload:{a:a.EventAttributeHandler},complete:{p:d.xml3dComplete},height:{a:a.IntAttributeHandler,params:600},width:{a:a.IntAttributeHandler,params:800},getElementByPoint:{m:e.xml3dGetElementByPoint},
generateRay:{m:e.xml3dGenerateRay},getElementByRay:{m:e.xml3dGetElementByRay},getBoundingBox:{m:e.deprecatedGetBoundingBoxWorld},getWorldBoundingBox:{m:e.getWorldBoundingBox},getLocalBoundingBox:{m:e.getLocalBoundingBox},getRenderInterface:{m:e.xml3dGetRenderInterface},activeView:{a:a.StringAttributeHandler},_term:void 0};i.compute={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},value:{a:a.StringValueHandler},_term:void 0};i.data={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,
id:"class"},compute:{a:a.StringAttributeHandler},platform:{a:a.EnumAttributeHandler,params:{e:k,d:1}},filter:{a:a.StringAttributeHandler},onload:{a:a.EventAttributeHandler},onprogress:{a:a.EventAttributeHandler},complete:{p:d.XML3DNestedDataContainerTypeComplete},progressLevel:{p:d.XML3DNestedDataContainerTypeProgressLevel},getOutputNames:{m:e.XML3DNestedDataContainerTypeGetOutputNames},getOutputChannelInfo:{m:e.XML3DNestedDataContainerTypeGetOutputChannelInfo},getComputeInfo:{m:e.XML3DNestedDataContainerTypeGetComputeInfo},
getProtoInfo:{m:e.XML3DNestedDataContainerTypeGetProtoInfo},isOutputConnected:{m:e.XML3DNestedDataContainerTypeIsOutputConnected},getResult:{m:e.XML3DNestedDataContainerTypeGetResult},src:{a:a.StringAttributeHandler},_term:void 0};i.dataflow={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},platform:{a:a.EnumAttributeHandler,params:{e:k,d:1}},out:{a:a.StringAttributeHandler},onload:{a:a.EventAttributeHandler},onprogress:{a:a.EventAttributeHandler},complete:{p:d.XML3DNestedDataContainerTypeComplete},
progressLevel:{p:d.XML3DNestedDataContainerTypeProgressLevel},getOutputNames:{m:e.XML3DNestedDataContainerTypeGetOutputNames},getOutputChannelInfo:{m:e.XML3DNestedDataContainerTypeGetOutputChannelInfo},getComputeInfo:{m:e.XML3DNestedDataContainerTypeGetComputeInfo},getProtoInfo:{m:e.XML3DNestedDataContainerTypeGetProtoInfo},isOutputConnected:{m:e.XML3DNestedDataContainerTypeIsOutputConnected},getResult:{m:e.XML3DNestedDataContainerTypeGetResult},_term:void 0};i.asset={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,
id:"class"},onload:{a:a.EventAttributeHandler},onprogress:{a:a.EventAttributeHandler},complete:{p:d.AssetComplete},progressLevel:{p:d.AssetProgressLevel},src:{a:a.StringAttributeHandler},name:{a:a.StringAttributeHandler},pick:{a:a.StringAttributeHandler},transform:{a:a.StringAttributeHandler},shader:{a:a.StringAttributeHandler},_term:void 0};i.defs={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},_term:void 0};i.group={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,
id:"class"},onclick:{a:a.EventAttributeHandler},ondblclick:{a:a.EventAttributeHandler},onmousedown:{a:a.EventAttributeHandler},onmouseup:{a:a.EventAttributeHandler},onmouseover:{a:a.EventAttributeHandler},onmousemove:{a:a.EventAttributeHandler},onmouseout:{a:a.EventAttributeHandler},onkeypress:{a:a.EventAttributeHandler},onkeydown:{a:a.EventAttributeHandler},onkeyup:{a:a.EventAttributeHandler},visible:{a:a.BoolAttributeHandler,params:!0},getWorldMatrix:{m:e.XML3DGraphTypeGetWorldMatrix},getLocalMatrix:{m:e.groupGetLocalMatrix},
getBoundingBox:{m:e.deprecatedGetBoundingBoxWorld},getWorldBoundingBox:{m:e.getWorldBoundingBox},getLocalBoundingBox:{m:e.getLocalBoundingBox},transform:{a:a.StringAttributeHandler},shader:{a:a.StringAttributeHandler},_term:void 0};i.mesh={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},onclick:{a:a.EventAttributeHandler},ondblclick:{a:a.EventAttributeHandler},onmousedown:{a:a.EventAttributeHandler},onmouseup:{a:a.EventAttributeHandler},onmouseover:{a:a.EventAttributeHandler},
onmousemove:{a:a.EventAttributeHandler},onmouseout:{a:a.EventAttributeHandler},onkeypress:{a:a.EventAttributeHandler},onkeydown:{a:a.EventAttributeHandler},onkeyup:{a:a.EventAttributeHandler},onload:{a:a.EventAttributeHandler},onprogress:{a:a.EventAttributeHandler},complete:{p:d.XML3DNestedDataContainerTypeComplete},progressLevel:{p:d.XML3DNestedDataContainerTypeProgressLevel},visible:{a:a.BoolAttributeHandler,params:!0},type:{a:a.EnumAttributeHandler,params:{e:b,d:0}},compute:{a:a.StringAttributeHandler},
transform:{a:a.StringAttributeHandler},shader:{a:a.StringAttributeHandler},getWorldMatrix:{m:e.XML3DGraphTypeGetWorldMatrix},getBoundingBox:{m:e.deprecatedGetBoundingBoxLocal},getWorldBoundingBox:{m:e.getWorldBoundingBox},getLocalBoundingBox:{m:e.getLocalBoundingBox},getOutputNames:{m:e.meshGetOutputNames},getOutputChannelInfo:{m:e.meshGetOutputChannelInfo},getComputeInfo:{m:e.meshGetComputeInfo},getProtoInfo:{m:e.meshGetProtoInfo},isOutputConnected:{m:e.meshIsOutputConnected},getResult:{m:e.meshGetResult},
src:{a:a.StringAttributeHandler},_term:void 0};i.model={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},onclick:{a:a.EventAttributeHandler},ondblclick:{a:a.EventAttributeHandler},onmousedown:{a:a.EventAttributeHandler},onmouseup:{a:a.EventAttributeHandler},onmouseover:{a:a.EventAttributeHandler},onmousemove:{a:a.EventAttributeHandler},onmouseout:{a:a.EventAttributeHandler},onkeypress:{a:a.EventAttributeHandler},onkeydown:{a:a.EventAttributeHandler},onkeyup:{a:a.EventAttributeHandler},
onload:{a:a.EventAttributeHandler},onprogress:{a:a.EventAttributeHandler},complete:{p:d.AssetComplete},progressLevel:{p:d.AssetProgressLevel},visible:{a:a.BoolAttributeHandler,params:!0},getWorldMatrix:{m:e.XML3DGraphTypeGetWorldMatrix},getBoundingBox:{m:e.deprecatedGetBoundingBoxLocal},getWorldBoundingBox:{m:e.getWorldBoundingBox},getLocalBoundingBox:{m:e.getLocalBoundingBox},src:{a:a.StringAttributeHandler},pick:{a:a.StringAttributeHandler},transform:{a:a.StringAttributeHandler},shader:{a:a.StringAttributeHandler},
_term:void 0};i.transform={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},translation:{a:a.XML3DVec3AttributeHandler,params:[0,0,0]},scale:{a:a.XML3DVec3AttributeHandler,params:[1,1,1]},rotation:{a:a.XML3DRotationAttributeHandler,params:[0,0,1,0]},center:{a:a.XML3DVec3AttributeHandler,params:[0,0,0]},scaleOrientation:{a:a.XML3DRotationAttributeHandler,params:[0,0,1,0]},_term:void 0};i.shader={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},onload:{a:a.EventAttributeHandler},
onprogress:{a:a.EventAttributeHandler},complete:{p:d.XML3DNestedDataContainerTypeComplete},progressLevel:{p:d.XML3DNestedDataContainerTypeProgressLevel},compute:{a:a.StringAttributeHandler},getOutputNames:{m:e.XML3DShaderProviderTypeGetOutputNames},getOutputChannelInfo:{m:e.XML3DShaderProviderTypeGetOutputChannelInfo},getComputeInfo:{m:e.XML3DShaderProviderTypeGetComputeInfo},getProtoInfo:{m:e.XML3DShaderProviderTypeGetProtoInfo},isOutputConnected:{m:e.XML3DShaderProviderTypeIsOutputConnected},getResult:{m:e.XML3DShaderProviderTypeGetResult},
script:{a:a.StringAttributeHandler},src:{a:a.StringAttributeHandler},_term:void 0};i.light={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},onclick:{a:a.EventAttributeHandler},ondblclick:{a:a.EventAttributeHandler},onmousedown:{a:a.EventAttributeHandler},onmouseup:{a:a.EventAttributeHandler},onmouseover:{a:a.EventAttributeHandler},onmousemove:{a:a.EventAttributeHandler},onmouseout:{a:a.EventAttributeHandler},onkeypress:{a:a.EventAttributeHandler},onkeydown:{a:a.EventAttributeHandler},
onkeyup:{a:a.EventAttributeHandler},visible:{a:a.BoolAttributeHandler,params:!0},global:{a:a.BoolAttributeHandler,params:!1},intensity:{a:a.FloatAttributeHandler,params:1},getWorldMatrix:{m:e.XML3DGraphTypeGetWorldMatrix},shader:{a:a.StringAttributeHandler},_term:void 0};i.lightshader={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},onload:{a:a.EventAttributeHandler},onprogress:{a:a.EventAttributeHandler},complete:{p:d.XML3DNestedDataContainerTypeComplete},progressLevel:{p:d.XML3DNestedDataContainerTypeProgressLevel},
compute:{a:a.StringAttributeHandler},getOutputNames:{m:e.XML3DShaderProviderTypeGetOutputNames},getOutputChannelInfo:{m:e.XML3DShaderProviderTypeGetOutputChannelInfo},getComputeInfo:{m:e.XML3DShaderProviderTypeGetComputeInfo},getProtoInfo:{m:e.XML3DShaderProviderTypeGetProtoInfo},isOutputConnected:{m:e.XML3DShaderProviderTypeIsOutputConnected},getResult:{m:e.XML3DShaderProviderTypeGetResult},script:{a:a.StringAttributeHandler},src:{a:a.StringAttributeHandler},_term:void 0};i.script={id:{a:a.IDHandler},
className:{a:a.StringAttributeHandler,id:"class"},value:{a:a.StringValueHandler},src:{a:a.StringAttributeHandler},name:{a:a.StringAttributeHandler},type:{a:a.StringAttributeHandler},_term:void 0};i.assetmesh={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},name:{a:a.StringAttributeHandler},match:{a:a.StringAttributeHandler},type:{a:a.EnumAttributeHandler,params:{e:b,d:0}},compute:{a:a.StringAttributeHandler},filter:{a:a.StringAttributeHandler},includes:{a:a.StringAttributeHandler},
shader:{a:a.StringAttributeHandler},transform:{a:a.StringAttributeHandler},platform:{a:a.EnumAttributeHandler,params:{e:k,d:1}},getOutputNames:{m:e.XML3DNestedDataContainerTypeGetOutputNames},getOutputChannelInfo:{m:e.XML3DNestedDataContainerTypeGetOutputChannelInfo},getComputeInfo:{m:e.XML3DNestedDataContainerTypeGetComputeInfo},getProtoInfo:{m:e.XML3DNestedDataContainerTypeGetProtoInfo},isOutputConnected:{m:e.XML3DNestedDataContainerTypeIsOutputConnected},getResult:{m:e.XML3DNestedDataContainerTypeGetResult},
src:{a:a.StringAttributeHandler},_term:void 0};i.assetdata={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},name:{a:a.StringAttributeHandler},compute:{a:a.StringAttributeHandler},filter:{a:a.StringAttributeHandler},includes:{a:a.StringAttributeHandler},platform:{a:a.EnumAttributeHandler,params:{e:k,d:1}},getOutputNames:{m:e.XML3DNestedDataContainerTypeGetOutputNames},getOutputChannelInfo:{m:e.XML3DNestedDataContainerTypeGetOutputChannelInfo},getComputeInfo:{m:e.XML3DNestedDataContainerTypeGetComputeInfo},
getProtoInfo:{m:e.XML3DNestedDataContainerTypeGetProtoInfo},isOutputConnected:{m:e.XML3DNestedDataContainerTypeIsOutputConnected},getResult:{m:e.XML3DNestedDataContainerTypeGetResult},src:{a:a.StringAttributeHandler},_term:void 0};i["float"]={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},name:{a:a.StringAttributeHandler},param:{a:a.BoolAttributeHandler,params:!1},key:{a:a.FloatAttributeHandler,params:0},value:{a:a.FloatArrayValueHandler},setScriptValue:{m:e.XML3DDataSourceTypeSetScriptValue},
_term:void 0};i.float2={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},name:{a:a.StringAttributeHandler},param:{a:a.BoolAttributeHandler,params:!1},key:{a:a.FloatAttributeHandler,params:0},value:{a:a.Float2ArrayValueHandler},setScriptValue:{m:e.XML3DDataSourceTypeSetScriptValue},_term:void 0};i.float3={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},name:{a:a.StringAttributeHandler},param:{a:a.BoolAttributeHandler,params:!1},key:{a:a.FloatAttributeHandler,
params:0},value:{a:a.Float3ArrayValueHandler},setScriptValue:{m:e.XML3DDataSourceTypeSetScriptValue},_term:void 0};i.float4={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},name:{a:a.StringAttributeHandler},param:{a:a.BoolAttributeHandler,params:!1},key:{a:a.FloatAttributeHandler,params:0},value:{a:a.Float4ArrayValueHandler},setScriptValue:{m:e.XML3DDataSourceTypeSetScriptValue},_term:void 0};i.float4x4={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},name:{a:a.StringAttributeHandler},
param:{a:a.BoolAttributeHandler,params:!1},key:{a:a.FloatAttributeHandler,params:0},value:{a:a.Float4x4ArrayValueHandler},setScriptValue:{m:e.XML3DDataSourceTypeSetScriptValue},_term:void 0};i["int"]={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},name:{a:a.StringAttributeHandler},param:{a:a.BoolAttributeHandler,params:!1},key:{a:a.FloatAttributeHandler,params:0},value:{a:a.IntArrayValueHandler},setScriptValue:{m:e.XML3DDataSourceTypeSetScriptValue},_term:void 0};i.int4={id:{a:a.IDHandler},
className:{a:a.StringAttributeHandler,id:"class"},name:{a:a.StringAttributeHandler},param:{a:a.BoolAttributeHandler,params:!1},key:{a:a.FloatAttributeHandler,params:0},value:{a:a.IntArrayValueHandler},setScriptValue:{m:e.XML3DDataSourceTypeSetScriptValue},_term:void 0};i.bool={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},name:{a:a.StringAttributeHandler},param:{a:a.BoolAttributeHandler,params:!1},key:{a:a.FloatAttributeHandler,params:0},value:{a:a.BoolArrayValueHandler},setScriptValue:{m:e.XML3DDataSourceTypeSetScriptValue},
_term:void 0};i.texture={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},name:{a:a.StringAttributeHandler},param:{a:a.BoolAttributeHandler,params:!1},key:{a:a.FloatAttributeHandler,params:0},type:{a:a.EnumAttributeHandler,params:{e:c,d:0}},filterMin:{a:a.EnumAttributeHandler,params:{e:g,d:6}},filterMag:{a:a.EnumAttributeHandler,params:{e:g,d:2}},filterMip:{a:a.EnumAttributeHandler,params:{e:g,d:1}},wrapS:{a:a.EnumAttributeHandler,params:{e:f,d:0}},wrapT:{a:a.EnumAttributeHandler,
params:{e:f,d:0}},wrapU:{a:a.EnumAttributeHandler,params:{e:f,d:0}},borderColor:{a:a.StringAttributeHandler},setScriptValue:{m:e.XML3DDataSourceTypeSetScriptValue},_term:void 0};i.img={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},src:{a:a.StringAttributeHandler},_term:void 0};i.video={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},src:{a:a.StringAttributeHandler},autoplay:{a:a.BoolAttributeHandler,params:!1},play:{m:e.videoPlay},pause:{m:e.videoPause},
_term:void 0};i.view={id:{a:a.IDHandler},className:{a:a.StringAttributeHandler,id:"class"},onclick:{a:a.EventAttributeHandler},ondblclick:{a:a.EventAttributeHandler},onmousedown:{a:a.EventAttributeHandler},onmouseup:{a:a.EventAttributeHandler},onmouseover:{a:a.EventAttributeHandler},onmousemove:{a:a.EventAttributeHandler},onmouseout:{a:a.EventAttributeHandler},onkeypress:{a:a.EventAttributeHandler},onkeydown:{a:a.EventAttributeHandler},onkeyup:{a:a.EventAttributeHandler},visible:{a:a.BoolAttributeHandler,
params:!0},position:{a:a.XML3DVec3AttributeHandler,params:[0,0,0]},orientation:{a:a.XML3DRotationAttributeHandler,params:[0,0,1,0]},fieldOfView:{a:a.FloatAttributeHandler,params:0.785398},getWorldMatrix:{m:e.XML3DGraphTypeGetWorldMatrix},setDirection:{m:e.viewSetDirection},setUpVector:{m:e.viewSetUpVector},lookAt:{m:e.viewLookAt},getDirection:{m:e.viewGetDirection},getUpVector:{m:e.viewGetUpVector},getViewMatrix:{m:e.viewGetViewMatrix},perspective:{a:a.StringAttributeHandler},_term:void 0};j.exports=
{classInfo:i,MeshTypes:b,FilterTypes:g,TextureTypes:c,WrapTypes:f,PlatformTypes:k,DataFieldTypes:{"float ":0,"0":"float ","float2 ":1,1:"float2 ",float3:2,2:"float3",float4:3,3:"float4",float4x4:4,4:"float4x4","int":10,10:"int",int4:11,11:"int4",bool:20,20:"bool",texture:30,30:"texture"},DataChannelOrigin:{"origin_value ":0,"0":"origin_value ",origin_child:1,1:"origin_child",origin_source:2,2:"origin_source",origin_compute:3,3:"origin_compute",origin_proto:4,4:"origin_proto"}}},{"./attributes.js":31,
"./methods.js":35,"./properties.js":37}],33:[function(h){var j=h("./elements.js").config,e=h("./configuration.js").classInfo,h={},a=document.getElementById;h.getElementById=function(b){var d=a.call(this,b);if(d)return d;for(var d=this.getElementsByTagName("*"),f=0;f<d.length;f++){var e=d[f];if(e.getAttribute("id")===b)return e}return null};var d=document.createElementNS;h.createElementNS=function(a,b){var f=d.call(this,a,b);(a==XML3D.xml3dNS||e[b.toLowerCase()])&&j.element(f);return f};var b=document.createElement;
h.createElement=function(a){var d=b.call(this,a);e[a.toLowerCase()]&&j.element(d);return d};XML3D.extend(window.document,h)},{"./configuration.js":32,"./elements.js":34}],34:[function(h,j){function e(g){for(var e=0;e<g.length;++e){var k=g[e];if("attributes"===k.type){var i=k,l=i.target;if(k=l._configured){var n=!1,h=k.handlers[i.attributeName]||k.handlers[i.attributeName.toLowerCase()];h&&h.setFromAttribute&&(n=l.getAttribute(i.attributeName),n=h.setFromAttribute(n,i.oldValue,l,k.storage));n||(i=
new f.NotificationWrapper(i,f.VALUE_MODIFIED,i.target),k.notify(i))}}else if("childList"===k.type){l=k.addedNodes;for(i=0;i<l.length;i++)if(l[i].nodeType===Node.TEXT_NODE)a(k);else{var n=l[i],m=k;if(h=m.target._configured)q.element(n),c(n),n=new f.NotificationWrapper(m,f.NODE_INSERTED,n),h.notify(n)}l=k.removedNodes;for(i=0;i<l.length;i++)if(l[i].nodeType!==Node.TEXT_NODE&&(h=l[i],n=k,m=n.target._configured)){var r=new f.NotificationWrapper(n,f.NODE_REMOVED,h);m.notify(r);h._configured?(r.type=f.THIS_REMOVED,
b(h,r),d(h)):h.nodeType===Node.TEXT_NODE&&a(n)}}else"characterData"==k.type&&a(k)}}function a(a){for(var b=a.target;!b._configured&&b.parentElement;)b=b.parentElement;var c=b._configured;c&&(a=new f.NotificationWrapper(a,f.VALUE_MODIFIED,b),void 0!==c.handlers.value&&c.handlers.value.resetValue(c.storage),c.notify(a))}function d(a){i.notifyNodeIdChange(a,a.id,null);for(a=a.firstElementChild;a;)d(a),a=a.nextElementSibling}function b(a,c){a._configured&&(a._configured.notify(c),a._configured.remove(c));
for(var d=a.firstElementChild;d;)b(d,c),d=d.nextElementSibling}function c(a){for(var b=a.firstElementChild;b;)c(b),b=b.nextElementSibling;i.notifyNodeIdChange(a,null,a.id)}function g(a,b,c){var d={get:function(){return c[a]}};try{Object.defineProperty(b,a,d)}catch(g){XML3D.debug.logWarning("Can't configure "+b.nodeName+"::"+a)}}var f=h("./notification.js"),k=h("./configuration.js").classInfo;h("../utils/array.js");var i=h("../base/resourcemanager.js").Resource,n=window.MutationObserver||window.WebKitMutationObserver||
window.MozMutationObserver,l;n?l=new n(e):(XML3D.debug.logError("XML3D requires MutationObservers, which your browser does not support. Please consider upgrading to a newer version."),l={takeRecords:function(){return[]},observe:function(){}});XML3D.flushDOMChanges=function(){var a=l.takeRecords();a.length&&e(a)};var m=function(a){if(a){this.element=a;this.handlers=null;this.storage={};this.adapters={};l.observe(a,{childList:true,attributes:true,attributeOldValue:true})}};m.prototype.registerAttributes=
function(a){var b=this.element,c=b instanceof HTMLElement,d=c?"_html":"_xml",g=d+"handlers",d=d+"proto",f=!!b.__proto__;if(!a._cache)a._cache={};if(!a._cache[g]){var e;if(f){e=function(){};e.prototype=b.__proto__;e=new e}var k={},i;for(i in a)if(i!="_cache")if(a[i]===void 0)e&&delete e[i];else if(a[i].a!==void 0){var l=a[i].id||i,n=new a[i].a(l,a[i].params);k[c?l.toLowerCase():l]=n;if(e)try{Object.defineProperty(e,i,n.desc)}catch(h){XML3D.debug.logWarning("Can't configure "+b.nodeName+"::"+i)}}else if(a[i].m!==
void 0){if(e)e[i]=a[i].m}else if(a[i].p!==void 0){if(e)try{Object.defineProperty(e,i,a[i].p)}catch(m){XML3D.debug.logWarning("Can't configure "+b.nodeName+"::"+i)}}else XML3D.debug.logError("Can't configure "+b.nodeName+"::"+i);a._cache[g]=k;a._cache[d]=e}this.handlers=a._cache[g];if(f){b.__proto__=a._cache[d];for(i in a)if(i!="_cache"&&a[i]&&a[i].a!==void 0){l=a[i].id||i;n=this.handlers[c?l.toLowerCase():l];n.init&&n.init(b,this.storage);delete b[i]}}else for(i in a)if(i!="_cache")if(a[i]===void 0)delete b[i];
else if(a[i].a!==void 0){l=a[i].id||i;n=this.handlers[c?l.toLowerCase():l];n.init&&n.init(b,this.storage);try{Object.defineProperty(b,i,n.desc)}catch(r){XML3D.debug.logWarning("Can't configure "+b.nodeName+"::"+i)}}else if(a[i].m!==void 0)b[i]=a[i].m;else if(a[i].p!==void 0)try{Object.defineProperty(b,i,a[i].p)}catch(q){XML3D.debug.logWarning("Can't configure "+b.nodeName+"::"+i)}return b};m.prototype.registerMixed=function(){l.observe(this.element,{childList:true,attributes:true,attributeOldValue:true,
characterData:true,subtree:true})};m.prototype.notify=function(a){var b=this.adapters,c;for(c in b)try{b[c].notifyChanged(a)}catch(d){XML3D.debug.logException(d)}};m.prototype.remove=function(){for(var a in this.adapters){var b=this.adapters[a];if(b.onDispose)b.onDispose();b.clearAdapterHandles&&b.clearAdapterHandles()}this.adapters={};for(a in this.handlers){b=this.handlers[a];b.remove&&b.remove()}};m.prototype.toString=function(){return"ElementHandler ("+this.element.nodeName+", id: "+this.element.id+
")"};var r="clientHeight,clientLeft,clientTop,clientWidth,offsetHeight,offsetLeft,offsetTop,offsetWidth".split(","),p=function(a){m.call(this,a);var b=document.createElement("canvas");b.width=800;b.height=600;this.canvas=b;for(var c in r)g(r[c],a,b);a.getBoundingClientRect=function(){return b.getBoundingClientRect()}};XML3D.createClass(p,m);var q={element:function(a){if(a._configured===void 0){var b=k[a.localName];if(b===void 0)XML3D.debug.logInfo("Unrecognised element "+a.localName);else{a._configured=
a.localName=="xml3d"?new p(a):new m(a);a._configured.registerAttributes(b);try{if(a.style==void 0)a.style=null}catch(c){}b=a.firstElementChild;for(i.notifyNodeIdChange(a,null,a.getAttribute("id"));b;){q.element(b);b=b.nextElementSibling}}}},configure:function(a){Array.isArray(a)?Array.forEach(a,function(a){q.element(a)}):q.element(a)}};j.exports={ElementHandler:m,XML3DHandler:p,config:q}},{"../base/resourcemanager.js":10,"../utils/array.js":127,"./configuration.js":32,"./notification.js":36}],35:[function(h,
j){function e(a,b){var c={},d;for(d in b){var g=b[d],f=a.getOutputData(g)&&a.getOutputData(g).getValue();f&&(c[g]=f)}return c}var a=h("../base/resourcemanager.js").Resource,d=h("../utils/misc.js").sendAdapterEvent,b=h("../utils/misc.js").callAdapterFunc,c={xml3dGetElementByRay:function(a,b,c){XML3D.flushDOMChanges();var d=this._configured.adapters||{},g;for(g in d)if(d[g].getElementByRay)return d[g].getElementByRay(a,b,c);return null},viewGetDirection:function(){return this.orientation.rotateVec3(new window.XML3DVec3(0,
0,-1))},viewSetPosition:function(a){this.position=a}},g=XML3D.math.vec3.create(),f=XML3D.math.vec3.create(),k=XML3D.math.vec3.create();c.viewSetDirection=function(a){var a=a||new window.XML3DVec3(0,0,-1),a=a.normalize(),b=this.orientation.rotateVec3(new window.XML3DVec3(0,1,0)),b=b.normalize();XML3D.math.vec3.cross(g,a._data,b._data);XML3D.math.vec3.length(g)||(g=this.orientation.rotateVec3(new window.XML3DVec3(1,0,0))._data);XML3D.math.vec3.cross(f,g,a._data);XML3D.math.vec3.negate(k,a._data);a=
XML3D.math.quat.create();XML3D.math.quat.setFromBasis(g,f,k,a);this.orientation._setQuaternion(a)};c.viewSetUpVector=function(a){var a=a||new window.XML3DVec3(0,1,0),a=a.normalize(),b=new window.XML3DRotation;b.setRotation(new window.XML3DVec3(0,1,0),a);b=this.orientation.multiply(b);b=b.normalize();this.orientation.set(b)};c.viewGetUpVector=function(){return this.orientation.rotateVec3(new window.XML3DVec3(0,1,0))};c.viewLookAt=function(a){this.setDirection(a.subtract(this.position))};c.viewGetViewMatrix=
function(){XML3D.flushDOMChanges();var a=this._configured.adapters||{},b;for(b in a)if(a[b].getViewMatrix)return a[b].getViewMatrix();a=this.position;b=this.orientation;var c=b.axis;return(new window.XML3DMatrix).translate(a.x,a.y,a.z).rotateAxisAngle(c.x,c.y,c.z,b.angle).inverse()};c.xml3dGetElementByPoint=function(a,b,c,d){XML3D.flushDOMChanges();var g=this._configured.adapters||{},f;for(f in g)if(g[f].getElementByPoint)return g[f].getElementByPoint(a,b,c,d);return null};c.xml3dGenerateRay=function(a,
b){var c=this._configured.adapters||{},d;for(d in c)if(c[d].generateRay)return c[d].generateRay(a,b);return new window.XML3DRay};c.deprecatedGetBoundingBoxWorld=function(){XML3D.debug.logWarning("getBoundingBox is deprecated and will be removed in a future version! Please use getLocalBoundingBox or getWorldBoundingBox instead.");return c.getWorldBoundingBox.call(this)};c.deprecatedGetBoundingBoxLocal=function(){XML3D.debug.logWarning("getBoundingBox is deprecated and will be removed in a future version! Please use getLocalBoundingBox or getWorldBoundingBox instead.");
return c.getLocalBoundingBox.call(this)};c.groupGetLocalMatrix=function(){XML3D.flushDOMChanges();var a=this._configured.adapters||{},b;for(b in a)if(a[b].getLocalMatrix)return a[b].getLocalMatrix();return new window.XML3DMatrix};c.getWorldBoundingBox=function(){XML3D.flushDOMChanges();var a=this._configured.adapters||{},b;for(b in a)if(a[b].getWorldBoundingBox)return a[b].getWorldBoundingBox();return new window.XML3DBox};c.getLocalBoundingBox=function(){XML3D.flushDOMChanges();var a=this._configured.adapters||
{},b;for(b in a)if(a[b].getLocalBoundingBox)return a[b].getLocalBoundingBox();return new window.XML3DBox};c.xml3dGetRenderInterface=function(){XML3D.flushDOMChanges();var a=this._configured.adapters||{},b;for(b in a)if(a[b].getRenderInterface)return a[b].getRenderInterface();return{}};c.XML3DGraphTypeGetWorldMatrix=function(){XML3D.flushDOMChanges();var a=this._configured.adapters||{},b;for(b in a)if(a[b].getWorldMatrix)return a[b].getWorldMatrix();return new window.XML3DMatrix};c.videoPlay=function(){d(this,
{play:[]})};c.videoPause=function(){d(this,{pause:[]})};c.XML3DNestedDataContainerTypeGetOutputNames=c.XML3DShaderProviderTypeGetOutputNames=c.meshGetOutputNames=function(){XML3D.flushDOMChanges();var b=a.getAdapter(this,"data");return b?b.getOutputNames():null};c.XML3DNestedDataContainerTypeGetResult=c.XML3DShaderProviderTypeGetResult=c.meshGetResult=function(b){XML3D.flushDOMChanges();var c=a.getAdapter(this,"data");return c?(b=c.getComputeResult(b),!b?null:new window.XML3DDataResult(b)):null};
c.XML3DNestedDataContainerTypeGetOutputChannelInfo=c.XML3DShaderProviderTypeGetOutputChannelInfo=c.meshGetOutputChannelInfo=function(b){XML3D.flushDOMChanges();var c=a.getAdapter(this,"data");return c?(b=c.getOutputChannelInfo(b),!b?null:new window.XML3DDataChannelInfo(b.type,b.origin,b.originalName,b.seqLength,b.seqMinKey,b.seqMaxKey)):null};c.XML3DNestedDataContainerTypeGetComputeInfo=c.XML3DShaderProviderTypeGetComputeInfo=c.meshGetComputeInfo=function(){XML3D.flushDOMChanges();XML3D.debug.logError(this.nodeName+
"::getComputeInfo is not implemeted yet.");return null};c.XML3DNestedDataContainerTypeGetProtoInfo=c.XML3DShaderProviderTypeGetProtoInfo=c.meshGetProtoInfo=function(){XML3D.flushDOMChanges();XML3D.debug.logError(this.nodeName+"::getProtoInfo is not implemeted yet.");return null};c.XML3DNestedDataContainerTypeIsOutputConnected=c.XML3DShaderProviderTypeIsOutputConnected=c.meshIsOutputConnected=function(){XML3D.flushDOMChanges();XML3D.debug.logError(this.nodeName+"::isOutputConnected is not implemeted yet.");
return!1};c.dataAddOutputFieldListener=function(a,c){XML3D.flushDOMChanges();if(!a)return!1;"String"===Object.prototype.toString.call(a).slice(8,-1)&&(a=[a]);if(0==a.length)return!1;var d=b(this,{getComputeRequest:[a,function(b){c(e(b.getResult(),a))}]});if(0==d.length)return!1;d=d[0].getResult();d=e(d,a);Object.keys(d).length&&c(d);return!0};c.XML3DDataSourceTypeSetScriptValue=function(b){var c=this._configured;c&&("[value set by script]"!=this.textContent&&(this.textContent="[value set by script]"),
XML3D.flushDOMChanges(),c.scriptValue=b,(c=a.getAdapter(this,"data"))&&c.setScriptValue(b))};j.exports=c},{"../base/resourcemanager.js":10,"../utils/misc.js":131}],36:[function(h,j){var e={NODE_INSERTED:0,VALUE_MODIFIED:1,NODE_REMOVED:2,THIS_REMOVED:3,ADAPTER_HANDLE_CHANGED:4,ADAPTER_VALUE_CHANGED:5,Notification:function(a){this.type=a}};e.Notification.prototype.toString=function(){return"Notification (type:"+this.type+")"};e.NotificationWrapper=function(a,d,b){this.mutation=a;this.type=d;this.affectedNode=
b};XML3D.createClass(e.NotificationWrapper,e.Notification);e.NotificationWrapper.prototype.toString=function(){return"NotificationWrapper (type:"+this.type+", wrapped: "+this.mutation+")"};e.AdapterHandleNotification=function(a,d){this.adapterHandle=a;this.type=d};XML3D.createClass(e.AdapterHandleNotification,e.Notification);e.AdapterHandleNotification.prototype.toString=function(){return"AdapterHandleNotification (type:"+this.type+")"};e.ConnectedAdapterNotification=function(a,d){this.adapter=a.adapterHandle.getAdapter();
this.key=d;this.url=a.adapterHandle.url;this.type=a.type;this.handleStatus=a.adapterHandle.status};XML3D.createClass(e.ConnectedAdapterNotification,e.Notification);e.ConnectedAdapterNotification.prototype.toString=function(){return"ConnectedAdapterNotification (type:"+this.type+", key: "+this.key+")"};j.exports=e},{}],37:[function(h,j){j.exports={XML3DNestedDataContainerTypeComplete:{get:function(){XML3D.flushDOMChanges();var e=this._configured.adapters||{},a;for(a in e)if(e[a].getDataComplete)return e[a].getDataComplete();
return!1},set:function(){}},XML3DNestedDataContainerTypeProgressLevel:{get:function(){XML3D.flushDOMChanges();var e=this._configured.adapters||{},a;for(a in e)if(e[a].getDataProgressLevel)return e[a].getDataProgressLevel();return!1},set:function(){}},AssetComplete:{get:function(){XML3D.flushDOMChanges();var e=this._configured.adapters||{},a;for(a in e)if(e[a].getAssetComplete)return e[a].getAssetComplete();return!1},set:function(){}},AssetProgressLevel:{get:function(){XML3D.flushDOMChanges();var e=
this._configured.adapters||{},a;for(a in e)if(e[a].getAssetProgressLevel)return e[a].getAssetProgressLevel();return!1},set:function(){}},xml3dComplete:{get:function(){XML3D.flushDOMChanges();var e=this._configured.adapters||{},a;for(a in e)if(e[a].getComplete)return e[a].getComplete();return!1},set:function(){}}}},{}],38:[function(h,j){(function(e){var a={create:function(){var a=new Float32Array(6);a[0]=Number.MAX_VALUE;a[1]=Number.MAX_VALUE;a[2]=Number.MAX_VALUE;a[3]=-Number.MAX_VALUE;a[4]=-Number.MAX_VALUE;
a[5]=-Number.MAX_VALUE;return a},clone:function(a){var b=new Float32Array(6);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a},copyMin:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},copyMax:function(a,b){a[0]=b[3];a[1]=b[4];a[2]=b[5];return a},extendWithBox:function(a,b){for(var c=0;3>c;c++)a[c]=Math.min(b[c],a[c]),a[c+3]=Math.max(b[c+3],a[c+3]);return a},empty:function(a){a[0]=Number.MAX_VALUE;
a[1]=Number.MAX_VALUE;a[2]=Number.MAX_VALUE;a[3]=-Number.MAX_VALUE;a[4]=-Number.MAX_VALUE;a[5]=-Number.MAX_VALUE;return a},isEmpty:function(a){return a[0]>a[3]||a[1]>a[4]||a[2]>a[5]},center:function(a,b){a[0]=0.5*(b[0]+b[3]);a[1]=0.5*(b[1]+b[4]);a[2]=0.5*(b[2]+b[5]);return a},size:function(a,b){a[0]=b[3]-b[0];a[1]=b[4]-b[1];a[2]=b[5]-b[2];return a},halfSize:function(a,b){a[0]=0.5*(b[3]-b[0]);a[1]=0.5*(b[4]-b[1]);a[2]=0.5*(b[5]-b[2]);return a},transform:function(d,b,c){if(c[0]>c[3]||c[1]>c[4]||c[2]>
c[5])a.copy(d,c);else{c=a.clone(c);if(0==b[3]&&0==b[7]&&0==b[11]&&1==b[15]){for(var g=0;3>g;g++){d[g]=d[g+3]=b[12+g];for(var f=0;3>f;f++){var e,i;e=b[4*f+g]*c[f];i=b[4*f+g]*c[f+3];e<i?(d[g]+=e,d[g+3]+=i):(d[g]+=i,d[g+3]+=e)}}return d}throw Error("Matrix is not affine");}}};a.transform2=function(){var d=XML3D.math.mat4.create(),b=XML3D.math.vec3.create(),c=XML3D.math.vec3.create();return function(g,f,e){a.center(b,e);a.halfSize(c,e);XML3D.math.mat4.copy(d,f);d.set([0,0,0,1],12);for(e=0;16>e;e++)d[e]=
Math.abs(d[e]);XML3D.math.vec3.transformMat4(c,c,d);XML3D.math.vec3.transformMat4(b,b,f);g[0]=b[0]-c[0];g[1]=b[1]-c[1];g[2]=b[2]-c[2];g[3]=b[0]+c[0];g[4]=b[1]+c[1];g[5]=b[2]+c[2];return g}}();a.longestSide=function(a){var b=Math.abs(a[3]-a[0]),c=Math.abs(a[4]-a[1]),a=Math.abs(a[5]-a[2]);return Math.max(b,Math.max(c,a))};a.intersects=function(a,b,c){var g=1/b._direction.x,f=1/b._direction.y,e=1/b._direction.z,i=(a[0]-b._origin.x)*g,g=(a[3]-b._origin.x)*g,h=(a[1]-b._origin.y)*f,f=(a[4]-b._origin.y)*
f,l=(a[2]-b._origin.z)*e,b=(a[5]-b._origin.z)*e,a=Math.max(Math.max(Math.min(i,g),Math.min(h,f)),Math.min(l,b)),i=Math.min(Math.min(Math.max(i,g),Math.max(h,f)),Math.max(l,b));if(void 0===c||void 0===c.dist)return 0<i&&a<=i;if(0>i||a>i)return c.dist=Number.MAX_VALUE,!1;c.dist=a;return!0};a.asXML3DBox=function(a){var b=new window.XML3DBox;b.min._data[0]=a[0];b.min._data[1]=a[1];b.min._data[2]=a[2];b.max._data[0]=a[3];b.max._data[1]=a[4];b.max._data[2]=a[5];return b};a.fromXML3DBox=function(a){var b=
new Float32Array(6);b[0]=a.min._data[0];b[1]=a.min._data[1];b[2]=a.min._data[2];b[3]=a.max._data[0];b[4]=a.max._data[1];b[5]=a.max._data[2];return b};a.str=function(a){return"bbox("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};a.EMPTY_BOX=a.create();e.exports=a})(j)},{}],39:[function(h,j){j.exports=function(e){e.vec3.reciprocal=function(a,c){c||(c=a);c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];return c};e.mat4.multiplyOffsetVec3=function(a,c,d,f,e){e||(e=d);f||(f=0);var i=d[f+0],h=d[f+1],d=
d[f+2];e[0]=a[c+0]*i+a[c+4]*h+a[c+8]*d+a[c+12];e[1]=a[c+1]*i+a[c+5]*h+a[c+9]*d+a[c+13];e[2]=a[c+2]*i+a[c+6]*h+a[c+10]*d+a[c+14];return e};e.mat4.multiplyOffsetDirection=function(a,c,d,f,e){e||(e=d);f||(f=0);var i=d[f+0],h=d[f+1],d=d[f+2];e[0]=a[c+0]*i+a[c+4]*h+a[c+8]*d;e[1]=a[c+1]*i+a[c+5]*h+a[c+9]*d;e[2]=a[c+2]*i+a[c+6]*h+a[c+10]*d;return e};XML3D.math.mat4.identity(XML3D.math.mat4.create());var a=XML3D.math.mat4.create(),d=XML3D.math.vec3.create();e.mat4.makeTransformXflow=function(b,c,g,f,e,i){XML3D.math.mat4.identity(i);
b&&XML3D.math.mat4.translate(i,i,b);f&&XML3D.math.mat4.translate(i,i,f);c&&(XML3D.math.mat4.fromRotationTranslation(a,[c[0],c[1],c[2],c[3]],[0,0,0]),XML3D.math.mat4.multiply(i,i,a));e&&(XML3D.math.mat4.fromRotationTranslation(a,[e[0],e[1],e[2],e[3]],[0,0,0]),XML3D.math.mat4.multiply(i,i,a));g&&XML3D.math.mat4.scale(i,i,g);e&&(XML3D.math.mat4.fromRotationTranslation(a,[e[0],e[1],e[2],-e[3]],[0,0,0]),XML3D.math.mat4.multiply(i,i,a));f&&XML3D.math.mat4.translate(i,i,XML3D.math.vec3.negate(d,f))};e.mat4.makeTransformInvXflow=
function(b,c,g,f,e,i){XML3D.math.mat4.identity(i);f&&XML3D.math.mat4.translate(i,i,f);e&&(XML3D.math.mat4.fromRotationTranslation(a,[e[0],e[1],e[2],e[3]],[0,0,0]),XML3D.math.mat4.multiply(i,i,a));g&&XML3D.math.mat4.scale(i,i,XML3D.math.vec3.reciprocal(g,d));e&&(XML3D.math.mat4.fromRotationTranslation(a,[e[0],e[1],e[2],-e[3]],[0,0,0]),XML3D.math.mat4.multiply(i,i,a));c&&(XML3D.math.mat4.fromRotationTranslation(a,[c[0],c[1],c[2],-c[3]],[0,0,0]),XML3D.math.mat4.multiply(i,i,a));f&&XML3D.math.mat4.translate(i,
i,XML3D.math.vec3.negate(d,f));b&&XML3D.math.mat4.translate(i,i,XML3D.math.vec3.negate(d,b))};e.mat4.multiplyOffset=function(a,c,d,f,e,i){var h=e[i+0],l=e[i+1],m=e[i+2],r=e[i+3],p=e[i+4],q=e[i+5],o=e[i+6],j=e[i+7],u=e[i+8],t=e[i+9],v=e[i+10],w=e[i+11],z=e[i+12],y=e[i+13],x=e[i+14],e=e[i+15],i=d[f+0],C=d[f+1],J=d[f+2],D=d[f+3],H=d[f+4],P=d[f+5],Q=d[f+6],V=d[f+7],R=d[f+8],A=d[f+9],B=d[f+10],G=d[f+11],E=d[f+12],F=d[f+13],I=d[f+14],d=d[f+15];a[c+0]=i*h+C*p+J*u+D*z;a[c+1]=i*l+C*q+J*t+D*y;a[c+2]=i*m+C*
o+J*v+D*x;a[c+3]=i*r+C*j+J*w+D*e;a[c+4]=H*h+P*p+Q*u+V*z;a[c+5]=H*l+P*q+Q*t+V*y;a[c+6]=H*m+P*o+Q*v+V*x;a[c+7]=H*r+P*j+Q*w+V*e;a[c+8]=R*h+A*p+B*u+G*z;a[c+9]=R*l+A*q+B*t+G*y;a[c+10]=R*m+A*o+B*v+G*x;a[c+11]=R*r+A*j+B*w+G*e;a[c+12]=E*h+F*p+I*u+d*z;a[c+13]=E*l+F*q+I*t+d*y;a[c+14]=E*m+F*o+I*v+d*x;a[c+15]=E*r+F*j+I*w+d*e};e.quat.slerpOffset=function(a,c,d,f,e,i,h,l){i||(i=a);var m=c+1,r=c+2,p=c+3,q=f+1,o=f+2,j=f+3,u=h+1,t=h+2,v=h+3,w=a[c]*d[f]+a[m]*d[q]+a[r]*d[o]+a[p]*d[j],z;if(0.01>1-Math.abs(w))z=1-e;else{var y=
Math.acos(Math.abs(w)),x=Math.sin(y);z=Math.sin(y*(1-e))/x;e=Math.sin(y*e)/x}l&&0>w&&(z=-z);i[h]=z*a[c]+e*d[f];i[u]=z*a[m]+e*d[q];i[t]=z*a[r]+e*d[o];i[v]=z*a[p]+e*d[j]};e.vec3.transformDirection=function(a,c,d){var f=c[0],e=c[1],c=c[2];a[0]=d[0]*f+d[4]*e+d[8]*c;a[1]=d[1]*f+d[5]*e+d[9]*c;a[2]=d[2]*f+d[6]*e+d[10]*c;return a};e.quat.setFromMat3=function(a,c){var d=a[0]+a[4]+a[8];0<d?(d=2*Math.sqrt(d+1),c[0]=(a[7]-a[5])/d,c[1]=(a[2]-a[6])/d,c[2]=(a[3]-a[1])/d,c[3]=0.25*d):a[0]>a[4]&&a[0]>a[8]?(d=2*Math.sqrt(1+
a[0]-a[4]-a[8]),c[3]=(a[7]-a[5])/d,c[0]=0.25*d,c[1]=(a[1]+a[3])/d,c[2]=(a[2]+a[6])/d):a[4]>a[8]?(d=2*Math.sqrt(1+a[4]-a[0]-a[8]),c[3]=(a[2]-a[6])/d,c[0]=(a[1]+a[3])/d,c[1]=0.25*d,c[2]=(a[5]+a[7])/d):(d=2*Math.sqrt(1+a[8]-a[0]-a[4]),c[3]=(a[3]-a[1])/d,c[0]=(a[2]+a[6])/d,c[1]=(a[5]+a[7])/d,c[2]=0.25*d)};e.quat.setFromBasis=function(a,c,d,f){var e=1/XML3D.math.vec3.length(a),i=1/XML3D.math.vec3.length(c),h=1/XML3D.math.vec3.length(d),l=XML3D.math.mat3.create();l[0]=a[0]*e;l[1]=c[0]*i;l[2]=d[0]*h;l[3]=
a[1]*e;l[4]=c[1]*i;l[5]=d[1]*h;l[6]=a[2]*e;l[7]=c[2]*i;l[8]=d[2]*h;XML3D.math.quat.setFromMat3(l,f)}}},{}],40:[function(h,j){var e=h("../../../base/adapter.js").NodeAdapter,a=function(a,b){e.call(this,a,b)};XML3D.createClass(a,e);a.prototype.getShader=function(){return null};a.prototype.getParentRenderAdapter=function(){return this.factory.getAdapter(this.node.parentNode,a)};a.prototype.initElement=function(a){this.factory.getAdapter(a);this.initChildElements(a)};a.prototype.initChildElements=function(a){for(a=
a.firstElementChild;a;)this.initElement(a),a=a.nextElementSibling};a.prototype.applyTransformMatrix=function(a){return a};a.prototype.getScene=function(){return this.factory.renderer.scene};j.exports=a},{"../../../base/adapter.js":7}],41:[function(h,j){var e=h("./base.js"),a=function(a,b){e.call(this,a,b)};XML3D.createClass(a,e);j.exports=a},{"./base.js":40}],42:[function(h,j){var e=h("../../../base/adapter.js").NodeAdapterFactory,a=h("../../../data/adapter/factory.js");h("../../../base/formathandler.js").xml3dFormatHandler.registerFactoryClass(a);
a=function(a){e.call(this,"webgl",a);this.type="RenderAdapterFactory"};XML3D.createClass(a,e);a.prototype.aspect="webgl";var d={xml3d:h("./xml3d.js"),view:h("./view.js"),defs:h("./defs.js"),mesh:h("./mesh.js"),model:h("./model.js"),shader:h("./shader.js"),group:h("./group.js"),light:h("./light.js"),lightshader:h("./lightshader.js")};a.prototype.createAdapter=function(a){var c=d[a.localName];return void 0!==c?new c(this,a):null};a.prototype.setScene=function(a){this.scene=a};a.prototype.getScene=function(){return this.scene};
a.prototype.setRenderer=function(a){this.renderer=a};a.prototype.getRenderer=function(){return this.renderer};j.exports=a},{"../../../base/adapter.js":7,"../../../base/formathandler.js":9,"../../../data/adapter/factory.js":20,"./defs.js":41,"./group.js":43,"./light.js":44,"./lightshader.js":45,"./mesh.js":46,"./model.js":47,"./shader.js":48,"./view.js":50,"./xml3d.js":51}],43:[function(h,j){var e=h("./transformable.js"),a=h("../../../interface/notification.js"),d=function(a,b){e.call(this,a,b,!0,
!0);this.createRenderNode()};XML3D.createClass(d,e);var b=d.prototype;b.createRenderNode=function(){var a=this.getParentRenderAdapter(),a=a.getRenderNode&&a.getRenderNode();this.renderNode=this.getScene().createRenderGroup({parent:a,visible:this.node.visible,name:this.node.id});this.updateLocalMatrix();this.updateShaderHandler();this.renderNode.setWorldSpaceBoundingBox(XML3D.math.bbox.create())};b.notifyChanged=function(b){e.prototype.notifyChanged.call(this,b);if(b.type!==a.VALUE_MODIFIED)return this.handleConnectedAdapterEvent(b)};
b.handleConnectedAdapterEvent=function(b){switch(b.type){case a.NODE_INSERTED:this.initElement(b.mutation.target);break;case a.THIS_REMOVED:this.dispose();break;case a.ADAPTER_HANDLE_CHANGED:break;case a.NODE_REMOVED:break;default:XML3D.debug.logWarning("Unhandled connected adapter event for "+b.key+" in shader adapter")}};b.dispose=function(){this.traverse(function(a){a&&a.destroy&&a.dispose()});this.getRenderNode().remove();this.clearAdapterHandles()};b.getWorldBoundingBox=function(){var a=XML3D.math.bbox.create();
this.renderNode.getWorldSpaceBoundingBox(a);return XML3D.math.bbox.asXML3DBox(a)};b.getLocalBoundingBox=function(){var a=XML3D.math.mat4.create();return function(){var b=new window.XML3DBox;if(!this.renderNode.visible)return b;Array.prototype.forEach.call(this.node.childNodes,function(a){a.getLocalBoundingBox&&a.visible&&b.extend(a.getLocalBoundingBox())});this.renderNode.getLocalMatrix(a);var d=XML3D.math.bbox.fromXML3DBox(b);XML3D.math.bbox.transform(d,a,d);return XML3D.math.bbox.asXML3DBox(d)}}();
b.getLocalMatrix=function(){var a=new window.XML3DMatrix;this.renderNode.getLocalMatrix(a._data);return a};b.getWorldMatrix=function(){var a=new window.XML3DMatrix;this.renderNode.getWorldMatrix(a._data);return a};j.exports=d},{"../../../interface/notification.js":36,"./transformable.js":49}],44:[function(h,j){var e=h("./transformable.js"),a=h("../../../interface/notification.js"),d=function(a,c){e.call(this,a,c,!1,!0);this.updateLightShader();this.createRenderNode()};XML3D.createClass(d,e);d.prototype.createRenderNode=
function(){var a=this.getParentRenderAdapter(),a=a.getRenderNode&&a.getRenderNode(),c=this.getLightShader();this.renderNode=this.factory.getScene().createRenderLight({light:{type:c?c.getLightType():null,data:c?c.getDataNode():null},parent:a,shader:c,visible:!this.node.visible?!1:void 0,localIntensity:this.node.intensity})};d.prototype.notifyChanged=function(b){switch(b.type){case a.THIS_REMOVED:this.dispose();break;case a.ADAPTER_HANDLE_CHANGED:if("shader"==b.key){this.renderNode.remove();break}break;
case a.VALUE_MODIFIED:this.valueModified(b.mutation);break;case a.ADAPTER_VALUE_CHANGED:this.renderNode.setLightType(b.adapter.getLightType(),b.adapter.getDataNode())}};d.prototype.valueModified=function(a){var c=a.target.getAttribute(a.attributeName);switch(a.attributeName){case "visible":this.renderNode.setLocalVisible(c&&"false"!==c.toLowerCase());break;case "intensity":this.renderNode.setLocalIntensity(c);break;case "shader":this.renderNode.remove(),this.updateLightShader(),this.createRenderNode()}};
d.prototype.updateLightShader=function(){var a=this.node.shader;if(!a){var c=this.node.getAttribute("style");c&&(c=/shader\s*:\s*url\s*\(\s*(\S+)\s*\)/i.exec(c))&&(a=c[1])}this.connectAdapterHandle("shader",this.getAdapterHandle(a))};d.prototype.getLightShader=function(){return this.getConnectedAdapter("shader")};d.prototype.dispose=function(){this.getRenderNode().remove();this.clearAdapterHandles()};d.prototype.getWorldMatrix=function(){var a=new window.XML3DMatrix;this.renderNode.getWorldMatrix(a._data);
return a};j.exports=d},{"../../../interface/notification.js":36,"./transformable.js":49}],45:[function(h,j){var e=h("./base.js"),a=h("../../../interface/notification.js"),d=h("../../../base/resourcemanager.js").Resource,b=function(a,b){e.call(this,a,b);this.dataAdapter=d.getAdapter(this.node,"data")};XML3D.createClass(b,e,{getDataNode:function(){return this.dataAdapter.getXflowNode()},getLightType:function(){var a=this.node.getAttribute("script");if(0===a.indexOf("urn:xml3d:lightshader:"))return a.substring(22,
a.length);XML3D.debug.logError("Unsupported light type "+a);return null},notifyChanged:function(b){switch(b.type){case a.THIS_REMOVED:this.notifyOppositeAdapters();break;case a.VALUE_MODIFIED:this.notifyOppositeAdapters(a.ADAPTER_VALUE_CHANGED)}}});j.exports=b},{"../../../base/resourcemanager.js":10,"../../../interface/notification.js":36,"./base.js":40}],46:[function(h,j){var e=h("./transformable.js"),a=h("../../../interface/notification.js"),d=h("../../../base/resourcemanager.js").Resource,b=function(a,
b){e.call(this,a,b,!0,!0);this.createRenderNode()};XML3D.createClass(b,e,{createRenderNode:function(){var a=d.getAdapter(this.node,"data"),b=this.getParentRenderAdapter(),b=b.getRenderNode&&b.getRenderNode();this.renderNode=this.getScene().createRenderObject({parent:b,node:this.node,object:{data:a.getXflowNode(),type:this.getMeshType()},name:this.node.id,visible:!this.node.visible?!1:void 0});this.updateLocalMatrix();this.updateShaderHandler()},getMeshType:function(){return this.node.hasAttribute("type")?
this.node.getAttribute("type"):"triangles"},notifyChanged:function(b){e.prototype.notifyChanged.call(this,b);switch(b.type){case a.THIS_REMOVED:this.dispose();break;case a.VALUE_MODIFIED:this.valueChanged(b.mutation)}},valueChanged:function(a){switch(a.attributeName){case "type":this.renderNode.setType(a.target.getAttribute("type"))}},dispose:function(){this.getRenderNode().remove();this.clearAdapterHandles()}});XML3D.extend(b.prototype,{getLocalBoundingBox:function(){if(this.renderNode){var a=new XML3D.math.bbox.create;
this.renderNode.getObjectSpaceBoundingBox(a);return XML3D.math.bbox.asXML3DBox(a)}return new window.XML3DBox},getWorldBoundingBox:function(){if(this.renderNode){var a=new XML3D.math.bbox.create;this.renderNode.getWorldSpaceBoundingBox(a);return XML3D.math.bbox.asXML3DBox(a)}return new window.XML3DBox},getWorldMatrix:function(){var a=new window.XML3DMatrix,b=this.renderNode;b&&b.getWorldMatrix(a._data);return a}});j.exports=b},{"../../../base/resourcemanager.js":10,"../../../interface/notification.js":36,
"./transformable.js":49}],47:[function(h,j){function e(a,b){if(a){b||a.remove();for(var c=a.getChildren(),d=c.length;d--;)e(c[d],!1)}}function a(c,d,f){if(f.postTransformXflowNode){var g=new b(f.postTransformXflowNode,["transform"],c._bindedRequestCallback),d=c.getScene().createRenderGroup({parent:d,visible:!0,name:void 0});c.postTransformXflowRequests.push(g);c.postTransformRenderGroups.push(d);c.updatePostTransform(d,g)}d=c.getScene().createRenderGroup({parent:d,visible:!0,name:c.node.id});d.setLocalMatrix(f.transform||
i);d.setMaterial(c.getMaterialConfiguration(f.shader,c._subRenderNodes.length));c._subRenderNodes.push(d);for(var e=f.meshes,g=0;g<e.length;++g){var k=c.getScene().createRenderObject({parent:d,node:e[g].refNode||c.node,object:{data:e[g].xflowNode,type:e[g].type},name:c.node.id,visible:!0});k.setLocalMatrix(e[g].transform||i);k.setMaterial(c.getMaterialConfiguration(e[g].shader,c._subRenderNodes.length));c._subRenderNodes.push(k)}f=f.groups;for(g=0;g<f.length;++g)a(c,d,f[g])}var d=h("./transformable.js"),
b=h("../../../xflow/interface/request.js").ComputeRequest,c=h("../../../interface/notification.js"),g=h("../../../base/resourcemanager.js").Resource,f=h("../../../base/adapterhandle.js"),k=function(a,b){d.call(this,a,b,!1,!0);this.asset=null;this.postTransformXflowRequests=[];this.postTransformRenderGroups=[];this.createRenderNode();this._bindedRequestCallback=this.onXflowRequestChange.bind(this);this.transformFetcher.update()},i=XML3D.math.mat4.create();XML3D.createClass(k,d,{createRenderNode:function(){this.asset=
g.getAdapter(this.node,"data").getAsset();this.asset.addChangeListener(this);var a=this.getParentRenderAdapter(),a=a.getRenderNode&&a.getRenderNode();this.renderNode=this.getScene().createRenderGroup({parent:a,visible:this.node.visible,name:this.node.id});this.renderNode.setLocalMatrix(i);this.createModelRenderNodes()},clearModelRenderNodes:function(){this.clearAdapterHandles();this._subRenderNodes=[];for(var a=this.postTransformXflowRequests.length;a--;)this.postTransformXflowRequests[a].clear();
e(this.renderNode,!0);this.postTransformXflowRequests.length=0;this.postTransformRenderGroups.length=0},createModelRenderNodes:function(){this.clearModelRenderNodes();if(!this.asset.isSubtreeLoading())try{this.asset.checkValidity();var b=this.asset.getResult().getDataTree();a(this,this.renderNode,b)}catch(c){XML3D.debug.logError("Asset Error: "+c.message,c.node||this.node),this.clearModelRenderNodes()}},getMaterialConfiguration:function(a,b){var c=null;if(a){var d=this.getAdapterHandle(a);this.connectAdapterHandle("shader_"+
b,d);switch(d.status){case f.STATUS.NOT_FOUND:XML3D.debug.logError("Could not find <shader> of url '"+d.url+"' ",this.node);break;case f.STATUS.READY:(d=d.getAdapter())&&d.getMaterialConfiguration&&(c=d.getMaterialConfiguration())}}return c},notifyChanged:function(a){d.prototype.notifyChanged.call(this,a);switch(a.type){case c.THIS_REMOVED:this.dispose();break;case c.ADAPTER_HANDLE_CHANGED:var b=a.key.split("_");"shader"==b[0]&&(b=this._subRenderNodes[+b[1]],XML3D.debug.assert(b),a.handleStatus==
f.STATUS.NOT_FOUND?b.setMaterial(null):(a=a.adapter)&&a.getMaterialConfiguration&&b.setMaterial(a.getMaterialConfiguration()),this.factory.renderer.requestRedraw("Material model changed."))}},onAssetChange:function(){this.renderNode&&this.createModelRenderNodes()},onXflowRequestChange:function(a){var b=this.postTransformXflowRequests.indexOf(a);-1!=b&&this.updatePostTransform(this.postTransformRenderGroups[b],a)},updatePostTransform:function(a,b){var c=b.getResult();(c=c.getOutputData("transform")&&
c.getOutputData("transform").getValue())?a.setLocalMatrix(c):(XML3D.debug.logWarning("Post Transform entry does not contain any 'transform' value.",this.node),a.setLocalMatrix(i))},dispose:function(){this.asset.removeChangeListener(this);this.clearModelRenderNodes();this.getRenderNode().remove();this.clearAdapterHandles()}});XML3D.extend(k.prototype,{getLocalBoundingBox:function(){if(this.renderNode){var a=new XML3D.math.bbox.create;this.renderNode.getObjectSpaceBoundingBox(a);return XML3D.math.bbox.asXML3DBox(a)}return new window.XML3DBox},
getWorldBoundingBox:function(){if(this.renderNode){var a=new XML3D.math.bbox.create;this.renderNode.getWorldSpaceBoundingBox(a);return XML3D.math.bbox.asXML3DBox(a)}return new window.XML3DBox},getWorldMatrix:function(){var a=new window.XML3DMatrix,b=this.renderNode;b&&b.getWorldMatrix(a._data);return a}});j.exports=k},{"../../../base/adapterhandle.js":8,"../../../base/resourcemanager.js":10,"../../../interface/notification.js":36,"../../../xflow/interface/request.js":139,"./transformable.js":49}],
48:[function(h,j){var e=h("./base.js"),a=h("../../../interface/notification.js"),d=h("../../../utils/uri.js").URI,b=h("../../../base/resourcemanager.js").Resource,c=h("../../../base/adapterhandle.js"),g=function(a,c){e.call(this,a,c);this._dataAdapter=b.getAdapter(this.node,"data");this._materialModel=this._materialConfiguration=null;this.updateMaterialConfiguration()};XML3D.createClass(g,e);XML3D.extend(g.prototype,{getMaterialConfiguration:function(){return this._materialConfiguration},updateMaterialConfiguration:function(){this.updateMaterialModel();
this._materialConfiguration=this._materialModel?this.getScene().createMaterialConfiguration(this._materialModel,this._dataAdapter.getXflowNode(),{name:this.node.id}):null;this.notifyOppositeAdapters()},updateMaterialModel:function(){this._materialModel=null;var a=this.getShaderScriptURI();if("urn"==a.scheme)this.disconnectAdapterHandle("script"),this._materialModel={type:"urn",urn:a};else if(this.connectAdapterHandle("script",this.getAdapterHandle(a,"data",0)),(a=this.getConnectedAdapter("script"))&&
a.getScriptType)this._materialModel={type:a.getScriptType(),script:a.getScript()}},getShaderScriptURI:function(){return new d(this.node.getAttribute("script"))},notifyChanged:function(b){switch(b.type){case a.VALUE_MODIFIED:b=b.mutation.attributeName;switch(b){case "script":this.updateMaterialConfiguration();break;default:XML3D.debug.logWarning("Unhandled mutation event in shader adapter for parameter '"+b+"'")}break;case a.ADAPTER_HANDLE_CHANGED:b.handleStatus==c.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find material for url '"+
b.url+"'"),this.updateMaterialConfiguration()}}});j.exports=g},{"../../../base/adapterhandle.js":8,"../../../base/resourcemanager.js":10,"../../../interface/notification.js":36,"../../../utils/uri.js":133,"./base.js":40}],49:[function(h,j){var e=h("./base.js"),a=h("../../../data/transform-fetcher.js"),d=h("../../../interface/notification.js"),b=h("../../../base/adapterhandle.js"),c=function(b,c,d,i){e.call(this,b,c);this.shaderHandler=this.renderNode=null;this.handleShader=d||!1;i&&(this.transformFetcher=
new a(this,"transform","transform"))};XML3D.createClass(c,e);XML3D.extend(c.prototype,{updateShaderHandler:function(){var a,b=this.node;a=b.shader;if(""==a&&(b=b.getAttribute("style")))(b=/shader\s*:\s*url\s*\(\s*(\S+)\s*\)/i.exec(b))&&(a=b[1]);a?(this.shaderHandler=this.getAdapterHandle(a),this.connectAdapterHandle("shader",this.shaderHandler)):(this.disconnectAdapterHandle("shader"),this.shaderHandler=null);this.referencedShaderChanged()},referencedShaderChanged:function(){if(this.shaderHandler)if(this.shaderHandler.status===
b.STATUS.NOT_FOUND)XML3D.debug.logError("Could not find element of url '"+this.shaderHandler.url+"' for shader",this.node),this.getRenderNode().setMaterial(null);else{var a=this.shaderHandler.getAdapter();a&&a.getMaterialConfiguration?this.getRenderNode().setMaterial(a.getMaterialConfiguration()):this.getRenderNode().setMaterial(null)}else this.getRenderNode().setMaterial(null)},onDispose:function(){this.transformFetcher&&this.transformFetcher.clear()},onConfigured:function(){},getRenderNode:function(){this.renderNode||
(this.renderNode=this.createRenderNode?this.createRenderNode():null,this.updateLocalMatrix());return this.renderNode},updateLocalMatrix:function(){this.transformFetcher&&this.transformFetcher.update()},onTransformChange:function(a,b){"transform"==a&&this.renderNode.setLocalMatrix(b)},notifyChanged:function(a){if(a.type==d.VALUE_MODIFIED){var b=a.mutation.attributeName;"transform"==b?this.transformFetcher&&this.transformFetcher.update():"style"==b?this.transformFetcher&&this.transformFetcher.updateMatrix():
"visible"==b?(a=a.mutation.target.getAttribute("visible"),this.renderNode.setLocalVisible(a&&"false"!==a.toLowerCase()),this.factory.renderer.requestRedraw("Transformable visibility changed.")):"shader"==b&&this.handleShader&&(this.updateShaderHandler(),this.factory.renderer.requestRedraw("Transformable shader changed."))}else a.type==d.ADAPTER_HANDLE_CHANGED&&"shader"==a.key&&(this.updateShaderHandler(),this.factory.renderer.requestRedraw("Shader reference changed."))}});j.exports=c},{"../../../base/adapterhandle.js":8,
"../../../data/transform-fetcher.js":28,"../../../interface/notification.js":36,"./base.js":40}],50:[function(h,j){var e=h("./transformable.js"),a=h("../../../data/transform-fetcher.js"),d=h("../../../interface/notification.js"),b=function(b,c){e.call(this,b,c,!1,!1);this.perspectiveFetcher=new a(this,"perspective","perspective",!0);this.createRenderNode()};XML3D.createClass(b,e);var c=b.prototype;c.createRenderNode=function(){var a=this.getParentRenderAdapter(),a=a.getRenderNode?a.getRenderNode():
this.factory.renderer.scene.createRootNode();this.renderNode=this.factory.renderer.scene.createRenderView({position:this.node.position._data,orientation:this.node.orientation.toMatrix()._data,fieldOfView:this.node.fieldOfView,parent:a});this.perspectiveFetcher.update()};c.getViewMatrix=function(){var a=new window.XML3DMatrix;this.renderNode.getWorldToViewMatrix(a._data);return a};c.getWorldMatrix=function(){var a=new window.XML3DMatrix;this.renderNode.getViewToWorldMatrix(a._data);return a};c.notifyChanged=
function(a){switch(a.type){case d.THIS_REMOVED:this.dispose();break;case d.VALUE_MODIFIED:switch(a=a.mutation.attributeName,a){case "orientation":this.renderNode.updateOrientation(this.node.orientation.toMatrix()._data);break;case "position":this.renderNode.updatePosition(this.node.position._data);break;case "perspective":this.perspectiveFetcher.update();break;case "fieldOfView":this.renderNode.updateFieldOfView(this.node.fieldOfView);break;default:XML3D.debug.logWarning("Unhandled value changed event in view adapter for attribute:"+
a)}}this.factory.getRenderer().requestRedraw("View changed")};c.onTransformChange=function(a,b){e.prototype.onTransformChange.call(this,a,b);"perspective"==a&&this.renderNode.setProjectionOverride(b)};c.dispose=function(){this.perspectiveFetcher.clear();this.getRenderNode().remove();this.clearAdapterHandles()};j.exports=b},{"../../../data/transform-fetcher.js":28,"../../../interface/notification.js":36,"./transformable.js":49}],51:[function(h,j){var e=h("./base.js"),a=h("../utils.js"),d=h("../../../interface/notification.js"),
b=h("../../../utils/misc.js").dispatchCustomEvent,c=h("../../../utils/misc.js").getOrCreateActiveView,g=h("../../../base/resourcemanager.js").Resource,f=function(a,b){e.call(this,a,b);this.firstLoadFired=this.fireLoadEventAfterDraw=!1};XML3D.createClass(f,e);XML3D.extend(f.prototype,{updateActiveViewAdapter:function(){var a=this.node.getAttribute("activeView");a?this.connectAdapterHandle("activeView",this.getAdapterHandle(a)):this.disconnectAdapterHandle("activeView")},setViewAdapter:function(a){a=
a||this.getConnectedAdapter("activeView");if(!a||!a.getRenderNode)a=this.factory.getAdapter(c(this.node));this.factory.getScene().setActiveView(a.getRenderNode())},dispose:function(){this.clearAdapterHandles()}});f.prototype.notifyChanged=function(a){switch(a.type){case d.ADAPTER_HANDLE_CHANGED:this.setViewAdapter(a.adapter);return;case d.NODE_INSERTED:this.initElement(a.mutation.target);return;case d.NODE_REMOVED:return}if((a=a.mutation.attributeName)&&"activeview"===a.toLowerCase())this.updateActiveViewAdapter(),
this.setViewAdapter()};f.prototype.onConfigured=function(){this.updateActiveViewAdapter();this.setViewAdapter();var a=this.onLoadComplete.bind(this);g.addLoadCompleteListener(0,a);g.addLoadCompleteListener(this.factory.canvasId,a);this.onLoadComplete()};f.prototype.onLoadComplete=function(){g.isLoadComplete(0)&&g.isLoadComplete(this.factory.canvasId)&&(this.fireLoadEventAfterDraw=!0)};f.prototype.onFrameDrawn=function(){this.fireLoadEventAfterDraw&&(this.fireLoadEventAfterDraw=!1,this.firstLoadFired=
!0,b(this.node,"load",!1,!0,null))};f.prototype.getComplete=function(){return this.fireLoadEventAfterDraw||!this.firstLoadFired?!1:g.isLoadComplete(0)&&g.isLoadComplete(this.factory.canvasId)};f.prototype.getWorldBoundingBox=function(){var a=new window.XML3DBox;Array.prototype.forEach.call(this.node.childNodes,function(b){b.getWorldBoundingBox&&a.extend(b.getWorldBoundingBox())});return a};f.prototype.getLocalBoundingBox=f.prototype.getWorldBoundingBox;f.prototype.getElementByPoint=function(b,c,d,
f){var c=a.convertPageCoords(this.node,b,c),b=c.x,c=c.y,g=this.factory.getRenderer(),e=g.getRenderObjectFromPickingBuffer(b,c);if(e){if(d){var h=g.getWorldSpacePositionByPoint(b,c,e);d.set(h[0],h[1],h[2])}f&&(h=g.getWorldSpaceNormalByPoint(b,c,e),f.set(h[0],h[1],h[2]))}else d&&d.set(NaN,NaN,NaN),f&&f.set(NaN,NaN,NaN);return e?e.node:null};f.prototype.getRenderInterface=function(){return this.factory.getRenderer().getRenderInterface()};f.prototype.generateRay=function(b,c){var d=a.convertPageCoords(this.node,
b,c);return this.factory.getRenderer().generateRay(d.x,d.y)};f.prototype.getElementByRay=function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create();return function(c,d,f){var g=this.factory.getRenderer();g.calculateMatricesForRay(c,a,b);var e=g.getRenderObjectByRay(c,a,b);if(null!==e&&(d||f)){if(d){var h=g.getWorldSpacePositionByRay(c,e,a,b);d.set(h[0],h[1],h[2])}f&&(h=g.getWorldSpaceNormalByRay(c,e,a,b),f.set(h[0],h[1],h[2]))}else d&&d.set(NaN,NaN,NaN),f&&f.set(NaN,NaN,NaN);return null!==
e?e.node:null}}();j.exports=f},{"../../../base/resourcemanager.js":10,"../../../interface/notification.js":36,"../../../utils/misc.js":131,"../utils.js":72,"./base.js":40}],52:[function(h,j){function e(c,g){this._xml3dElement=c;this._canvas=g;this.id=++b;this._mouseHandler=new a.MouseEventHandler(c,this);this._registerCanvasListeners(this._mouseHandler,a.EVENTS);this.hasTouchEvents()&&(this._touchHandler=new d.TouchEventHandler(c,this),this._registerCanvasListeners(this._touchHandler,d.EVENTS))}var a=
h("./events/mouse.js"),d=h("./events/touch.js"),b=0;e.prototype.hasTouchEvents=function(){return"ontouchstart"in window};e.prototype.getCanvas=function(){return this._canvas};e.prototype.dispatchEvent=function(a){this._xml3dElement.dispatchEvent(a)};e.prototype._registerCanvasListeners=function(a,b){var d=this._canvas;b.forEach(function(b){d.addEventListener(b,function(d){a[b]&&a[b].call(a,d);d.stopPropagation()})})};e.prototype.dispatchCustomEvent=function(a,b){var b=b||null,d=document.createEvent("CustomEvent");
d.initCustomEvent(a,!0,!0,b);this._xml3dElement.dispatchEvent(d)};e.prototype.dispatchUpdateEvent=function(){this.dispatchCustomEvent("update")};e.prototype.dispatchResizeEvent=function(a){this.dispatchCustomEvent("resize",a)};e.prototype.dispatchFrameDrawnEvent=function(a,b,d){d=d||{count:{primitives:0,objects:0}};this.dispatchCustomEvent("framedrawn",{timeStart:a,timeEnd:b,renderTimeInMilliseconds:b-a,count:d.count})};j.exports=e},{"./events/mouse.js":54,"./events/touch.js":55}],53:[function(h,
j){var e=h("./adapter/factory.js");h("../../base/formathandler.js").xml3dFormatHandler.registerFactoryClass(e);var a=h("./renderer-factory.js");j.exports=function(d){d instanceof Array||(d=[d]);d.forEach(function(b){XML3D.debug.logDebug("Configuring Renderer for",b.id);a.createRenderer(b)})}},{"../../base/formathandler.js":9,"./adapter/factory.js":42,"./renderer-factory.js":58}],54:[function(h,j){var e=h("../../../utils/options.js");e.register("renderer-mousemove-picking",!0);e.register("renderer-movement-aware-click-handler",
!1);var a=function(a,b){this._defaultTarget=a;this._canvasHandler=b;this._lastMousePosition={x:0,y:0}},d;try{new MouseEvent("click",{}),d=!0}catch(b){d=!1}a.prototype={dispatchMouseEvent:function(a,b,d){var d=d||{},b=b||this._defaultTarget,e=void 0!==d.x?d.x:a.clientX,i=void 0!==d.y?d.y:a.clientY;d.noCopy||(a=this.copyMouseEvent(a));this.initExtendedMouseEvent(a,e,i);b.dispatchEvent(a)},copyMouseEvent:function(a){var b;d?b="[object WheelEvent]"===a.toString()?new WheelEvent(a.type,a):new MouseEvent(a.type,
a):"[object WheelEvent]"===a.toString()?(b=document.createEvent("WheelEvent"),b.initWheelEvent(a.type,a.bubbles,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.button,a.relatedTarget,"",a.deltaX,a.deltaY,a.deltaZ,a.deltaMode)):(b=document.createEvent("MouseEvent"),b.initMouseEvent(a.type,a.bubbles,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget));a.dataTransfer&&(b.data={url:a.dataTransfer.getData("URL"),
text:a.dataTransfer.getData("Text")});b.preventDefault=function(){a.preventDefault()};return b},createMouseEvent:function(a,b){var b=b||{},f={bubbles:void 0!==b.bubbles?b.bubbles:!0,cancelable:void 0!==b.cancelable?b.cancelable:!0,view:b.view||window,detail:void 0!==b.detail?b.detail:0,screenX:void 0!==b.screenX?b.screenX:0,screenY:void 0!==b.screenY?b.screenY:0,clientX:void 0!==b.clientX?b.clientX:0,clientY:void 0!==b.clientY?b.clientY:0,ctrl:void 0!==b.ctrl?b.ctrl:!1,alt:void 0!==b.alt?b.alt:!1,
shift:void 0!==b.shift?b.shift:!1,meta:void 0!==b.meta?b.meta:!1,button:void 0!==b.button?b.button:0,relatedTarget:b.relatedTarget};if(d)return new MouseEvent(a,f);var e=document.createEvent("MouseEvent");e.initMouseEvent(a,f.bubbles,f.cancelable,f.view,f.detail,f.screenX,f.screenY,f.clientX,f.clientY,f.ctrlKey,f.altKey,f.shiftKey,f.metaKey,f.button,f.relatedTarget);return e},initExtendedMouseEvent:function(a,b,d){var e=this._canvasHandler;(function(){var i=void 0,h=void 0;a.__defineGetter__("normal",
function(){if(void 0!==h)return h;var a=e.getWorldSpaceNormalByPoint(b,d);return h=a?new window.XML3DVec3(a[0],a[1],a[2]):null});a.__defineGetter__("position",function(){if(!i){var a=e.getWorldSpacePositionByPoint(b,d);i=a?new window.XML3DVec3(a[0],a[1],a[2]):null}return i})})()},dispatchMouseEventOnPickedObject:function(a,b){var b=b||{},d=this.getMousePosition(a),e=null;b.omitUpdate||(e=this._canvasHandler.getPickObjectByPoint(d.x,d.y));this.dispatchMouseEvent(a,e&&e.node,d)},getMousePosition:function(a){return this._canvasHandler.getMousePosition(a)},
mouseup:function(a){this.dispatchMouseEventOnPickedObject(a)},mousedown:function(a){this._lastMousePosition=this.getMousePosition(a);this.dispatchMouseEventOnPickedObject(a)},click:function(a){if(!0===e.getValue("renderer-movement-aware-click-handler")){var b=this.getMousePosition(a);if(4<Math.abs(b.x-this._lastMousePosition.x)||4<Math.abs(b.y-this._lastMousePosition.y))return}this.dispatchMouseEventOnPickedObject(a)},dblclick:function(a){this.dispatchMouseEventOnPickedObject(a)},mousemove:function(a){var b=
this.getMousePosition(a),d=e.getValue("renderer-mousemove-picking");this.dispatchMouseEventOnPickedObject(a,{omitUpdate:!d});if(d&&(d=this._canvasHandler.getPickedObject(),d!==this.lastPickObj))this.lastPickObj&&(this.dispatchMouseEvent(this.createMouseEvent("mouseout",{clientX:b.x,clientY:b.y,button:a.button}),this.lastPickObj),d||this.dispatchMouseEvent(this.createMouseEvent("mouseover",{clientX:b.x,clientY:b.y,button:a.button}),this._defaultTarget)),d&&(this.dispatchMouseEvent(this.createMouseEvent("mouseover",
{clientX:b.x,clientY:b.y,button:a.button}),d),this.lastPickObj||this.dispatchMouseEvent(this.createMouseEvent("mouseout",{clientX:b.x,clientY:b.y,button:a.button}),this._defaultTarget)),this.lastPickObj=d},mouseout:function(a){var b=this.getMousePosition(a);this.dispatchMouseEvent(a,this.lastPickObj,b)},mouseover:function(a){var b=e.getValue("renderer-mousemove-picking");this.dispatchMouseEventOnPickedObject(a,{omitUpdate:!b})},wheel:function(a){this.dispatchMouseEventOnPickedObject(a,{type:"wheel"})}};
j.exports={EVENTS:"click,dblclick,mousedown,mouseup,mouseover,mousemove,mouseout,wheel".split(","),MouseEventHandler:a}},{"../../../utils/options.js":132}],55:[function(h,j){var e=function(a,d){this._defaultTarget=a;this._canvasHandler=d};e.prototype={copyTouchEvent:function(a,d){return this.createTouchEvent(this.copyTouchEventData(a,d))},copyTouchEventData:function(a,d){return{type:d.type||a.type,timeStamp:Date.now(),bubbles:a.bubbles,cancelable:a.cancelable,detail:a.detail,screenX:a.screenX,screenY:a.screenY,
pageX:a.pageX,pageY:a.pageY,clientX:a.clientX,clientY:a.clientY,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey,metaKey:a.metaKey,scale:a.scale,rotation:a.rotation,view:a.view,touches:a.touches,changedTouches:a.changedTouches,targetTouches:a.targetTouches}},createTouchEvent:function(a){var d;try{d=document.createEvent("TouchEvent")}catch(b){XML3D.debug.logWarning("Create Touch Event failed, creating UI instead"),d=document.createEvent("UIEvent")}d&&d.initTouchEvent&&(0==d.initTouchEvent.length?
d.initTouchEvent(a.touches,a.targetTouches,a.changedTouches,a.type,a.view,a.screenX,a.screenY,a.clientX,a.clientY):12==d.initTouchEvent.length?d.initTouchEvent(a.type,a.bubbles,a.cancelable,a.view,a.detail,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.touches,a.targetTouches,a.changedTouches):d.initTouchEvent(a.type,a.bubbles,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.pageX,a.pageY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.touches,a.targetTouches,a.changedTouches,a.scale,a.rotation));return d},
dispatchTouchEventOnPickedObject:function(a,d){var d=d||{},b=this.copyTouchEvent(a,d);b.preventDefault=function(){a.preventDefault()};this._defaultTarget.dispatchEvent(b)},touchstart:function(a){this.dispatchTouchEventOnPickedObject(a)},touchend:function(a){this.dispatchTouchEventOnPickedObject(a)},touchmove:function(a){this.dispatchTouchEventOnPickedObject(a)},touchcancel:function(a){this.dispatchTouchEventOnPickedObject(a)}};j.exports={EVENTS:["touchstart","touchmove","touchend","touchcancel"],
TouchEventHandler:e}},{}],56:[function(h,j){function e(){this._lights=[];this._models={};this._inUpdate=!1}e.prototype={add:function(a){this._lights.push(a);this._addModel(a.model)},remove:function(a){var d=this._lights.indexOf(a);-1!=d&&this._lights.splice(d,1);this._removeModel(a.model)},fillGlobalParameters:function(a,d){for(var b in this._models){var c=this._models[b];if(c.changed||d){var g=b+"Light",f;for(f in c.parameters){var e=g+f.charAt(0).toUpperCase()+f.slice(1);a[e]=c.parameters[f]}c.changed=
!1}}},lightValueChanged:function(a){if(!this._inUpdate){this._inUpdate=!0;var d=this;(a?[a]:this._lights).forEach(function(a){var a=a.model,c=d.getModelEntry(a.id),g=c.lightModels.indexOf(a);XML3D.debug.assert(-1!=g,"Light values changed for a light that is not managed by this LightManager");a.fillLightParameters(c.parameters,g);a.getLightData(c.parameters,g);c.changed=!0});this._inUpdate=!1}},getModelEntry:function(a){return this._models[a]},getModels:function(){return Object.keys(this._models)},
getModelCount:function(a){return(a=this.getModelEntry(a))?a.lightModels.length:0},_addModel:function(a){var d=this._models[a.id];d||(d=this._models[a.id]={lightModels:[],parameters:{}});d.lightModels.push(a);this._lightStructureChanged(d)},_removeModel:function(a){var d=this.getModelEntry(a.id),a=d.lightModels.indexOf(a);-1!=a&&d.lightModels.splice(a,1);this._lightStructureChanged(d)},_lightStructureChanged:function(a){this._inUpdate=!0;var d=a.lightModels.length;d?(a.parameters=a.lightModels[0].allocateParameterArray(d),
a.lightModels.forEach(function(b,c){b.fillLightParameters(a.parameters,c);b.getLightData(a.parameters,c)}),a.changed=!0,this._inUpdate=!1):a.parameters={}}};j.exports=e},{}],57:[function(h,j){function e(a){var b=new g,d;for(d in a){var e=a[d],i=b,h=d,l=e.type,e=new k(l,new c.TYPED_ARRAY_MAP[l](e["default"])),l=new f;l.data=e;l.name=h;i.appendChild(l)}return b}function a(a,b,c){a.getWorldMatrix(p);b&&XML3D.math.vec3.transformMat4(b,b,p);c&&(XML3D.math.vec3.transformDirection(c,c,p),XML3D.math.vec3.normalize(c,
c))}function d(a,b,c){var d=a.intensity.subarray(3*b,3*b+3);XML3D.math.vec3.scale(d,d,c.localIntensity);a.on[b]=c.visible}var b=h("../tools/frustum.js").Frustum,c=h("../../../xflow/interface/constants.js"),g=h("../../../xflow/interface/graph.js").DataNode,f=h("../../../xflow/interface/graph.js").InputNode,k=h("../../../xflow/interface/data.js").BufferEntry,i=h("../../../xflow/interface/request.js").ComputeRequest,n={intensity:{type:c.DATA_TYPE.FLOAT3,"default":[1,1,1]},attenuation:{type:c.DATA_TYPE.FLOAT3,
"default":[0,0,1]},position:{type:c.DATA_TYPE.FLOAT3,"default":[0,0,0]},shadowBias:{type:c.DATA_TYPE.FLOAT,"default":[1.0E-4]},direction:{type:c.DATA_TYPE.FLOAT3,"default":[0,0,-1]},castShadow:{type:c.DATA_TYPE.BOOL,"default":[!1]},on:{type:c.DATA_TYPE.BOOL,"default":[!0]},matrix:{type:c.DATA_TYPE.FLOAT4X4,"default":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},nearFar:{type:c.DATA_TYPE.FLOAT2,"default":[1,100]}},l={intensity:{type:c.DATA_TYPE.FLOAT3,"default":[1,1,1]},attenuation:{type:c.DATA_TYPE.FLOAT3,"default":[0,
0,1]},position:{type:c.DATA_TYPE.FLOAT3,"default":[0,0,0]},direction:{type:c.DATA_TYPE.FLOAT3,"default":[0,0,-1]},falloffAngle:{type:c.DATA_TYPE.FLOAT,"default":[Math.PI/4]},softness:{type:c.DATA_TYPE.FLOAT,"default":[0]},shadowBias:{type:c.DATA_TYPE.FLOAT,"default":[1.0E-4]},castShadow:{type:c.DATA_TYPE.BOOL,"default":[!1]},matrix:{type:c.DATA_TYPE.FLOAT4X4,"default":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},on:{type:c.DATA_TYPE.BOOL,"default":[!0]}},m={intensity:{type:c.DATA_TYPE.FLOAT3,"default":[1,1,
1]},direction:{type:c.DATA_TYPE.FLOAT3,"default":[0,0,-1]},shadowBias:{type:c.DATA_TYPE.FLOAT,"default":[1.0E-4]},position:{type:c.DATA_TYPE.FLOAT3,"default":[0,0,0]},castShadow:{type:c.DATA_TYPE.BOOL,"default":[!1]},on:{type:c.DATA_TYPE.BOOL,"default":[!0]},matrix:{type:c.DATA_TYPE.FLOAT4X4,"default":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},r=function(a,b,c,d){this.id=a;this.light=b;this.dataNode=c;this.configuration=d;this.parameters=Object.keys(d);c?c.insertBefore(e(d),null):c=e(d);this.fovy=Math.PI/
2;this.lightParameterRequest=new i(c,this.parameters,this.lightParametersChanged.bind(this));this.lightParametersChanged(this.lightParameterRequest,null)};r.prototype={fillLightParameters:function(a,b){var d=this.lightParameterRequest.getResult();this.parameters.forEach(function(f){var g=d.getOutputData(f),e=c.DATA_TYPE_TUPLE_SIZE[g.type],g=g.getValue();a[f].set(g.subarray(0,e),b*e)});this.transformParameters(a,b)},allocateParameterArray:function(a){var b={},d=this.configuration;this.parameters.forEach(function(f){var g=
d[f].type;b[f]=new c.TYPED_ARRAY_MAP[g](c.DATA_TYPE_TUPLE_SIZE[g]*a)});return b},getParameter:function(a){return a in this.configuration?this.lightParameterRequest.getResult().getOutputData(a).getValue():null},lightParametersChanged:function(a,b){b&&this.light.lightValueChanged()},_expandNearFar:function(a){var b=Math.max(0.3*(a.far-a.near),0.05);a.near-=b;a.far+=b},getLightData:function(a,b){this.getLightViewProjectionMatrix(a.matrix.subarray(16*b,16*b+16))},getLightViewProjectionMatrix:function(a){var b=
XML3D.math.mat4.create(),c=XML3D.math.mat4.create();this.getLightViewMatrix(b);this.getLightProjectionMatrix(c);XML3D.math.mat4.multiply(a,c,b)},getLightProjectionMatrix:function(a){this.light.getFrustum(1).getProjectionMatrix(a)},getLightViewMatrix:function(a){var b=this.getParameter("direction"),c=this.getParameter("position");this.light.getWorldMatrix(a);b=XML3D.math.quat.rotationTo(XML3D.math.quat.create(),q,b);c=XML3D.math.mat4.fromRotationTranslation(XML3D.math.mat4.create(),b,c);XML3D.math.mat4.mul(a,
a,c);XML3D.math.mat4.invert(a,a)}};var p=XML3D.math.mat4.create(),q=XML3D.math.vec3.fromValues(0,0,-1),o=function(a,b){r.call(this,"point",b,a,n)};XML3D.createClass(o,r,{getFrustum:function(a,c){var d=this.light.scene.lights.getModelEntry(this.id);if(XML3D.math.bbox.isEmpty(c))return d.parameters.nearFar[0]=1,d.parameters.nearFar[1]=110,new b(1,110,0,this.fovy,a,!1);var f=XML3D.math.mat4.create();this.getLightViewMatrix(f);XML3D.math.bbox.transform(c,f,c);f={near:-c[5],far:-c[2]};this._expandNearFar(f);
d.parameters.nearFar[0]=1;d.parameters.nearFar[1]=f.far;return new b(1,f.far,0,this.fovy,a,!1)},transformParameters:function(b,c){var f=b.position.subarray(3*c,3*c+3);a(this.light,f,null);d(b,c,this.light)}});var s=function(a,b){r.call(this,"spot",b,a,l)};XML3D.createClass(s,r,{getFrustum:function(a,c){if(XML3D.math.bbox.isEmpty(c))return new b(1,110,0,this.fovy,a,!1);var d=XML3D.math.mat4.create();this.getLightViewMatrix(d);XML3D.math.bbox.transform(c,d,c);d={near:-c[5],far:-c[2]};this._expandNearFar(d);
return new b(1,d.far,0,this.fovy,a,!1)},transformParameters:function(b,c){var f=b.position.subarray(3*c,3*c+3),g=b.direction.subarray(3*c,3*c+3);a(this.light,f,g);d(b,c,this.light)},lightParametersChanged:function(a,b){this.fovy=2*this.getParameter("falloffAngle")[0];r.prototype.lightParametersChanged.call(this,a,b)}});var u=function(a,b){r.call(this,"directional",b,a,m)};XML3D.createClass(u,r,{getFrustum:function(a,c){if(XML3D.math.bbox.isEmpty(c))return new b(1,110,0,this.fovy,a,!0);var d=XML3D.math.mat4.create();
this.getLightViewMatrix(d);XML3D.math.bbox.transform(c,d,c);d={near:-c[5],far:-c[2]};this._expandNearFar(d);return new b(1,d.far,0,this.fovy,a,!0)},transformParameters:function(b,c){var f=b.direction.subarray(3*c,3*c+3);a(this.light,null,f);d(b,c,this.light)},getLightViewMatrix:function(a){var b=this.light.scene.lights.getModelEntry(this.id),c=b.parameters.direction,d=b.parameters.position,f=new XML3D.math.bbox.create;this.light.scene.getBoundingBox(f);var g=XML3D.math.vec3.create(),e=XML3D.math.vec3.create(),
i=XML3D.math.vec3.create();XML3D.math.bbox.center(e,f);XML3D.math.bbox.size(g,f);f=XML3D.math.vec3.len(g);XML3D.math.vec3.scale(i,c,-0.55*f);d=XML3D.math.vec3.add(d,e,i);b.parameters.position=d;XML3D.math.mat4.identity(a);e=XML3D.math.mat4.create();i=XML3D.math.vec3.fromValues(0,1,0);0==c[0]&&0==c[2]&&(i=XML3D.math.vec3.fromValues(0,0,1));f=XML3D.math.vec3.create();g=XML3D.math.vec3.len(c);XML3D.math.vec3.scale(f,c,-XML3D.math.vec3.dot(i,c)/(g*g));XML3D.math.vec3.add(f,f,i);XML3D.math.vec3.normalize(f,
f);XML3D.math.mat4.lookAt(e,XML3D.math.vec3.fromValues(0,0,0),c,f);XML3D.math.mat4.invert(e,e);XML3D.math.mat4.translate(a,a,d);XML3D.math.mat4.multiply(a,a,e);f=new XML3D.math.bbox.create;this.light.scene.getBoundingBox(f);XML3D.math.bbox.transform(f,a,f);g=XML3D.math.vec3.create();XML3D.math.bbox.size(g,f);e=g[0]>g[1]?g[0]:g[1];this.fovy=2*Math.atan(0.55*e);b.parameters.direction=c;b.parameters.position=d;XML3D.math.mat4.invert(a,a)}});j.exports={PointLightModel:o,SpotLightModel:s,DirectionalLightModel:u}},
{"../../../xflow/interface/constants.js":136,"../../../xflow/interface/data.js":137,"../../../xflow/interface/graph.js":138,"../../../xflow/interface/request.js":139,"../tools/frustum.js":70}],58:[function(h,j){var e=h("../webgl/renderer.js"),a=h("../webgl/canvas-handler.js");j.exports=new function(){this.createRenderer=function(d){var b=new a(d,d._configured.canvas),d=new e(d,b);b.setRenderer(d);window.requestAnimationFrame(b.tick);return d}}},{"../webgl/canvas-handler.js":80,"../webgl/renderer.js":112}],
59:[function(h,j){j.exports={NODE_TYPE:{GROUP:"group",OBJECT:"object",LIGHT:"light",VIEW:"view"},EVENT_TYPE:{VIEW_CHANGED:"view_changed",LIGHT_STRUCTURE_CHANGED:"light_structure_changed",LIGHT_VALUE_CHANGED:"light_value_changed",SCENE_SHAPE_CHANGED:"scene_shape_changed",SCENE_STRUCTURE_CHANGED:"scene_structure_changed",DRAWABLE_STATE_CHANGED:"drawable_state_changed"}}},{}],60:[function(h,j){var e=h("../../../contrib/EventDispatcher.js"),a=function(a,b){this.context=a;this._type=b;this._valid=!1};
a.TYPES={MESH:"mesh",VOLUME:"volume"};a.READY_STATE={COMPLETE:"complete",INCOMPLETE:"incomplete"};XML3D.createClass(a,e,{getType:function(){return this._type},isValid:function(){return this._valid},setShaderComposer:function(){},update:function(){}});j.exports=a},{"../../../contrib/EventDispatcher.js":11}],61:[function(h,j){var e=h("../../webgl/base/utils.js").getUniqueCounter();j.exports=function(a,d,b){b=b||{};this.id=e();this.model=a;this.dataNode=d;this.name=b.name||null}},{"../../webgl/base/utils.js":79}],
62:[function(h,j){var e=h("../../../contrib/EventDispatcher.js"),a=function(){this.pages=[];this.nextOffset=0;this.freeEntries=[];this.addPage()};XML3D.createClass(a,e,{addPage:function(){this.pages.push(new Float32Array(a.PAGE_SIZE));this.nextOffset=0;XML3D.debug.logInfo("Adding page",this.pages.length,"(",a.PAGE_SIZE*Float32Array.BYTES_PER_ELEMENT*this.pages.length/1024,"kB)")},getPageEntry:function(a){if(!a)throw Error("No size given for page entry");return this.reusePageEntry(a)||this.createPageEntry(a)},
reusePageEntry:function(a){return(a=this.freeEntries[a])&&a.length?a.pop():null},createPageEntry:function(d){if(this.nextOffset+d>a.PAGE_SIZE)return this.addPage(),this.getPageEntry(d);var b=this.pages[this.pages.length-1],c=this.nextOffset;this.nextOffset+=d;return{page:b,offset:c,size:d}},freePageEntry:function(a){var b=this.freeEntries[a.size];b||(b=this.freeEntries[a.size]=[]);b.push(a)}});a.PAGE_SIZE=4096;j.exports=a},{"../../../contrib/EventDispatcher.js":11}],63:[function(h,j){var e=h("./rendernode.js"),
a=h("./constants.js"),d=a.NODE_TYPE,b=a.EVENT_TYPE,a=function(a,b,f){e.call(this,d.GROUP,a,b,f);f=f||{};this._material=f.material||null;this.boundingBoxDirty=!1;this.setWorldSpaceBoundingBox(XML3D.math.bbox.EMPTY_BOX)};a.ENTRY_SIZE=38;XML3D.createClass(a,e);XML3D.extend(a.prototype,{getLocalMatrix:function(a){for(var b=this.offset+16,d=0;16>d;d++,b++)a[d]=this.page[b]},setLocalMatrix:function(a){for(var b=this.offset+16,d=0;16>d;d++,b++)this.page[b]=a[d];this.setTransformDirty();this.setBoundingBoxDirty()},
getWorldSpaceBoundingBox:function(a){this.boundingBoxDirty&&this.updateWorldSpaceBoundingBox();var b=this.offset+32;a[0]=this.page[b];a[1]=this.page[b+1];a[2]=this.page[b+2];a[3]=this.page[b+3];a[4]=this.page[b+4];a[5]=this.page[b+5]},setWorldSpaceBoundingBox:function(a){var b=this.offset+32;this.page[b]=a[0];this.page[b+1]=a[1];this.page[b+2]=a[2];this.page[b+3]=a[3];this.page[b+4]=a[4];this.page[b+5]=a[5]},updateWorldSpaceBoundingBox:function(){var a=XML3D.math.bbox.create();return function(){for(var b=
XML3D.math.bbox.create(),d=0,e=this.children.length;d<e;d++){var i=this.children[d];i.isVisible()&&(i.getWorldSpaceBoundingBox(a),XML3D.math.bbox.extendWithBox(b,a))}this.setWorldSpaceBoundingBox(b);this.boundingBoxDirty=!1}}(),addChild:function(a){this.children.push(a);this.setBoundingBoxDirty();this.scene.dispatchEvent({type:b.SCENE_STRUCTURE_CHANGED,newChild:a})},removeChild:function(a){var d=this.children.indexOf(a);-1!=d&&this.children.splice(d,1);this.scene.dispatchEvent({type:b.SCENE_STRUCTURE_CHANGED,
removedChild:a})},getChildren:function(){return this.children},updateWorldMatrix:function(a){var b=this.page,d=this.offset;XML3D.math.mat4.multiplyOffset(b,d+0,b,d+16,a,0);this.transformDirty=!1},setTransformDirty:function(){this.transformDirty=!0;this.children.forEach(function(a){a.setTransformDirty()})},setMaterial:function(a){this._material!==a&&(this._material=a,this.children.forEach(function(a){a.parentMaterialChanged&&a.parentMaterialChanged()}))},parentMaterialChanged:function(){this._material||
this.children.forEach(function(a){a.parentMaterialChanged&&a.parentMaterialChanged()})},getMaterial:function(){return this._material||this.parent.getMaterial()},setBoundingBoxDirty:function(){this.boundingBoxDirty=!0;this.parent&&this.parent.setBoundingBoxDirty()},setLocalVisible:function(a){this.localVisible=a;this.setVisible(this.parent&&this.parent.isVisible()&&a);this.setBoundingBoxDirty()},findRayIntersections:function(){var a=XML3D.math.bbox.create();return function(b,d){this.getWorldSpaceBoundingBox(a);
if(XML3D.math.bbox.intersects(a,b))for(var e=0;e<this.children.length;e++)this.children[e].findRayIntersections(b,d)}}()});j.exports=a},{"./constants.js":59,"./rendernode.js":65}],64:[function(h,j){var e=h("./rendernode.js"),a=h("./constants.js"),d=h("../lights/light-models.js"),b=a.NODE_TYPE,c=a.EVENT_TYPE,g=XML3D.math.mat4.create();new Float32Array([0.5,0,0,0,0,0.5,0,0,0,0,0.5,0,0.5,0.5,0.5,1]);var f=new XML3D.math.bbox.create,a=function(a,c,d){e.call(this,b.LIGHT,a,c,d);d=d||{};a=d.light||{};this.userData=
null;this.localIntensity=void 0!==d.localIntensity?d.localIntensity:1;this.setLightType(a.type,a.data)};a.ENTRY_SIZE=16;XML3D.createClass(a,e);XML3D.extend(a.prototype,{setLightType:function(a,b){a=a||"directional";if(this.model){if(this.model.id==a)return;this.scene.lights.remove(this);this.lightStructureChanged(!0)}var c;a:switch(c=a,c){case "point":c=new d.PointLightModel(b,this);break a;case "spot":c=new d.SpotLightModel(b,this);break a;case "directional":c=new d.DirectionalLightModel(b,this);
break a;default:XML3D.debug.logWarning("Unknown light model: ",c,". Using directional instead."),c=new d.DirectionalLightModel(b,this)}this.model=c;this.scene.lights.add(this);this.lightStructureChanged(!1)},getFrustum:function(a){this.scene.getBoundingBox(f);return this.model.getFrustum(a,f)},lightValueChanged:function(){this.model&&this.scene.dispatchEvent({type:c.LIGHT_VALUE_CHANGED,light:this})},lightStructureChanged:function(a){this.scene.dispatchEvent({type:c.LIGHT_STRUCTURE_CHANGED,light:this,
removed:a})},updateWorldMatrix:function(){this.parent&&(this.parent.getWorldMatrix(g),this.setWorldMatrix(g),this.lightValueChanged())},setTransformDirty:function(){this.updateWorldMatrix()},setVisible:function(a){a=this.localVisible&&a;this.visible!=a&&(this.visible=a,this.lightValueChanged())},setLocalIntensity:function(a){this.localIntensity=a;this.lightValueChanged()},remove:function(){this.parent.removeChild(this);this.scene.lights.remove(this);this.lightStructureChanged(!0)},getWorldSpaceBoundingBox:function(a){XML3D.math.bbox.empty(a)}});
j.exports=a},{"../lights/light-models.js":57,"./constants.js":59,"./rendernode.js":65}],65:[function(h,j){var e=function(a,d,b,c){var c=c||{},g=!1!==c.visible;this.scene=d;this.type=a;this.name=c.name||"";this.page=b.page;this.offset=b.offset;this.entrySize=b.size;this.transformDirty=!0;this.children=[];this.setParent(c.parent||d.rootNode);this.visible=void 0;this.setLocalVisible(g)};XML3D.extend(e.prototype,{getChildren:function(){return this.children},getParent:function(){return this.parent},setParent:function(a){(this.parent=
a)&&a.addChild&&a.addChild(this);this.setLocalVisible(this.localVisible)},traverse:function(a){a(this);this.children.forEach(function(d){d.traverse(a)})},getWorldMatrix:function(a){this.transformDirty&&(this.parent.getWorldMatrix(a),this.updateWorldMatrix(a));for(var d=this.offset+0,b=0;16>b;b++,d++)a[b]=this.page[d]},setWorldMatrix:function(a){for(var d=this.offset+0,b=0;16>b;b++,d++)this.page[d]=a[b];this.transformDirty=!1;this.setBoundingBoxDirty&&this.setBoundingBoxDirty()},isVisible:function(){return this.visible},
setTransformDirty:function(){this.transformDirty=!0},setLocalVisible:function(a){this.localVisible=a;this.setVisible(this.parent&&this.parent.isVisible()&&a)},setVisible:function(a){var d=a;!1===this.localVisible&&(d=!1);this.visible!==d&&(this.visible=d,this.children.forEach(function(a){a.setVisible(d)}))},remove:function(){this.parent.removeChild(this);this.scene.freePageEntry({page:this.page,offset:this.offset,size:this.entrySize})},findRayIntersections:function(){}});j.exports=e},{}],66:[function(h,
j){var e=h("../../webgl/system/system-notifier.js"),a=h("./rendernode.js"),d=h("./drawableclosure.js"),b=h("./constants.js");h("./scene.js");var c=h("../../../xflow/interface/request.js").ComputeRequest,g=function(c,d,g){a.call(this,b.NODE_TYPE.OBJECT,c,d,g);g=g||{};this.node=g.node;this.object=g.object||{data:null,type:"triangles"};this.boundingBoxDirty=this.transformDirty=!0;this.transformDataRequest=this.createTransformRequest();this.drawable=this.createDrawable();this._material=g.material||null;
this._actualMaterial=null;this.initMaterial();this.override=null};g.ENTRY_SIZE=108;g.IDENTITY_MATRIX=XML3D.math.mat4.create();XML3D.createClass(g,a,{createTransformRequest:function(){return!this.object.data?null:new c(this.object.data,["meshTransform"],this.onTransformDataChange.bind(this))},createDrawable:function(){var a=this.scene.createDrawable(this);if(a){var c=this;a.addEventListener(b.EVENT_TYPE.DRAWABLE_STATE_CHANGED,function(a){a.newState===d.READY_STATE.COMPLETE?c.scene.moveFromQueueToReady(c):
a.newState===d.READY_STATE.INCOMPLETE&&a.oldState===d.READY_STATE.COMPLETE&&c.scene.moveFromReadyToQueue(c)});a.updateTypeRequest();a.calculateBoundingBox();a.addEventListener(b.EVENT_TYPE.SCENE_SHAPE_CHANGED,function(){c.scene.dispatchEvent({type:b.EVENT_TYPE.SCENE_SHAPE_CHANGED})})}return a},setType:function(a){this.object.type=a},getType:function(){return this.object.type},getDataNode:function(){return this.object?this.object.data:null},getLocalMatrix:function(a){for(var b=this.offset+16,c=0;16>
c;c++,b++)a[c]=this.page[b]},setLocalMatrix:function(a){for(var b=this.offset+16,c=0;16>c;c++,b++)this.page[b]=a[c];this.setTransformDirty();this.setBoundingBoxDirty()},dispose:function(){this.transformDataRequest&&this.transformDataRequest.clear();this.scene.remove(this)},onTransformDataChange:function(){this.setTransformDirty()},getModelViewMatrix:function(a){for(var b=this.offset+44,c=0;16>c;c++,b++)a[c]=this.page[b]},getModelMatrixN:function(a){var b=this.offset+76;a[0]=this.page[b];a[1]=this.page[b+
1];a[2]=this.page[b+2];a[3]=this.page[b+4];a[4]=this.page[b+5];a[5]=this.page[b+6];a[6]=this.page[b+8];a[7]=this.page[b+9];a[8]=this.page[b+10]},getModelViewMatrixN:function(a){var b=this.offset+92;a[0]=this.page[b];a[1]=this.page[b+1];a[2]=this.page[b+2];a[3]=this.page[b+4];a[4]=this.page[b+5];a[5]=this.page[b+6];a[6]=this.page[b+8];a[7]=this.page[b+9];a[8]=this.page[b+10]},getModelViewProjectionMatrix:function(a){for(var b=this.offset+60,c=0;16>c;c++,b++)a[c]=this.page[b]},updateWorldSpaceMatrices:function(a,
b){this.transformDirty&&this.updateWorldMatrix();this.updateModelViewMatrix(a);this.updateModelMatrixN();this.updateModelViewMatrixN();this.updateModelViewProjectionMatrix(b)},updateWorldMatrix:function(){var a=XML3D.math.mat4.create();return function(){this.parent.getWorldMatrix(a);XML3D.math.mat4.multiplyOffset(a,0,this.page,this.offset+16,a,0);if(this.transformDataRequest){var b=this.transformDataRequest.getResult().getOutputData("meshTransform");b&&b.getValue()&&XML3D.math.mat4.multiply(a,a,b.getValue())}this.setWorldMatrix(a);
this.boundingBoxDirty=!0;this.transformDirty=!1}}(),updateModelViewMatrix:function(a){this.transformDirty&&this.updateWorldMatrix();var b=this.page,c=this.offset;XML3D.math.mat4.multiplyOffset(b,c+44,b,c+0,a,0)},updateModelMatrixN:function(){var a=XML3D.math.mat4.create();return function(){this.getWorldMatrix(a);for(var b=XML3D.math.mat4.invert(a,a),b=b?XML3D.math.mat4.transpose(b,b):g.IDENTITY_MATRIX,c=this.offset+76,d=0;16>d;d++,c++)this.page[c]=b[d]}}(),updateModelViewMatrixN:function(){var a=
XML3D.math.mat4.create();return function(){this.getModelViewMatrix(a);for(var b=XML3D.math.mat4.invert(a,a),b=b?XML3D.math.mat4.transpose(b,b):g.IDENTITY_MATRIX,c=this.offset+92,d=0;16>d;d++,c++)this.page[c]=b[d]}}(),updateModelViewProjectionMatrix:function(a){var b=this.page,c=this.offset;XML3D.math.mat4.multiplyOffset(b,c+60,b,c+44,a,0)},setTransformDirty:function(){this.transformDirty=!0;this.setBoundingBoxDirty();this.scene.dispatchEvent({type:b.EVENT_TYPE.SCENE_SHAPE_CHANGED});this.scene.requestRedraw("Transformation changed")},
setObjectSpaceBoundingBox:function(a){var b=this.offset+32;this.page[b]=a[0];this.page[b+1]=a[1];this.page[b+2]=a[2];this.page[b+3]=a[3];this.page[b+4]=a[4];this.page[b+5]=a[5];this.setBoundingBoxDirty()},getObjectSpaceBoundingBox:function(a){var b=this.offset+32;a[0]=this.page[b];a[1]=this.page[b+1];a[2]=this.page[b+2];a[3]=this.page[b+3];a[4]=this.page[b+4];a[5]=this.page[b+5]},setBoundingBoxDirty:function(){this.boundingBoxDirty=!0;this.parent.setBoundingBoxDirty()},setWorldSpaceBoundingBox:function(a){var b=
this.offset+38;this.page[b]=a[0];this.page[b+1]=a[1];this.page[b+2]=a[2];this.page[b+3]=a[3];this.page[b+4]=a[4];this.page[b+5]=a[5]},getWorldSpaceBoundingBox:function(a){this.boundingBoxDirty&&this.updateWorldSpaceBoundingBox();var b=this.offset+38;a[0]=this.page[b];a[1]=this.page[b+1];a[2]=this.page[b+2];a[3]=this.page[b+3];a[4]=this.page[b+4];a[5]=this.page[b+5]},updateWorldSpaceBoundingBox:function(){var a=new XML3D.math.bbox.create,b=new XML3D.math.mat4.create;return function(){this.getObjectSpaceBoundingBox(a);
this.getWorldMatrix(b);XML3D.math.bbox.transform(a,b,a);this.setWorldSpaceBoundingBox(a);this.boundingBoxDirty=!1}}(),setLocalVisible:function(a){this.localVisible=a;this.setVisible(this.parent&&this.parent.isVisible()&&a);this.setBoundingBoxDirty()},getProgram:function(){return this.drawable.getProgram()},hasTransparency:function(){var a=this.getProgram();return a?a.hasTransparency():!1},updateForRendering:function(){e.setNode(this.node);try{this.drawable&&this.drawable.update(this.scene)}catch(a){XML3D.debug.logError("Mesh Error: "+
a.message,this.node)}e.setNode(null)},findRayIntersections:function(){var a=XML3D.math.bbox.create(),b={dist:0};return function(c,d){this.getWorldSpaceBoundingBox(a);XML3D.math.bbox.intersects(a,c,b)&&d.push(this)}}(),setMaterial:function(a){this._material!==a&&(this._actualMaterial=(this._material=a)?a:this.parent.getMaterial(),this.materialChanged())},parentMaterialChanged:function(){this._material||this.initMaterial()},initMaterial:function(){this._actualMaterial=this._material?this._material:
this.parent.getMaterial();this.materialChanged()},materialChanged:function(){XML3D.debug.logDebug("material changed",this._actualMaterial);this.drawable&&this.drawable.setShaderComposer(this.scene.shaderFactory.createComposerFromMaterialConfiguration(this._actualMaterial))}});j.exports=g},{"../../../xflow/interface/request.js":139,"../../webgl/system/system-notifier.js":118,"./constants.js":59,"./drawableclosure.js":60,"./rendernode.js":65,"./scene.js":68}],67:[function(h,j){var e=h("./rendernode.js"),
a=h("./constants.js"),d=h("../tools/frustum.js").Frustum,b=a.NODE_TYPE,c=0.25*Math.PI,a=function(a,f,k){e.call(this,b.VIEW,a,f,k);k=k||{};this.position=k.position||XML3D.math.vec3.create();this.orientation=k.orientation||XML3D.math.mat4.create();this.fieldOfView=void 0!==k.fieldOfView?k.fieldOfView:c;this.worldSpacePosition=XML3D.math.vec3.create();this.projectionOverride=k.projectionOverride;this.projectionDirty=this.viewDirty=!0;this.frustum=new d(1,1E5,0,this.fieldOfView,1);this.lastAspectRatio=
1};a.ENTRY_SIZE=48;XML3D.createClass(a,e);XML3D.extend(a.prototype,{getFrustum:function(){return this.frustum},updateViewMatrix:function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create();return function(){XML3D.math.mat4.identity(a);a[12]=this.position[0];a[13]=this.position[1];a[14]=this.position[2];XML3D.math.mat4.multiply(a,a,this.orientation);this.parent.getWorldMatrix(b);XML3D.math.mat4.multiply(a,b,a);XML3D.math.vec3.set(this.worldSpacePosition,a[12],a[13],a[14]);this.setViewToWorldMatrix(a);
XML3D.math.mat4.invert(a,a);this.setWorldToViewMatrix(a);this.viewDirty=!1}}(),updateProjectionMatrix:function(){var a=XML3D.math.mat4.create();return function(b){if(this.projectionOverride)this.setProjectionMatrix(this.projectionOverride),this.frustum.setFrustum(1,1E5,0,this.fieldOfView,1);else{var c=this.getClippingPlanes(),d=c.near,c=c.far,e=this.fieldOfView;XML3D.math.mat4.perspective(a,e,b,d,c);this.setProjectionMatrix(a);this.frustum.setFrustum(d,c,0,e,b);this.lastAspectRatio=b}}}(),getClippingPlanes:function(){var a=
XML3D.math.mat4.create(),b=new XML3D.math.bbox.create;return function(){this.scene.getBoundingBox(b);if(XML3D.math.bbox.isEmpty(b))return{near:1,far:10};this.getWorldToViewMatrix(a);XML3D.math.bbox.transform(b,a,b);var c=-b[5],d=-b[2],e=Math.max(0.005*(d-c),0.05),d=d+e;return{near:Math.max(c-e,e,0.01),far:d}}}(),setMatrix:function(a,b){for(var c=this.offset+b,d=0;16>d;d++,c++)this.page[c]=a[d]},setWorldToViewMatrix:function(a){this.setMatrix(a,16)},setViewToWorldMatrix:function(a){this.setMatrix(a,
0)},setProjectionMatrix:function(a){for(var b=this.offset+32,c=0;16>c;c++,b++)this.page[b]=a[c];this.projectionDirty=!1},setProjectionOverride:function(a){this.projectionOverride=a;this.setProjectionDirty();this.scene.requestRedraw("Projection changed")},setTransformDirty:function(){this.viewDirty=!0;this.setProjectionDirty();this.scene.requestRedraw("Transformation changed")},setProjectionDirty:function(){this.projectionDirty=!0},updatePosition:function(a){this.setTransformDirty();this.position[0]=
a[0];this.position[1]=a[1];this.position[2]=a[2]},updateOrientation:function(a){this.setTransformDirty();for(var b=0;16>b;b++)this.orientation[b]=a[b]},updateFieldOfView:function(a){this.setTransformDirty();this.fieldOfView=a},getViewToWorldMatrix:function(a){this.viewDirty&&this.updateViewMatrix();for(var b=this.offset+0,c=0;16>c;c++,b++)a[c]=this.page[b]},getWorldToViewMatrix:function(a){this.viewDirty&&this.updateViewMatrix();for(var b=this.offset+16,c=0;16>c;c++,b++)a[c]=this.page[b]},getProjectionMatrix:function(a,
b){(this.projectionDirty||b!=this.lastAspectRatio)&&this.updateProjectionMatrix(b);for(var c=this.offset+32,d=0;16>d;d++,c++)a[d]=this.page[c]},getWorldSpacePosition:function(){return this.worldSpacePosition},getWorldSpaceBoundingBox:function(a){XML3D.math.bbox.empty(a)}});j.exports=a},{"../tools/frustum.js":70,"./constants.js":59,"./rendernode.js":65}],68:[function(h,j){var e=h("./pager.js"),a=h("./renderobject.js"),d=h("./renderview.js"),b=h("./rendergroup.js"),c=h("./renderlight.js"),g=h("./material-configuration.js"),
f=h("../lights/light-manager.js"),k=h("./constants.js"),i=h("../../../xflow/interface/graph.js").InputNode,n=h("../../../xflow/interface/graph.js").DataNode,l=h("../../../xflow/interface/data.js").BufferEntry,m=h("../../../xflow/interface/constants.js"),r=h("../../../utils/uri.js").URI,p=function(){e.call(this);this.boundingBox=new XML3D.math.bbox.create;this.lights=new f;this._defaultMaterial=this.activeView=null;this.rootNode=this.createRootNode()};XML3D.createClass(p,e);XML3D.extend(p.prototype,
{getActiveView:function(){return this.activeView},setActiveView:function(a){if(a!=this.activeView){if(!a)throw Error("Active view must not be null");this.activeView=a;this.dispatchEvent({type:k.EVENT_TYPE.VIEW_CHANGED,newView:this.activeView})}},createRenderObject:function(b){var c=this.getPageEntry(a.ENTRY_SIZE);return new a(this,c,b)},createRenderGroup:function(a){var c=this.getPageEntry(b.ENTRY_SIZE);return new b(this,c,a)},createRenderView:function(a){var b=this.getPageEntry(d.ENTRY_SIZE);return new d(this,
b,a)},createRenderLight:function(a){var b=this.getPageEntry(c.ENTRY_SIZE);return new c(this,b,a)},createMaterialConfiguration:function(a,b,c){return new g(a,b,c)},createRootNode:function(){var a=this.getPageEntry(b.ENTRY_SIZE),a=new b(this,a,{material:this.getDefaultMaterial()});a.setWorldMatrix(XML3D.math.mat4.create());a.setLocalMatrix(XML3D.math.mat4.create());a.transformDirty=!1;a.visible=!0;return a},updateBoundingBox:function(){this.rootNode.boundingBoxDirty&&this.activeView&&this.activeView.setProjectionDirty();
this.rootNode.getWorldSpaceBoundingBox(this.boundingBox)},getBoundingBox:function(a){this.updateBoundingBox();XML3D.math.bbox.copy(a,this.boundingBox)},createDrawable:function(){throw Error("Scene::createDrawable not implemented");},requestRedraw:function(){throw Error("Scene::requestRedraw not implemented");},traverse:function(a){this.rootNode.traverse(a)},findRayIntersections:function(a){var b=[];this.rootNode.findRayIntersections(a,b);return b},getDefaultMaterial:function(){if(!this._defaultMaterial){var a=
new i;a.data=new l(m.DATA_TYPE.FLOAT3,new Float32Array([1,0,0]));a.name="diffuseColor";var b=new n(!1);b.appendChild(a);this._defaultMaterial=this.createMaterialConfiguration({type:"urn",urn:new r("urn:xml3d:shader:matte")},b,{name:"default"})}return this._defaultMaterial}});j.exports=p},{"../../../utils/uri.js":133,"../../../xflow/interface/constants.js":136,"../../../xflow/interface/data.js":137,"../../../xflow/interface/graph.js":138,"../lights/light-manager.js":56,"./constants.js":59,"./material-configuration.js":61,
"./pager.js":62,"./rendergroup.js":63,"./renderlight.js":64,"./renderobject.js":66,"./renderview.js":67}],69:[function(h,j){var e=h("../../../xflow/interface/data.js").DataChangeNotifier,a=function(){e.addListener(this.dataEntryChanged)};a.prototype.dataEntryChanged=function(a,b){if(a.userData.webglData)for(var c in a.userData.webglData)a.userData.webglData[c].changed=Math.max(a.userData.webglData[c].changed,b)};j.exports=a},{"../../../xflow/interface/data.js":137}],70:[function(h,j){var e=XML3D.math.vec3,
a=e.create(),d=e.create(),b=function(a,b,c,d,g,e){this.orthographic="undefined"===typeof e?!1:e;this.setFrustum(a,b,c,d,g,this.orthographic)};XML3D.extend(b.prototype,{setFrustum:function(a,b,c,d,g,e){if(c&&d)throw Error("fovx and fovy cannot both be non-zero.");c?(this.right=a*Math.tan(c/2),this.left=-this.right,this.top=(this.right-this.left)/g/2,this.bottom=-this.top):(this.top=a*Math.tan(0.5*d),this.bottom=-this.top,this.right=(this.top-this.bottom)*g/2,this.left=-this.right);this.nearPlane=a;
this.farPlane=b;this.orthographic="undefined"===typeof e?!1:e},getProjectionMatrix:function(a){var b=Number.MAX_VALUE,c=this.right+this.left,d=this.right-this.left,g=this.top+this.bottom,e=this.top-this.bottom,h=this.farPlane+this.nearPlane,j=this.farPlane-this.nearPlane;if(1>Math.abs(d)&&Math.abs(c)>b*Math.abs(d)||1>Math.abs(e)&&Math.abs(g)>b*Math.abs(e)||1>Math.abs(j)&&Math.abs(h)>b*Math.abs(j))throw Error("Bad viewing frustum: projection matrix cannot be computed.");if(this.orthographic){var q=
-c/d,o=-g/e,s=-h/j;if(1>Math.abs(d)&&2>b*Math.abs(d)||1>Math.abs(e)&&2>b*Math.abs(e)||1>Math.abs(j)&&2>b*Math.abs(j))throw Error("Bad viewing frustum:  projection matrix cannot be computed.");c=2/d;g=2/e;h=-2/j;XML3D.math.mat4.identity(a);a[0]=c;a[5]=g;a[10]=h;a[12]=q;a[13]=o;a[14]=s;a[15]=1}else{c/=d;g/=e;h=-h/j;q=-2*this.farPlane*this.nearPlane;if(1>Math.abs(j)&&Math.abs(q)>b*Math.abs(j))throw Error("Bad viewing frustum: projection matrix cannot be computed.");j=q/j;q=2*this.nearPlane;if(1>Math.abs(d)&&
Math.abs(q)>b*Math.abs(d)||1>Math.abs(e)&&Math.abs(q)>b*Math.abs(e))throw Error("Bad viewing frustum: projection matrix cannot be computed.");b=q/d;e=q/e;XML3D.math.mat4.identity(a);a[0]=b;a[5]=e;a[8]=c;a[9]=g;a[10]=h;a[11]=-1;a[14]=j;a[15]=0}},getPlanes:function(){var a=e.create(),b=e.create(),c=e.create(),d=e.create(),g=e.create(),h=e.create(),j=e.create(),p=e.create();return function(q,o){var s=e.transformMat4(a,[this.left,this.bottom,-this.nearPlane],o),u=e.transformMat4(b,[this.left,this.top,
-this.nearPlane],o),t=e.transformMat4(c,[this.right,this.top,-this.nearPlane],o),v=e.transformMat4(d,[this.right,this.bottom,-this.nearPlane],o),w,z,y,x;this.orthographic?(w=e.transformMat4(g,[this.left,this.bottom,-this.farPlane],o),z=e.transformMat4(h,[this.left,this.top,-this.farPlane],o),y=e.transformMat4(j,[this.right,this.top,-this.farPlane],o),x=e.transformMat4(p,[this.right,this.bottom,-this.farPlane],o),q[0].setFromPoints(t,y,z),q[1].setFromPoints(v,x,y),q[2].setFromPoints(s,w,x),q[3].setFromPoints(u,
z,w)):(w=this.farPlane/this.nearPlane,z=w*this.left,y=w*this.right,x=w*this.top,w=e.transformMat4(g,[z,w*this.bottom,-this.farPlane],o),z=e.transformMat4(h,[z,x,-this.farPlane],o),y=e.transformMat4(j,[y,x,-this.farPlane],o),x=e.transformMat4(p,[0,0,0],o),q[0].setFromPoints(x,t,u),q[1].setFromPoints(x,v,t),q[2].setFromPoints(x,s,v),q[3].setFromPoints(x,u,s));q[4].setFromPoints(s,v,t);q[5].setFromPoints(w,z,y)}}()});var c=function(){this.distance=0;this.normal=e.create()};XML3D.extend(c.prototype,{setFromPoints:function(b,
c,g){e.cross(this.normal,e.sub(d,g,b),e.sub(a,c,b));e.normalize(this.normal,this.normal);this.distance=-e.dot(this.normal,b)},set:function(a,b,c,d){e.set(this.normal,a,b,c);e.normalize(this.normal,this.normal);this.distance=d}});var g=function(a,b){this.frustumPlanes=[new c,new c,new c,new c,new c,new c];a&&b&&this.set(a,b)};XML3D.extend(g.prototype,{set:function(a,b){a.getPlanes(this.frustumPlanes,b)},isBoxVisible:function(){return function(a){if(XML3D.math.bbox.isEmpty(a))return!1;for(var b=0;b<
this.frustumPlanes.length;b++){var c=this.frustumPlanes[b],d=c.normal;if(0>(0<=d[0]?a[3]:a[0])*d[0]+(0<=d[1]?a[4]:a[1])*d[1]+(0<=d[2]?a[5]:a[2])*d[2]+c.distance)return!1}return!0}}()});j.exports={Plane:c,Frustum:b,FrustumTest:g}},{}],71:[function(h,j){var e=function(){},a=XML3D.math.bbox.create(),d=XML3D.math.vec3.create();XML3D.extend(e.prototype,{sortScene:function(b,c){for(var g=b.ready,f={},e=[],i=[],h,l=0,m=g.length;l<m;l++)if(h=g[l],!1!==h.inFrustum)if(h.hasTransparency())i.push(h);else{var j=
h.getProgram();f[j.id]=f[j.id]||[];f[j.id].push(h)}for(var p in f){g=f[p];m=Array(g.length);for(l=0;l<g.length;l++)h=g[l],h.getWorldSpaceBoundingBox(a),XML3D.math.bbox.center(d,a),c&&XML3D.math.vec3.transformMat4(d,d,c),m[l]={obj:h,depth:d[2]};m.sort(function(a,b){return b.depth-a.depth});f[p]=m.map(function(a){return a.obj})}p=i.length;if(1<p){for(l=0;l<p;l++)h=i[l],h.getWorldSpaceBoundingBox(a),XML3D.math.bbox.center(d,a),c&&XML3D.math.vec3.transformMat4(d,d,c),i[l]=[h,d[2]];i.sort(function(a,b){return a[1]-
b[1]});for(l=0;l<p;l++)e[l]=i[l][0]}else 1==p&&(e[0]=i[0]);return{opaque:f,transparent:e}}});j.exports=e},{}],72:[function(h,j){j.exports={convertPageCoords:function(e,a,d){var b;b=e.getBoundingClientRect();var c=document.body,g=document.documentElement,e=b.left+(window.pageXOffset||g.scrollLeft||c.scrollLeft)-(g.clientLeft||c.clientLeft||0);b=Math.round(b.top+(window.pageYOffset||g.scrollTop||c.scrollTop)-(g.clientTop||c.clientTop||0));e=Math.round(e);return{x:a-e,y:d-b}}}},{}],73:[function(h,j){var e=
h("texture-manager").SimpleTextureManager,a=h("./texture.js").GLTexture,d=h("./texture.js").GLCubeMap,b=h("./rendertarget.js").GLCanvasTarget,c=h("./../shader/programfactory.js"),g=h("../../../xflow/interface/constants.js"),f={alpha:!0,premultipliedAlpha:!1,antialias:!0,stencil:!0,preserveDrawingBuffer:!0},k=function(a,d){var g;try{g=a.getContext("experimental-webgl",f)}catch(k){g=null}this.gl=g;this.id=d;this.canvasTarget=new b(this,a.clientWidth,a.clientHeight);this.programFactory=new c(this);this.textureManager=
new e({units:this.gl.getParameter(WebGLRenderingContext.MAX_COMBINED_TEXTURE_IMAGE_UNITS)});this.stats={materials:0,meshes:0};g=this.gl;var h={},j;for(j in i){var o=i[j],s=g.getExtension(o);s?h[o]=s:XML3D.debug.logInfo(o,"is not supported on your graphics card")}this.extensions=h},i=k.EXTENSIONS={};i.STANDARD_DERIVATES="OES_standard_derivatives";i.MULTIPLE_RENDER_TARGETS="WEBGL_draw_buffers";i.DEPTH_TEXTURE="WEBGL_depth_texture";i.FLOAT_COLOR_BUFFER="WEBGL_color_buffer_float";i.FLOAT_TEXTURES="OES_texture_float";
i.UINT32_INDICES="OES_element_index_uint";XML3D.extend(k.prototype,{getXflowEntryWebGlData:function(a){var b=this.id;a?(a.userData.webglData||(a.userData.webglData={}),a.userData.webglData[b]||(a.userData.webglData[b]={changed:g.DATA_ENTRY_STATE.CHANGED_NEW}),a=a.userData.webglData[b]):a=null;return a},requestRedraw:function(){},handleResizeEvent:function(a,c){this.canvasTarget=new b(this,a,c)},getStatistics:function(){return this.stats},getExtensionByName:function(a){return this.extensions[a]},createTexture:function(){return new a(this)},
createCubeMap:function(){return new d(this)}});j.exports=k},{"../../../xflow/interface/constants.js":136,"./../shader/programfactory.js":116,"./rendertarget.js":77,"./texture.js":78,"texture-manager":3}],74:[function(h,j){var e=function(a){this.gl=a.gl;this.createGLAssets()};XML3D.extend(e.prototype,{createGLAssets:function(){var a=this.gl;this.posBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.posBuffer);a.bufferData(a.ARRAY_BUFFER,new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0]),a.STATIC_DRAW)},
draw:function(a){var d=this.gl,a=a.attributes.position;d.enableVertexAttribArray(a.location);d.bindBuffer(d.ARRAY_BUFFER,this.posBuffer);d.vertexAttribPointer(a.location,3,d.FLOAT,!1,0,0);d.drawArrays(d.TRIANGLE_STRIP,0,4);d.disableVertexAttribArray(a.location)}});j.exports=e},{}],75:[function(h,j){var e=function(d,b){this.context=d;this.glType=a(b);this.buffers={};this.uniformOverride={};this.maxIndex=this.minIndex=0;this.isIndexed=!1;this.vertexCount=null;this.minAttributeCount=-1;this.context.getStatistics().meshes++;
this.multiDraw=this.glType==WebGLRenderingContext.LINE_STRIP||this.glType==WebGLRenderingContext.TRIANGLE_STRIP};XML3D.extend(e.prototype,{setIndexRange:function(a,b){this.minIndex=a;this.maxIndex=b},checkBufferCompatible:function(a,b){var c=b.getIterateCount();this.minAttributeCount=-1==this.minAttributeCount?c:Math.min(this.minAttributeCount,c);if(this.isIndexed){if(c<=this.maxIndex)throw Error("Index range of ["+this.minIndex+", "+this.maxIndex+"]  goes beyond element count "+c+" of attribute '"+
a+"'");}else if(null!==this.vertexCount&&c<this.vertexCount)throw Error("VertexCount "+this.vertexCount+" is larger than element count "+c+" of attribute '"+a+"'");},removeBuffer:function(a){delete this.buffers[a]},setBuffer:function(a,b){this.buffers[a]=b;this.isIndexed=this.isIndexed||"index"==a},clear:function(){this.buffers={};this.uniformOverride={};this.minIndex=this.maxIndex=0;this.isIndexed=!1;this.minAttributeCount=-1},setUniformOverride:function(a,b){void 0===b&&delete this.uniformOverride[a];
this.uniformOverride[a]=b},setVertexCount:function(a){this.vertexCount=a},isReadyToRender:function(){return 0<this.minAttributeCount},getElementCount:function(){try{return this.buffers.index.length}catch(a){return 0}},getVertexCount:function(){try{return null!=this.vertexCount?this.vertexCount:this.minAttributeCount}catch(a){return 0}},_bindVertexBuffers:function(a){var b=this.context.gl,a=a.attributes,c=this.buffers,g,f,e=Object.keys(a),i=e.length;for(g=0;g<i;g++){f=e[g];var h=c[f];f=a[f].location;
h&&(b.enableVertexAttribArray(f),b.bindBuffer(b.ARRAY_BUFFER,h),b.vertexAttribPointer(f,h.tupleSize,h.glType,!1,0,0))}},_unbindVertexBuffers:function(a){var b=this.context.gl,a=a.attributes,c;for(c in a)b.disableVertexAttribArray(a[c].location);b.bindBuffer(b.ARRAY_BUFFER,null);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)},draw:function(a){var b=this.context.gl,c=this.buffers,g=0,f;this._bindVertexBuffers(a);if(this.isIndexed){g=c.index;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,g);if(this.multiDraw&&this.vertexCount)for(f=
c=0;f<this.vertexCount.length;f++){var e=this.vertexCount[f];b.drawElements(this.glType,e,g.glType,c*g.bytesPerElement);c+=e}else b.drawElements(this.glType,this.getElementCount(),g.glType,0);g=this.getElementCount()/3}else if(this.multiDraw&&this.vertexCount)for(f=c=0;f<this.vertexCount.length;f++)e=this.vertexCount[f],b.drawArrays(this.glType,c,e),c+=e;else b.drawArrays(this.glType,0,this.getVertexCount()),g=this.getVertexCount();this._unbindVertexBuffers(a);a.undoUniformVariableOverride&&a.undoUniformVariableOverride(this.uniformOverride);
return g}});var a=function(a){var b=window.WebGLRenderingContext;a&&a.toLoweGLase&&(a=a.toLowerCase());switch(a){case "triangles":return b.TRIANGLES;case "tristrips":return b.TRIANGLE_STRIP;case "points":return b.POINTS;case "lines":return b.LINES;case "linestrips":return b.LINE_STRIP;default:throw Error("Unknown primitive type: "+a);}};j.exports=e},{}],76:[function(h,j){var e=h("./utils.js"),a=h("../system/system-notifier.js"),d=function(b,c,d){var e=b.createShader(c);b.shaderSource(e,d);b.compileShader(e);
if(0==b.getShaderParameter(e,WebGLRenderingContext.COMPILE_STATUS)){var e=b.getShaderInfoLog(e),h="",h=c==WebGLRenderingContext.VERTEX_SHADER?"Vertex shader failed to compile: \n":"Fragment shader failed to compile: \n",h=h+(e+"\n--------\n")+"Shader Source:\n--------\n"+XML3D.debug.formatSourceCode(d);b.getError();a.sendEvent("glsl",{glslType:"compile_error",shaderType:c==WebGLRenderingContext.VERTEX_SHADER?"vertex":"fragment",code:d,message:e});throw Error(h);}return e},b=e.getUniqueCounter(),c=
function(a,c){this.gl=a;this.sources=c;this.id=b();this.attributes={};this.uniforms={};this.samplers={};this.handle=null;this.create()};XML3D.extend(c.prototype,{create:function(){XML3D.debug.logDebug("Create shader program: ",this.id);var b=this.gl,c=[this.sources.vertex],h=[this.sources.fragment],i,n,l=[];for(n in c)i=c[n],i=d(b,WebGLRenderingContext.VERTEX_SHADER,i),l.push(i);for(n in h)i=h[n],i=d(b,WebGLRenderingContext.FRAGMENT_SHADER,i),l.push(i);var c=b.createProgram(),m;for(m in l)b.attachShader(c,
l[m]);b.linkProgram(c);if(0==b.getProgramParameter(c,WebGLRenderingContext.LINK_STATUS))throw l=b.getProgramInfoLog(c),m="Shader linking failed: \n"+l+"\n--------\n",b.getError(),a.sendEvent("glsl",{glslType:"link_error",message:l}),Error(m);if(this.handle=c){a.sendEvent("glsl",{glslType:"success"});this.bind();b=this.gl;l=this.handle;c=b.getProgramParameter(l,b.ACTIVE_ATTRIBUTES);for(m=0;m<c;m++)if(h=b.getActiveAttrib(l,m))n={},n.name=h.name,n.size=h.size,n.glType=h.type,n.location=b.getAttribLocation(l,
h.name),this.attributes[h.name]=n;c=b.getProgramParameter(l,b.ACTIVE_UNIFORMS);for(m=0;m<c;m++)if(h=b.getActiveUniform(l,m))n={},n.name=h.name,n.size=h.size,n.glType=h.type,n.location=b.getUniformLocation(l,h.name),i=n.name,"[0]"==i.substring(i.length-3)&&(i=i.substring(0,i.length-3)),h.type==b.SAMPLER_2D||h.type==b.SAMPLER_CUBE?(n.cachedUnits=new Int32Array(n.size),n.textures=[],e.setUniform(b,n,n.cachedUnits),this.samplers[i]=n):this.uniforms[i]=n}},bind:function(){this.handle||XML3D.debug.logError("Trying to bind invalid GLProgram.");
this.gl.useProgram(this.handle);for(var a in this.samplers){var b=this.samplers[a];b.textures.length&&this.setSamplerFromTextures(b)}},unbind:function(){},isValid:function(){return!!this.handle},setUniformVariables:function(a,b,c){var d,e,h,m;if(a&&c.envBase){d=a.length;e=c.envBase;for(h=c.envOverride;d--;)m=a[d],this.setUniformVariable(m,h&&void 0!==h[m]?h[m]:e[m])}if(b&&c.sysBase){d=b.length;for(e=c.sysBase;d--;)m=b[d],this.setUniformVariable(m,e[m])}},setUniformVariable:function(a,b){void 0!==
b&&(this.uniforms[a]?e.setUniform(this.gl,this.uniforms[a],b):this.samplers[a]&&this.setUniformSampler(this.samplers[a],b))},setSamplerFromTextures:function(a){for(var b=a.textures,c=a.cachedUnits,d=!1,h=0,l=b.length;h<l;h++){var m=b[h].unit;-1==m&&(m=b[h]._bind());m!=c[h]&&(c[h]=m,d=!0)}d&&(XML3D.debug.logDebug("Setting new texture units:",a.name,c),e.setUniform(this.gl,a,c))},setSamplerFromArray:function(a,b){for(var c=a.cachedUnits,d=!1,h=0,l=b.length;h<l;h++){var m=b[h];m!=c[h]&&(c[h]=m,d=!0)}d&&
(e.setUniform(this.gl,a,c),XML3D.debug.logDebug("Setting global texture units:",a.name,c,this.id))},setUniformSampler:function(a,b){XML3D.debug.assert(b&&a);XML3D.debug.assert(Array.isArray(b),"Program::setUniformSampler: Unexpected value.");XML3D.debug.assert(b.length,"Program::setUniformSampler: No entry in value.");void 0!=b[0].unit?(a.textures=b,this.setSamplerFromTextures(a)):this.setSamplerFromArray(a,b)}});j.exports=c},{"../system/system-notifier.js":118,"./utils.js":79}],77:[function(h,j){var e=
function(a,b,d){this.context=a;this.width=b;this.height=d},a=function(){};XML3D.extend(e.prototype,{getWidth:function(){return this.width},getHeight:function(){return this.height},getScale:function(){return 1},bind:a,unbind:a,resize:a});var d=function(a,b){this.context=a;this.width=b.width||800;this.height=b.height||600;this.scale=b.scale||1;this.opt=this.fillOptions(b);this.handle=null;this.colorTarget={handle:null,isTexture:!1};this.depthTarget={handle:null,isTexture:!1};this.stencilTarget={handle:null,
isTexture:!1};this.valid=!1};XML3D.extend(d.prototype,{getWidth:function(){return this.width},getHeight:function(){return this.height},getScale:function(){return this.scale},bind:function(){var a=!1;this.handle||(this.createFrameBuffer(this.opt.colorFormat,this.opt.depthFormat,this.opt.stencilFormat),a=!0);if(this.valid){var b=this.context.gl;b.bindFramebuffer(b.FRAMEBUFFER,this.handle);a&&b.viewport(0,0,this.width,this.height)}},unbind:function(){var a=this.context.gl;a.bindFramebuffer(a.FRAMEBUFFER,
null)},resize:function(a,b){this.dispose();this.width=a;this.height=b;this.bind()},createFrameBuffer:function(a,b,d){var e=this.context.gl;this.handle=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,this.handle);a&&this.createColorTarget(a);b&&this.createDepthTarget(b);d&&this.createStencilTarget(d);this.checkStatus()},createColorTarget:function(a){var b=this.context.gl;if(this.opt.colorAsRenderbuffer){var d=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,d);b.renderbufferStorage(b.RENDERBUFFER,
a,this.width,this.height);b.bindRenderbuffer(b.RENDERBUFFER,null);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,d);this.colorTarget={handle:d,isTexture:!1}}else d=this.context.createTexture(),d.createTex2DFromData(a,this.width,this.height,b.RGBA,this.opt.colorType||b.UNSIGNED_BYTE,this.opt),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,d.handle,0),this.colorTarget={handle:d,isTexture:!0}},createDepthTarget:function(a){var b=this.context.gl;this.opt.isDepth=
!0;if(this.opt.depthAsRenderbuffer){var d=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,d);b.renderbufferStorage(b.RENDERBUFFER,a,this.width,this.height);b.bindRenderbuffer(b.RENDERBUFFER,null);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,d);this.depthTarget={handle:d,isTexture:!1}}else d=this.context.createTexture(),d.createTex2DFromData(a,this.width,this.height,b.DEPTH_COMPONENT,b.FLOAT,this.opt),b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.TEXTURE_2D,
d.handle,0),this.depthTarget={handle:d,isTexture:!0}},createStencilTarget:function(a){var b=this.context.gl;if(this.opt.stencilAsRenderbuffer){var d=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,d);b.renderbufferStorage(b.RENDERBUFFER,a,this.width,this.height);b.bindRenderbuffer(b.RENDERBUFFER,null);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.RENDERBUFFER,d);this.stencilTarget={handle:d,isTexture:!1}}else d=this.context.createTexture(),d.createTex2DFromData(a,this.width,
this.height,b.STENCIL_COMPONENT,b.UNSIGNED_BYTE,this.opt),b.framebufferTexture2D(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.TEXTURE_2D,d.handle,0),this.stencilTarget={handle:d,isTexture:!0}},checkStatus:function(){var a=this.context.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.handle);var b=a.checkFramebufferStatus(a.FRAMEBUFFER);switch(b){case a.FRAMEBUFFER_COMPLETE:break;case a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
break;case a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case a.FRAMEBUFFER_UNSUPPORTED:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:XML3D.debug.logError("Incomplete framebuffer: "+b)}a.bindFramebuffer(a.FRAMEBUFFER,null);return this.valid=b==a.FRAMEBUFFER_COMPLETE},fillOptions:function(a){var b=this.context.gl,b={wrapS:b.CLAMP_TO_EDGE,wrapT:b.CLAMP_TO_EDGE,minFilter:b.NEAREST,magFilter:b.NEAREST,
depthMode:b.LUMINANCE,depthCompareMode:b.COMPARE_R_TO_TEXTURE,depthCompareFunc:b.LEQUAL,colorsAsRenderbuffer:!1,depthAsRenderbuffer:!1,stencilAsRenderbuffer:!1,isDepth:!1},d;for(d in a)b[d]=a[d];return b},dispose:function(){if(this.handle){var a=this.context.gl;a.deleteFramebuffer(this.handle);null!==this.colorTarget&&(this.colorTarget.isTexture?this.colorTarget.handle.dispose():a.deleteRenderBuffer(this.colorTarget.handle));null!==this.depthTarget&&(this.depthTarget.isTexture?this.depthTarget.handle.dispose():
a.deleteRenderBuffer(this.depthTarget.handle));null!==this.stencilTarget&&(this.stencilTarget.isTexture?this.stencilTarget.handle.dispose():a.deleteRenderBuffer(this.stencilTarget.handle))}}});a=function(a,b,e){d.call(this,a,e);this.scaleToMaxDimension(b)};XML3D.createClass(a,d);XML3D.extend(a.prototype,{scaleToMaxDimension:function(a){var b=this.height-a,d=this.width-a;if(0<b||0<d)a=b>d?a/this.height:a/this.width,this.width=Math.floor(this.width*a),this.height=Math.floor(this.height*a),this.scale=
a}});var b=function(a,b){var d=a.gl;this.context=a;this.height=this.width=b.width||800;this.scale=b.scale||1;this.opt=this.fillOptions(b);this.stencilTarget=this.depthTarget=this.colorTarget=this.stex=this.dtex=this.ctex=this.handle=null;this.valid=!1;this.glSides=[d.TEXTURE_CUBE_MAP_POSITIVE_X,d.TEXTURE_CUBE_MAP_NEGATIVE_X,d.TEXTURE_CUBE_MAP_POSITIVE_Y,d.TEXTURE_CUBE_MAP_NEGATIVE_Y,d.TEXTURE_CUBE_MAP_POSITIVE_Z,d.TEXTURE_CUBE_MAP_NEGATIVE_Z];this.framebuffers=[]};XML3D.extend(b.prototype,{getWidth:function(){return this.width},
getHeight:function(){return this.height},getScale:function(){return this.scale},bind:function(a){var b=!1;0>=this.framebuffers.length&&(this.createFrameBuffers(this.opt.colorFormat,this.opt.depthFormat,this.opt.stencilFormat),b=!0);if(this.valid){var d=this.context.gl;d.bindFramebuffer(d.FRAMEBUFFER,this.framebuffers[a]);b&&d.viewport(0,0,this.width,this.height)}},unbind:function(){var a=this.context.gl;a.bindFramebuffer(a.FRAMEBUFFER,null)},resize:function(a,b){this.dispose();this.width=a;this.height=
b;this.bind()},createFrameBuffers:function(a,b,d){var e=this.context.gl;a&&(this.ctex=this.context.createCubeMap(),this.ctex.createTex2DFromData(a,this.width,this.height,e.RGBA,this.opt.colorType||e.UNSIGNED_BYTE,this.opt),this.colorTarget={handle:this.ctex,isTexture:!0});b&&(this.opt.isDepth=!0,this.opt.depthAsRenderbuffer||(this.dtex=this.context.createCubeMap(),this.dtex.createTex2DFromData(b,this.width,this.height,e.DEPTH_COMPONENT,e.FLOAT,this.opt),this.depthTarget={handle:this.dtex,isTexture:!0}));
d&&(this.stex=this.context.createCubeMap(),this.stex.createTex2DFromData(d,this.width,this.height,e.STENCIL_COMPONENT,e.UNSIGNED_BYTE,this.opt),this.stencilTarget={handle:this.stex,isTexture:!0});for(var i=0;i<this.glSides.length;++i)this.framebuffers[i]=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffers[i]),a&&this.createColorTarget(a,i),b&&this.createDepthTarget(b,i),d&&this.createStencilTarget(d,i),this.checkStatus(i)},createColorTarget:function(a,b){var d=this.context.gl;
d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,this.glSides[b],this.ctex.handle,0)},createDepthTarget:function(a,b){var d=this.context.gl;this.opt.depthAsRenderbuffer?(this.dtex||(this.dtex=[]),this.dtex[b]=d.createRenderbuffer(),d.bindRenderbuffer(d.RENDERBUFFER,this.dtex[b]),d.renderbufferStorage(d.RENDERBUFFER,a,this.width,this.height),d.bindRenderbuffer(d.RENDERBUFFER,null),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,this.dtex[b]),this.depthTarget||(this.depthTarget=
[]),this.depthTarget[b]={handle:this.dtex[b],isTexture:!1}):d.framebufferTexture2D(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT0,this.glSides[b],this.dtex.handle,0)},createStencilTarget:function(a,b){var d=this.context.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.STENCIL_ATTACHMENT,this.glSides[b],this.stex.handle,0)},checkStatus:function(a){var b=this.context.gl;b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffers[a]);a=b.checkFramebufferStatus(b.FRAMEBUFFER);switch(a){case b.FRAMEBUFFER_COMPLETE:break;case b.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");
break;case b.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case b.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case b.FRAMEBUFFER_UNSUPPORTED:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:XML3D.debug.logError("Incomplete framebuffer: "+a)}b.bindFramebuffer(b.FRAMEBUFFER,null);return this.valid=
a==b.FRAMEBUFFER_COMPLETE},fillOptions:function(a){var b=this.context.gl,b={wrapS:b.CLAMP_TO_EDGE,wrapT:b.CLAMP_TO_EDGE,minFilter:b.NEAREST,magFilter:b.NEAREST,depthMode:b.LUMINANCE,depthCompareMode:b.COMPARE_R_TO_TEXTURE,depthCompareFunc:b.LEQUAL,colorsAsRenderbuffer:!1,depthAsRenderbuffer:!1,stencilAsRenderbuffer:!1,isDepth:!1},d;for(d in a)b[d]=a[d];return b},dispose:function(){if(!(0>=this.framebuffers.length)){var a=this.context.gl,b;for(b in this.framebuffers)a.deleteFramebuffer(this.framebuffers[b]);
null!==this.colorTarget.handle&&this.colorTarget.handle.dispose();null!==this.depthTarget&&this.depthTarget.handle.dispose();null!==this.stencilTarget&&this.stencilTarget.handle.dispose();this.framebuffers=[]}}});j.exports={GLCanvasTarget:e,GLRenderTarget:d,GLScaledRenderTarget:a,GLCubeMapRenderTarget:b}},{}],78:[function(h,j){var e=h("./utils.js"),a=h("../../../contrib/state-machine.js"),d=h("../../../xflow/interface/data.js").SamplerConfig,b=h("../../../xflow/interface/constants.js"),c=e.getUniqueCounter(),
g=function(a){d.call(this);this.context=a;this.id=c();this.unit=-1;this.setDefaults();this.height=this.width=0;this.handle=null;this.textureType=a.gl.TEXTURE_2D;this.textureUnitCallback=this.lostTextureUnit.bind(this)};XML3D.createClass(g,d);g.State={NONE:"none",LOADING:"loading",READY:"ready",ERROR:"error"};(function(){var a=null;return function(b){if(!a){a=new g(b);for(var b=new Uint8Array(768),c=0;c<b.length;c++)b[c]=128;a.createTex2DFromData(WebGLRenderingContext.RGB,16,16,WebGLRenderingContext.RGB,
WebGLRenderingContext.UNSIGNED_BYTE,{texels:b,wrapS:WebGLRenderingContext.REPEAT,wrapT:WebGLRenderingContext.REPEAT,minFilter:WebGLRenderingContext.LINEAR,magFilter:WebGLRenderingContext.LINEAR})}return a}})();var f=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1},k=function(a,c){switch(a){case b.TEXTURE_FORMAT.ALPHA:return c.ALPHA;case b.TEXTURE_FORMAT.RGB:return c.RGB;case b.TEXTURE_FORMAT.RGBA:return c.RGBA;case b.TEXTURE_FORMAT.LUMINANCE:return c.LUMINANCE;case b.TEXTURE_FORMAT.LUMINANCE_ALPHA:return c.LUMINANCE_ALPHA;
default:throw Error("Unsupported Texture Format!");}},i=function(a,c){switch(a){case b.TEXTURE_TYPE.FLOAT:return c.FLOAT;case b.TEXTURE_TYPE.UBYTE:return c.UNSIGNED_BYTE;case b.TEXTURE_TYPE.USHORT_4_4_4_4:return c.UNSIGNED_SHORT_4_4_4_4;case b.TEXTURE_TYPE.USHORT_5_5_5_1:return c.UNSIGNED_SHORT_5_5_5_1;case b.TEXTURE_TYPE.USHORT_5_6_5:return c.GL_UNSIGNED_SHORT_5_6_5;default:throw Error("Unsupported Texture Type!");}};XML3D.extend(g.prototype,{updateFromTextureEntry:function(a){if(a.isLoading())this.loads();
else{this.set(a.getSamplerConfig());a=a.asGLTextureValue();if(!a)return this.failed();this.createOrUpdateTexture(a)}},needsScale:function(a,b){return(this.generateMipMap||this.wrapS!=WebGLRenderingContext.CLAMP_TO_EDGE||this.wrapT!=WebGLRenderingContext.CLAMP_TO_EDGE)&&(0!=(a&a-1)||0!=(b&b-1))},_bind:function(){var a=this.context.gl,b=this.unit=this.context.textureManager.bind(this.id,{dispose:this.textureUnitCallback});-2==b?XML3D.debug.logError("All available texture units are full."):(a.activeTexture(WebGLRenderingContext.TEXTURE0+
b),a.bindTexture(this.textureType,this.handle));return b},unbind:function(){},destroy:function(){var a=this.context.gl;this.context.textureManager.dispose(this.id);a.deleteTexture(this.handle)},canBind:function(){return this.current==g.State.READY},createOrUpdateTexture:function(a){this.handle||(this.handle=this.context.gl.createTexture());this.updateTextureFromData(a)},updateTextureFromData:function(a){var b=this.context.gl;this._bind();b.texParameteri(this.textureType,b.TEXTURE_WRAP_S,this.wrapS);
b.texParameteri(this.textureType,b.TEXTURE_WRAP_T,this.wrapT);b.texParameteri(this.textureType,b.TEXTURE_MIN_FILTER,this.minFilter);b.texParameteri(this.textureType,b.TEXTURE_MAG_FILTER,this.magFilter);var c=i(a.texelType,b),d=k(a.texelFormat,b),e=a.width;this.width=e;var g=a.height;this.height=g;if(this.generateMipMap&&this.needsScale(e,g)){if(c===b.FLOAT)throw Error("Should generate MipMaps but texture data is float and not power of two in size!");var h=document.createElement("canvas");h.width=
f(e);h.height=f(g);var j=h.getContext("2d");if(a instanceof HTMLElement)j.drawImage(a,0,0,h.width,h.height);else{var u=document.createElement("canvas");u.width=e;u.height=g;var t=u.getContext("2d"),v=t.createImageData(e,g);v.data.set(a.data);t.putImageData(v,0,0);j.drawImage(u,0,0,h.width,h.height)}a=h}a instanceof HTMLElement?b.texImage2D(b.TEXTURE_2D,0,d,d,c,a):a.data instanceof Uint8ClampedArray?b.texImage2D(b.TEXTURE_2D,0,d,e,g,0,d,c,new Uint8Array(a.data.buffer)):b.texImage2D(b.TEXTURE_2D,0,
d,e,g,0,d,c,a.data);this.generateMipMap&&b.generateMipmap(this.textureType);this.created()},createTex2DFromData:function(a,b,c,d,e,f){var g=this.context.gl,f=f||{},i=f.texels;i||(i=e==g.FLOAT?new Float32Array(4*b*c):new Uint8Array(4*b*c));this.width=b;this.height=c;this.handle=g.createTexture();this._bind();g.texParameteri(this.textureType,g.TEXTURE_WRAP_S,f.wrapS);g.texParameteri(this.textureType,g.TEXTURE_WRAP_T,f.wrapT);g.texParameteri(this.textureType,g.TEXTURE_MIN_FILTER,f.minFilter);g.texParameteri(this.textureType,
g.TEXTURE_MAG_FILTER,f.magFilter);f.isDepth?g.texImage2D(g.TEXTURE_2D,0,a,b,c,0,d,e,null):i instanceof Uint8ClampedArray?g.texImage2D(g.TEXTURE_2D,0,a,b,c,0,d,e,new Uint8Array(i.buffer)):g.texImage2D(g.TEXTURE_2D,0,a,b,c,0,d,e,i);f.generateMipmap&&g.generateMipmap(this.textureType);this.created()},lostTextureUnit:function(){this.unit=-1}});a.create({target:g.prototype,initial:g.State.NONE,events:[{name:"created",from:"*",to:g.State.READY},{name:"failed",from:"*",to:g.State.ERROR},{name:"loads",from:"*",
to:g.State.LOADING}]});e=function(a){g.call(this,a,a.gl.TEXTURE_CUBE_MAP);var b=a.gl;this.textureType=a.gl.TEXTURE_CUBE_MAP;this.glSides=[b.TEXTURE_CUBE_MAP_POSITIVE_X,b.TEXTURE_CUBE_MAP_NEGATIVE_X,b.TEXTURE_CUBE_MAP_POSITIVE_Y,b.TEXTURE_CUBE_MAP_NEGATIVE_Y,b.TEXTURE_CUBE_MAP_POSITIVE_Z,b.TEXTURE_CUBE_MAP_NEGATIVE_Z]};XML3D.createClass(e,g,{updateTextureFromData:function(){debug.log("updateTextureFromData not implemented for CubeMapping!")},createTex2DFromData:function(a,b,c,d,e,f){var g=this.context.gl,
f=f||{},i=f.texels;i||(i=e==g.FLOAT?new Float32Array(4*b*c):new Uint8Array(4*b*c));this.width=b;this.height=c;this.handle=g.createTexture();this._bind();g.texParameteri(this.textureType,g.TEXTURE_WRAP_S,f.wrapS);g.texParameteri(this.textureType,g.TEXTURE_WRAP_T,f.wrapT);g.texParameteri(this.textureType,g.TEXTURE_MIN_FILTER,f.minFilter);g.texParameteri(this.textureType,g.TEXTURE_MAG_FILTER,f.magFilter);for(var h=0;h<this.glSides.length;++h)f.isDepth?g.texImage2D(this.glSides[h],0,a,b,c,0,d,e,null):
i instanceof Uint8ClampedArray?g.texImage2D(this.glSides[h],0,a,b,c,0,d,e,new Uint8Array(i.buffer)):g.texImage2D(this.glSides[h],0,a,b,c,0,d,e,i);f.generateMipmap&&g.generateMipmap(this.textureType);this.created()}});e.State={NONE:"none",LOADING:"loading",READY:"ready",ERROR:"error"};a.create({target:e.prototype,initial:e.State.NONE,events:[{name:"created",from:"*",to:e.State.READY},{name:"failed",from:"*",to:e.State.ERROR},{name:"loads",from:"*",to:e.State.LOADING}]});j.exports={GLTexture:g,GLCubeMap:e}},
{"../../../contrib/state-machine.js":14,"../../../xflow/interface/constants.js":136,"../../../xflow/interface/data.js":137,"./utils.js":79}],79:[function(h,j){h("../../../utils/array.js");j.exports={setUniform:function(e,a,d,b){switch(a.glType){case 35670:d&&void 0!==d.length?e.uniform1iv(a.location,Array.prototype.map.call(d,function(a){return a})):e.uniform1i(a.location,d||0);break;case 5124:case 35678:case 35680:d&&void 0!==d.length?e.uniform1iv(a.location,d):e.uniform1i(a.location,d||0);break;
case 35671:case 35667:e.uniform2iv(a.location,d);break;case 35672:case 35668:e.uniform3iv(a.location,d);break;case 35673:case 35669:e.uniform4iv(a.location,d);break;case 5126:null!=d.length?e.uniform1fv(a.location,d):e.uniform1f(a.location,d);break;case 35664:e.uniform2fv(a.location,d);break;case 35665:e.uniform3fv(a.location,d);break;case 35666:e.uniform4fv(a.location,d);break;case 35674:e.uniformMatrix2fv(a.location,b||!1,d);break;case 35675:e.uniformMatrix3fv(a.location,b||!1,d);break;case 35676:e.uniformMatrix4fv(a.location,
b||!1,d);break;default:XML3D.debug.logError("Unknown uniform type "+a.glType)}},getUniqueCounter:function(){var e=0;return function(){return e++}},checkError:function(e,a){var d=e.getError();if(d!==e.NO_ERROR){var b=""+d;switch(d){case 1280:b="1280 ( GL_INVALID_ENUM )";break;case 1281:b="1281 ( GL_INVALID_VALUE )";break;case 1282:b="1282 ( GL_INVALID_OPERATION )";break;case 1283:b="1283 ( GL_STACK_OVERFLOW )";break;case 1284:b="1284 ( GL_STACK_UNDERFLOW )";break;case 1285:b="1285 ( GL_OUT_OF_MEMORY )"}d=
"GL error "+b+" occured.";void 0!==a&&(d+=" "+a);XML3D.debug.trace(d)}},supported:function(){var e=document.createElement("canvas");try{return!(!window.WebGLRenderingContext||!e.getContext("experimental-webgl"))}catch(a){return!1}}}},{"../../../utils/array.js":127}],80:[function(h,j){function e(b,c){a.call(this,b,c);this.renderInterface={};this.lastPickObj=null;this.lastKnownDimensions={width:c.width,height:c.height};this.initialize()}var a=h("../renderer/canvas-handler.js"),d=h("../../utils/options.js"),
b=h("../../base/formathandler.js").xml3dFormatHandler;d.register("renderer-continuous",!1);XML3D.createClass(e,a);e.prototype.setRenderer=function(a){this.renderer=a};e.prototype.initialize=function(){this.configureCanvas();var a=this;this.tick=function(){if(a.renderer){XML3D.updateXflowObserver();XML3D.flushDOMChanges();if(a.canvasSizeChanged()||a.renderer.needsRedraw()||d.getValue("renderer-continuous"))a.dispatchUpdateEvent(),a.draw();window.requestAnimFrame(a.tick,30)}};var b=this._xml3dElement.getAttribute("contextmenu");
(!b||"false"==b)&&this._canvas.addEventListener("contextmenu",function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation()},!1)};e.prototype.configureCanvas=function(){var a=this._xml3dElement,b=this._canvas,c=a.parentNode,d=c.ownerDocument.createElement("div");d.style.display="none";c.insertBefore(d,a);d.appendChild(a);c.insertBefore(b,d);a=b.ownerDocument.defaultView.getComputedStyle(a);if(!b.style.backgroundColor&&(a=a.getPropertyValue("background-color"))&&"transparent"!=
a)b.style.backgroundColor=a;b.width=b.clientWidth;b.height=b.clientHeight;return b};e.prototype.getPickObjectByPoint=function(a,b){return this.renderer.getRenderObjectFromPickingBuffer(a,b)};e.prototype.getPickedObject=function(){return this.renderer.pickedObject?this.renderer.pickedObject.node:null};e.prototype.getWorldSpaceNormalByPoint=function(a,b){return this.renderer.getWorldSpaceNormalByPoint(a,b)};e.prototype.getWorldSpacePositionByPoint=function(a,b){return this.renderer.getWorldSpacePositionByPoint(a,
b)};e.prototype.canvasSizeChanged=function(){var a=this._canvas;return a.clientWidth!==this.lastKnownDimensions.width||a.clientHeight!==this.lastKnownDimensions.height?(this.lastKnownDimensions.width=a.width=a.clientWidth,this.lastKnownDimensions.height=a.height=a.clientHeight,this.renderer.handleResizeEvent(a.width,a.height),this.dispatchResizeEvent({width:a.width,height:a.height}),!0):!1};var c=window.performance||Date;e.prototype.draw=function(){XML3D.flushDOMChanges();try{var a=c.now(),d=this.renderer.renderToCanvas(),
e=c.now();b.getFactory("webgl",this.id).getAdapter(this._xml3dElement).onFrameDrawn();this.dispatchFrameDrawnEvent(a,e,d)}catch(i){XML3D.debug.logException(i)}};e.prototype.getMousePosition=function(a){var b=this._canvas.getBoundingClientRect();return{x:a.clientX-b.left,y:a.clientY-b.top}};j.exports=e},{"../../base/formathandler.js":9,"../../utils/options.js":132,"../renderer/canvas-handler.js":52}],81:[function(h,j){var e=h("../base/program.js"),a=h("../xflow/utils.js"),d=function(a){this.program=
null;this.context=a;this.obsolete=!1;this.id="";this.uniformCollection={envBase:{},envOverride:null,sysBase:null};this.isTransparent=!1;this.source={vertex:"",fragment:""}};Object.defineProperties(d.prototype,{attributes:{writeable:!1,get:function(){return this.program?this.program.attributes:{}}},uniforms:{writeable:!1,get:function(){return this.program?this.program.uniforms:{}}},samplers:{writeable:!1,get:function(){return this.program?this.program.samplers:{}}}});XML3D.createClass(d,null,{equals:function(a){return this.source.vertex===
a.source.vertex&&this.source.fragment===a.source.fragment},hasTransparency:function(){return this.isTransparent},compile:function(){if(!this.source.fragment||!this.source.vertex)XML3D.debug.logError("No source found for shader",this);else{var a=new e(this.context.gl,this.source);this.program=a;this.id=a.id}},bind:function(){this.program.bind()},unbind:function(){this.program.unbind()},isValid:function(){return this.program.isValid()},updateUniformsFromComputeResult:function(b){var b=b.getOutputMap(),
c=this.uniformCollection.envBase={};this.setDefaultUniforms(this.uniformCollection.envBase);for(var d in b)c[d]=a.getGLUniformValueFromXflowDataEntry(b[d],this.context);this.setUniformVariables(Object.keys(c),null,this.uniformCollection);this.isTransparent=this.getTransparencyFromInputData(b)},setUniformVariables:function(a,c,d){this.program.setUniformVariables(a,c,d)},setSystemUniformVariables:function(a,c){this.uniformCollection.sysBase=c;this.setUniformVariables(null,a,this.uniformCollection)},
changeUniformVariableOverride:function(a,c){var d=a?Object.keys(a):[];c&&d.push.apply(d,Object.keys(c));this.uniformCollection.envOverride=c;this.setUniformVariables(d,null,this.uniformCollection)}});j.exports=d},{"../base/program.js":76,"../xflow/utils.js":119}],82:[function(h,j){h("../scene/glscene.js");var e=h("../scene/gllights.js"),a=h("../materials/events.js"),d=h("../../../contrib/EventDispatcher.js"),b=h("../../../xflow/interface/request.js").ComputeRequest,c=h("../../../xflow/interface/constants.js"),
g=function(a){this.context=a;this.shaderClosures=[];this.updateLightValues=this.dataChanged=!1;this.request=null};XML3D.createClass(g,d,{setShaderInfo:null,updateRequest:function(a){this.request&&this.request.clear();this.request=new b(a,this.getRequestFields(),this.onShaderRequestChange.bind(this));this.setShaderRecompile()},onShaderInfoChanged:function(a){this.setShaderInfo(a);this.setShaderRecompile();this.context.requestRedraw("Shader script changed")},onShaderRequestChange:function(a,b){this.dataChanged=
!0;b==c.RESULT_STATE.CHANGED_STRUCTURE&&this.setShaderRecompile();this.context.requestRedraw("Shader data changed")},update:function(a){for(var b=this,c=this.shaderClosures.length;c--;)this.shaderClosures[c].obsolete&&this.shaderClosures.splice(c,1);if(this.shaderClosures.length){if(this.dataChanged){var d=this.getShaderDataResult();this.shaderClosures.forEach(function(a){b.updateClosureFromComputeResult(a,d)});this.dataChanged=!1}this.updateLightValues&&this.shaderClosures.forEach(function(c){b.updateClosureFromLightParameters(c,
a)})}},updateClosureFromComputeResult:function(a,b){b&&b.getOutputMap&&(a.bind(),a.updateUniformsFromComputeResult(b))},updateClosureFromLightParameters:function(a,b){a.bind();a.setSystemUniformVariables(e.ALL_PARAMETERS,b.systemUniforms)},updateSystemUniforms:function(a,b){this.shaderClosures.forEach(function(c){c.bind();c.setSystemUniformVariables(a,b.systemUniforms)})},createShaderClosure:function(){throw Error("AbstractComposer::createShaderClosure needs to be overridden");},createObjectDataRequest:function(){throw Error("AbstractComposer::createObjectDataRequest needs to be overridden");
},distributeObjectShaderData:function(){throw Error("AbstractComposer::distributeObjectShaderData needs to be overridden");},getShaderClosure:function(a,b){var c=this.createShaderClosure();try{c.createSources(a,this.getShaderDataResult(),b)}catch(d){throw Error("Shader: "+d.message);}for(var e=0;e<this.shaderClosures.length;e++)if(this.shaderClosures[e].equals(c))return this.shaderClosures[e].obsolete=!1,this.shaderClosures[e];this.initializeShaderClosure(c,a);return c},initializeShaderClosure:function(b,
c){b.compile();c.dispatchEvent({type:a.MATERIAL_INITIALIZED});this.updateClosureFromComputeResult(b,this.getShaderDataResult());this.updateClosureFromLightParameters(b,c);this.shaderClosures.push(b)},setShaderRecompile:function(){for(var b=0;b<this.shaderClosures.length;++b)this.shaderClosures[b].obsolete=!0;this.dispatchEvent({type:a.MATERIAL_STRUCTURE_CHANGED});this.updateLightValues=this.dataChanged=!0},getShaderDataResult:function(){return this.request?this.request.getResult():null}});d=function(a){this.context=
a};XML3D.createClass(d,g,{update:function(){},getShaderClosure:function(){return this.context.programFactory.getFallbackProgram()},getShaderAttributes:function(){return{color:null,normal:null}},getRequestFields:function(){return["diffuseColor","useVertexColor"]},createObjectDataRequest:function(a,c){return new b(a,["position","color","normal","diffuseColor","useVertexColor"],c)},distributeObjectShaderData:function(a,b,c){var a=a.getResult().getOutputMap(),d=this.getRequestFields(),e;for(e in a)-1!=
d.indexOf(e)?c(e,a[e]):b(e,a[e])}});j.exports={AbstractShaderComposer:g,DefaultComposer:d}},{"../../../contrib/EventDispatcher.js":11,"../../../xflow/interface/constants.js":136,"../../../xflow/interface/request.js":139,"../materials/events.js":83,"../scene/gllights.js":114,"../scene/glscene.js":115}],83:[function(h,j){j.exports={MATERIAL_STRUCTURE_CHANGED:"material_structure_changed",MATERIAL_INITIALIZED:"material_initialized"}},{}],84:[function(h,j){var e=h("./../abstractshaderclosure.js");h("./jsshadercomposer.js");
var a=h("../../system/system-notifier.js"),d=h("./jssystemconfiguration.js"),b=h("../../../../xflow/interface/constants.js"),c=h("../../../../utils/options.js"),g={pointLightOn:{staticValue:"MAX_POINTLIGHTS",staticSize:"pointLightOn,pointLightAttenuation,pointLightIntensity,pointLightPosition,pointLightCastShadow,pointLightShadowBias,pointLightShadowMap,pointLightMatrix,pointLightNearFar".split(",")},directionalLightOn:{staticValue:"MAX_DIRECTIONALLIGHTS",staticSize:"directionalLightOn,directionalLightIntensity,directionalLightDirection,directionalLightCastShadow,directionalLightShadowBias,directionalLightShadowMap,directionalLightMatrix".split(",")},
spotLightOn:{staticValue:"MAX_SPOTLIGHTS",staticSize:"spotLightOn,spotLightAttenuation,spotLightIntensity,spotLightPosition,spotLightDirection,spotLightCosFalloffAngle,spotLightCosSoftFalloffAngle,spotLightCastShadow,spotLightShadowBias,spotLightShadowMap,spotLightMatrix".split(",")}},f={},k=function(a,c){var d={};switch(a){case b.DATA_TYPE.BOOL:d.type=Shade.TYPES.BOOLEAN;break;case b.DATA_TYPE.INT:d.type=Shade.TYPES.INT;break;case b.DATA_TYPE.FLOAT:d.type=Shade.TYPES.NUMBER;break;case b.DATA_TYPE.FLOAT2:d.type=
Shade.TYPES.OBJECT;d.kind=Shade.OBJECT_KINDS.FLOAT2;break;case b.DATA_TYPE.FLOAT3:d.type=Shade.TYPES.OBJECT;d.kind=Shade.OBJECT_KINDS.FLOAT3;break;case b.DATA_TYPE.FLOAT4:d.type=Shade.TYPES.OBJECT;d.kind=Shade.OBJECT_KINDS.FLOAT4;break;case b.DATA_TYPE.FLOAT3X3:d.type=Shade.TYPES.OBJECT;d.kind=Shade.OBJECT_KINDS.MATRIX3;break;case b.DATA_TYPE.FLOAT4X4:d.type=Shade.TYPES.OBJECT;d.kind=Shade.OBJECT_KINDS.MATRIX4;break;case b.DATA_TYPE.TEXTURE:d.type=Shade.TYPES.OBJECT;d.kind=Shade.OBJECT_KINDS.TEXTURE;
break;default:throw Error("Unknown Xflow DataType: "+a);}d.source=c;return d},i=function(a,b,c){e.call(this,a);this.sourceTemplate=b;this.extractedParams=c;this.uniformSetter=function(){};this.uniformConverter=[]};XML3D.createClass(i,e,{createSources:function(b,e,i){var h=i.getResult(),j={"this":d(this.context),"global.shade":[{extra:{type:"object",kind:"any",global:!0,info:{}}}]},q=b.systemUniforms,o=j["this"].info,s;for(s in g){var u=g[s],t=q[s]&&q[s].length;o[u.staticValue].staticValue=t;for(var v=
0;v<u.staticSize.length;++v)o[u.staticSize[v]].staticSize=t}q=j["global.shade"][0].extra.info;e=e&&e.getOutputMap();o=h&&h.outputNames;for(v=0;v<this.extractedParams.length;++v)s=this.extractedParams[v],o&&-1!=o.indexOf(s)?q[s]=k(h.getOutputType(s),h.isOutputUniform(s)?Shade.SOURCES.UNIFORM:Shade.SOURCES.VERTEX):e&&e[s]&&(q[s]=k(e[s].type,Shade.SOURCES.UNIFORM));XML3D.debug.logDebug("CONTEXT:",j);v={propagateConstants:!0,validate:!0,sanitize:!0,transformSpaces:c.getValue("shadejs-transformSpaces"),
extractUniformExpressions:c.getValue("shadejs-extractUniformExpressions")};e={useStatic:!0,uniformExpressions:v.uniformExpressions};o=b.deferred?"xml3d-glsl-deferred":"xml3d-glsl-forward";q=o+";"+JSON.stringify(v)+";"+JSON.stringify(q)+";"+this.sourceTemplate;if(!(s=f[q]))try{var w=new Shade.WorkingSet;w.parse(this.sourceTemplate,{loc:!0});w.analyze(j,o,v);var z=w.getProcessingData("spaceInfo"),y=w.compileFragmentShader(e);s={source:y.source,uniformSetter:y.uniformSetter,spaceInfo:z};this.uniformSetter=
y.uniformSetter;this.source={fragment:y.source,vertex:this.createVertexShader(i,h,z)};b.deferred&&(s.signatures=w.getProcessingData("colorClosureSignatures"));c.getValue("shadejs-cache")&&(f[q]=s)}catch(x){throw a.sendEvent("shadejs",{shadejsType:"error",event:x,code:this.sourceTemplate}),b="Shade.js Compile Error:\n"+x.message+"\n------------\nShader Source:\n------------\n"+XML3D.debug.formatSourceCode(this.sourceTemplate),Error(b);}this.source={fragment:s.source,vertex:this.createVertexShader(i,
h,s.spaceInfo)};this.uniformSetter=s.uniformSetter;b.deferred&&b.colorClosureSignatures.push.apply(b.colorClosureSignatures,s.signatures);XML3D.debug.logDebug(this.source.vertex);XML3D.debug.logDebug(this.source.fragment);a.sendEvent("shadejs",{shadejsType:"success",vertexShader:this.source.vertex,fragmentShader:this.source.fragment});return!0},createVertexShader:function(a,c,d){for(var e=a.getConfig(),c=c.outputNames,g=0;g<c.length;++g){var f=e,i=c[g],h=d;if(!h||!h[i])h=("_env_"+i).replace(/_+/g,
"_"),f.channelAttribute(i,h,null);else for(var k=h[i].length;k--;){var j=h[i][k],v=("_env_"+j.name).replace(/_+/g,"_"),w=null;switch(j.space){case Shade.SPACE_VECTOR_TYPES.OBJECT:break;case Shade.SPACE_VECTOR_TYPES.VIEW_POINT:f.addInputParameter(b.DATA_TYPE.FLOAT4X4,"modelViewMatrix",!0);w=v+" = ( modelViewMatrix * vec4(#I{"+i+"}, 1.0) ).xyz;";break;case Shade.SPACE_VECTOR_TYPES.VIEW_NORMAL:f.addInputParameter(b.DATA_TYPE.FLOAT3X3,"modelViewMatrixN",!0);w=v+" = normalize( modelViewMatrixN * #I{"+
i+"} );";break;case Shade.SPACE_VECTOR_TYPES.WORLD_POINT:f.addInputParameter(b.DATA_TYPE.FLOAT4X4,"modelMatrix",!0);w=v+" = ( modelMatrix * vec4(#I{"+i+"}, 1.0) ).xyz;";break;case Shade.SPACE_VECTOR_TYPES.WORLD_NORMAL:f.addInputParameter(b.DATA_TYPE.FLOAT3X3,"modelMatrixN",!0);w=v+" = normalize( modelMatrixN * #I{"+i+"} );";break;default:throw Error("Can't handle Space Type: "+j.space);}f.channelAttribute(i,v,w)}}e.addInputParameter(b.DATA_TYPE.FLOAT4X4,"modelViewProjectionMatrix",!0);e.addCodeFragment("gl_Position = modelViewProjectionMatrix * vec4(#I{position}, 1.0);");
return a.getVertexShader().getGLSLCode()},setUniformVariables:function(a,b,c){this.uniformSetter(a,b,c,this.program.setUniformVariable.bind(this.program))},getTransparencyFromInputData:function(){return!1},setDefaultUniforms:function(){}});j.exports=i},{"../../../../utils/options.js":132,"../../../../xflow/interface/constants.js":136,"../../system/system-notifier.js":118,"./../abstractshaderclosure.js":81,"./jsshadercomposer.js":85,"./jssystemconfiguration.js":86}],85:[function(h,j){var e=h("./../abstractshadercomposer.js").AbstractShaderComposer,
a=h("./jsshaderclosure.js"),d=h("../../../../xflow/processing/vs-connect.js").VSConfig,b=h("../../../../xflow/interface/request.js").VertexShaderRequest,c=h("../../../../xflow/interface/constants.js"),g=function(a,b){e.call(this,a,b);if(!window.Shade)throw Error("shade.js library not found");this.context=a;this.sourceTemplate=b.model.script;this.extractedParams=[];this.request=null;this.setShaderInfo(b)};g.convertSysName=function(a){return a};XML3D.createClass(g,e,{setShaderInfo:function(a){try{this.extractedParams=
Shade.extractParameters(this.sourceTemplate,{implementation:"xml3d-glsl-forward"}).shaderParameters}catch(b){this.extractedParams=[]}-1==this.extractedParams.indexOf("position")&&this.extractedParams.push("position");this.extractedParams.length&&this.updateRequest(a.dataNode)},getRequestFields:function(){return this.extractedParams},getShaderAttributes:function(){return{color:null,normal:null,texcoord:null}},createShaderClosure:function(){return new a(this.context,this.sourceTemplate,this.extractedParams)},
createObjectDataRequest:function(a,e){var g=new d,h=this.extractedParams.slice();g.addAttribute(c.DATA_TYPE.FLOAT3,"position",!0);for(var l=0;l<h.length;++l){var m=h[l];if("position"!=m){var j=a.getOutputChannelInfo(m);j&&g.addAttribute(j.type,m,!0)}}return new b(a,g,e)},distributeObjectShaderData:function(a,b,c){var a=a.getVertexShader(),d=a.inputNames,e,g,h;for(e=0;e<d.length;++e)g=d[e],h=a.getInputData(g),a.isInputUniform(g)?c(g,h):b(g,h);b=a.outputNames;for(e=0;e<b.length;++e)g=b[e],a.isOutputFragmentUniform(g)&&
c(a.getOutputSourceName(g),a.getUniformOutputData(g))}});j.exports=g},{"../../../../xflow/interface/constants.js":136,"../../../../xflow/interface/request.js":139,"../../../../xflow/processing/vs-connect.js":186,"./../abstractshadercomposer.js":82,"./jsshaderclosure.js":84}],86:[function(h,j){var e=h("../../base/context.js"),a=null,d={type:"object",kind:"any",info:{coords:{type:"object",kind:"float3",source:"uniform"},cameraPosition:{type:"object",kind:"float3",source:"uniform"},viewMatrix:{type:"object",
kind:"matrix4",source:"uniform"},viewInverseMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelViewMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelViewProjectionMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelMatrixN:{type:"object",kind:"matrix3",source:"uniform"},modelViewMatrixN:{type:"object",kind:"matrix3",source:"uniform"},MAX_POINTLIGHTS:{type:"int",source:"constant",staticValue:5},pointLightOn:{type:"array",
elements:{type:"boolean"},staticSize:5,source:"uniform"},pointLightAttenuation:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},pointLightIntensity:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},pointLightPosition:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},pointLightCastShadow:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},pointLightShadowBias:{type:"array",elements:{type:"number"},
staticSize:5,source:"uniform"},pointLightShadowMap:{type:"array",elements:{type:"object",kind:"texture"},staticSize:5,source:"uniform"},pointLightMatrix:{type:"array",elements:{type:"object",kind:"matrix4"},staticSize:5,source:"uniform"},pointLightProjection:{type:"array",elements:{type:"object",kind:"matrix4"},staticSize:5,source:"uniform"},pointLightNearFar:{type:"array",elements:{type:"object",kind:"float2"},staticSize:5,source:"uniform"},MAX_DIRECTIONALLIGHTS:{type:"int",source:"constant",staticValue:5},
directionalLightOn:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},directionalLightIntensity:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},directionalLightDirection:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},directionalLightCastShadow:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},directionalLightShadowBias:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},
directionalLightShadowMap:{type:"array",elements:{type:"object",kind:"texture"},staticSize:5,source:"uniform"},directionalLightMatrix:{type:"array",elements:{type:"object",kind:"matrix4"},staticSize:5,source:"uniform"},MAX_SPOTLIGHTS:{type:"int",source:"constant",staticValue:5},spotLightOn:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},spotLightAttenuation:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},spotLightIntensity:{type:"array",elements:{type:"object",
kind:"float3"},staticSize:5,source:"uniform"},spotLightPosition:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},spotLightDirection:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},spotLightCosFalloffAngle:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},spotLightCosSoftFalloffAngle:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},spotLightCastShadow:{type:"array",elements:{type:"boolean"},
staticSize:5,source:"uniform"},spotLightShadowBias:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},spotLightShadowMap:{type:"array",elements:{type:"object",kind:"texture"},staticSize:5,source:"uniform"},spotLightMatrix:{type:"array",elements:{type:"object",kind:"matrix4"},staticSize:5,source:"uniform"},ssaoMap:{type:"object",kind:"texture",source:"uniform"},environment:{type:"object",kind:"texture",source:"uniform"}}};j.exports=function(b){a||(b.getExtensionByName(e.EXTENSIONS.STANDARD_DERIVATES)&&
(d.info.fwidth={type:Shade.TYPES.FUNCTION},d.info.dx={type:Shade.TYPES.FUNCTION},d.info.dy={type:Shade.TYPES.FUNCTION}),a=d);return a}},{"../../base/context.js":73}],87:[function(h,j){var e=h("./js/jsshadercomposer.js"),a=h("./urn/urnshadercomposer.js"),d=h("./abstractshadercomposer.js").DefaultComposer,b=function(a){this.context=a;this.composers={};this.defaultComposer=new d(a);this.lightValuesDirty=!0};XML3D.extend(b.prototype,{createComposerFromMaterialConfiguration:function(b){if(!b)return this.defaultComposer;
var d=this.composers[b.id];if(!d){try{var f=b.model.type;switch(f){case "urn":d=new a(this.context,b);break;case "text/javascript":case "application/javascript":case "text/shade-javascript":d=new e(this.context,b);break;default:XML3D.debug.logError("Can not create shader of type:",f,b.model)}}catch(h){XML3D.debug.logError("No shader could be created for '"+b.name+"':",h.message),d=this.defaultComposer}d&&(this.composers[b.id]=d,this.context.getStatistics().materials++);return d||this.defaultComposer}return d},
getTemplateById:function(a){return this.composers[a]},update:function(a){for(var b in this.composers)this.composers[b].update(a,{updateLightValues:this.lightValuesDirty});this.lightValuesDirty=!1},setLightStructureDirty:function(){this.setShaderRecompile()},setShaderRecompile:function(){for(var a in this.composers)this.composers[a].setShaderRecompile()},updateSystemUniforms:function(a,b){for(var d in this.composers)this.composers[d].updateSystemUniforms(a,b)},setLightValueChanged:function(){for(var a in this.composers)this.composers[a].updateLightValues=
!0}});j.exports=b},{"./abstractshadercomposer.js":82,"./js/jsshadercomposer.js":85,"./urn/urnshadercomposer.js":96}],88:[function(h,j){function e(a){var b={};["spot","point","directional"].forEach(function(c){var d=a.filter(function(a){return a.light.model.id==c});b[c+"LightShadowMap"]=d.map(function(a){return a.slot})});return b}var a=h("../../renderer/scene/constants.js").EVENT_TYPE,d=h("../base/rendertarget"),b=h("../render-passes/light-pass"),c=h("../render-passes/pointlight-pass"),g=function(b,
c){this.context=b;c.addEventListener(a.LIGHT_STRUCTURE_CHANGED,this.onLightStructureChanged.bind(this));c.addEventListener(a.LIGHT_VALUE_CHANGED,this.onLightValueChanged.bind(this));c.addEventListener(a.SCENE_SHAPE_CHANGED,this.onSceneShapeChanged.bind(this));this.shadowMapInfos=[];this.dirty=!0};XML3D.extend(g.prototype,{onLightStructureChanged:function(a){var a=a.light,e=this.shadowMapInfos;if(a.removed)for(var g=0;g<e.length;g++){if(e[g].light===a){e.splice(index,1);break}}else if(a.model.getParameter("castShadow")[0]){var g=
a.scene.context,h=2*Math.max(g.canvasTarget.width,g.canvasTarget.height),h={width:h,height:h,colorFormat:g.gl.RGBA,depthFormat:g.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0};"point"==a.model.id?(h=new d.GLCubeMapRenderTarget(g,h),h=new c({context:g},h,a)):(h=new d.GLRenderTarget(g,h),h=new b({context:g},h,a));h.init(g);h.output.bind();g=g.textureManager.getEntry(h.output.colorTarget.handle.id);g.fixed=!0;h.output.unbind();e.push({light:a,pass:h,slot:g.slot});this.requestRendering("light added")}},
onLightValueChanged:function(){this.requestRendering("light value changed")},onSceneShapeChanged:function(){this.requestRendering("scene shape changed")},requestRendering:function(){this.dirty=!0},updateForRendering:function(){if(this.dirty){for(var a=this.shadowMapInfos,b=0;b<a.length;b++)a[b].pass.renderScene();this.dirty=!1}},fillGlobalParameters:function(a){var b=e(this.shadowMapInfos);XML3D.extend(a,b)}});j.exports=g},{"../../renderer/scene/constants.js":59,"../base/rendertarget":77,"../render-passes/light-pass":102,
"../render-passes/pointlight-pass":106}],89:[function(){XML3D.shaders.register("diffuse",{vertex:"attribute vec3 position;\nattribute vec3 normal;\nattribute vec3 color;\nattribute vec2 texcoord;\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat3 modelViewMatrixN;\nuniform vec3 eyePosition;\nvoid main(void) {\n    vec3 pos = position;\n    vec3 norm = normal;\n    gl_Position = modelViewProjectionMatrix * vec4(pos, 1.0);\n    fragNormal = normalize(modelViewMatrixN * norm);\n    fragVertexPosition = (modelViewMatrix * vec4(pos, 1.0)).xyz;\n    fragEyeVector = normalize(fragVertexPosition);\n    fragTexCoord = texcoord;\n    fragVertexColor = color;\n}",
fragment:"uniform float ambientIntensity;\nuniform vec3 diffuseColor;\nuniform vec3 emissiveColor;\nuniform float transparency;\nuniform mat4 viewMatrix;\nuniform bool useVertexColor;\n#if HAS_EMISSIVETEXTURE\nuniform sampler2D emissiveTexture;\n#endif\n#if HAS_DIFFUSETEXTURE\nuniform sampler2D diffuseTexture;\n#endif\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\n#if MAX_POINTLIGHTS > 0\nuniform vec3 pointLightAttenuation[MAX_POINTLIGHTS];\nuniform vec3 pointLightPosition[MAX_POINTLIGHTS];\nuniform vec3 pointLightIntensity[MAX_POINTLIGHTS];\nuniform bool pointLightOn[MAX_POINTLIGHTS];\n#endif\n#if MAX_DIRECTIONALLIGHTS > 0\nuniform vec3 directionalLightDirection[MAX_DIRECTIONALLIGHTS];\nuniform vec3 directionalLightIntensity[MAX_DIRECTIONALLIGHTS];\nuniform bool directionalLightOn[MAX_DIRECTIONALLIGHTS];\n#endif\n#if MAX_SPOTLIGHTS > 0\nuniform vec3 spotLightAttenuation[MAX_SPOTLIGHTS];\nuniform vec3 spotLightPosition[MAX_SPOTLIGHTS];\nuniform vec3 spotLightIntensity[MAX_SPOTLIGHTS];\nuniform bool spotLightOn[MAX_SPOTLIGHTS];\nuniform vec3 spotLightDirection[MAX_SPOTLIGHTS];\nuniform float spotLightCosFalloffAngle[MAX_SPOTLIGHTS];\nuniform float spotLightCosSoftFalloffAngle[MAX_SPOTLIGHTS];\nuniform float spotLightSoftness[MAX_SPOTLIGHTS];\n#endif\nvoid main(void) {\n  float alpha =  max(0.0, 1.0 - transparency);\n  vec3 objDiffuse = diffuseColor;\n  if(useVertexColor)\n    objDiffuse *= fragVertexColor;\n  #if HAS_DIFFUSETEXTURE\n    vec4 texDiffuse = texture2D(diffuseTexture, fragTexCoord);\n    alpha *= texDiffuse.a;\n    objDiffuse *= texDiffuse.rgb;\n  #endif\n  if (alpha < 0.05) discard;\n  #if HAS_EMISSIVETEXTURE\n    vec3 color = emissiveColor * texture2D(emissiveTexture, fragTexCoord).rgb + (ambientIntensity * objDiffuse);\n  #else\n    vec3 color = emissiveColor + (ambientIntensity * objDiffuse);\n  #endif\n  #if MAX_POINTLIGHTS > 0\n    for (int i=0; i<MAX_POINTLIGHTS; i++) {\n      if (!pointLightOn[i])\n         continue;\n      vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n      vec3 L = lPosition.xyz - fragVertexPosition;\n      float dist = length(L);\n      L = normalize(L);\n      float atten = 1.0 / (pointLightAttenuation[i].x + pointLightAttenuation[i].y * dist + pointLightAttenuation[i].z * dist * dist);\n      vec3 Idiff = pointLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n      color = color + atten*Idiff;\n    }\n  #endif\n#if MAX_DIRECTIONALLIGHTS > 0\n  for (int i=0; i<MAX_DIRECTIONALLIGHTS; i++) {\n      if (!directionalLightOn[i])\n         continue;\n    vec4 lDirection = viewMatrix * vec4(directionalLightDirection[i], 0.0);\n    vec3 L =  normalize(-lDirection.xyz);\n    vec3 Idiff = directionalLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n    color = color + Idiff;\n  }\n#endif\n#if MAX_SPOTLIGHTS > 0\n  for (int i=0; i<MAX_SPOTLIGHTS; i++) {\n      if (!spotLightOn[i])\n         continue;\n    vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n    vec3 L = lPosition.xyz - fragVertexPosition;\n    float dist = length(L);\n    L = normalize(L);\n    float atten = 1.0 / (spotLightAttenuation[i].x + spotLightAttenuation[i].y * dist + spotLightAttenuation[i].z * dist * dist);\n    vec3 Idiff = spotLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n    vec4 lDirection = viewMatrix * vec4(-spotLightDirection[i], 0.0);\n    vec3 D = normalize(lDirection.xyz);\n    float angle = dot(L, D);\n    if(angle > spotLightCosFalloffAngle[i]) {\n       float softness = 1.0;\n       if (angle < spotLightCosSoftFalloffAngle[i])\n           softness = (angle - spotLightCosFalloffAngle[i]) /  (spotLightCosSoftFalloffAngle[i] -  spotLightCosFalloffAngle[i]);\n       color += atten * softness * Idiff;\n    }\n  }\n#endif\n  gl_FragColor = vec4(color, alpha);\n}",
addDirectives:function(h,j,e){["point","directional","spot"].forEach(function(a){var d=j.getModelCount(a);h.push("MAX_"+a.toUpperCase()+"LIGHTS "+d)});h.push("HAS_DIFFUSETEXTURE "+("diffuseTexture"in e?"1":"0"));h.push("HAS_EMISSIVETEXTURE "+("emissiveTexture"in e?"1":"0"))},hasTransparency:function(h){return h.transparency&&0.001<h.transparency.getValue()[0]},uniforms:{diffuseColor:[1,1,1],emissiveColor:[0,0,0],transparency:0,ambientIntensity:0,useVertexColor:!1},samplers:{diffuseTexture:null,emissiveTexture:null},
attributes:{normal:{required:!0},texcoord:null,color:null}})},{}],90:[function(){XML3D.shaders.register("matte",{vertex:"attribute vec3 position;\nattribute vec3 color;\nvarying vec3 fragVertexColor;\nuniform mat4 modelViewProjectionMatrix;\nvoid main(void) {\n   fragVertexColor = color;\n   gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"uniform vec3 diffuseColor;\nuniform bool useVertexColor;\nvarying vec3 fragVertexColor;\nvoid main(void) {\n    vec3 color = diffuseColor;\n    if (useVertexColor)\n       color *=  fragVertexColor;\n    gl_FragColor = vec4(color, 1.0);\n}",
uniforms:{diffuseColor:[1,1,1],useVertexColor:!1},attributes:{color:null,normal:null}});XML3D.shaders.register("flat",XML3D.shaders.getScript("matte"))},{}],91:[function(){XML3D.shaders.register("phong",{vertex:"attribute vec3 position;\nattribute vec3 normal;\nattribute vec3 color;\nattribute vec2 texcoord;\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\n#if (HAS_POINTLIGHT_SHADOWMAPS || HAS_DIRECTIONALLIGHT_SHADOWMAPS || HAS_SPOTLIGHT_SHADOWMAPS)\nvarying vec3 fragWorldPosition;\n#endif\nuniform mat4 modelMatrix;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat3 modelViewMatrixN;\nuniform vec3 eyePosition;\nvoid main(void) {\n    vec3 pos = position;\n    vec3 norm = normal;\n    gl_Position = modelViewProjectionMatrix * vec4(pos, 1.0);\n    fragNormal = normalize(modelViewMatrixN * norm);\n    fragVertexPosition = (modelViewMatrix * vec4(pos, 1.0)).xyz;\n    fragEyeVector = normalize(fragVertexPosition);\n    fragTexCoord = texcoord;\n    fragVertexColor = color;\n#if (HAS_POINTLIGHT_SHADOWMAPS || HAS_DIRECTIONALLIGHT_SHADOWMAPS || HAS_SPOTLIGHT_SHADOWMAPS)\n    fragWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;\n#endif\n}",
fragment:"uniform float ambientIntensity;\nuniform vec3 diffuseColor;\nuniform vec3 emissiveColor;\nuniform float shininess;\nuniform vec3 specularColor;\nuniform float transparency;\nuniform mat4 viewMatrix;\nuniform bool useVertexColor;\nuniform vec3 coords;\n#if HAS_EMISSIVETEXTURE\nuniform sampler2D emissiveTexture;\n#endif\n#if HAS_DIFFUSETEXTURE\nuniform sampler2D diffuseTexture;\n#endif\n#if HAS_SPECULARTEXTURE\nuniform sampler2D specularTexture;\n#endif\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\n#if (HAS_POINTLIGHT_SHADOWMAPS || HAS_DIRECTIONALLIGHT_SHADOWMAPS || HAS_SPOTLIGHT_SHADOWMAPS)\nvarying vec3 fragWorldPosition;\nfloat unpackDepth( const in vec4 rgba_depth ) {\n  const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n  float depth = dot( rgba_depth, bit_shift );\n  return depth;\n}\n#endif\n#if MAX_POINTLIGHTS > 0\nuniform vec3 pointLightAttenuation[MAX_POINTLIGHTS];\nuniform vec3 pointLightPosition[MAX_POINTLIGHTS];\nuniform vec3 pointLightIntensity[MAX_POINTLIGHTS];\nuniform bool pointLightOn[MAX_POINTLIGHTS];\nuniform bool pointLightCastShadow[MAX_POINTLIGHTS];\n#if HAS_POINTLIGHT_SHADOWMAPS\nuniform samplerCube pointLightShadowMap[MAX_POINTLIGHTS];\nuniform float pointLightShadowBias[MAX_POINTLIGHTS];\nuniform vec2 pointLightNearFar[MAX_POINTLIGHTS];\nfloat vecToDepth(vec3 vec, float n, float f){\nvec3 absVec = abs(vec);float maxComp = max(absVec.x, max(absVec.y, absVec.z));\nfloat res = (f+n)/(f-n)-(2.0*f*n)/(f-n)/maxComp;\nreturn res*0.5+0.5;\n}\n#endif\n#endif\n#if MAX_SPOTLIGHTS > 0\nuniform vec3 spotLightAttenuation[MAX_SPOTLIGHTS];\nuniform vec3 spotLightPosition[MAX_SPOTLIGHTS];\nuniform vec3 spotLightIntensity[MAX_SPOTLIGHTS];\nuniform bool spotLightOn[MAX_SPOTLIGHTS];\nuniform vec3 spotLightDirection[MAX_SPOTLIGHTS];\nuniform float spotLightCosFalloffAngle[MAX_SPOTLIGHTS];\nuniform float spotLightCosSoftFalloffAngle[MAX_SPOTLIGHTS];\nuniform float spotLightSoftness[MAX_SPOTLIGHTS];\nuniform bool spotLightCastShadow[MAX_SPOTLIGHTS];\n#if HAS_SPOTLIGHT_SHADOWMAPS\nuniform mat4 spotLightMatrix[ MAX_SPOTLIGHTS ];\nuniform sampler2D spotLightShadowMap[MAX_SPOTLIGHTS];\nuniform float spotLightShadowBias[MAX_SPOTLIGHTS];\n#endif\n#endif\n#if MAX_DIRECTIONALLIGHTS > 0\nuniform vec3 directionalLightDirection[MAX_DIRECTIONALLIGHTS];\nuniform vec3 directionalLightIntensity[MAX_DIRECTIONALLIGHTS];\nuniform bool directionalLightOn[MAX_DIRECTIONALLIGHTS];\nuniform bool directionalLightCastShadow[MAX_DIRECTIONALLIGHTS];\n#if HAS_DIRECTIONALLIGHT_SHADOWMAPS\nuniform mat4 directionalLightMatrix[MAX_DIRECTIONALLIGHTS];\nuniform sampler2D directionalLightShadowMap[MAX_DIRECTIONALLIGHTS];\nuniform float directionalLightShadowBias[MAX_DIRECTIONALLIGHTS];\n#endif\n#endif\nuniform sampler2D ssaoMap;\nvoid main(void) {\n#if MAX_POINTLIGHTS > 0 && HAS_POINTLIGHT_SHADOWMAPS\n    vec3 pointLightShadowMapDirection[MAX_POINTLIGHTS];\n    for(int i = 0; i < MAX_POINTLIGHTS; i++) {\n       pointLightShadowMapDirection[i] = fragWorldPosition - pointLightPosition[i];\n    }\n#endif\n#if MAX_SPOTLIGHTS > 0 && HAS_SPOTLIGHT_SHADOWMAPS\n    vec4 spotLightShadowMapCoord[MAX_SPOTLIGHTS];\n    for(int i = 0; i < MAX_SPOTLIGHTS; i++) {\n      spotLightShadowMapCoord[i] = spotLightMatrix[i] * vec4(fragWorldPosition, 1.0);\n    }\n#endif\n#if MAX_DIRECTIONALLIGHTS > 0 && HAS_DIRECTIONALLIGHT_SHADOWMAPS\n    vec4 directionalLightShadowMapCoord[MAX_DIRECTIONALLIGHTS];\n    for(int i = 0; i < MAX_DIRECTIONALLIGHTS; i++) {\n      directionalLightShadowMapCoord[i] = directionalLightMatrix[i] * vec4(fragWorldPosition, 1.0);\n    }\n#endif\n  float alpha =  max(0.0, 1.0 - transparency);\n  vec3 objDiffuse = diffuseColor;\n  if(useVertexColor)\n    objDiffuse *= fragVertexColor;\n  #if HAS_DIFFUSETEXTURE\n    vec4 texDiffuse = texture2D(diffuseTexture, fragTexCoord);\n    alpha *= texDiffuse.a;\n    objDiffuse *= texDiffuse.rgb;\n  #endif\n  if (alpha < 0.05) discard;\n  #if HAS_EMISSIVETEXTURE\n    vec3 color = emissiveColor * texture2D(emissiveTexture, fragTexCoord).rgb + (ambientIntensity * objDiffuse);\n  #else\n    vec3 color = emissiveColor + (ambientIntensity * objDiffuse);\n  #endif\n  vec3 objSpecular = specularColor;\n  #if HAS_SPECULARTEXTURE\n    objSpecular = objSpecular * texture2D(specularTexture, fragTexCoord).rgb;\n  #endif\n  #if HAS_SSAOMAP\n\t float ssao = 1.0 - texture2D(ssaoMap, gl_FragCoord.xy / coords.xy).r;\n  #endif\n  float shadowInfluence = 0.0;\n#if MAX_POINTLIGHTS > 0\n  for (int i = 0; i < MAX_POINTLIGHTS; i++) {\n    shadowInfluence = 1.0;\n    if(pointLightOn[i]){\n   #if HAS_POINTLIGHT_SHADOWMAPS\n       if(pointLightCastShadow[i]){\n           shadowInfluence = 0.0;\n           float lsDepth = vecToDepth(pointLightShadowMapDirection[i], pointLightNearFar[i].x, pointLightNearFar[i].y );\n\t\t    float depth = unpackDepth( textureCube(pointLightShadowMap[i], pointLightShadowMapDirection[i])) +  pointLightShadowBias[i];\n           if(lsDepth < depth)\n               shadowInfluence = 1.0;\n       }\n       if(shadowInfluence > 0.0){\n   #endif\n       vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n       vec3 L = lPosition.xyz - fragVertexPosition;\n       float dist = length(L);\n       L = normalize(L);\n       vec3 R = normalize(reflect(L,fragNormal));\n       float atten = 1.0 / (pointLightAttenuation[i].x + pointLightAttenuation[i].y * dist + pointLightAttenuation[i].z * dist * dist);\n       vec3 Idiff = pointLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n   #if HAS_SSAOMAP\n       Idiff *= ssao;\n   #endif\n       vec3 Ispec = pointLightIntensity[i] * objSpecular * pow(max(dot(R,fragEyeVector),0.0), shininess*128.0);\n       color = color + (atten*shadowInfluence*(Idiff + Ispec));\n   #if HAS_POINTLIGHT_SHADOWMAPS\n       }\n   #endif\n     }\n  }\n#endif\n#if MAX_SPOTLIGHTS > 0\n  for (int i=0; i<MAX_SPOTLIGHTS; i++) {\n    shadowInfluence = 1.0;\n    if(spotLightOn[i]) {\n  #if HAS_SPOTLIGHT_SHADOWMAPS\n       if(spotLightCastShadow[i]){\n           shadowInfluence = 0.0;\n           vec4 lspos = spotLightShadowMapCoord[i];\n\t\t\tvec3 perspectiveDivPos = lspos.xyz / lspos.w * 0.5 + 0.5;\n\t\t\tfloat lsDepth = perspectiveDivPos.z;\n\t\t\tvec2 lightuv = perspectiveDivPos.xy;\n\t\t\tfloat depth = unpackDepth(texture2D(spotLightShadowMap[i], lightuv)) + spotLightShadowBias[i];\n           if(lsDepth < depth)\n               shadowInfluence = 1.0;\n       }\n       if(shadowInfluence > 0.0){\n  #endif\n       vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n       vec3 L = lPosition.xyz - fragVertexPosition;\n       float dist = length(L);\n       L = normalize(L);\n       vec3 R = normalize(reflect(L,fragNormal));\n       float atten = 1.0 / (spotLightAttenuation[i].x + spotLightAttenuation[i].y * dist + spotLightAttenuation[i].z * dist * dist);\n       vec3 Idiff = spotLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n   #if HAS_SSAOMAP\n\t    Idiff *= ssao;\n   #endif\n       vec3 Ispec = spotLightIntensity[i] * objSpecular * pow(max(dot(R,fragEyeVector),0.0), shininess*128.0);\n       vec4 lDirection = viewMatrix * vec4(-spotLightDirection[i], 0.0);\n       vec3 D = normalize(lDirection.xyz);\n       float angle = dot(L, D);\n       if(angle > spotLightCosFalloffAngle[i]) {\n           float softness = 1.0;\n           if (angle < spotLightCosSoftFalloffAngle[i])\n               softness = (angle - spotLightCosFalloffAngle[i]) /  (spotLightCosSoftFalloffAngle[i] -  spotLightCosFalloffAngle[i]);\n           color += atten*softness*shadowInfluence*(Idiff + Ispec);\n       }\n   #if HAS_SPOTLIGHT_SHADOWMAPS\n       }\n   #endif\n   } \n  }\n#endif\n#if MAX_DIRECTIONALLIGHTS > 0\n  for (int i=0; i<MAX_DIRECTIONALLIGHTS; i++) {\n   shadowInfluence = 1.0;\n   if(directionalLightOn[i]){\n   #if HAS_DIRECTIONALLIGHT_SHADOWMAPS\n       if(directionalLightCastShadow[i]){\n           shadowInfluence = 0.0;\n           vec4 lspos = directionalLightShadowMapCoord[i];\n           vec3 orthogonalDivPos = lspos.xyz / lspos.w *0.5 + 0.5;\n           float lsDepth = orthogonalDivPos.z;\n           vec2 lightuv = orthogonalDivPos.xy;\n               float depth = unpackDepth(texture2D(directionalLightShadowMap[i], lightuv))+directionalLightShadowBias[i];\n               if(lsDepth < depth) shadowInfluence = 1.0;\n       }\n       if(shadowInfluence > 0.0){\n   #endif\n       vec4 lDirection = viewMatrix * vec4(directionalLightDirection[i], 0.0);\n       vec3 L =  normalize(-lDirection.xyz);\n       vec3 R = normalize(reflect(L,fragNormal));\n       vec3 Idiff = directionalLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n   #if HAS_SSAOMAP\n       Idiff *= ssao;\n   #endif\n       vec3 Ispec = directionalLightIntensity[i] * objSpecular * pow(max(dot(R,fragEyeVector),0.0), shininess*128.0);\n       color = color + shadowInfluence*((Idiff + Ispec));\n   #if HAS_DIRECTIONALLIGHT_SHADOWMAPS\n       }\n   #endif\n   }\n  }\n#endif\n  gl_FragColor = vec4(color, alpha);\n}",
addDirectives:function(h,j,e){["point","directional","spot"].forEach(function(a){var d=j.getModelCount(a),b=!1;d&&(b=Array.prototype.some.call(j.getModelEntry(a).parameters.castShadow,function(a){return a}));h.push("MAX_"+a.toUpperCase()+"LIGHTS "+d);h.push("HAS_"+a.toUpperCase()+"LIGHT_SHADOWMAPS "+(b?1:0))});h.push("HAS_DIFFUSETEXTURE "+("diffuseTexture"in e?"1":"0"));h.push("HAS_SPECULARTEXTURE "+("specularTexture"in e?"1":"0"));h.push("HAS_EMISSIVETEXTURE "+("emissiveTexture"in e?"1":"0"));h.push("HAS_SSAOMAP "+
(XML3D.options.getValue("renderer-ssao")?"1":"0"))},hasTransparency:function(h){return h.transparency&&0.001<h.transparency.getValue()[0]},uniforms:{diffuseColor:[1,1,1],emissiveColor:[0,0,0],specularColor:[0,0,0],transparency:0,shininess:0.2,ambientIntensity:0,useVertexColor:!1},samplers:{diffuseTexture:null,emissiveTexture:null,specularTexture:null,directionalLightShadowMap:null,spotLightShadowMap:null,pointLightShadowMap:null,ssaoMap:null},attributes:{normal:{required:!0},texcoord:null,color:null}})},
{}],92:[function(){XML3D.shaders.register("point",{vertex:"attribute vec3 position;\nattribute vec3 color;\nattribute vec2 texcoord;\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat3 modelViewMatrixN;\nuniform vec3 eyePosition;\nuniform vec3 coords;\nuniform float pointSize;\nvoid main(void) {\n    vec3 pos = position;\n    gl_Position = modelViewProjectionMatrix * vec4(pos, 1.0);\n    fragVertexPosition = (modelViewMatrix * vec4(pos, 1.0)).xyz;\n    fragEyeVector = normalize(fragVertexPosition);\n    fragTexCoord = texcoord;\n    fragVertexColor = color;\n    vec4 pos2 = vec4(fragVertexPosition, 1.0); pos2.x += pointSize;\n    gl_PointSize = distance( gl_Position.xy, (projectionMatrix * pos2).xy ) * coords.x / gl_Position.w;\n}",
fragment:"uniform vec3 diffuseColor;\nuniform float transparency;\nuniform mat4 viewMatrix;\nuniform bool useVertexColor;\nuniform vec2 texCoordOffset;\nuniform vec2 texCoordSize;\n#if HAS_DIFFUSETEXTURE\nuniform sampler2D diffuseTexture;\n#endif\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\nvoid main(void) {\n  float alpha =  max(0.0, 1.0 - transparency);\n  vec3 objDiffuse = diffuseColor;\n  if(useVertexColor)\n    objDiffuse *= fragVertexColor;\n  #if HAS_DIFFUSETEXTURE\n    vec2 texCoord = fragTexCoord + texCoordOffset + gl_PointCoord*texCoordSize;\n    texCoord.y = 1.0 - texCoord.y;\n    vec4 texDiffuse = texture2D(diffuseTexture, texCoord);\n    alpha *= texDiffuse.a;\n    objDiffuse *= texDiffuse.rgb;\n  #endif\n  if (alpha < 0.05) discard;\n  gl_FragColor = vec4(objDiffuse, alpha);\n}",
addDirectives:function(h,j,e){h.push("HAS_DIFFUSETEXTURE "+("diffuseTexture"in e?"1":"0"))},hasTransparency:function(h){return h.transparency&&0.001<h.transparency.getValue()[0]},uniforms:{diffuseColor:[1,1,1],texCoordOffset:[0,0],texCoordSize:[1,1],transparency:0,useVertexColor:!1,pointSize:1},samplers:{diffuseTexture:null},attributes:{texcoord:null,color:null}})},{}],93:[function(h,j){var e=function(){this.uniforms={};this.samplers={};this.attributes={};this.vertex=this.fragment=this.name=""};e.prototype.addDirectives=
function(){};e.prototype.hasTransparency=function(){return!1};j.exports=e},{}],94:[function(h,j){var e={};j.exports={register:function(a,d){e[a]=d;d.name=a},getScript:function(a){return e[a]}}},{}],95:[function(h,j){var e=h("./../abstractshaderclosure.js"),a=h("../../system/system-notifier.js"),d=function(a,c){e.call(this,a);this.descriptor=c};XML3D.createClass(d,e);XML3D.extend(d.prototype,{setDefaultUniforms:function(a){XML3D.extend(a,this.descriptor.uniforms)},createSources:function(b,c,d){var e=
d&&d.getResult(),d=[],h={};c&&XML3D.extend(h,c.getOutputMap());e&&XML3D.extend(h,e.getOutputMap());for(var i in this.descriptor.attributes)if((c=this.descriptor.attributes[i])&&c.required&&!h[i])throw Error("Mesh is missing '"+i+"' attribute.");this.descriptor.addDirectives(d,b.lights||{},h);this.source={fragment:this.addDirectivesToSource(d,this.descriptor.fragment),vertex:this.addDirectivesToSource(d,this.descriptor.vertex)};a.sendEvent("urnshader",{urnshaderType:"code",vertexShader:this.source.vertex,
fragmentShader:this.source.fragment});return!0},addDirectivesToSource:function(a,c){var d="";a.forEach(function(a){d+="#define "+a+"\n"});return d+"\n"+c},getTransparencyFromInputData:function(a){return this.descriptor.hasTransparency(a)}});j.exports=d},{"../../system/system-notifier.js":118,"./../abstractshaderclosure.js":81}],96:[function(h,j){var e=h("../abstractshadercomposer.js").AbstractShaderComposer,a=h("./urnshaderclosure.js"),d=h("./shader-descriptor.js"),b=h("../../../../xflow/interface/request.js").ComputeRequest,
c=h("../../shader/shader-utils.js").addFragmentShaderHeader;h("./diffuse.js");h("./phong.js");h("./matte.js");h("./point.js");h("./utility.js");var g=function(a,b){e.call(this,a,b);this.descriptor=null;this.setMaterialConfiguration(b)};XML3D.createClass(g,e,{setMaterialConfiguration:function(a){this.setShaderScript(a.model.urn);this.descriptor&&(a.dataNode&&this.updateRequest(a.dataNode),this.descriptor.fragment=c(this.descriptor.fragment))},setShaderScript:function(a){if(a)if("urn"!=a.scheme)XML3D.debug.logError("Shader script reference should start with an URN: ",
this.adapter.node);else{var b;b=a.path;b=b.substring(b.lastIndexOf(":")+1);b=XML3D.shaders.getScript(b);if(!b)throw Error("Unknown URN: "+a);this.descriptor=new d;XML3D.extend(this.descriptor,b)}else XML3D.debug.logError("Shader has no script attached: ",this.adapter.node)},getRequestFields:function(){return Object.keys(this.descriptor.uniforms).concat(Object.keys(this.descriptor.samplers))},getShaderAttributes:function(){return this.descriptor.attributes},createShaderClosure:function(){return new a(this.context,
this.descriptor)},createObjectDataRequest:function(a,c){var d=["position"];d.push.apply(d,Object.keys(this.descriptor.attributes));d.push.apply(d,Object.keys(this.descriptor.uniforms));d.push.apply(d,Object.keys(this.descriptor.samplers));return new b(a,d,c)},distributeObjectShaderData:function(a,b,c){var a=a.getResult().getOutputMap(),d;for(d in a)"position"==d||void 0!==this.descriptor.attributes[d]?b(d,a[d]):(void 0!==this.descriptor.uniforms[d]||void 0!==this.descriptor.samplers[d])&&c(d,a[d])}});
j.exports=g},{"../../../../xflow/interface/request.js":139,"../../shader/shader-utils.js":117,"../abstractshadercomposer.js":82,"./diffuse.js":89,"./matte.js":90,"./phong.js":91,"./point.js":92,"./shader-descriptor.js":93,"./urnshaderclosure.js":95,"./utility.js":97}],97:[function(){XML3D.shaders.register("pickobjectid",{vertex:"attribute vec3 position;\nuniform mat4 modelViewProjectionMatrix;\nvoid main(void) {\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"uniform vec3 id;\nvoid main(void) {\n    gl_FragColor = vec4(id, 0.0);\n}",
uniforms:{}});XML3D.shaders.register("pickedposition",{vertex:"attribute vec3 position;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewProjectionMatrix;\nuniform vec3 bbox[2];\nvarying vec3 worldCoord;\nvoid main(void) {\n    worldCoord = (modelMatrix * vec4(position, 1.0)).xyz;\n    vec3 diff = bbox[1] - bbox[0];\n    worldCoord = worldCoord - bbox[0];\n    worldCoord = worldCoord / diff;\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec3 worldCoord;\nvoid main(void) {\n    gl_FragColor = vec4(worldCoord, 1.0);\n}",
uniforms:{}});XML3D.shaders.register("pickedNormals",{vertex:"attribute vec3 position;\nattribute vec3 normal;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat3 modelViewMatrixN;\nvarying vec3 fragNormal;\nvoid main(void) {\n    fragNormal = normalize(modelViewMatrixN * normal);\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec3 fragNormal;\nvoid main(void) {\n    gl_FragColor = vec4((fragNormal+1.0)/2.0 * (254.0 / 255.0), 1.0);\n}",uniforms:{}});XML3D.shaders.register("light-depth",
{vertex:"attribute vec3 position;\nvarying vec4 worldPosition;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewProjectionMatrix;\nvoid main(void) {\n   worldPosition = modelMatrix * vec4(position, 1.0);\n   gl_Position   = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec4 worldPosition;\nuniform mat4 viewMatrix;\nvec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main(void) {\n    gl_FragColor = pack_depth( gl_FragCoord.z );\n}",
uniforms:{}});XML3D.shaders.register("render-normal",{vertex:"attribute vec3 position;\nattribute vec3 normal;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat3 modelMatrixN;\nvarying vec3 fragNormal;\nvoid main(void) {\n    fragNormal = modelMatrixN * normal;\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec3 fragNormal;\nvoid main(void) {\n   gl_FragColor = vec4((normalize(fragNormal) + 1.0) / 2.0, 1.0);\n}",uniforms:{}});XML3D.shaders.register("render-position",
{vertex:"attribute vec3 position;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewProjectionMatrix;\nvarying vec3 worldCoord;\nvoid main(void) {\n    worldCoord = (modelMatrix * vec4(position, 1.0)).xyz;\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec3 worldCoord;\nvoid main(void) {\n    gl_FragColor = vec4(worldCoord, 1.0);\n}",uniforms:{}});XML3D.shaders.register("boxblur",{vertex:"attribute vec3 position;\nvoid main(void) {\n   gl_Position = vec4(position, 1.0);\n}",
fragment:"uniform sampler2D sInTexture;\nuniform vec2 canvasSize;\nuniform vec2 blurOffset;\nconst float blurSize = 1.0/512.0;\nvoid main(void) {\n   vec2 texcoord = (gl_FragCoord.xy / canvasSize.xy);\n   vec4 sum = vec4(0.0);\n   float blurSizeY = blurOffset.y / canvasSize.y;\n   float blurSizeX = blurOffset.x / canvasSize.x;\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y - 1.5*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y - 2.0*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y - blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y + blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y + 2.0*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y + 1.5*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x - 1.5*blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x - 2.0*blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x - blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x + blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x + 2.0*blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x + 1.5*blurSizeX, texcoord.y));\n   gl_FragColor = sum / 12.0;\n}",
uniforms:{canvasSize:[512,512],blurOffset:[1,1]},samplers:{sInTexture:null}});XML3D.shaders.register("ssao",{vertex:"attribute vec2 position;\nvoid main(void) {\n    gl_Position = vec4(position, 0.0, 1.0);\n}",fragment:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 canvasSize;\nuniform sampler2D sPositionTex;\nuniform sampler2D sNormalTex;\nuniform sampler2D sRandomNormals;\nuniform vec2 uRandomTexSize;\nuniform float uSampleRadius;\nuniform float uScale;\nuniform float uBias;\nuniform float uIntensity;\nuniform vec2 uConstVectors[4];\nuniform mat4 viewMatrix;\nvec3 getPosition(vec2 uv) {\nreturn texture2D(sPositionTex, uv).xyz;\n}\nfloat calcAmbientOcclusion(vec2 screenUV, vec2 uvOffset, vec3 origin, vec3 cnorm) {\n   vec3 diff = getPosition(screenUV + uvOffset) - origin;\n   vec3 v = normalize(diff);\n   float dist = length(diff) * uScale;\n   return max(0.0, dot(cnorm, v) - uBias) * (1.0/(1.0 + dist)) * uIntensity;\n}\nvoid main(void) {\n   vec2 screenUV = gl_FragCoord.xy / canvasSize.xy;\n   vec2 rand = normalize(texture2D(sRandomNormals, gl_FragCoord.xy / uRandomTexSize).xy * 2.0 - 1.0 );\n   vec3 norm = normalize(texture2D(sNormalTex, screenUV).xyz * 2.0 - 1.0 );\n   vec3 origin = getPosition(screenUV);\n   float radius = uSampleRadius / (viewMatrix * vec4(origin, 1.0)).z;\n   float ao = 0.0;\n   const int iterations = 4;\n   for (int i = 0; i < iterations; ++i) {\n       vec2 coord1 = reflect(uConstVectors[i], rand) * radius;\n       vec2 coord2 = vec2(coord1.x*0.707 - coord1.y*0.707, coord1.x*0.707 + coord1.y*0.707);\n       ao += calcAmbientOcclusion(screenUV, coord1*0.25, origin, norm);\n       ao += calcAmbientOcclusion(screenUV, coord2*0.5, origin, norm);\n       ao += calcAmbientOcclusion(screenUV, coord1*0.75, origin, norm);\n       ao += calcAmbientOcclusion(screenUV, coord2, origin, norm);\n   }\n   ao /= (float(iterations) * 4.0);\n   gl_FragColor = vec4(ao, ao, ao, 1.0);\n}",
uniforms:{canvasSize:[512,512],uConstVectors:[1,0,-1,0,0,1,0,-1],uRandomTexSize:[64,64],uSampleRadius:0.9,uScale:0.9,uBias:0.2,uIntensity:1},samplers:{sPositionTex:null,sNormalTex:null,sRandomNormals:null},attributes:{}})},{}],98:[function(h,j){var e=window.WebGLRenderingContext,a=h("./render-trees/forward.js"),d=function(a,d){this.context=a;this.scene=d;this.options={pickingEnabled:!0,mouseMovePickingEnabled:!0,glBlendFuncSeparate:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA]};
this.renderPipeline=null};XML3D.extend(d.prototype,{getRenderPipeline:function(){return this.renderPipeline=this.renderPipeline||new a(this.context)},setRenderPipeline:function(a){this.renderPipeline=a;this.context.requestRedraw("Pipeline changed")},getRenderOptions:function(){return this.options}});j.exports=d},{"./render-trees/forward.js":111}],99:[function(h,j){var e=function(a,d,b){this.renderInterface=a;this.output=d;b=b||{};this.inputs=b.inputs||{};this.id=b.id||"";this.prePasses=[];this.postPasses=
[];this.processed=!1};XML3D.extend(e.prototype,{addPrePass:function(a){-1===this.prePasses.indexOf(a)&&(this.prePasses.push(a),a.postPasses.push(this))},removePrePass:function(a){var d=this.prePasses.indexOf(a);-1!==d&&(this.prePasses.splice(d,1),a.postPasses.splice(a.postPasses.indexOf(this),1))},clearPrePasses:function(){for(var a=this.prePasses.length;a--;)this.removePrePass(this.prePasses[a])},setProcessed:function(a){if(this.processed&&!a)for(var d=this.postPasses.length;d--;)this.postPasses[d].setProcessed(!1);
this.processed=a},renderTree:function(a){if(!this.processed){this.processed=!0;for(var d=this.prePasses.length;d--;)this.prePasses[d].renderTree(a);this.render(a)}},readPixelDataFromBuffer:function(){var a=new Uint8Array(8);return function(d,b,c){var e=this.renderInterface.context.gl,f=c.getScale(),d=d*f,b=b*f;c.bind();try{return e.readPixels(d,b,1,1,e.RGBA,e.UNSIGNED_BYTE,a),c.unbind(),a}catch(h){return XML3D.debug.logException(h),c.unbind(),null}}}()});j.exports=e},{}],100:[function(h,j){var e=
h("./base.js"),a=h("../base/fullscreenquad.js"),d=function(b,d,g){e.call(this,b,d,g);this._program=this.renderInterface.context.programFactory.getProgramByName("boxblur");this._screenQuad=new a(this.renderInterface.context);this._uniformsDirty=!0};XML3D.createClass(d,e);XML3D.extend(d.prototype,{render:function(){return function(){var a=this.renderInterface.context.gl,d=this.output;d.bind();a.clear(a.COLOR_BUFFER_BIT);a.disable(a.DEPTH_TEST);this._program.bind();this._setNonVolatileShaderUniforms();
this._screenQuad.draw(this._program);this._program.unbind();d.unbind()}}(),_setNonVolatileShaderUniforms:function(){var a={},d=["canvasSize","sInTexture","blurOffset"];return function(){if(this._uniformsDirty){var e=this._program,f=this.output;a.canvasSize=[f.width,f.height];a.sInTexture=[this.inputs.buffer.colorTarget.handle];a.blurOffset=[1,1];e.setSystemUniformVariables(d,a)}}}()});j.exports=d},{"../base/fullscreenquad.js":74,"./base.js":99}],101:[function(h,j){var e=h("./scene-pass.js"),a=h("../../renderer/tools/objectsorter.js"),
d=function(b,d,g){e.call(this,b,d,g);this.sorter=new a;this.lastRenderStats={}};XML3D.createClass(d,e);XML3D.extend(d.prototype,{render:function(){var a=XML3D.math.mat4.create(),d=XML3D.math.mat4.create(),e=XML3D.math.mat4.create(),f="viewMatrix,viewInverseMatrix,projectionMatrix,cameraPosition,coords,ssaoMap,width".split(",");return function(h){var i=this.renderInterface.context.gl,j={objects:0,primitives:0},l=this.output,m=h.systemUniforms,r=l.getWidth(),p=l.getHeight(),q=r/p;l.bind();this.setGLStates();
i.viewport(0,0,r,p);h.updateReadyObjectsFromActiveView(q);h.getActiveView().getWorldToViewMatrix(a);h.getActiveView().getViewToWorldMatrix(d);h.getActiveView().getProjectionMatrix(e,q);i=this.sorter.sortScene(h,a);m.viewMatrix=a;m.viewInverseMatrix=d;m.projectionMatrix=e;m.cameraPosition=h.getActiveView().getWorldSpacePosition();m.coords=[l.width,l.height,1];this.inputs.ssaoMap&&(m.ssaoMap=[this.inputs.ssaoMap.colorTarget.handle]);for(var o in i.opaque)this.renderObjectsToActiveBuffer(i.opaque[o],
h,l,m,f,{transparent:!1,stats:j});for(o=0;o<i.transparent.length;o++)this.renderObjectsToActiveBuffer([i.transparent[o]],h,l,m,f,{transparent:!0,stats:j});h.lights.changed=!1;l.unbind();this.lastRenderStats.count=j}}(),getRenderStats:function(){return this.lastRenderStats}});j.exports=d},{"../../renderer/tools/objectsorter.js":71,"./scene-pass.js":107}],102:[function(h,j){var e=h("./scene-pass.js"),a=h("../../renderer/tools/objectsorter.js"),d=function(a,d,g,f){e.call(this,a,d,f);this.light=g;this.program=
null};XML3D.createClass(d,e,{init:function(b){this.sorter=new a;this.program=b.programFactory.getProgramByName("light-depth")},renderScene:function(){this.render(this.light.scene)},render:function(){var a=XML3D.math.mat4.create(),d=XML3D.math.mat4.create(),e=["viewMatrix","projectionMatrix"];return function(f){var h=this.renderInterface.context.gl,i=this.output,j=i.getWidth(),l=i.getHeight(),m=j/l,r=this.light.getFrustum(m),p=this.program;i.bind();h.clear(h.DEPTH_BUFFER_BIT|h.COLOR_BUFFER_BIT);h.viewport(0,
0,j,l);h.enable(h.DEPTH_TEST);h={objects:0,primitives:0};this.light.model.getLightViewMatrix(a);r.getProjectionMatrix(d,m);f.updateReadyObjectsFromMatrices(a,d);m=this.sorter.sortScene(f);r={};r.viewMatrix=a;r.projectionMatrix=d;for(var q in m.opaque)this.renderObjectsToActiveBuffer(m.opaque[q],f,i,r,e,{transparent:!1,stats:h,program:p});i.unbind();return{count:h}}}()});j.exports=d},{"../../renderer/tools/objectsorter.js":71,"./scene-pass.js":107}],103:[function(h,j){var e=h("./base.js"),a=function(a,
b,c){e.call(this,a,b,c)};XML3D.createClass(a,e,{render:function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create(),c=XML3D.math.mat3.create(),e={envBase:{},envOverride:null,sysBase:{}},f=["modelViewProjectionMatrix","modelViewMatrixN"];return function(h,i,j){var l=this.renderInterface.context.gl,m=this.output;m.bind();l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT|l.STENCIL_BUFFER_BIT);l.enable(l.DEPTH_TEST);l.disable(l.CULL_FACE);l.disable(l.BLEND);i&&j&&(h.updateModelViewMatrix(i),h.updateModelViewProjectionMatrix(j));
h.getModelViewProjectionMatrix(a);h.getWorldMatrix(b);XML3D.math.mat3.normalFromMat4(c,b)||XML3D.math.mat3.identity(c);i=this.renderInterface.context.programFactory.getPickingNormalProgram();i.bind();e.sysBase.modelViewProjectionMatrix=a;e.sysBase.modelViewMatrixN=c;i.setUniformVariables(null,f,e);h.mesh.draw(i);i.unbind();m.unbind()}}(),readNormalFromPickingBuffer:function(){var a=XML3D.math.vec3.create(),b=XML3D.math.vec3.fromValues(1,1,1);return function(c,e){var f=this.readPixelDataFromBuffer(c,
e,this.output);if(!f)return null;a[0]=f[0]/254;a[1]=f[1]/254;a[2]=f[2]/254;return XML3D.math.vec3.subtract(XML3D.math.vec3.create(),XML3D.math.vec3.scale(XML3D.math.vec3.create(),a,2),b)}}()});j.exports=a},{"./base.js":99}],104:[function(h,j){var e=h("./base.js"),a=function(a,b,c){e.call(this,a,b,c)};XML3D.createClass(a,e);XML3D.extend(a.prototype,{render:function(){var a=XML3D.math.mat4.create(),b={envBase:{},envOverride:null,sysBase:{}},c=["id","modelViewProjectionMatrix"];return function(e,f,h){var i=
this.renderInterface.context.gl,j=this.output;j.bind();i.enable(i.DEPTH_TEST);i.disable(i.CULL_FACE);i.disable(i.BLEND);i.viewport(0,0,j.getWidth(),j.getHeight());i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT);i=this.renderInterface.context.programFactory.getPickingObjectIdProgram();i.bind();for(var l=0,m=e.length;l<m;l++){var r=e[l],p=r.mesh;if(r.isVisible()){f&&h&&(r.updateModelViewMatrix(f),r.updateModelViewProjectionMatrix(h));r.getModelViewProjectionMatrix(a);var r=l+1,q=r&255,r=r>>8,o=r&255,
r=r>>8;b.sysBase.id=[(r&255)/255,o/255,q/255];b.sysBase.modelViewProjectionMatrix=a;i.setUniformVariables(null,c,b);p.draw(i)}}i.unbind();j.unbind()}}(),getRenderObjectFromPickingBuffer:function(a,b,c){b=this.readPixelDataFromBuffer(a,b,this.output);if(!b)return null;a=null;b=65536*b[0]+256*b[1]+b[2];0<b&&(a=c[b-1]);return a}});j.exports=a},{"./base.js":99}],105:[function(h,j){var e=h("./base.js"),a=function(a,b,c){e.call(this,a,b,c);this.objectBoundingBox=XML3D.math.bbox.create()};XML3D.createClass(a,
e,{render:function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create(),c={envBase:{},envOverride:null,sysBase:{}},e=["bbox","modelMatrix","modelViewProjectionMatrix"];return function(f,h,i){var j=this.renderInterface.context.gl,l=this.output;l.bind();j.clear(j.COLOR_BUFFER_BIT|j.DEPTH_BUFFER_BIT|j.STENCIL_BUFFER_BIT);j.enable(j.DEPTH_TEST);j.disable(j.CULL_FACE);j.disable(j.BLEND);h&&i&&(f.updateModelViewMatrix(h),f.updateModelViewProjectionMatrix(i));f.getWorldMatrix(a);f.getObjectSpaceBoundingBox(this.objectBoundingBox);
XML3D.math.bbox.transform(this.objectBoundingBox,a,this.objectBoundingBox);h=this.renderInterface.context.programFactory.getPickingPositionProgram();h.bind();f.getModelViewProjectionMatrix(b);c.sysBase.bbox=this.objectBoundingBox;c.sysBase.modelMatrix=a;c.sysBase.modelViewProjectionMatrix=b;h.setUniformVariables(null,e,c);f.mesh.draw(h);h.unbind();l.unbind()}}(),readPositionFromPickingBuffer:function(){var a=XML3D.math.vec3.create();return function(b,c){var e=this.readPixelDataFromBuffer(b,c,this.output);
return e?(a[0]=e[0]/255,a[1]=e[1]/255,a[2]=e[2]/255,e=XML3D.math.bbox.size(XML3D.math.vec3.create(),this.objectBoundingBox),e=XML3D.math.vec3.mul(e,a,e),XML3D.math.vec3.add(e,this.objectBoundingBox,e),e):null}}()});j.exports=a},{"./base.js":99}],106:[function(h,j){var e=h("./scene-pass.js"),a=h("../../renderer/tools/objectsorter.js"),d=function(a,d,g,f){e.call(this,a,d,f);this.light=g;this.program=null};XML3D.createClass(d,e,{init:function(b){this.sorter=new a;this.program=b.programFactory.getProgramByName("light-depth")},
renderScene:function(){this.render(this.light.scene)},render:function(){var a=XML3D.math.mat4.create(),d=XML3D.math.mat4.create(),e=["viewMatrix","projectionMatrix"];return function(f){for(var h=this.renderInterface.context.gl,i=this.output,j=i.getWidth(),l=i.getHeight(),m=j/l,r=this.light.getFrustum(m),p=this.program,q=0;q<i.glSides.length;q++){var o=XML3D.math.mat4.create();XML3D.math.mat4.identity(o);0==q?(o[0]=0,o[1]=0,o[2]=-1,o[4]=0,o[5]=-1,o[6]=0,o[8]=-1,o[9]=0,o[10]=0):1==q?(o[0]=0,o[1]=0,
o[2]=1,o[4]=0,o[5]=-1,o[6]=0,o[8]=1,o[9]=0,o[10]=0):2==q?(o[0]=1,o[1]=0,o[2]=0,o[4]=0,o[5]=0,o[6]=-1,o[8]=0,o[9]=1,o[10]=0):3==q?(o[0]=1,o[1]=0,o[2]=0,o[4]=0,o[5]=0,o[6]=1,o[8]=0,o[9]=-1,o[10]=0):4==q?(o[0]=1,o[1]=0,o[2]=0,o[4]=0,o[5]=-1,o[6]=0,o[8]=0,o[9]=0,o[10]=-1):5==q&&(o[0]=-1,o[1]=0,o[2]=0,o[4]=0,o[5]=-1,o[6]=0,o[8]=0,o[9]=0,o[10]=1);i.bind(q);h.clear(h.DEPTH_BUFFER_BIT|h.COLOR_BUFFER_BIT);h.viewport(0,0,j,l);h.enable(h.DEPTH_TEST);var s={objects:0,primitives:0};this.light.model.getLightViewMatrix(a);
XML3D.math.mat4.mul(a,o,a);r.getProjectionMatrix(d,m);f.updateReadyObjectsFromMatrices(a,d);var o=this.sorter.sortScene(f),u={};u.viewMatrix=a;u.projectionMatrix=d;for(var t in o.opaque)this.renderObjectsToActiveBuffer(o.opaque[t],f,i,u,e,{transparent:!1,stats:s,program:p});i.unbind()}return{count:s}}}()});j.exports=d},{"../../renderer/tools/objectsorter.js":71,"./scene-pass.js":107}],107:[function(h,j){function e(a){return"cw"==a.toLowerCase()?function(a){a.frontFace(a.CW)}:function(a){a.frontFace(a.CCW)}}
function a(a){switch(a.toLowerCase()){case "back":return function(a){a.enable(a.CULL_FACE);a.cullFace(a.BACK)};case "front":return function(a){a.enable(a.CULL_FACE);a.cullFace(a.FRONT)};case "both":return function(a){a.enable(a.CULL_FACE);a.cullFace(a.FRONT_AND_BACK)};default:return function(a){a.disable(a.CULL_FACE)}}}var d=h("./base.js"),b=h("../../../utils/options.js");b.register("renderer-faceculling","none");b.register("renderer-frontface","ccw");var c=function(c,f,h){d.call(this,c,f,h);this.setFaceCulling=
a(b.getValue("renderer-faceculling"));this.setFrontFace=e(b.getValue("renderer-frontface"));var i=this;b.addObserver("renderer-faceculling",function(b,d){i.setFaceCulling=a(d)});b.addObserver("renderer-frontface",function(a,b){i.setFrontFace=e(b)})};XML3D.createClass(c,d,{setGLStates:function(){var a=this.renderInterface.context.gl;a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);this.setFaceCulling(a);this.setFrontFace(a);a.enable(a.DEPTH_TEST)},renderObjectsToActiveBuffer:function(){var a=
XML3D.math.mat4.create(),b=XML3D.math.mat3.create(),d=XML3D.math.mat4.create(),c=XML3D.math.mat4.create(),e=XML3D.math.mat3.create(),h=["modelMatrix","modelMatrixN","modelViewMatrix","modelViewProjectionMatrix","modelViewMatrixN"];return function(m,j,p,q,o,s){var p=j=0,u=s.stats||{},t=!0===s.transparent||!1,v=this.renderInterface.context.gl,s=s.program||m[0].getProgram();if(0==m.length)return u;t&&(v.enable(v.BLEND),v.blendFuncSeparate(v.SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA,v.ONE,v.ONE_MINUS_SRC_ALPHA));
s.bind();s.setSystemUniformVariables(o,q);for(var o=null,w=0,z=m.length;w<z;w++){var y=m[w];if(y.isVisible()){var x=y.mesh;XML3D.debug.assert(x,"We need a mesh at this point.");y.getWorldMatrix(a);q.modelMatrix=a;y.getModelMatrixN(b);q.modelMatrixN=b;y.getModelViewMatrix(d);q.modelViewMatrix=d;y.getModelViewProjectionMatrix(c);q.modelViewProjectionMatrix=c;y.getModelViewMatrixN(e);q.modelViewMatrixN=e;s.setSystemUniformVariables(h,q);s.changeUniformVariableOverride(o,x.uniformOverride);o=x.uniformOverride;
p+=x.draw(s);j++;t&&v.disable(v.BLEND)}}s.changeUniformVariableOverride(o,null);s.unbind();u.objects+=j;u.primitives+=p;return u}}()});j.exports=c},{"../../../utils/options.js":132,"./base.js":99}],108:[function(h,j){var e=h("./base.js"),a=h("./vertexattribute-pass.js"),d=h("../base/rendertarget.js").GLRenderTarget,b=h("../base/fullscreenquad.js"),c=h("../../../utils/options.js"),g={"renderer-ssao-scale":{defaultValue:1},"renderer-ssao-intensity":{defaultValue:5},"renderer-ssao-bias":{defaultValue:0.2},
"renderer-ssao-radius":{defaultValue:1}},f;for(f in g)c.register(f,g[f].defaultValue);g=function(a,d,c){e.call(this,a,d,c);a=this.renderInterface.context;this._program=a.programFactory.getProgramByName("ssao");this.randomVectorTexture=this.createRandomVectorTexture(a);this.loadRandomVectorImage();this._screenQuad=new b(a);this._uniformsDirty=!0};XML3D.createClass(g,e);XML3D.extend(g.prototype,{createRandomVectorTexture:function(a){var b=a.gl,a=a.createTexture();a.createTex2DFromData(b.RGBA,64,64,
b.RGBA,b.UNSIGNED_BYTE,{wrapS:b.REPEAT,wrapT:b.REPEAT,minFilter:b.LINEAR,magFilter:b.LINEAR});a.isTexture=!0;return a},loadRandomVectorImage:function(){var a=new Image;a.src="data:image/png;base64,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";
var b=this.renderInterface.context.gl,d=this.randomVectorTexture.handle;a.onload=function(){b.bindTexture(b.TEXTURE_2D,d);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a)}},createVertexAttributePass:function(b){var c=this.renderInterface.context,c=new d(c,{width:c.canvasTarget.width,height:c.canvasTarget.height,colorFormat:c.gl.RGBA,colorType:c.gl.FLOAT,depthFormat:c.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});return new a(this.renderInterface,c,{programName:b})},
render:function(){var a=XML3D.math.mat4.create(),b=["viewMatrix"];return function(d){var c=this.renderInterface.context.gl,e=this.output;e.bind();c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT);c.viewport(0,0,e.getWidth(),e.getHeight());c.disable(c.DEPTH_TEST);this._program.bind();this._setNonVolatileShaderUniforms();c={};d.getActiveView().getWorldToViewMatrix(a);c.viewMatrix=a;this._program.setSystemUniformVariables(b,c);this._screenQuad.draw(this._program);this._program.unbind();e.unbind()}}(),_setNonVolatileShaderUniforms:function(){var a=
"canvasSize,sPositionTex,sNormalTex,sRandomNormals,uRandomTexSize,uScale,uBias,uIntensity,uSampleRadius,uConstVectors".split(",");return function(){if(this._uniformsDirty){var b={},d=this._program;d.bind();var e=this.output;b.canvasSize=[e.width,e.height];b.sPositionTex=[this.inputs.positionBuffer.colorTarget.handle];b.sNormalTex=[this.inputs.normalBuffer.colorTarget.handle];b.sRandomNormals=[this.randomVectorTexture];b.uRandomTexSize=[64,64];b.uScale=c.getValue("renderer-ssao-scale");b.uBias=c.getValue("renderer-ssao-bias");
b.uIntensity=c.getValue("renderer-ssao-intensity");b.uSampleRadius=c.getValue("renderer-ssao-radius");b.uConstVectors=[1,0,-1,0,0,1,0,-1];d.setSystemUniformVariables(a,b);d.unbind()}}}()});j.exports=g},{"../../../utils/options.js":132,"../base/fullscreenquad.js":74,"../base/rendertarget.js":77,"./base.js":99,"./vertexattribute-pass.js":109}],109:[function(h,j){var e=h("./scene-pass.js"),a=function(a,b,c){e.call(this,a,b,c);this._program=this.renderInterface.context.programFactory.getProgramByName(c.programName)};
XML3D.createClass(a,e);XML3D.extend(a.prototype,{render:function(a){var b=this.renderInterface.context.gl,c=this.output,e=c.getWidth(),f=c.getHeight(),e=e/f;c.bind();b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.viewport(0,0,c.getWidth(),c.getHeight());b.enable(b.DEPTH_TEST);a.updateReadyObjectsFromActiveView(e);this.renderObjectsToActiveBuffer(a.ready,a,c,a.systemUniforms,[],{transparent:!1,program:this._program});c.unbind()}});j.exports=a},{"./scene-pass.js":107}],110:[function(h,j){var e=function(a){this.mainRenderPass=
null;this.renderInterface=a};XML3D.extend(e.prototype,{render:function(a){this.mainRenderPass.renderTree(a)}});j.exports=e},{}],111:[function(h,j){var e=h("./base.js"),a=h("../base/rendertarget.js").GLRenderTarget;h("../base/rendertarget.js");var d=h("../render-passes/forward.js"),b=h("../render-passes/boxblur.js");h("../render-passes/light-pass.js");h("../render-passes/pointlight-pass.js");var c=h("../render-passes/vertexattribute-pass.js"),g=h("../render-passes/ssao-pass.js");h("../../renderer/scene/constants.js");
h("../materials/events.js");var f=function(a,b){e.call(this,a);this._enableSSAO=b;this.mainPass=null;this.createMainPass()};XML3D.createClass(f,e);XML3D.extend(f.prototype,{createMainPass:function(){var a=this.renderInterface.context.canvasTarget;if(this._enableSSAO){var b=this.createVertexAttributePass("render-position"),c=this.createVertexAttributePass("render-normal"),e=this.createSSAOPass(b.output,c.output);e.addPrePass(b);e.addPrePass(c);var g=this.createBlurPass(e.output);g.addPrePass(e);this._blurPass=
g;this._ssaoPass=e;this._positionPass=b;this._normalPass=c;this.mainPass=new d(this.renderInterface,a,{inputs:{ssaoMap:g.output}});this.mainPass.addPrePass(g)}else this.mainPass=new d(this.renderInterface,a);this.mainRenderPass=this.mainPass},createVertexAttributePass:function(b){var d=this.renderInterface.context,d=new a(d,{width:d.canvasTarget.width,height:d.canvasTarget.height,colorFormat:d.gl.RGBA,colorType:d.gl.FLOAT,depthFormat:d.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});
return new c(this.renderInterface,d,{programName:b})},createSSAOPass:function(b,d){var c=this.renderInterface.context,c=new a(c,{width:c.canvasTarget.width,height:c.canvasTarget.height,colorFormat:c.gl.RGBA,depthFormat:c.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});return new g(this.renderInterface,c,{inputs:{positionBuffer:b,normalBuffer:d}})},createBlurPass:function(d){var c=this.renderInterface.context,c=new a(c,{width:d.width,height:d.height,colorFormat:c.gl.RGBA,depthFormat:c.gl.DEPTH_COMPONENT16,
stencilFormat:null,depthAsRenderbuffer:!0});return new b(this.renderInterface,c,{inputs:{buffer:d}})},render:function(a){this._enableSSAO&&(this._positionPass.setProcessed(!1),this._normalPass.setProcessed(!1),this._ssaoPass.setProcessed(!1),this._blurPass.setProcessed(!1));this.mainRenderPass.setProcessed(!1);e.prototype.render.call(this,a)},getRenderStats:function(){return this.mainPass.getRenderStats()}});j.exports=f},{"../../renderer/scene/constants.js":59,"../base/rendertarget.js":77,"../materials/events.js":83,
"../render-passes/boxblur.js":100,"../render-passes/forward.js":101,"../render-passes/light-pass.js":102,"../render-passes/pointlight-pass.js":106,"../render-passes/ssao-pass.js":108,"../render-passes/vertexattribute-pass.js":109,"./base.js":110}],112:[function(h,j){var e=h("./base/context.js"),a=h("./scene/glscene.js"),d=h("./base/rendertarget.js").GLScaledRenderTarget,b=h("../renderer/tools/datachangelistener.js"),c=h("./render-interface.js"),g=h("./render-passes/pick-object.js"),f=h("./render-passes/pick-position.js"),
k=h("./render-passes/pick-normal.js"),i=h("./render-trees/forward.js"),n=h("../../contrib/glu.js"),l=h("../../utils/options.js"),m=h("../../base/formathandler.js").xml3dFormatHandler,r={"renderer-ssao":{defaultValue:!1,recompileOnChange:!0}},p;for(p in r)l.register(p,r[p].defaultValue);var q=function(a,b){return a.height-b-1},r=function(d,c){this._canvasHandler=c;var g=this._canvasHandler.getCanvas();this.width=g.clientWidth;this.height=g.clientHeight;this.context=new e(g,this._canvasHandler.id);
this.scene=new a(this.context);g=m.getFactory("webgl",this._canvasHandler.id);g.setScene(this.scene);g.setRenderer(this);g.getAdapter(d).traverse(function(){});this.scene.rootNode.setVisible(!0);this.pickedObject=null;this.needsPickingDraw=this.needsDraw=!0;this.context.requestRedraw=this.requestRedraw.bind(this);this.rayCamera=this.scene.createRenderView();this.initGL();this.changeListener=new b(this);this.renderInterface=this.createRenderInterface();this.createDefaultPipelines();l.addObserver(this.onFlagsChange.bind(this))};
r.prototype.generateRay=function(){};XML3D.extend(r.prototype,{initGL:function(){var a=this.context.gl;a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(0);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.frontFace(a.CCW);a.cullFace(a.BACK);a.disable(a.CULL_FACE);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.disable(a.BLEND);a.viewport(0,0,this.width,this.height);a.pixelStorei(a.PACK_ALIGNMENT,1);a.pixelStorei(a.UNPACK_ALIGNMENT,1);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,
!0);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL)},handleResizeEvent:function(a,b){this.width=a;this.height=b;this.context.handleResizeEvent(a,b);this.createDefaultPipelines();this.scene.handleResizeEvent(a,b);this.needsDraw=this.needsPickingDraw=!0},createDefaultPipelines:function(){this.renderInterface.setRenderPipeline(new i(this.renderInterface,l.getValue("renderer-ssao")));var a=new d(this.context,512,{width:this.context.canvasTarget.width,
height:this.context.canvasTarget.height,colorFormat:this.context.gl.RGBA,depthFormat:this.context.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});this.pickObjectPass=new g(this.renderInterface,a);this.pickPositionPass=new f(this.renderInterface,a);this.pickNormalPass=new k(this.renderInterface,a)},createRenderInterface:function(){return new c(this.context,this.scene)},requestRedraw:function(a){XML3D.debug.logDebug("Request redraw because:",a);this.needsPickingDraw=this.needsDraw=
!0},getWorldSpaceNormalByPoint:function(a,b,d){d=d||this.pickedObject;if(!d)return null;b=q(this._canvasHandler.getCanvas(),b);this.pickNormalPass.render(d);this.needsPickingDraw=!0;return this.pickNormalPass.readNormalFromPickingBuffer(a,b)},getWorldSpacePositionByPoint:function(a,b,d){d=d||this.pickedObject;if(!d)return null;b=q(this._canvasHandler.getCanvas(),b);this.pickPositionPass.render(d);this.needsPickingDraw=!0;return this.pickPositionPass.readPositionFromPickingBuffer(a,b)},getRenderObjectByRay:function(a,
b,d){a=this.scene.findRayIntersections(a);this.pickObjectPass.render(a,b,d);b=Math.floor(this.pickObjectPass.output.getWidth()/2/this.pickObjectPass.output.getScale());d=Math.floor(this.pickObjectPass.output.getHeight()/2/this.pickObjectPass.output.getScale());return this.pickObjectPass.getRenderObjectFromPickingBuffer(b,d,a)},getWorldSpaceNormalByRay:function(a,b,d,c){if(!b)return null;this.pickNormalPass.render(b,d,c);a=Math.floor(this.pickNormalPass.output.getWidth()/2/this.pickNormalPass.output.getScale());
b=Math.floor(this.pickNormalPass.output.getHeight()/2/this.pickNormalPass.output.getScale());return this.pickNormalPass.readNormalFromPickingBuffer(a,b)},getWorldSpacePositionByRay:function(a,b,d,c){if(!b)return null;this.pickPositionPass.render(b,d,c);a=Math.floor(this.pickPositionPass.output.getWidth()/2/this.pickPositionPass.output.getScale());b=Math.floor(this.pickPositionPass.output.getHeight()/2/this.pickPositionPass.output.getScale());return this.pickPositionPass.readPositionFromPickingBuffer(a,
b)},calculateMatricesForRay:function(a,b,d){this.rayCamera.updatePosition(a.origin._data);this.rayCamera.updateOrientation(this.calculateOrientationForRayDirection(a));this.rayCamera.getWorldToViewMatrix(b);a=this.pickObjectPass.output.getWidth()/this.pickObjectPass.output.getHeight();this.rayCamera.getProjectionMatrix(d,a)},calculateOrientationForRayDirection:function(){var a=XML3D.math.vec3.create(),b=XML3D.math.vec3.create(),d=XML3D.math.vec3.create(),c=XML3D.math.vec3.create(),e=XML3D.math.quat.create(),
g=XML3D.math.mat4.create();return function(f){XML3D.math.vec3.set(c,0,1,0);XML3D.math.vec3.cross(a,f.direction._data,c);XML3D.math.vec3.length(a)||XML3D.math.vec3.set(a,1,0,0);XML3D.math.vec3.cross(b,a,f.direction._data);XML3D.math.vec3.negate(d,f.direction._data);XML3D.math.quat.setFromBasis(a,b,d,e);XML3D.math.mat4.fromRotationTranslation(g,e,[0,0,0]);return g}}(),needsRedraw:function(){return this.needsDraw},renderToCanvas:function(){this.needsDraw=!1;this.prepareRendering();this.renderInterface.getRenderPipeline().render(this.scene);
var a=this.renderInterface.getRenderPipeline().getRenderStats();XML3D.debug.logDebug("Rendered to Canvas");return a},getRenderObjectFromPickingBuffer:function(a,b){b=q(this._canvasHandler.getCanvas(),b);this.needsPickingDraw&&(this.needsPickingDraw=!1,this.prepareRendering(),this.scene.updateReadyObjectsFromActiveView(this.pickObjectPass.output.getWidth()/this.pickObjectPass.output.getHeight()),this.pickObjectPass.render(this.scene.ready),XML3D.debug.logDebug("Rendered Picking Buffer"));return this.pickedObject=
this.pickObjectPass.getRenderObjectFromPickingBuffer(a,b,this.scene.ready)},prepareRendering:function(){this.scene.update()},generateRay:function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create();return function(d,c){var e=q(this._canvasHandler.getCanvas(),c),g=[0,0];g[2]=this.width;g[3]=this.height;var f=this.scene.getActiveView();f.getWorldToViewMatrix(a);f.getProjectionMatrix(b,g[2]/g[3]);var f=new window.XML3DRay,h=[],i=[];if(!1===n.unProject(d,e,0,a,b,g,h)||!1===n.unProject(d,e,1,a,
b,g,i))return f;XML3D.math.mat4.invert(a,a);e=new window.XML3DVec3(a[12],a[13],a[14]);f.origin.set(e);f.direction.set(i[0]-h[0],i[1]-h[1],i[2]-h[2]);f.direction.set(f.direction.normalize());return f}}(),dispose:function(){this.scene.clear()},getRenderInterface:function(){return this.renderInterface},onFlagsChange:function(a){"renderer-ssao"==a&&(this.scene.shaderFactory.setShaderRecompile(),this.createDefaultPipelines())}});j.exports=r},{"../../base/formathandler.js":9,"../../contrib/glu.js":12,"../../utils/options.js":132,
"../renderer/tools/datachangelistener.js":69,"./base/context.js":73,"./base/rendertarget.js":77,"./render-interface.js":98,"./render-passes/pick-normal.js":103,"./render-passes/pick-object.js":104,"./render-passes/pick-position.js":105,"./render-trees/forward.js":111,"./scene/glscene.js":115}],113:[function(h,j){var e=h("../xflow/xflow-mesh.js"),a=function(){};XML3D.extend(a.prototype,{createDrawable:function(a,b){XML3D.debug.logDebug("DrawableFactory::createDrawable",a);try{var c=new e(b,a.getDataNode(),
a.getType(),{boundingBoxChanged:a.setObjectSpaceBoundingBox.bind(a)});a.mesh=c.getMesh();return c}catch(g){return XML3D.debug.logError(g,a.node),null}}});j.exports=a},{"../xflow/xflow-mesh.js":120}],114:[function(h,j){var e="pointLightPosition,pointLightAttenuation,pointLightIntensity,pointLightOn,pointLightCastShadow,pointLightMatrix,pointLightShadowBias,pointLightNearFar,pointLightShadowMap".split(",").concat("directionalLightDirection,directionalLightIntensity,directionalLightOn,directionalLightCastShadow,directionalLightMatrix,directionalLightShadowBias,directionalLightShadowMap".split(",")).concat("spotLightAttenuation,spotLightPosition,spotLightIntensity,spotLightDirection,spotLightOn,spotLightSoftness,spotLightCosFalloffAngle,spotLightCosSoftFalloffAngle,spotLightCastShadow,spotLightMatrix,spotLightShadowBias,spotLightShadowMap".split(","));
j.exports={ALL_PARAMETERS:e}},{}],115:[function(h,j){function e(a,b){var d=a.indexOf(b);return-1!=d?(a.splice(d,1),!0):!1}var a=h("./../../renderer/scene/scene.js"),d=h("./drawable-factory.js"),b=h("./../../renderer/scene/constants.js"),c=h("./../../renderer/tools/frustum.js").FrustumTest,g=h("../materials/shadercomposerfactory.js"),f=h("../../../utils/options.js"),k=h("../materials/shadowmap-service"),i={"shadejs-extractUniformExpressions":{defaultValue:!1,recompileOnChange:!0},"shadejs-transformSpaces":{defaultValue:!0,
recompileOnChange:!0},"renderer-frustumCulling":{defaultValue:!0,recompileOnChange:!1},"shadejs-cache":{defaultValue:!0,recompileOnChange:!1}},n;for(n in i)f.register(n,i[n].defaultValue);n=function(b){a.call(this);this.context=b;this.shaderFactory=new g(b);this.drawableFactory=new d;this.shadowMapService=new k(b,this);this.ready=[];this.queue=[];this.lightsNeedUpdate=!0;this.systemUniforms={};this.deferred=window.XML3D_DEFERRED||!1;this.colorClosureSignatures=[];this.doFrustumCulling=!!f.getValue("renderer-frustumCulling");
this.addListeners()};XML3D.createClass(n,a);XML3D.extend(n.prototype,{remove:function(a){e(this.queue,a);e(this.ready,a)},clear:function(){this.ready=[];this.queue=[]},moveFromQueueToReady:function(a){e(this.queue,a)&&this.ready.push(a)},moveFromReadyToQueue:function(a){e(this.ready,a)&&this.queue.push(a)},update:function(){this.lightsNeedUpdate&&(this.lightsNeedUpdate=!1,this.updateLightParameters(),this.lights.lightValueChanged());this.updateObjectsForRendering();this.shadowMapService.updateForRendering();
this.updateShaders()},updateLightParameters:function(){var a=this.systemUniforms;this.lights.fillGlobalParameters(a);this.shadowMapService.fillGlobalParameters(a);var b=a.spotLightFalloffAngle,d=a.spotLightSoftness;if(b){for(var c=[],e=[],g=0;g<b.length;g++)e[g]=Math.cos(b[g]),c[g]=Math.cos(b[g]*(1-d[g]));a.spotLightCosFalloffAngle=e;a.spotLightCosSoftFalloffAngle=c}},updateSystemUniforms:function(a){this.shaderFactory.updateSystemUniforms(a,this)},updateShaders:function(){this.shaderFactory.update(this)},
updateObjectsForRendering:function(){this.forEach(function(a){a.updateForRendering()})},forEach:function(a,b){this.queue.slice().forEach(a,b);this.ready.slice().forEach(a,b)},updateReadyObjectsFromActiveView:function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create(),d=XML3D.math.mat4.create(),e=XML3D.math.bbox.create(),g=new c;return function(c){var f=this.getActiveView(),h=this.ready;f.getWorldToViewMatrix(a);h.forEach(function(b){b.updateModelViewMatrix(a);b.updateModelMatrixN();b.updateModelViewMatrixN()});
this.updateBoundingBox();f.getProjectionMatrix(d,c);f.getViewToWorldMatrix(b);c=f.getFrustum();g.set(c,b);c=0;for(f=h.length;c<f;c++){var i=h[c];i.updateModelViewProjectionMatrix(d);i.getWorldSpaceBoundingBox(e);i.inFrustum=this.doFrustumCulling?g.isBoxVisible(e):!0}}}(),updateReadyObjectsFromMatrices:function(a,b){for(var d=this.ready,c=0,e=d.length;c<e;c++){var g=d[c];g.updateModelViewMatrix(a);g.updateModelMatrixN();g.updateModelViewProjectionMatrix(b)}},addListeners:function(){this.addEventListener(b.EVENT_TYPE.SCENE_STRUCTURE_CHANGED,
function(a){void 0!==a.newChild?this.addChildEvent(a.newChild):void 0!==a.removedChild&&this.removeChildEvent(a.removedChild)});this.addEventListener(b.EVENT_TYPE.VIEW_CHANGED,function(){this.context.requestRedraw("Active view changed.")});this.addEventListener(b.EVENT_TYPE.LIGHT_STRUCTURE_CHANGED,function(){this.lightsNeedUpdate=!0;this.shaderFactory.setLightStructureDirty();this.context.requestRedraw("Light structure changed.")});this.addEventListener(b.EVENT_TYPE.LIGHT_VALUE_CHANGED,function(a){this.lightsNeedUpdate=
!0;this.shaderFactory.setLightValueChanged();this.lights.lightValueChanged(a.light);this.context.requestRedraw("Light value changed.")});this.addEventListener(b.EVENT_TYPE.SCENE_SHAPE_CHANGED,function(){this.lightsNeedUpdate=!0});f.addObserver(this.onFlagsChange.bind(this))},addChildEvent:function(a){a.type==b.NODE_TYPE.OBJECT&&(this.queue.push(a),this.context.requestRedraw("Object was added to scene."))},removeChildEvent:function(a){a.type==b.NODE_TYPE.OBJECT&&(this.remove(a),a.dispose(),this.context.requestRedraw("Object was removed from scene."))},
handleResizeEvent:function(){this.getActiveView().setProjectionDirty()},createDrawable:function(a){return this.drawableFactory.createDrawable(a,this.context)},requestRedraw:function(a){return this.context.requestRedraw(a)},onFlagsChange:function(a,b){i[a]&&i[a].recompileOnChange&&this.shaderFactory.setShaderRecompile();"renderer-frustumCulling"==a&&(this.doFrustumCulling=!!b)}});j.exports=n},{"../../../utils/options.js":132,"../materials/shadercomposerfactory.js":87,"../materials/shadowmap-service":88,
"./../../renderer/scene/constants.js":59,"./../../renderer/scene/scene.js":68,"./../../renderer/tools/frustum.js":70,"./drawable-factory.js":113}],116:[function(h,j){var e=h("./shader-utils.js"),a=h("../materials/urn/shader-descriptor.js"),d=h("../materials/urn/urnshaderclosure.js"),b=function(a){this.context=a;this.programs={fallback:null,picking:{id:null,normal:null,position:null}}};XML3D.extend(b.prototype,{getProgramByName:function(b){var g=XML3D.shaders.getScript(b);if(!g||!g.vertex)return XML3D.debug.logError("Unknown shader: ",
b),null;b=new a;XML3D.extend(b,g);b.fragment=e.addFragmentShaderHeader(b.fragment);g=new d(this.context,b);g.createSources({},null,null);g.compile();return g},getFallbackProgram:function(){if(!this.programs.fallback){var b=new a;XML3D.extend(b,XML3D.shaders.getScript("matte"));b.fragment=e.addFragmentShaderHeader(b.fragment);b=new d(this.context,b);b.uniformCollection.envBase.diffuseColor=[1,0,0];b.createSources({},null,null);b.compile();this.programs.fallback=b;this.programs.fallback.bind();this.programs.fallback.setUniformVariables(["diffuseColor"],
null,{envBase:{diffuseColor:[1,0,0]}});this.programs.fallback.unbind()}return this.programs.fallback},getPickingObjectIdProgram:function(){var a=this.programs.picking;a.id||(a.id=this.getProgramByName("pickobjectid"));return a.id},getPickingPositionProgram:function(){var a=this.programs.picking;a.position||(a.position=this.getProgramByName("pickedposition"));return a.position},getPickingNormalProgram:function(){var a=this.programs.picking;a.normal||(a.normal=this.getProgramByName("pickedNormals"));
return a.normal}});j.exports=b},{"../materials/urn/shader-descriptor.js":93,"../materials/urn/urnshaderclosure.js":95,"./shader-utils.js":117}],117:[function(h,j){j.exports={addFragmentShaderHeader:function(e){return"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif // GL_FRAGMENT_PRECISION_HIGH\n\n"+e}}},{}],118:[function(h,j){j.exports={node:null,setNode:function(e){this.node=e},sendEvent:function(e,a){if(this.node){var d=document.createEvent("CustomEvent");
a.systemtype=e;d.initCustomEvent("xml3dsystem",!0,!0,a);this.node.dispatchEvent(d)}}}},{}],119:[function(h,j){var e=h("../base/context.js"),a=h("../../../xflow/interface/constants.js");j.exports={getGLUniformValueFromXflowDataEntry:function(d,b){var c;if(!d)return null;if(d.type==a.DATA_TYPE.TEXTURE){c=b.getXflowEntryWebGlData(d);var e=c.texture||b.createTexture();c.changed&&e.updateFromTextureEntry(d);c.texture=e;c.changed=0;c=[e]}else if(d.type==a.DATA_TYPE.BOOL){c=d.getValue();for(var e=[c.length],
f=0;f<c.length;f++)e[f]=c[f];c=e}else c=d.getValue();return c},getGLBufferFromXflowDataEntry:function(d,b,c){var g=b.getXflowEntryWebGlData(d),f=g.buffer,h=b.gl;if(g.changed&&c){for(var i=d.getValue(),j=1E8,l=0,m=i.length;m--;)j=Math.min(j,i[m]),l=Math.max(l,i[m]);g.maxIndex=l;g.minIndex=j}switch(g.changed){case a.DATA_ENTRY_STATE.CHANGED_VALUE:if(c){d=d.getValue();switch(f.glType){case h.UNSIGNED_BYTE:d=new Uint8Array(d);break;case h.UNSIGNED_SHORT:d=new Uint16Array(d);break;case h.UNSIGNED_INT:break;
default:return XML3D.debug.logError("Unknown GL type for element buffer: ",f.glType),null}h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,f);h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,d)}else h.bindBuffer(h.ARRAY_BUFFER,f),h.bufferSubData(h.ARRAY_BUFFER,0,d.getValue());break;case a.DATA_ENTRY_STATE.CHANGED_NEW:case a.DATA_ENTRY_STATE.CHANGED_SIZE:case a.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE:c?(f=d.getValue(),j=g.maxIndex,h=b.gl,c=f,i=h.UNSIGNED_INT,256>j?(i=h.UNSIGNED_BYTE,c=new Uint8Array(f)):65536>j?(i=h.UNSIGNED_SHORT,
c=new Uint16Array(f)):b.extensions[e.EXTENSIONS.UINT32_INDICES]||(XML3D.debug.logError("Trying to use index data with indices larger than 65535, but this is not supported on your platform. Indexing errors will occur."),i=h.UNSIGNED_SHORT,c=new Uint16Array(f)),b=h.createBuffer(),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,b),h.bufferData(h.ELEMENT_ARRAY_BUFFER,c,h.STATIC_DRAW),b.bytesPerElement=c.BYTES_PER_ELEMENT,b.length=f.length,b.glType=i):(f=d.getValue(),h=b.gl,b=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,
b),h.bufferData(h.ARRAY_BUFFER,f,h.STATIC_DRAW),b.length=f.length,h=window.WebGLRenderingContext,b.glType=f instanceof Int8Array?h.BYTE:f instanceof Uint8Array?h.UNSIGNED_BYTE:f instanceof Int16Array?h.SHORT:f instanceof Uint16Array?h.UNSIGNED_SHORT:f instanceof Int32Array?h.INT:f instanceof Uint32Array?h.UNSIGNED_INT:h.FLOAT),f=b,f.tupleSize=d.getTupleSize(),g.buffer=f}g.changed=0;return f},calculateBoundingBox:function(a,b){var c=new XML3D.math.bbox.create,e;if(!a||3>a.length)return c;if(b){e=3*
b[0];c[0]=a[e];c[1]=a[e+1];c[2]=a[e+2];c[3]=a[e];c[4]=a[e+1];c[5]=a[e+2];for(e=1;e<b.length;e++){var f=3*b[e],h=a[f],i=a[f+1],f=a[f+2];h<c[0]&&(c[0]=h);i<c[1]&&(c[1]=i);f<c[2]&&(c[2]=f);h>c[3]&&(c[3]=h);i>c[4]&&(c[4]=i);f>c[5]&&(c[5]=f)}}else{c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[0];c[4]=a[1];c[5]=a[2];for(e=3;e<a.length;e+=3)a[e]<c[0]&&(c[0]=a[e]),a[e+1]<c[1]&&(c[1]=a[e+1]),a[e+2]<c[2]&&(c[2]=a[e+2]),a[e]>c[3]&&(c[3]=a[e]),a[e+1]>c[4]&&(c[4]=a[e+1]),a[e+2]>c[5]&&(c[5]=a[e+2])}return c}}},{"../../../xflow/interface/constants.js":136,
"../base/context.js":73}],120:[function(h,j){var e=h("../../renderer/scene/drawableclosure.js"),a=h("../base/mesh.js"),d=h("./utils.js"),b=h("../../renderer/scene/constants.js").EVENT_TYPE,c=h("../materials/events.js"),g=h("../../../xflow/interface/constants.js"),f=h("../../../xflow/interface/request.js").ComputeRequest,k=e.READY_STATE,i={};i[WebGLRenderingContext.TRIANGLES]={attributeData:{position:g.DATA_TYPE.FLOAT3},typeData:{index:g.DATA_TYPE.INT,solid:g.DATA_TYPE.BOOL,vertexCount:g.DATA_TYPE.INT},
bboxFix:{boundingBox:g.DATA_TYPE.FLOAT3},bboxCompute:{position:g.DATA_TYPE.FLOAT3}};i[WebGLRenderingContext.LINE_STRIP]=i[WebGLRenderingContext.TRIANGLES];i[WebGLRenderingContext.LINES]=i[WebGLRenderingContext.TRIANGLES];i[WebGLRenderingContext.POINTS]=i[WebGLRenderingContext.TRIANGLES];i[WebGLRenderingContext.TRIANGLE_STRIP]=i[WebGLRenderingContext.TRIANGLES];var n=function(b,d,c,g){e.call(this,b,e.TYPES.MESH);g=g||{};this.mesh=new a(b,c);this.dataNode=d;this.typeRequest=this.shaderClosure=this.shaderComposer=
null;this.typeDataValid=!0;this.objectShaderRequest=null;this.changeState=1;this.boundingBoxChanged=g.boundingBoxChanged||function(){};this.initialize()};XML3D.createClass(n,e,{initialize:function(){this.typeDataChanged(this.typeRequest,g.RESULT_STATE.CHANGED_STRUCTURE);this.shaderChanged()},setShaderComposer:function(a){this.bindedShaderChanged||(this.bindedShaderChanged=this.shaderChanged.bind(this));this.shaderComposer&&this.shaderComposer.removeEventListener(c.MATERIAL_STRUCTURE_CHANGED,this.bindedShaderChanged);
(this.shaderComposer=a)&&this.shaderComposer.addEventListener(c.MATERIAL_STRUCTURE_CHANGED,this.bindedShaderChanged);this.changeState|=32},update:function(a){if(0!==this.changeState){XML3D.debug.logDebug("Update mesh closure",this.changeState);var d=!!this.shaderClosure&&this.typeDataValid,c=null,e=!1;try{if(this.changeState&33&&this.mesh.clear(),this.changeState&3&&this.updateTypeData(),e=!0,this.changeState&35&&this.updateIndexBuffer(),this.changeState&33?(this.updateObjectShaderRequest(),this.updateShaderClosure(a),
this.updateObjectShaderData()):this.changeState&5&&this.updateObjectShaderData(),this.dataNode.isSubtreeLoading())this.shaderClosure=null,this.typeDataValid=!1}catch(g){c=g,e?this.shaderClosure=null:this.typeDataValid=!1}a=!!this.shaderClosure&&this.typeDataValid;d!=a&&this.dispatchEvent({type:b.DRAWABLE_STATE_CHANGED,newState:a?k.COMPLETE:k.INCOMPLETE,oldState:d?k.COMPLETE:k.INCOMPLETE});this.changeState=0;if(c)throw c;}},calculateBoundingBox:function(){var a=XML3D.math.bbox.create();return function(){var b=
this.typeRequest.getResult(),c=b.getOutputData("boundingBox");c?this.boundingBoxChanged(d.calculateBoundingBox(c.getValue(),null)):(c=b.getOutputData("position"))?(b=b.getOutputData("index"),this.boundingBoxChanged(d.calculateBoundingBox(c.getValue(),b?b.getValue():null))):this.boundingBoxChanged(a)}}(),typeDataChanged:function(a,d){this.changeState|=d==g.RESULT_STATE.CHANGED_STRUCTURE?1:2;this.dispatchEvent({type:b.SCENE_SHAPE_CHANGED});this.context.requestRedraw("Mesh Type Data Change");XML3D.debug.logDebug("XflowMesh: Type data changed",
a,d,this.changeState)},getMesh:function(){return this.mesh},getMeshType:function(){return this.mesh.glType},updateObjectShaderRequest:function(){this.objectShaderRequest&&this.objectShaderRequest.clear();this.objectShaderRequest=null;this.dataNode.isSubtreeLoading()||(this.objectShaderRequest=this.shaderComposer.createObjectDataRequest(this.dataNode,this.shaderInputDataChanged.bind(this)))},updateShaderClosure:function(a){this.shaderClosure=null;if(!this.dataNode.isSubtreeLoading()&&!this.dataNode.getOutputChannelInfo("position"))throw Error("Mesh does not have 'position' attribute.");
!this.dataNode.isSubtreeLoading()&&!this.objectShaderRequest.getResult().loading&&(this.shaderClosure=this.shaderComposer.getShaderClosure(a,this.objectShaderRequest))},updateIndexBuffer:function(){var a=this.typeRequest.getResult().getOutputData("index");a&&a.getValue()&&this.handleBuffer("index",a,!0)},updateObjectShaderData:function(){if(this.shaderClosure&&(this.bindedHandleBuffer||(this.bindedHandleBuffer=this.handleBuffer.bind(this)),this.bindedHandleUniform||(this.bindedHandleUniform=this.handleUniform.bind(this)),
this.shaderComposer.distributeObjectShaderData(this.objectShaderRequest,this.bindedHandleBuffer,this.bindedHandleUniform),!this.mesh.isReadyToRender()))throw Error("Mesh has empty vertex attributes.");},updateTypeData:function(){if(this.typeDataValid||this.changeState&1){this.updateTypeRequest();this.calculateBoundingBox();var a=this.typeRequest.getResult().getOutputData("vertexCount");this.mesh.setVertexCount(a&&a.getValue()?a.getValue():null);this.typeDataValid=!0}},handleBuffer:function(a,b,c){var c=
c||!1,e=this.mesh;if("position"==a&&!b)throw Error("'position' attribute of mesh is empty.");if(b)if(b.type==g.DATA_TYPE.TEXTURE)XML3D.debug.logError("Texture as mesh parameter is not yet supported");else{var f=d.getGLBufferFromXflowDataEntry(b,this.context,"index"==a);c?this.updateIndexRange(b):this.mesh.checkBufferCompatible(a,b);e.setBuffer(a,f)}else this.mesh.removeBuffer(a)},updateIndexRange:function(a){a=this.context.getXflowEntryWebGlData(a);this.mesh.setIndexRange(a.minIndex,a.maxIndex)},
handleUniform:function(a,b){var c=d.getGLUniformValueFromXflowDataEntry(b,this.context);this.mesh.setUniformOverride(a,c)},updateTypeRequest:function(){var a=i[this.getMeshType()];if(a){if(a=this.getTypeRequestNames(a),!this.typeRequest||this.typeRequest.filter!=a)this.typeRequest&&this.typeRequest.clear(),this.typeRequest=new f(this.dataNode,a,this.typeDataChanged.bind(this))}else XML3D.debug.logError("Unsupported Mesh request: ",this.mesh,this.getMeshType()),this.typeDataValid=!1},getTypeRequestNames:function(a){var b=
[];b.push.apply(b,Object.keys(a.typeData));b.push.apply(b,Object.keys(a.bboxFix));this.checkXflowTypes(this.dataNode,a.bboxFix)||(this.checkXflowTypes(this.dataNode,a.bboxCompute)||(this.typeDataValid=!1),b.push.apply(b,Object.keys(a.bboxCompute)));return b},checkXflowTypes:function(a,b){for(var c in b){var d=a.getOutputChannelInfo(c);if(!d||d.type!=b[c])return!1}return!0},shaderInputDataChanged:function(a,c){this.changeState|=c!=g.RESULT_STATE.CHANGED_DATA_VALUE?1:4;this.dispatchEvent({type:b.SCENE_SHAPE_CHANGED});
this.context.requestRedraw("Mesh Attribute Data Changed");XML3D.debug.logDebug("XflowMesh: Attribute data changed",a,c,this.changeState)},shaderChanged:function(){this.changeState|=32},getProgram:function(){return this.shaderClosure}});j.exports=n},{"../../../xflow/interface/constants.js":136,"../../../xflow/interface/request.js":139,"../../renderer/scene/constants.js":59,"../../renderer/scene/drawableclosure.js":60,"../base/mesh.js":75,"../materials/events.js":83,"./utils.js":119}],121:[function(h,
j){var e=function(a,d,b){var c=this,e=function(){c._callback&&c._callback(c)};this._min=new window.XML3DVec3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,e);this._max=new window.XML3DVec3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,e);a&&a.min?(this._min.set(a.min),this._max.set(a.max)):(a&&this._min.set(a),d&&this._max.set(d));this._callback="function"==typeof b?b:0};Object.defineProperty(e.prototype,"min",{get:function(){return this._min},set:function(){throw Error("XML3DBox::min is readonly.");
},configurable:!1,enumerable:!1});Object.defineProperty(e.prototype,"max",{get:function(){return this._max},set:function(){throw Error("XML3DBox::max is readonly.");},configurable:!1,enumerable:!1});e.prototype.size=function(){var a=this._max.subtract(this._min);0>a.x&&(a.x=0);0>a.y&&(a.y=0);0>a.z&&(a.z=0);return a};e.prototype.center=function(){return this._min.add(this._max).scale(0.5)};e.prototype.makeEmpty=function(){this._min=new window.XML3DVec3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);
this._max=new window.XML3DVec3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);this._callback&&this._callback(this)};e.prototype.isEmpty=function(){return this._min.x>this._max.x||this._min.y>this._max.y||this._min.z>this._max.z};e.prototype.toString=function(){return"[object XML3DBox]"};e.prototype.set=function(a){this._min.set(a.min);this._max.set(a.max);this._callback&&this._callback(this)};e.prototype.extend=function(a){if(a){var d;if(a.constructor===window.XML3DBox)d=a.min,a=a.max;else if(a.constructor===
window.XML3DVec3)d=a;else return;d.x<this._min.x&&(this._min.x=d.x);d.y<this._min.y&&(this._min.y=d.y);d.z<this._min.z&&(this._min.z=d.z);a.x>this._max.x&&(this._max.x=a.x);a.y>this._max.y&&(this._max.y=a.y);a.z>this._max.z&&(this._max.z=a.z)}};j.exports=e},{}],122:[function(h,j){function e(b){switch(b){case a.DATA_TYPE.FLOAT:return f.FLOAT;case a.DATA_TYPE.FLOAT2:return f.FLOAT2;case a.DATA_TYPE.FLOAT3:return f.FLOAT3;case a.DATA_TYPE.FLOAT4:return f.FLOAT4;case a.DATA_TYPE.FLOAT4X4:return f.FLOAT4X4;
case a.DATA_TYPE.INT:return f.INT;case a.DATA_TYPE.INT4:return f.INT4;case a.DATA_TYPE.BOOL:return f.BOOL;case a.DATA_TYPE.TEXTURE:return f.TEXTURE;case a.DATA_TYPE.BYTE:return f.BYTE;case a.DATA_TYPE.UBYTE:return f.UBYTE;default:throw Error("WHAT IS THIS I DON'T EVEN...");}}var a=h("../xflow/interface/constants.js"),d=h("../base/resourcemanager.js").Resource,b=[],c=function(a){this.callback=a;this.observed=[]};c.prototype.observe=function(a,c){if(!a)throw Error("The node to observe is null.");if(!a._configured)throw Error("Note to observe is not   (yet). Make sure to pass an XML3D node and to execute this function after XML3D has been configured e.g. inside a DOMContentLoaded listener.");
var e=d.getAdapter(a,"data");if(!e)throw Error("Can't observe node. XML3DataObserver can only observe data containers such as <data>, <mesh> or <shader>");0==this.observed.length&&b.push(this);var g={node:a,changed:!1,request:null},f=c&&c.names;"String"===Object.prototype.toString.call(f).slice(8,-1)&&(f=[f]);g.request=e.getComputeRequest(f,function(){g.changed=!0});g.request.getResult();this.observed.push(g)};c.prototype.disconnect=function(){for(var a=0;a<this.observed.length;++a)this.observed[a].request.clear();
this.observed=[];for(a=b.length;a--;)b[a]==this&&b.splice(a,1)};XML3D.updateXflowObserver=function(){for(var a=0;a<b.length;++a){for(var c=b[a],d=[],e=0;e<c.observed.length;++e){var h=c.observed[e];if(h.changed){h.changed=!1;var k=h.request.getResult(),k=new f(k);d.push(new g(h.node,k))}}0<d.length&&c.callback&&c.callback(d,c)}};var g=function(a,b){this.target=a;this.result=b},f=function(a){this._entries={};for(var b=0;b<a.outputNames.length;++b){var c=a.outputNames[b],d=a.getOutputData(c),g=d&&d.getValue();
null!==g&&(d=e(d.type),this._entries[c]={type:d,value:g})}};f.prototype.getValue=function(a){return this._entries[a]?this._entries[a].value:null};f.prototype.getType=function(a){return this._entries[a]?this._entries[a].type:null};f.prototype.getNames=function(){var a=[],b;for(b in this._entries)a.push(b);return a};f.FLOAT=0;f.FLOAT2=1;f.FLOAT3=2;f.FLOAT4=3;f.FLOAT4X4=4;f.INT=10;f.INT4=11;f.BOOL=20;f.TEXTURE=30;f.BYTE=40;f.UBYTE=50;var k=function(a,b,c,d,g,f){this.type=e(a);this.origin=b;this.originalName=
c;this.seqLength=d;this.seqMinKey=g;this.seqMaxKey=f};k.ORIGIN_CHILD=1;k.ORIGIN_COMPUTE=2;k.ORIGIN_PROTO=3;j.exports={XML3DDataChannelInfo:k,XML3DDataResult:f,XML3DDataObserver:c}},{"../base/resourcemanager.js":10,"../xflow/interface/constants.js":136}],123:[function(h,j){function e(a){return{get:function(){return this._data[a]},set:function(c){this._data[a]=c;this._callback&&this._callback(this)},configurable:!1,enumerable:!1}}var a=function(a,c,d,e,h,i,j,l,m,r,p,q,o,s,u,t,v){"number"==typeof a&&
16<=arguments.length?(this.set(a,c,d,e,h,i,j,l,m,r,p,q,o,s,u,t),this._callback="function"==typeof v?v:0):"object"==typeof a&&1==arguments.length?this.set(a):(this._data=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._callback="function"==typeof a?a:0)},d=a.prototype;Object.defineProperty(d,"m11",e(0));Object.defineProperty(d,"m12",e(1));Object.defineProperty(d,"m13",e(2));Object.defineProperty(d,"m14",e(3));Object.defineProperty(d,"m21",e(4));Object.defineProperty(d,"m22",e(5));Object.defineProperty(d,
"m23",e(6));Object.defineProperty(d,"m24",e(7));Object.defineProperty(d,"m31",e(8));Object.defineProperty(d,"m32",e(9));Object.defineProperty(d,"m33",e(10));Object.defineProperty(d,"m34",e(11));Object.defineProperty(d,"m41",e(12));Object.defineProperty(d,"m42",e(13));Object.defineProperty(d,"m43",e(14));Object.defineProperty(d,"m44",e(15));d.set=function(a,c,d,e,h,i,j,l,m,r,p,q,o,s,u,t){"number"==typeof a&&16<=arguments.length?this._data=new Float32Array(arguments):a._data&&a._data.length&&16===a._data.length?
this._data=new Float32Array(a._data):a.length&&16<=a.length?this._data=new Float32Array(a):XML3D.debug.logError("XML3DMatrix.set(): invalid parameter(s). Expect XML3DMatrix, Float32Array or 16 numbers.")};d.toString=function(){return"[object XML3DMatrix]"};d.setMatrixValue=function(a){a=/^(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)$/.exec(a);if(!a)throw{code:DOMException.SYNTAX_ERR,message:"SYNTAX_ERR: DOM Exception 12"};
if(17!=a.length)throw{code:DOMException.SYNTAX_ERR,message:"Illegal number of elements: "+(a.length-1)+"expected: 16"};this._data=new Float32Array(a.slice(1));this._callback&&this._callback(this)};d.multiply=function(b){var c=new a;XML3D.math.mat4.multiply(c._data,this._data,b._data);return c};d.inverse=function(){var b=new a;b._data=XML3D.math.mat4.invert(b._data,this._data);if(null==b._data||isNaN(b._data[0]))throw Error("Trying to invert matrix that is not invertable.");return b};d.rotate=function(b,
c,d){var e=new a;if(void 0===c&&void 0===d)return XML3D.math.mat4.rotateZ(e._data,this._data,b),e;XML3D.math.mat4.rotateZ(e._data,this._data,d);XML3D.math.mat4.rotateY(e._data,e._data,c);XML3D.math.mat4.rotateX(e._data,e._data,b);return e};d.rotateAxisAngle=function(b,c,d,e){var h=new a;XML3D.math.mat4.rotate(h._data,this._data,e,[b,c,d]);return h};d.scale=function(b,d,e){var f=new a;e||(e=1);d||(d=b);XML3D.math.mat4.scale(f._data,this._data,[b,d,e]);return f};d.translate=function(b,d,e){var f=new a;
XML3D.math.mat4.translate(f._data,this._data,[b,d,e]);return f};j.exports=a},{}],124:[function(h,j){var e=function(a,b,c){var e=this,f=function(){e._callback&&e._callback(e)};this._origin=new window.XML3DVec3(0,0,0,f);this._direction=new window.XML3DVec3(0,0,-1,f);a&&a.origin?this.set(a,b):(a&&this._origin.set(a),b&&this._direction.set(b));this._callback="function"==typeof c?c:0},a=e.prototype;Object.defineProperty(a,"origin",{get:function(){return this._origin},set:function(){throw Error("Can't set axis. XML3DRay::origin is readonly.");
},configurable:!1,enumerable:!1});Object.defineProperty(a,"direction",{get:function(){return this._direction},set:function(){throw Error("Can't set axis. XML3DRay::_direction is readonly.");},configurable:!1,enumerable:!1});a.set=function(a){this._origin.set(a.origin);this._direction.set(a.direction);this._callback&&this._callback(this)};a.toString=function(){return"[object XML3DRay]"};j.exports=e},{}],125:[function(h,j){var e=function(a,b,c){var e=this;this._data=new Float32Array(4);this._axis=new window.XML3DVec3(0,
0,1,function(){e._updateQuaternion();e._callback&&e._callback(e)});this._angle=0;this._updateQuaternion();void 0!==a&&null!==a&&this.set(a,b);this._callback="function"==typeof c?c:0},a=e.prototype;a.set=function(a,b){a.axis&&void 0!==a.angle?this.setAxisAngle(a.axis,a.angle):a.length&&4<=a.length?this._setQuaternion(a):a._data&&a._data.length&&3===a._data.length?this.setAxisAngle(a,b):XML3D.debug.logError("XML3DRotation.set(): invalid argument given. Expect XML3DRotation or Float32Array.")};Object.defineProperty(a,
"axis",{get:function(){return this._axis},set:function(){throw Error("Can't set axis. XML3DRotation::axis is readonly.");},configurable:!1,enumerable:!1});Object.defineProperty(a,"angle",{get:function(){return this._angle},set:function(a){this._angle=a;this._updateQuaternion();this._callback&&this._callback(this)},configurable:!1,enumerable:!1});a.toString=function(){return"[object XML3DRotation]"};a.setAxisAngle=function(a,b){if("object"!=typeof a||isNaN(b))throw Error("Illegal axis and/or angle values: ( axis="+
a+" angle="+b+" )");this._axis._data[0]=a._data[0];this._axis._data[1]=a._data[1];this._axis._data[2]=a._data[2];this._angle=b;this._updateQuaternion();this._callback&&this._callback(this)};a.setRotation=function(a,b){var c=a.normalize(),e=b.normalize(),f=c.cross(e);f.length()||(f=Math.abs(c._data[1])>=0.9*Math.abs(c._data[0])&&Math.abs(c._data[2])>=0.9*Math.abs(c._data[0])?new window.XML3DVec3(0,-c._data[2],c._data[1]):Math.abs(c._data[0])>=0.9*Math.abs(c._data[1])&&Math.abs(c._data[2])>=0.9*Math.abs(c._data[1])?
new window.XML3DVec3(-c._data[2],0,c._data[0]):new window.XML3DVec3(-c._data[1],c._data[0],0));this.setAxisAngle(f,Math.acos(c.dot(e)))};a._updateQuaternion=function(){var a=this._axis.length();1.0E-5<a?(a=Math.sin(this._angle/2)/a,this._data[0]=this._axis.x*a,this._data[1]=this._axis.y*a,this._data[2]=this._axis.z*a,this._data[3]=Math.cos(this._angle/2)):XML3D.math.quat.set(this._data,0,0,0,1)};a.setAxisAngleValue=function(a){var b=/^\s*(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s*$/.exec(a);if(!b)throw Error("Could not parse AxisAngle string: "+
a);this.setAxisAngle(new window.XML3DVec3(+b[1],+b[2],+b[3]),+b[4])};a.interpolate=function(a,b){var c=XML3D.math.quat.create(),g=new e;XML3D.math.quat.slerp(c,this._data,a._data,b);g._setQuaternion(c);return g};a.setQuaternion=function(a,b){this._setQuaternion([a.x,a.y,a.z,b])};a.toMatrix=function(){var a=XML3D.math.quat.copy(XML3D.math.quat.create(),this._data),b=new XML3DMatrix;XML3D.math.mat4.fromRotationTranslation(b._data,a,[0,0,0]);return b};a.rotateVec3=function(a){var b=new XML3DVec3;XML3D.math.vec3.transformQuat(b._data,
a._data,this._data);return b};a._setQuaternion=function(a){var b=Math.sqrt(1-a[3]*a[3]);0.001>b||isNaN(b)?(this._axis._data[0]=0,this._axis._data[1]=0,this._axis._data[2]=1,this._angle=0):(b=1/b,this._axis._data[0]=a[0]*b,this._axis._data[1]=a[1]*b,this._axis._data[2]=a[2]*b,this._angle=2*Math.acos(a[3]));this._data=XML3D.math.quat.copy(XML3D.math.quat.create(),a);this._callback&&this._callback(this)};a.multiply=function(a){var b=new e,c=XML3D.math.quat.create();XML3D.math.quat.multiply(c,this._data,
a._data);b._setQuaternion(c);return b};a.normalize=function(){var a=this._axis.normalize();return new e(a,this._angle)};a.getQuaternion=function(){return XML3D.math.quat.copy(XML3D.math.quat.create(),this._data)};a.setFromBasis=function(a,b,c){var e=XML3D.math.quat.create();XML3D.math.quat.setFromBasis(a._data,b._data,c._data,e);this._setQuaternion(e)};j.exports=e},{}],126:[function(h,j){function e(a){return{get:function(){return this._data[a]},set:function(c){this._data[a]=c;this._callback&&this._callback(this)},
configurable:!1,enumerable:!1}}var a=function(a,c,d,e){this._data=new Float32Array(3);void 0!==a&&null!==a&&this.set(a,c,d);this._callback="function"==typeof e?e:0},d=a.prototype;d.set=function(a,c,d){a.length&&3<=a.length?(this._data[0]=a[0],this._data[1]=a[1],this._data[2]=a[2]):a._data&&a._data.length&&3===a._data.length?(this._data[0]=a._data[0],this._data[1]=a._data[1],this._data[2]=a._data[2]):3==arguments.length&&(this._data[0]=a,this._data[1]=c,this._data[2]=d);this._callback&&this._callback(this)};
Object.defineProperty(d,"x",e(0));Object.defineProperty(d,"y",e(1));Object.defineProperty(d,"z",e(2));d.toString=function(){return"[object XML3DVec3]"};d.add=function(b){return b._data?new a(this._data[0]+b._data[0],this._data[1]+b._data[1],this._data[2]+b._data[2]):new a(this._data[0]+b.x,this._data[1]+b.y,this._data[2]+b.z)};d.subtract=function(b){return b._data?new a(this._data[0]-b._data[0],this._data[1]-b._data[1],this._data[2]-b._data[2]):new a(this._data[0]-b.x,this._data[1]-b.y,this._data[2]-
b.z)};d.length=function(){return Math.sqrt(this._data[0]*this._data[0]+this._data[1]*this._data[1]+this._data[2]*this._data[2])};d.setVec3Value=function(a){a=/^\s*(\S+)\s+(\S+)\s+(\S+)\s*$/.exec(a);if(!a)throw Error("Wrong format for XML3DVec3::setVec3Value");this._data[0]=+a[1];this._data[1]=+a[2];this._data[2]=+a[3];this._callback&&this._callback(this)};d.multiply=function(b){return b._data?new a(this._data[0]*b._data[0],this._data[1]*b._data[1],this._data[2]*b._data[2]):new a(this._data[0]*b.x,
this._data[1]*b.y,this._data[2]*b.z)};d.scale=function(b){return new a(this._data[0]*b,this._data[1]*b,this._data[2]*b)};d.cross=function(b){return b._data?new a(this._data[1]*b._data[2]-this._data[2]*b._data[1],this._data[2]*b._data[0]-this._data[0]*b._data[2],this._data[0]*b._data[1]-this._data[1]*b._data[0]):new a(this._data[1]*b.z-this._data[2]*b.y,this._data[2]*b.x-this._data[0]*b.z,this._data[0]*b.y-this._data[1]*b.x)};d.negate=function(){return new a(-this._data[0],-this._data[1],-this._data[2])};
d.dot=function(a){return this._data[0]*a.x+this._data[1]*a.y+this._data[2]*a.z};d.normalize=function(){var b=this.length();if(b)b=1/b;else throw Error();return new a(this._data[0]*b,this._data[1]*b,this._data[2]*b)};j.exports=a},{}],127:[function(){Array.forEach||(Array.forEach=function(h,j,e){for(var a=h.length,d=0;d<a;d++)d in h&&j.call(e,h[d],d,h)});Array.map||(Array.map=function(h,j,e){for(var a=h.length,d=[],b=0;b<a;b++)b in h&&(d[b]=j.call(e,h[b],b,h));return d});Array.filter||(Array.filter=
function(h,j,e){for(var a=h.length,d=[],b=0;b<a;b++)if(b in h){var c=h[b];j.call(e,c,b,h)&&d.push(c)}return d});Array.erase||(Array.erase=function(h,j){for(var e=false,a=-1;(a=h.indexOf(j))!=-1;){h.splice(a,1);e=true}return e});Array.set||(Array.set=function(h,j,e){for(var a=0;a<e.length;a++)h[j+a]=e[a]});Array.isArray||(Array.isArray=function(h){return Object.prototype.toString.call(h)=="[object Array]"})},{}],128:[function(h,j){var e=h("./cssMatrix.js"),a={TRANSFORM_PROPERTY:null,init:function(){"transform"in
document.body.style?a.TRANSFORM_PROPERTY="transform":"WebkitTransform"in document.body.style?a.TRANSFORM_PROPERTY="-webkit-transform":"MozTransform"in document.body.style?a.TRANSFORM_PROPERTY="-moz-transform":XML3D.debug.logWarning("No supported transform css property found")},getInlinePropertyValue:function(a,b){var c=a.getAttribute("style");return c&&(c=RegExp(b+"s*:([^;]+)","i").exec(c))?c[1].trim():null},getPropertyValue:function(a,b){var c=this.getInlinePropertyValue(a,b);return c?c:window.getComputedStyle(a).getPropertyValue(b)},
getCSSMatrix:function(d){if(!a.TRANSFORM_PROPERTY||!e)return null;var b=null;"transform"!=a.TRANSFORM_PROPERTY&&(b=a.getInlinePropertyValue(d,"transform"));b||(b=a.getPropertyValue(d,a.TRANSFORM_PROPERTY));if(!b||"none"==b)return null;d=null;try{d=new e(b)}catch(c){XML3D.debug.logError("Error parsing transform property: "+b)}return d},convertCssToMat4:function(a,b){var c=b||XML3D.math.mat4.create();c[0]=a.m11;c[1]=a.m12;c[2]=a.m13;c[3]=a.m14;c[4]=a.m21;c[5]=a.m22;c[6]=a.m23;c[7]=a.m24;c[8]=a.m31;
c[9]=a.m32;c[10]=a.m33;c[11]=a.m34;c[12]=a.m41;c[13]=a.m42;c[14]=a.m43;c[15]=a.m44;return c}};j.exports=a},{"./cssMatrix.js":129}],129:[function(h,j){var e=function(a){this.m11=this.m22=this.m33=this.m44=1;this.m12=this.m13=this.m14=this.m21=this.m23=this.m24=this.m31=this.m32=this.m34=this.m41=this.m42=this.m43=0;"string"==typeof a&&this.setMatrixValue(a)};e.displayName="FirminCSSMatrix";e.degreesToRadians=function(a){return a*Math.PI/180};e.determinant2x2=function(a,d,b,c){return a*c-d*b};e.determinant3x3=
function(a,d,b,c,g,f,h,i,j){var l=e.determinant2x2;return a*l(g,f,i,j)-c*l(d,b,i,j)+h*l(d,b,g,f)};e.determinant4x4=function(a){var d=e.determinant3x3,b=a.m21,c=a.m31,g=a.m41,f=a.m12,h=a.m22,i=a.m32,j=a.m42,l=a.m13,m=a.m23,r=a.m33,p=a.m43,q=a.m14,o=a.m24,s=a.m34,u=a.m44;return a.m11*d(h,m,o,i,r,s,j,p,u)-b*d(f,l,q,i,r,s,j,p,u)+c*d(f,l,q,h,m,o,j,p,u)-g*d(f,l,q,h,m,o,i,r,s)};e.toMatrixString=function(a){var d=/(\w+)\(([^\)]+)\)/i,b=a.match(/(\w+)\([^\)]+\)/ig),c=b&&b.every(function(a){return/^matrix/.test(a)});
if(!b||c)return a;var g=function(a){return a.value},f={matrix:function(a,b){var c=new e(b.unparsed);return a.multiply(c)},matrix3d:function(a,b){var c=new e(b.unparsed);return a.multiply(c)},perspective:function(a,b){var c=new e;c.m34-=1/b.value[0].value;return a.multiply(c)},rotate:function(a,b){return a.rotate.apply(a,b.value.map(g))},rotate3d:function(a,b){return a.rotateAxisAngle.apply(a,b.value.map(g))},rotateX:function(a,b){return a.rotate.apply(a,[b.value[0].value,0,0])},rotateY:function(a,
b){return a.rotate.apply(a,[0,b.value[0].value,0])},rotateZ:function(a,b){return a.rotate.apply(a,[0,0,b.value[0].value])},scale:function(a,b){return a.scale.apply(a,b.value.map(g))},scale3d:function(a,b){return a.scale.apply(a,b.value.map(g))},scaleX:function(a,b){return a.scale.apply(a,b.value.map(g))},scaleY:function(a,b){return a.scale.apply(a,[0,b.value[0].value,0])},scaleZ:function(a,b){return a.scale.apply(a,[0,0,b.value[0].value])},skew:function(a,b){var c=new e("skewX("+b.value[0].unparsed+
")"),c="matrix(1.00000, "+(new e("skewY("+b.value[1].unparsed+")")).b+", "+c.c+", 1.000000, 0.000000, 0.000000)",c=new e(c);return a.multiply(c)},skewX:function(a,b){return a.skewX.apply(a,[b.value[0].value])},skewY:function(a,b){return a.skewY.apply(a,[b.value[0].value])},translate:function(a,b){return a.translate.apply(a,b.value.map(g))},translate3d:function(a,b){return a.translate.apply(a,b.value.map(g))},translateX:function(a,b){return a.translate.apply(a,[b.value[0].value,0,0])},translateY:function(a,
b){return a.translate.apply(a,[0,b.value[0].value,0])},translateZ:function(a,b){return a.translate.apply(a,[0,0,b.value[0].value])}},a=b.map(function(a){var b=a.match(d).slice(1);return{key:b[0],value:b[1].split(/, ?/).map(function(a){var b=a.match(/([-\+]?[0-9]+[\.0-9]*)(deg|rad|grad|px|%)*/)||[];return{value:parseFloat(b[1]),units:b[2],unparsed:a}}),unparsed:a}}),b=new e;return a.reduce(function(a,b){b.value=b.value.map(function(a){"rad"==a.units?(a.value*=180/Math.PI,a.units="deg"):"grad"==a.units&&
(a.value/=400/360,a.units="deg");return a});return(0,f[b.key])(a,b)||a},b).toString()};[["m11","a"],["m12","b"],["m21","c"],["m22","d"],["m41","e"],["m42","f"]].forEach(function(a){var d=a[0];Object.defineProperty(e.prototype,a[1],{set:function(a){this[d]=a},get:function(){return this[d]},enumerable:!0,configurable:!0})});e.prototype.isAffine=function(){return 0===this.m13&&0===this.m14&&0===this.m23&&0===this.m24&&0===this.m31&&0===this.m32&&1===this.m33&&0===this.m34&&0===this.m43&&1===this.m44};
e.prototype.multiply=function(a){if(!a)return null;var d=new e;d.m11=a.m11*this.m11+a.m12*this.m21+a.m13*this.m31+a.m14*this.m41;d.m12=a.m11*this.m12+a.m12*this.m22+a.m13*this.m32+a.m14*this.m42;d.m13=a.m11*this.m13+a.m12*this.m23+a.m13*this.m33+a.m14*this.m43;d.m14=a.m11*this.m14+a.m12*this.m24+a.m13*this.m34+a.m14*this.m44;d.m21=a.m21*this.m11+a.m22*this.m21+a.m23*this.m31+a.m24*this.m41;d.m22=a.m21*this.m12+a.m22*this.m22+a.m23*this.m32+a.m24*this.m42;d.m23=a.m21*this.m13+a.m22*this.m23+a.m23*
this.m33+a.m24*this.m43;d.m24=a.m21*this.m14+a.m22*this.m24+a.m23*this.m34+a.m24*this.m44;d.m31=a.m31*this.m11+a.m32*this.m21+a.m33*this.m31+a.m34*this.m41;d.m32=a.m31*this.m12+a.m32*this.m22+a.m33*this.m32+a.m34*this.m42;d.m33=a.m31*this.m13+a.m32*this.m23+a.m33*this.m33+a.m34*this.m43;d.m34=a.m31*this.m14+a.m32*this.m24+a.m33*this.m34+a.m34*this.m44;d.m41=a.m41*this.m11+a.m42*this.m21+a.m43*this.m31+a.m44*this.m41;d.m42=a.m41*this.m12+a.m42*this.m22+a.m43*this.m32+a.m44*this.m42;d.m43=a.m41*this.m13+
a.m42*this.m23+a.m43*this.m33+a.m44*this.m43;d.m44=a.m41*this.m14+a.m42*this.m24+a.m43*this.m34+a.m44*this.m44;return d};e.prototype.isIdentityOrTranslation=function(){return 1===this.m11&&0===this.m12&&0===this.m13&&0===this.m14&&0===this.m21&&1===this.m22&&0===this.m23&&0===this.m24&&0===this.m31&&0===this.m31&&1===this.m33&&0===this.m34&&1===this.m44};e.prototype.adjoint=function(){var a=new e,d=e.determinant3x3,b=this.m11,c=this.m12,g=this.m13,f=this.m14,h=this.m21,i=this.m22,j=this.m23,l=this.m24,
m=this.m31,r=this.m32,p=this.m33,q=this.m34,o=this.m41,s=this.m42,u=this.m43,t=this.m44;a.m11=d(i,r,s,j,p,u,l,q,t);a.m21=-d(h,m,o,j,p,u,l,q,t);a.m31=d(h,m,o,i,r,s,l,q,t);a.m41=-d(h,m,o,i,r,s,j,p,u);a.m12=-d(c,r,s,g,p,u,f,q,t);a.m22=d(b,m,o,g,p,u,f,q,t);a.m32=-d(b,m,o,c,r,s,f,q,t);a.m42=d(b,m,o,c,r,s,g,p,u);a.m13=d(c,i,s,g,j,u,f,l,t);a.m23=-d(b,h,o,g,j,u,f,l,t);a.m33=d(b,h,o,c,i,s,f,l,t);a.m43=-d(b,h,o,c,i,s,g,j,u);a.m14=-d(c,i,r,g,j,p,f,l,q);a.m24=d(b,h,m,g,j,p,f,l,q);a.m34=-d(b,h,m,c,i,r,f,l,q);
a.m44=d(b,h,m,c,i,r,g,j,p);return a};e.prototype.inverse=function(){var a,d,b,c;if(this.isIdentityOrTranslation())return a=new e,0===this.m41&&0===this.m42&&0===this.m43||(a.m41=-this.m41,a.m42=-this.m42,a.m43=-this.m43),a;d=this.adjoint();a=e.determinant4x4(this);if(1.0E-8>Math.abs(a))return null;for(b=1;5>b;b++)for(c=1;5>c;c++)d["m"+b+c]/=a;return d};e.prototype.rotate=function(a,d,b){var c=e.degreesToRadians;if("number"!=typeof a||isNaN(a))a=0;if(("number"!=typeof d||isNaN(d))&&("number"!=typeof b||
isNaN(b)))b=a,d=a=0;if("number"!=typeof d||isNaN(d))d=0;if("number"!=typeof b||isNaN(b))b=0;var a=c(a),d=c(d),b=c(b),c=new e,g=new e,f=new e,h,b=b/2;h=Math.sin(b);b=Math.cos(b);f.m11=f.m22=1-2*h*h;f.m12=f.m21=2*h*b;f.m21*=-1;d/=2;h=Math.sin(d);b=Math.cos(d);g.m11=g.m33=1-2*h*h;g.m13=g.m31=2*h*b;g.m13*=-1;a/=2;h=Math.sin(a);b=Math.cos(a);c.m22=c.m33=1-2*h*h;c.m23=c.m32=2*h*b;c.m32*=-1;return this.toString()===(new e).toString()?f.multiply(g).multiply(c):this.multiply(c).multiply(g).multiply(f)};e.prototype.rotateAxisAngle=
function(a,d,b,c){if("number"!=typeof a||isNaN(a))a=0;if("number"!=typeof d||isNaN(d))d=0;if("number"!=typeof b||isNaN(b))b=0;if("number"!=typeof c||isNaN(c))c=0;0===a&&0===d&&0===b&&(b=1);var g=new e,f=Math.sqrt(a*a+d*d+b*b),h,i,j,c=(e.degreesToRadians(c)||0)/2;h=Math.cos(c);i=Math.sin(c);c=i*i;0===f?(d=a=0,b=1):1!==f&&(a/=f,d/=f,b/=f);1===a&&0===d&&0===b?(g.m22=g.m33=1-2*c,g.m23=g.m32=2*h*i,g.m32*=-1):0===a&&1===d&&0===b?(g.m11=g.m33=1-2*c,g.m13=g.m31=2*h*i,g.m13*=-1):0===a&&0===d&&1===b?(g.m11=
g.m22=1-2*c,g.m12=g.m21=2*h*i,g.m21*=-1):(f=i*h,h=a*a,i=d*d,j=b*b,g.m11=1-2*(i+j)*c,g.m12=2*(a*d*c+b*f),g.m13=2*(a*b*c-d*f),g.m21=2*(d*a*c-b*f),g.m22=1-2*(j+h)*c,g.m23=2*(d*b*c+a*f),g.m31=2*(b*a*c+d*f),g.m32=2*(b*d*c-a*f),g.m33=1-2*(h+i)*c);return this.multiply(g)};e.prototype.scale=function(a,d,b){var c=new e;if("number"!=typeof a||isNaN(a))a=1;if("number"!=typeof d||isNaN(d))d=a;if("number"!=typeof b||isNaN(b))b=1;c.m11=a;c.m22=d;c.m33=b;return this.multiply(c)};e.prototype.skewX=function(a){var a=
e.degreesToRadians(a),d=new e;d.c=Math.tan(a);return this.multiply(d)};e.prototype.skewY=function(a){var a=e.degreesToRadians(a),d=new e;d.b=Math.tan(a);return this.multiply(d)};e.prototype.translate=function(a,d,b){var c=new e;if("number"!=typeof a||isNaN(a))a=0;if("number"!=typeof d||isNaN(d))d=0;if("number"!=typeof b||isNaN(b))b=0;c.m41=a;c.m42=d;c.m43=b;return this.multiply(c)};e.prototype.setMatrixValue=function(a){var a=e.toMatrixString(a.trim()),d=a.match(/^matrix(3d)?\(\s*(.+)\s*\)$/),b,c,
g,f,h;if(d)if(b=!!d[1],d=d[2].split(/\s*,\s*/),c=d.length,g=Array(c),b&&16!==c||!(b||6===c))XML3D.debug.logError("Invalid CSS Matrix: ",a);else{for(f=0;f<c;f++)if(h=d[f],h.match(/^-?\d+(\.\d+)?$/))g[f]=parseFloat(h);else{XML3D.debug.logError("Invalid CSS Matrix: ",a);return}for(f=0;f<c;f++)this[b?"m"+(Math.floor(f/4)+1)+(f%4+1):String.fromCharCode(f+97)]=g[f]}};e.prototype.toString=function(){var a=this,d,b;this.isAffine()?(b="matrix(",d="a,b,c,d,e,f".split(",")):(b="matrix3d(",d="m11,m12,m13,m14,m21,m22,m23,m24,m31,m32,m33,m34,m41,m42,m43,m44".split(","));
return b+d.map(function(b){return a[b].toFixed(6)}).join(", ")+")"};j.exports=e},{}],130:[function(h,j){var e=h("../contrib/stacktrace-0.4.js"),a=h("./options.js");(function(d){a.register("loglevel","warning");d.exports={ALL:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4,EXCEPTION:5,params:{},isSetup:!1,loglevel:4,loglevels:{all:0,debug:1,info:2,warning:3,error:4,exception:5},setup:function(){var b=XML3D.debug;b.isSetup||(b.isSetup=!0,b.loglevel=b.loglevels[a.getValue("loglevel")]||3,a.addObserver(function(a,
d){"loglevel"==a&&(b.loglevel=b.loglevels[d]||3)}));return!0},_setLogLevel:function(){},doLog:function(a,c){if(!(XML3D.debug.params.xml3d_nolog||a<XML3D.debug.loglevel))if(c=Array.prototype.slice.call(c),window.console)switch(a){case XML3D.debug.INFO:window.console.info.apply(window.console,c);break;case XML3D.debug.WARNING:window.console.warn.apply(window.console,c);break;case XML3D.debug.ERROR:window.console.error.apply(window.console,c);break;case XML3D.debug.EXCEPTION:window.console.error(e({e:c[0],
guess:!0}).join("\n"));break;case XML3D.debug.DEBUG:window.console.debug.apply(window.console,c)}},logDebug:function(){XML3D.debug.doLog(XML3D.debug.DEBUG,arguments)},logInfo:function(){XML3D.debug.doLog(XML3D.debug.INFO,arguments)},logWarning:function(){XML3D.debug.doLog(XML3D.debug.WARNING,arguments)},logError:function(){XML3D.debug.doLog(XML3D.debug.ERROR,arguments)},logException:function(){XML3D.debug.doLog(XML3D.debug.EXCEPTION,arguments)},assert:function(a,c){if(!a){var d;try{d=XML3D.debug.assert.caller?
XML3D.debug.assert.caller.name:null}catch(e){d=null}d?XML3D.debug.doLog(XML3D.debug.WARNING,["Assertion failed in "+d,c]):XML3D.debug.doLog(XML3D.debug.WARNING,["Assertion failed",c])}},trace:function(a,c){c=void 0!==c?c:XML3D.debug.ERROR;if(window.console.trace)a&&XML3D.debug.doLog(c,[a]),window.console.trace();else{var d=e();a&&d.splice(0,0,a);XML3D.debug.doLog(c,d)}},getNumberWithPadding:function(a,c){for(var d=""+a;d.length<c;)d=" "+d;return d},formatSourceCode:function(a){for(var c="",a=a.split("\n"),
d=0;d<a.length;++d)c+=this.getNumberWithPadding(d+1,3)+"  "+a[d]+"\n";return c}}})(j)},{"../contrib/stacktrace-0.4.js":13,"./options.js":132}],131:[function(h,j){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,a){window.setTimeout(e,1E3/a)}}();(function(e){e.callAdapterFunc=function(a,b){var c=[];if(!a||void 0===a._configured)return c;
var e=a._configured.adapters,f;for(f in e)for(var h in b){var i=e[f],j=i[h];j&&c.push(j.apply(i,b[h]))}return c};e.sendAdapterEvent=function(a,b){if(!a||void 0===a._configured)return!1;var c=a._configured.adapters,e;for(e in c)for(var f in b){var h=c[e][f];h&&h.apply(c[e],b[f])}return!0};e.dispatchCustomEvent=function(a,b,c,e,f){var h=document.createEvent("CustomEvent");h.initCustomEvent(b,c,e,f);return a.dispatchEvent(h)};e.dispatchEvent=function(a,b){var c=null;if(document.createEvent)return c=
document.createEvent("Events"),c.initEvent(b,!0,!0),a.dispatchEvent(c);if(document.createEventObject)return c=document.createEventObject(),a.fireEvent("on"+b,c)};var a=0;e.getOrCreateActiveView=function(d){var b=d.activeView;if(b){var c=window.XML3D.URIResolver.resolveLocal(b);if(!c)throw"XML3D Error: xml3d references view that is not defined: '"+b+"'.";return c}if(c=d.querySelector("view"))return c.id&&0<c.id.length&&(d.activeView="#"+c.id),c;XML3D.debug.logWarning("xml3d element has no view defined: creating one.");
b="xml3d.autocreatedview_"+a++;c=XML3D.createElement("view");c.setAttribute("id",b);d.appendChild(c);d.setAttribute("activeView","#"+b);return c}})(j.exports)},{}],132:[function(h,j){(function(e){var a=function(){this._options={};this._listeners={"*":[]}};a.prototype={register:function(a,b){if(this._options.hasOwnProperty(a))throw Error("Option already registered '"+a+"'");this._options[a]={currentValue:b,defaultValue:b}},resetValue:function(a){if(!this._options.hasOwnProperty(a))throw Error("Invalid configuration key '"+
a+"'");this._options[a].currentValue=this._options[a].defaultValue;this.notifyObservers(a,this._options[a].currentValue)},setValue:function(a,b){if(!this._options.hasOwnProperty(a))throw Error("Invalid configuration key '"+a+"'");this._options[a].currentValue=b;this.notifyObservers(a,b)},getValue:function(a){if(!this._options.hasOwnProperty(a))throw Error("Invalid configuration key '"+a+"'");return this._options[a].currentValue},getKeys:function(){return Object.keys(this._options)},notifyObservers:function(a,
b){this._listeners.hasOwnProperty(a)&&this._listeners[a].forEach(function(c){c(a,b)});this._listeners["*"].forEach(function(c){c(a,b)})},addObserver:function(a,b){"function"==typeof a&&(b=a,a="*");if(!this._options.hasOwnProperty(a)&&"*"!==a)throw Error("Can't register to unknown option '"+a+"'");this._listeners.hasOwnProperty(a)||(this._listeners[a]=[]);this._listeners[a].push(b)},removeObserver:function(a){for(var b in this._listeners){var c=this._listeners[b],e=c.indexOf(a);-1!=e&&c.splice(e,1)}}};
a=new a;a.setOptionsFromQuery=function(){window.location.search.substr(1).split("&").forEach(function(a){a=a.split("=");try{var b=a[0].toLowerCase();if(0===b.indexOf("xml3d-")){var c=decodeURIComponent(a[1]);try{c=JSON.parse(c)}catch(e){}XML3D.options.setValue(b.substr(6),c)}}catch(f){XML3D.debug&&XML3D.debug.logError(f)}})};e.exports=a})(j)},{}],133:[function(h,j){(function(e){var a=function(a){a=a||"";if(0==a.indexOf("blob:")){var c=/^(?:([^:\/?\#]+):)?([^\#]*)(?:\#(.*))?/,a=a.match(c);this.valid=
null!=a;this.scheme=a[1]||null;this.query=this.path=this.authority=null;this.opaqueString=a[2]||null;this.fragment=a[3]||null}else c=/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/,a=a.match(c),this.valid=null!=a,this.scheme=a[1]||null,this.authority=a[2]||null,this.path=a[3]||null,this.query=a[4]||null,this.opaqueString=null,this.fragment=a[5]||null};a.prototype.isLocal=function(){return"blob"!=this.scheme&&!this.authority&&!this.path};a.prototype.isAbsolute=function(){return null!=
this.scheme};a.prototype.getAbsoluteURI=function(b){if(!this.valid||this.isAbsolute())return this;b=new a(b);this.path?(b.path=0==this.path.indexOf("/")?this.path:b.path.substr(0,b.path.lastIndexOf("/")+1)+this.path,b.query=this.query):this.query&&(b.query=this.query);b.fragment=this.fragment;return b};a.prototype.hasSameOrigin=function(b){"string"==typeof b&&(b=new a(b));return"blob"==this.scheme||"data"==this.scheme?!0:this.scheme==b.scheme&&this.authority==b.authority};a.prototype.toString=function(){var a=
"";if("blob"==this.scheme)return a="blob:"+this.opaqueString,this.fragment&&(a+="#"+this.fragment),a;this.scheme&&(a+=this.scheme+":");this.authority&&(a+="//"+this.authority);this.path&&(a+=this.path);this.query&&(a+="?"+this.query);this.fragment&&(a+="#"+this.fragment);return a};a.prototype.toStringWithoutFragment=function(){var a="";if("blob"==this.scheme)return a="blob:"+this.opaqueString;this.scheme&&(a+=this.scheme+":");this.authority&&(a+="//"+this.authority);this.path&&(a+=this.path);this.query&&
(a+="?"+this.query);return a};var d=function(){};d.resolveLocal=function(b,c){"string"==typeof b&&(b=new a(b));c=c||window.document;return"urn"==b.scheme||"blob"==b.scheme?null:!b.path&&b.fragment?c.getElementById(b.fragment):null};d.resolve=function(a,c){XML3D.debug.logWarning("You are using deprecated XML3D.URIResolver.resolve. Use XML3D.URIResolver.resolveLocal instead.");return d.resolveLocal(a,c)};e.URI=a;e.URIResolver=d;window.XML3D.URIResolver=d})(j.exports)},{}],134:[function(h,j){(function(e){function a(a){var b;
if(!isNaN(parseFloat(a))&&isFinite(a)){for(b in z)if(z[b]===a)return b;XML3D.debug.logDebug("Got unknown OpenCL Error Code:",a)}return"UNKNOWN_ERROR"}function d(a){var b=null;return a.name&&"string"===typeof a.name&&z[a.name]?z[a.name]:a.message&&"string"===typeof a.message&&(b=a.message.match(/-?\d+/g),b instanceof Array)?parseInt(b[b.length-1],10):!1}function b(a,b){a&&"string"!==typeof a&&(XML3D.debug.logDebug("WebCL API: WebCLError: Error name not type of String"),a="");b&&"string"!==typeof b&&
(XML3D.debug.logDebug("WebCL API: WebCLError: Error message not type of String"),b="");this.name=a||"WebCLError";this.message=b||"Generic WebCL error.";this.stack=Error().stack}function c(){return t=window.webcl&&webcl.getPlatforms}function g(){var a;v=!0;try{a=webcl.getPlatforms()}catch(b){v=!1}if(!a||0===a.length)v=!1;return v}function f(){return c()&&g()}function h(){0===o.length&&(o=webcl.getPlatforms());return o}function i(c,e){var f=[];if(!e)return XML3D.debug.logError("WebCL API: getPlatformDevicesByType(): platform was not defined."),
!1;c=c||w;try{"CPU"===c?f=e.getDevices(webcl.DEVICE_TYPE_CPU):"GPU"===c?f=e.getDevices(webcl.DEVICE_TYPE_GPU):"ALL"===c&&(f=e.getDevices(webcl.DEVICE_TYPE_ALL))}catch(g){if(f=d(g)){if(f!==z.DEVICE_NOT_FOUND)throw new b(a(f),"Could not get devices.");}else throw g;return!1}return f}function j(a){var b=[],c,d;h();for(d=o.length;d--;)(c=i(a,o[d]))&&c.forEach(function(a){b.push(a)});return 0===b.length?!1:b}function l(c){try{var e=webcl.createContext(c)}catch(f){c=d(f);if(!c)throw f;throw new b(a(c),
"Failed to create a WebCL context.");}return e}function m(c,e){var f,e=e||u;if(!c)return XML3D.debug.logError("WebCL API: createProgram(): codeStr was not defined."),!1;if(!e)return XML3D.debug.logError("WebCL API: createProgram(): clCtx was not defined."),!1;try{f=e.createProgram(c)}catch(g){f=d(g);if(!f)throw g;throw new b(a(f),"Failed to create a WebCL program.");}return f}function r(c,e){e=e||s;if(!c)return XML3D.debug.logError("WebCL API: buildProgram(): program was not defined."),!1;try{c.build(e,
"")}catch(f){var g=d(f);if(!g)throw f;throw new b(a(g),c.getBuildInfo(e[0],WebCL.PROGRAM_BUILD_LOG));}return c}function p(c,e){var f;if(!c)return XML3D.debug.logError("WebCL API: createKernel(): program was not defined."),!1;if(!e)return XML3D.debug.logError("WebCL API: createKernel(): name was not defined."),!1;try{f=c.createKernel(e)}catch(g){f=d(g);if(!f)throw g;throw new b(a(f),"Failed to create a WebCL kernel.");}return f}function q(c,e){var f,e=e||u;if(!e)return XML3D.debug.logError("WebCL API: createCommandQueue: clCtx was not defined"),
!1;try{f=e.createCommandQueue(c||s[0],0)}catch(g){if(!d(g))throw g;throw new b(a(d(g)),"Could not create CommandQueue.");}return f}var o=[],s=[],u=null,t=!1,v=!1,w="CPU",z={SUCCESS:0,DEVICE_NOT_FOUND:-1,DEVICE_NOT_AVAILABLE:-2,COMPILER_NOT_AVAILABLE:-3,MEM_OBJECT_ALLOCATION_FAILURE:-4,OUT_OF_RESOURCES:-5,OUT_OF_HOST_MEMORY:-6,PROFILING_INFO_NOT_AVAILABLE:-7,MEM_COPY_OVERLAP:-8,IMAGE_FORMAT_MISMATCH:-9,IMAGE_FORMAT_NOT_SUPPORTED:-10,BUILD_PROGRAM_FAILURE:-11,MAP_FAILURE:-12,INVALID_VALUE:-30,INVALID_DEVICE_TYPE:-31,
INVALID_PLATFORM:-32,INVALID_DEVICE:-33,INVALID_CONTEXT:-34,INVALID_QUEUE_PROPERTIES:-35,INVALID_COMMAND_QUEUE:-36,INVALID_HOST_PTR:-37,INVALID_MEM_OBJECT:-38,INVALID_IMAGE_FORMAT_DESCRIPTOR:-39,INVALID_IMAGE_SIZE:-40,INVALID_SAMPLER:-41,INVALID_BINARY:-42,INVALID_BUILD_OPTIONS:-43,INVALID_PROGRAM:-44,INVALID_PROGRAM_EXECUTABLE:-45,INVALID_KERNEL_NAME:-46,INVALID_KERNEL_DEFINITION:-47,INVALID_KERNEL:-48,INVALID_ARG_INDEX:-49,INVALID_ARG_VALUE:-50,INVALID_ARG_SIZE:-51,INVALID_KERNEL_ARGS:-52,INVALID_WORK_DIMENSION:-53,
INVALID_WORK_GROUP_SIZE:-54,INVALID_WORK_ITEM_SIZE:-55,INVALID_GLOBAL_OFFSET:-56,INVALID_EVENT_WAIT_LIST:-57,INVALID_EVENT:-58,INVALID_OPERATION:-59,INVALID_GL_OBJECT:-60,INVALID_BUFFER_SIZE:-61,INVALID_MIP_LEVEL:-62,INVALID_GLOBAL_WORK_SIZE:-63};Object.freeze(z);b.prototype=Object.create(Error.prototype);b.prototype.constructor=b;var y=function(c,e){var f={};return{register:function(a,b){if(f.hasOwnProperty(a))return XML3D.debug.logWarning("WebCL API: kernels.register(): Kernel with a same name is already defined."),
!1;if("string"!==typeof a)return XML3D.debug.logError("WebCL API: kernels.register(): Kernel name was not defined or was not type of String."),!1;if("string"!==typeof b)return XML3D.debug.logError("WebCL API: kernels.register(): Kernel code was not defined or was not type of String."),!1;var d,g;d=m(b,c);r(d,e);d&&(g=p(d,a));return g?(f[a]=g,!0):!1},unRegister:function(c){if(f.hasOwnProperty(c)){try{f[c].release()}catch(e){c=d(e);if(!c)throw e;throw new b(a(c),"Could not release kernel resources.");
}delete f[c];return!0}return!1},getKernel:function(a){return"string"!==typeof a?!1:f.hasOwnProperty(a)?f[a]:!1},setArgs:function(){var c=Array.prototype.slice.call(arguments),e,f;if(2>c.length)return XML3D.debug.logWarning("WebCL API: setArgs(): No kernel arguments were defined."),!1;e=c[0];c=c.slice(1);if(!e)return XML3D.debug.logWarning("WebCL API: setArgs(): WebCL kernel was not defined."),!1;f=e.getInfo(webcl.KERNEL_NUM_ARGS);if(c.length>f)XML3D.debug.logWarning("WebCL: setArgs: Input args amount > kernel program args amount! Ignoring extra arguments.");
else if(c.length<f)return XML3D.debug.logError("WebCL: setArgs: Not enough arguments were given to WebCL kernel."),!1;XML3D.debug.logDebug("Args for kernel:",e.getInfo(webcl.KERNEL_FUNCTION_NAME));try{for(;f--;)XML3D.debug.logDebug("Arg:",f,c[f]),e.setArg(f,c[f])}catch(g){e=d(g);if(!e)throw g;throw new b(a(e),"Could not set kernel arguments.");}return!0}}};e.webcl={init:function(a){if(!c())return XML3D.debug.logWarning("WebCL API: Unfortunately your system does not support WebCL. WebCL namespace is not available."),
!1;if(!g())return XML3D.debug.logWarning("WebCL API: Unfortunately your system does not support WebCL. OpenCL drivers are not working properly."),!1;h();s=j(a||w);u=l(s);return!0},createContext:l,createProgram:m,buildProgram:r,createKernel:p,createCommandQueue:q,createBuffer:function(c,e,f){f=f||u;if(c){if(isNaN(parseFloat(c))||!isFinite(c)||0>c)return XML3D.debug.logError("WebCL API: createBuffer(): Buffer size must be a positive number."),!1}else return XML3D.debug.logError("WebCL API: createBuffer(): Buffer size was not defined."),
!1;if(!e)return XML3D.debug.logError("WebCL API: createBuffer(): Buffer type was not defined."),!1;if(!f)return XML3D.debug.logError("WebCL API: createBuffer(): clCtx was not defined."),!1;try{if("r"===e)return f.createBuffer(webcl.MEM_READ_ONLY,c);if("w"===e)return f.createBuffer(webcl.MEM_WRITE_ONLY,c);if("rw"===e)return f.createBuffer(webcl.MEM_READ_WRITE,c);XML3D.debug.logError("WebCL API: createBuffer(): Unknown buffer type:",e);return!1}catch(g){c=d(g);if(!c)throw g;throw new b(a(c),"Could not create a WebCL buffer.");
}},getDefaultContext:function(){return u},getPlatforms:h,getDevicesByType:j,getContextDevices:function(c){var e=[];if(!c)return XML3D.debug.logError("WebCL API: getContextDevices(): clCtx was not defined."),!1;try{e=c.getInfo(webcl.CONTEXT_DEVICES)}catch(f){if(c=d(f))throw new b(a(c),"Could not get devices.");throw f;}return 0===e.length?!1:e},getDevicePlatform:function(c){var e;if(!c)return XML3D.debug.logError("WebCL API: getDevicePlatform(): device was not defined."),!1;try{e=c.getInfo(webcl.DEVICE_PLATFORM)}catch(f){c=
d(f);if(!c)throw f;throw new b(a(c),"Could not get the platform of the device.");}return e},kernels:new y,KernelManager:y,hasWebCLNamespace:c,hasOpenCLDrivers:g,isAvailable:f,WebCLError:b,getCLErrorName:a};(function(a){if(!f())return!1;var b=h();if(!b||0>=b.length)return!1;try{var c=j("GPU")||j("CPU");if(!c)return!1;var d=l(c),e=q(c[0],d);a.cl={API:webcl,kernelManager:new y(d,c),platforms:b,devices:c,ctx:d,cmdQueue:e};XML3D.debug.logDebug("Successfully initialized WebCL platform.");return!0}catch(g){return!1}})(e.webcl);
window.XML3D.webcl=e.webcl})(j.exports)},{}],135:[function(h,j){var e=[],a=[],d=[];j.exports={registerErrorCallback:function(a){e.push(a)},notifyError:function(a,c){if(0<e.length){var d;for(d=0;d<e.length;++d)e[d](a,c)}},createClass:function(a,c,d){d=d||{};if(c){var e=function(){};e.prototype=c.prototype;a.prototype=new e;a.prototype.constructor=a;a.superclass=c.prototype}for(var h in d)a.prototype[h]=d[h];return a},extend:function(a,c){for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])},_queueResultCallback:function(b,
c){var e;if(-1==(e=a.indexOf(b)))e=a.length,a.push(b);var f=d[e];if(!f||f<c)d[e]=c},_flushResultCallbacks:function(){if(a.length){var b;for(b=0;b<a.length;++b)a[b]._onPostponedResultChanged(d[b]);a=[];d=[]}}}},{}],136:[function(h,j){var e={EPSILON:1.0E-6,DATA_TYPE:{UNKNOWN:0,FLOAT:1,FLOAT2:2,FLOAT3:3,FLOAT4:4,FLOAT3X3:5,FLOAT4X4:10,INT:20,INT4:21,BOOL:30,TEXTURE:40,BYTE:50,UBYTE:60,fromString:function(a){return!a||!a.toUpperCase?void 0:this[a.toUpperCase()]}}};e.DATA_TYPE_MAP={"float":e.DATA_TYPE.FLOAT,
float2:e.DATA_TYPE.FLOAT2,float3:e.DATA_TYPE.FLOAT3,float4:e.DATA_TYPE.FLOAT4,float3x3:e.DATA_TYPE.FLOAT3X3,float4x4:e.DATA_TYPE.FLOAT4X4,"int":e.DATA_TYPE.INT,int4:e.DATA_TYPE.INT4,bool:e.DATA_TYPE.BOOL,texture:e.DATA_TYPE.TEXTURE,"byte":e.DATA_TYPE.BYTE,ubyte:e.DATA_TYPE.UBYTE};e.TEXTURE_TYPE={UNKNOWN:0,FLOAT:1,UBYTE:60,USHORT_5_6_5:70,USHORT_4_4_4_4:71,USHORT_5_5_5_1:72};e.TEXTURE_FORMAT={UNKNOWN:0,ALPHA:100,RGB:101,RGBA:102,LUMINANCE:103,LUMINANCE_ALPHA:104};e.DATA_TYPE_TUPLE_SIZE={};e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.FLOAT]=
1;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.FLOAT2]=2;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.FLOAT3]=3;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.FLOAT4]=4;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.FLOAT3X3]=9;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.FLOAT4X4]=16;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.INT]=1;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.INT4]=4;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.BOOL]=1;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.TEXTURE]=1;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.BYTE]=1;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.UBYTE]=1;e.TYPED_ARRAY_MAP=
{};e.TYPED_ARRAY_MAP[e.DATA_TYPE.FLOAT]=Float32Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.FLOAT2]=Float32Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.FLOAT3]=Float32Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.FLOAT4]=Float32Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.FLOAT4X4]=Float32Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.INT]=Int32Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.INT4]=Int32Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.BOOL]=Int8Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.BYTE]=Int8Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.UBYTE]=Uint8Array;e.TYPED_ARRAY_MAP[e.TEXTURE_TYPE.USHORT_4_4_4_4]=
Uint16Array;e.TYPED_ARRAY_MAP[e.TEXTURE_TYPE.USHORT_5_6_5]=Uint16Array;e.TYPED_ARRAY_MAP[e.TEXTURE_TYPE.USHORT_5_5_5_1]=Uint16Array;e.TEXTURE_FORMAT_TUPLE_SIZE={};e.TEXTURE_FORMAT_TUPLE_SIZE[e.TEXTURE_FORMAT.ALPHA]=1;e.TEXTURE_FORMAT_TUPLE_SIZE[e.TEXTURE_FORMAT.RGB]=3;e.TEXTURE_FORMAT_TUPLE_SIZE[e.TEXTURE_FORMAT.RGBA]=4;e.TEXTURE_FORMAT_TUPLE_SIZE[e.TEXTURE_FORMAT.LUMINANCE]=1;e.TEXTURE_FORMAT_TUPLE_SIZE[e.TEXTURE_FORMAT.LUMINANCE_ALPHA]=2;e.getTypeName=function(a){for(var d in e.DATA_TYPE_MAP)if(e.DATA_TYPE_MAP[d]===
a)return d};e.TEX_FILTER_TYPE={NEAREST:9728,LINEAR:9729,MIPMAP_NEAREST:9984,MIPMAP_LINEAR:9985};e.TEX_WRAP_TYPE={CLAMP:33071,REPEAT:10497};e.TEX_TYPE={TEXTURE_2D:3553};e.SHADER_CONSTANT_KEY={WORLD_TRANSFORM:1,VIEW_TRANSFORM:2,SCREEN_TRANSFORM:3,WORLD_TRANSFORM_NORMAL:4,VIEW_TRANSFORM_NORMAL:5,SCREEN_TRANSFORM_NORMAL:6,OBJECT_ID:7};e.VS_ATTRIB_TRANSFORM={NONE:0,VIEW_POINT:1,WORLD_POINT:2,VIEW_NORMAL:3,WORLD_NORMAL:4};e.DATA_FILTER_TYPE={NONE:0,RENAME:1,KEEP:2,REMOVE:3};e.DATA_ENTRY_STATE={CHANGED_VALUE:1,
CHANGED_NEW:2,LOAD_START:3,LOAD_END:4,CHANGED_SIZE:5,CHANGED_REMOVED:6,CHANGED_SIZE_TYPE:7};e.RESULT_TYPE={COMPUTE:0,VS:1};e.RESULT_STATE={NONE:0,CHANGED_DATA_VALUE:1,CHANGED_DATA_SIZE:2,CHANGED_STRUCTURE:3,IMAGE_LOAD_START:4,IMAGE_LOAD_END:5};e.SEQUENCE={NO_ACCESS:0,PREV_BUFFER:1,NEXT_BUFFER:2,LINEAR_WEIGHT:3};e.ITERATION_TYPE={NULL:0,ONE:1,MANY:2};e.EXTRACT={NO_EXTRAC:0,TEX_WIDTH:1,TEX_HEIGHT:2};e.ORIGIN={CHILD:1,COMPUTE:2,PROTO:3};e.PLATFORM={JAVASCRIPT:0,GLSL:1,CL:2,ASYNC:3};e.PROCESS_STATE={MODIFIED:0,
LOADING:1,INVALID:3,UNPROCESSED:4,PROCESSED:5};j.exports=e},{}],137:[function(h,j){function e(a,c,d,e){"object"===typeof a?(a.nodeName&&("video"===a.nodeName.toLowerCase()&&"undefined"===typeof a.complete&&Object.defineProperties(a,{width:{get:function(){return this.videoWidth}},height:{get:function(){return this.videoHeight}},complete:{get:function(){return!(0==this.readyState||0>=this.videoWidth||0>=this.videoHeight)}}}),a.texelFormat=b.TEXTURE_FORMAT.RGBA,a.texelType=b.TEXTURE_TYPE.UBYTE),this._source=
a):(d=d||b.TEXTURE_FORMAT.RGBA,e=e||b.TEXTURE_TYPE.UBYTE,this._source={width:a,height:c,texelFormat:d,texelType:e,data:new b.TYPED_ARRAY_MAP[e](a*c*b.TEXTURE_FORMAT_TUPLE_SIZE[d])})}function a(a,b){var c;for(c=0;c<l._listeners.length;++c)l._listeners[c](a,b);for(c=0;c<a._listeners.length;++c)a._listeners[c](a,b)}var d=h("../base.js"),b=h("./constants.js");h("../../utils/array.js");var c=function(){this.generateMipMap=this.colorB=this.colorG=this.colorR=this.textureType=this.wrapU=this.wrapT=this.wrapS=
this.mipFilter=this.magFilter=this.minFilter=0};c.prototype.setDefaults=function(){this.magFilter=this.minFilter=b.TEX_FILTER_TYPE.LINEAR;this.mipFilter=b.TEX_FILTER_TYPE.NEAREST;this.wrapU=this.wrapT=this.wrapS=b.TEX_WRAP_TYPE.CLAMP;this.textureType=b.TEX_TYPE.TEXTURE_2D;this.generateMipMap=this.colorB=this.colorG=this.colorR=0};c.prototype.set=function(a){this.minFilter=a.minFilter;this.magFilter=a.magFilter;this.mipFilter=a.mipFilter;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.wrapU=a.wrapU;this.textureType=
a.textureType;this.colorR=a.colorR;this.colorG=a.colorG;this.colorB=a.colorB;this.generateMipMap=a.generateMipMap};var g=function(a){this._type=a;this._listeners=[];this.userData={}};Object.defineProperty(g.prototype,"type",{set:function(){throw Error("type is read-only");},get:function(){return this._type}});g.prototype.addListener=function(a){this._listeners.push(a)};g.prototype.removeListener=function(a){Array.erase(this._listeners,a)};g.prototype._notifyChanged=function(){a(this,b.DATA_ENTRY_STATE.CHANGED_VALUE)};
var f=function(c,d){g.call(this,c);this._value=d;a(this,b.DATA_ENTRY_STATE.CHANGED_NEW)};d.createClass(f,g);f.prototype.setValue=function(a){this._setValue(a);d._flushResultCallbacks()};f.prototype._setValue=function(c){var d=this._value?this._value.length:0,e=c?c.length:0,f=this.getTupleSize(),d=(d>=2*f?2:d>=f?1:0)!=(e>=2*f?2:e>=f?1:0)?b.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE:d!=e?b.DATA_ENTRY_STATE.CHANGED_SIZE:b.DATA_ENTRY_STATE.CHANGED_VALUE;this._value=c;a(this,d)};f.prototype.getValue=function(){return this._value};
f.prototype.getLength=function(){return this._value?this._value.length:0};f.prototype.getTupleSize=function(){return b.DATA_TYPE_TUPLE_SIZE[this._type]};f.prototype.getIterateCount=function(){return this.getLength()/this.getTupleSize()};f.prototype.isEmpty=function(){return!this._value||!this.getLength()};var k,i;b.toImageData=function(a){if(a instanceof ImageData)return a;if(!a.data)throw Error("no data property");if(!a.width)throw Error("no width property");if(!a.height)throw Error("no height property");
i||(k=document.createElement("canvas"),i=k.getContext("2d"));for(var b=i.createImageData(a.width,a.height),c=0;c<a.data.length;++c){var d=a.data[c];255<d&&(d=255);0>d&&(d=0);b.data[c]=d}return b};Object.defineProperties(e.prototype,{imageData:{get:function(){if(this._source instanceof HTMLElement){var a=document.createElement("canvas");a.width=this._source.width;a.height=this._source.height;a=a.getContext("2d");a.drawImage(this._source,0,0);a=a.getImageData(0,0,this._source.width,this._source.height);
a.texelFormat=this._source.texelFormat;a.texelType=this._source.texelType;this._source=a}return this._source}},glTextureData:{get:function(){return this._source}},complete:{get:function(){return"undefined"===typeof this._source.complete?!0:this._source.complete}},width:{get:function(){return this._source?this._source.width:-1}},height:{get:function(){return this._source?this._source.height:-1}},texelFormat:{get:function(){return this._source?this._source.texelFormat:b.TEXTURE_FORMAT.UNKNOWN}},texelType:{get:function(){return this._source?
this._source.texelType:b.TEXTURE_TYPE.UNKNOWN}}});TextureEntry=function(d){g.call(this,b.DATA_TYPE.TEXTURE);this._samplerConfig=new c;this._loading=!1;this.setImage(d);a(this,b.DATA_ENTRY_STATE.CHANGED_NEW)};d.createClass(TextureEntry,g);Object.defineProperties(TextureEntry.prototype,{width:{get:function(){return this._source?this._source.width:-1}},height:{get:function(){return this._source?this._source.height:-1}},texelFormat:{get:function(){return this._source?this._source.texelFormat:b.TEXTURE_FORMAT.UNKNOWN}},
texelType:{get:function(){return this._source?this._source.texelType:b.TEXTURE_TYPE.UNKNOWN}}});TextureEntry.prototype.isLoading=function(){return!this._source?!1:!this._source.complete};TextureEntry.prototype._createImage=function(a,b,d,f,g){!this._source||this.width!=a||this.height!=b||this.format!=d||this.type!=f?(a=new e(a,b,d,f),g||(g=new c,g.setDefaults()),this._samplerConfig.set(g),this._setImage(a)):this._notifyChanged();return this._source};TextureEntry.prototype.setImage=function(a,b){this._setImage(a,
b);d._flushResultCallbacks()};TextureEntry.prototype._setImage=function(a,b){a?a instanceof e?this._setSource(a,b):this._setSource(new e(a),b):this._setSource(null,b)};TextureEntry.prototype._setSource=function(c,d){var e=this.isLoading();this._source=c;var f=this.isLoading();d&&!f&&!e?(a(this,b.DATA_ENTRY_STATE.LOAD_START),a(this,b.DATA_ENTRY_STATE.LOAD_END)):f?(this._loading=!0,a(this,b.DATA_ENTRY_STATE.LOAD_START)):this._loading?(this._loading=!1,a(this,b.DATA_ENTRY_STATE.LOAD_END)):a(this,b.DATA_ENTRY_STATE.CHANGED_VALUE)};
TextureEntry.prototype.asGLTextureValue=function(){return this._source&&this._source.glTextureData};TextureEntry.prototype.getValue=function(){return!this._source||this.isLoading()?null:this._source.imageData};TextureEntry.prototype.getSamplerConfig=function(){return this._samplerConfig};TextureEntry.prototype.getLength=function(){return 1};TextureEntry.prototype.isEmpty=function(){return!1};TextureEntry.prototype.getIterateCount=function(){return 1};var n=function(d){g.call(this,b.DATA_TYPE.TEXTURE);
this._samplerConfig=new c;this._imageData=null;this._texelFormat=b.TEXTURE_FORMAT.RGBA;this._texelType=b.TEXTURE_TYPE.UBYTE;this._updateImageData(d);a(this,b.DATA_ENTRY_STATE.CHANGED_NEW)};d.createClass(n,g);Object.defineProperties(n.prototype,{width:{get:function(){return this._imageData?this._imageData.width:-1}},height:{get:function(){return this._imageData?this._imageData.height:-1}},texelFormat:{get:function(){return this._texelFormat}},texelType:{get:function(){return this._texelType}}});n.prototype.isLoading=
function(){return!this._imageData};n.prototype._updateImageData=function(a){this._texelFormat=b.TEXTURE_FORMAT.RGBA;this._texelType=b.TEXTURE_TYPE.UBYTE;this._imageData=a};n.prototype._createImage=function(a,d,e,f,g){if(!this._imageData||this.getWidth()!=a||this.getHeight()!=d||this._format!=e||this._type!=f){if(!a||!d)throw Error("Width or height is not specified");this._texelFormat=e;this._texelType=f;g||(g=new c,g.setDefaults());this._samplerConfig.set(g);e={width:a,height:d,data:null};e.data=
f==b.TEXTURE_TYPE.FLOAT?new Float32Array(4*a*d):Uint8Array==Uint8ClampedArray?new Int16Array(4*a*d):new Uint8ClampedArray(4*a*d);this._imageData=e}this._notifyChanged()};n.prototype.setImageData=function(c){this._updateImageData(c);a(this,b.DATA_ENTRY_STATE.CHANGED_VALUE);d._flushResultCallbacks()};n.prototype.getWidth=function(){return this._imageData&&this._imageData.width||0};n.prototype.getHeight=function(){return this._imageData&&this._imageData.height||0};n.prototype.getValue=function(){return this._imageData};
n.prototype.getSamplerConfig=function(){return this._samplerConfig};n.prototype.getLength=function(){return 1};n.prototype.isEmpty=function(){return!1};n.prototype.getIterateCount=function(){return 1};var l={_listeners:[],addListener:function(a){this._listeners.push(a)},removeListener:function(a){Array.erase(this._listeners,a)}};j.exports={DataEntry:g,BufferEntry:f,TextureEntry:TextureEntry,ImageDataTextureEntry:n,SamplerConfig:c,DataChangeNotifier:l}},{"../../utils/array.js":127,"../base.js":135,
"./constants.js":136}],138:[function(h,j){function e(a,b){if(a._filterMapping&&!a._filterMapping.isEmpty())return a;if(!a._computeOperator){if(a._sourceNode&&0==a._children.length)return e(a._sourceNode);if(1==a._children.length&&a._children[0]instanceof p)return e(a._children[0])}var c=a._channelNode.getChildDataIndex(b);return-1!=c&&void 0!=c?a._sourceNode?e(a._sourceNode):e(a._children[c]):a}function a(b){var c=b._loading?b._loadLevel:Infinity,d;for(d=0;c&&d<b._children.length;++d){var e=b._children[d];
e instanceof p?c=Math.min(c,Math.max(e._loadLevel,e._progressLevel)):e._data&&e._data.isLoading&&e._data.isLoading()&&(c=Math.min(c,1))}c&&b._sourceNode&&(c=Math.min(c,Math.max(b._sourceNode._loadLevel,b._sourceNode._progressLevel)));c&&b._dataflowNode&&(c=Math.min(c,Math.max(b._dataflowNode._loadLevel,b._dataflowNode._progressLevel)));d=b._progressLevel;b._progressLevel=c;if(d!=b._progressLevel){b._callLoadListeners(b._progressLevel,d);for(d=0;d<b._parents.length;++d)a(b._parents[d])}}function d(a,
b){for(var c=0;c<a._parents.length;++c)a._parents[c].notify(b,a)}function b(a,b,c){a[b]&&a[b]._removeOwner(a);a[b]=c;a[b]&&a[b]._addOwner(a)}function c(a,b,c){var d=a[b];d&&Array.erase(d._parents,a);(a[b]=c)&&c._parents.push(a)}var g=h("./constants.js"),f=h("./../processing/mapping.js");h("../../utils/array.js");var k=h("../base.js"),i=h("../processing/channel-node.js").ChannelNode,n=h("../utils/utils.js"),l=function(){this._parents=[]},m=function(){this._parents=[];this._name="";this._key=0;this._paramName=
this._data=null;this._paramGlobal=!1;this._dataListener=this.onDataChange.bind(this)};k.createClass(m,l);m.prototype.onDataChange=function(a,b){var c;switch(b){case g.DATA_ENTRY_STATE.CHANGED_VALUE:c=g.RESULT_STATE.CHANGED_DATA_VALUE;break;case g.DATA_ENTRY_STATE.LOAD_START:c=g.RESULT_STATE.IMAGE_LOAD_START;break;case g.DATA_ENTRY_STATE.LOAD_END:c=g.RESULT_STATE.IMAGE_LOAD_END;break;case g.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE:c=g.RESULT_STATE.CHANGED_STRUCTURE;break;case g.DATA_ENTRY_STATE.CHANGED_SIZE:c=
g.RESULT_STATE.CHANGED_DATA_SIZE;break;default:c=g.RESULT_STATE.CHANGED_DATA_SIZE}d(this,c)};Object.defineProperty(m.prototype,"name",{set:function(a){this._name=a;d(this,g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()},get:function(){return this._name}});Object.defineProperty(m.prototype,"key",{set:function(a){this._key=a;d(this,g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()},get:function(){return this._key}});Object.defineProperty(m.prototype,"paramName",{set:function(a){this._paramName=
a;d(this,g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()},get:function(){return this._paramName}});Object.defineProperty(m.prototype,"paramGlobal",{set:function(a){this._paramGlobal=a;d(this,g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()},get:function(){return this._paramGlobal}});Object.defineProperty(m.prototype,"data",{set:function(a){var b=!1;this._data&&(b=this._data._loading,this._data.removeListener(this._dataListener));(this._data=a)&&this._data.addListener(this._dataListener);
b!=this._data._loading&&d(this,this._data._loading?g.RESULT_STATE.IMAGE_LOAD_START:g.RESULT_STATE.IMAGE_LOAD_END);k._flushResultCallbacks()},get:function(){return this._data}});m.prototype._getParamNames=function(){return this._paramGlobal?null:this._paramName};m.prototype._getGlobalParamNames=function(){return this._paramGlobal?this._paramName:null};var r=0,p=function(a){this._parents=[];this._loading=!1;this._loadLevel=0;this._progressLevel=Infinity;this.id=++r;this._isProtoNode=a;this._children=
[];this._userData=this._sourceNode=null;this._filterType=g.DATA_FILTER_TYPE.NONE;this._filterMapping=null;this._computeOperator="";this._computeUsesDataflow=!1;this._dataflowNode=this._computeOutputMapping=this._computeInputMapping=null;this._channelNode=new i(this);this._substitutionNodes={};this._platform=this._globalParamNames=this._paramNames=null;this._listeners=[];this._loadListeners=[]};k.createClass(p,l);Object.defineProperty(p.prototype,"sourceNode",{set:function(b){c(this,"_sourceNode",
b);a(this);this.notify(g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()},get:function(){return this._sourceNode}});Object.defineProperty(p.prototype,"dataflowNode",{set:function(b){if(b&&!this._computeUsesDataflow)throw Error("Cannot set dataflowNode when compute doesn't use dataflow.");c(this,"_dataflowNode",b);a(this);this.notify(g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()},get:function(){return this._dataflowNode}});Object.defineProperty(p.prototype,"userData",{set:function(a){this._userData=
a},get:function(){return this._userData}});p.prototype.setLoading=function(b){this._loading!=b&&(this._loading=b,a(this),k._flushResultCallbacks())};p.prototype.isSubtreeLoading=function(){return 0==this._progressLevel};p.prototype.getProgressLevel=function(){return this._progressLevel};Object.defineProperty(p.prototype,"filterType",{set:function(a){this._filterType=a;this.notify(g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()},get:function(){return this._filterType}});Object.defineProperty(p.prototype,
"filterMapping",{set:function(a){b(this,"_filterMapping",a);this.notify(g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()},get:function(){return this._filterMapping}});Object.defineProperty(p.prototype,"computeOperator",{set:function(a){this._computeOperator=a;this._computeUsesDataflow=!1;this.notify(g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()},get:function(){return this._computeUsesDataflow?null:this._computeOperator}});Object.defineProperty(p.prototype,"computeDataflowUrl",
{set:function(a){this._computeOperator=a;this._computeUsesDataflow=!0;this.notify(g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()},get:function(){return this._computeUsesDataflow?this._computeOperator:null}});Object.defineProperty(p.prototype,"computeInputMapping",{set:function(a){b(this,"_computeInputMapping",a);this.notify(g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()},get:function(){return this._computeInputMapping}});Object.defineProperty(p.prototype,"computeOutputMapping",
{set:function(a){b(this,"_computeOutputMapping",a);this.notify(g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()},get:function(){return this._computeOutputMapping}});p.prototype.isProtoNode=function(){return this._isProtoNode};p.prototype.appendChild=function(b){this._children.push(b);b._parents.push(this);a(this);this.notify(g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()};p.prototype.removeChild=function(b){Array.erase(this._children,b);Array.erase(b._parents,this);a(this);
this.notify(g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()};p.prototype.insertBefore=function(b,c){var d=this._children.indexOf(c);-1==d?this._children.push(b):this._children.splice(d,0,b);b._parents.push(this);a(this);this.notify(g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()};p.prototype.clearChildren=function(){for(var b=0;b<this._children.length;++b)Array.erase(this._children[b]._parents,this);this._children=[];a(this);this.notify(g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()};
p.prototype.detachFromParents=function(){for(var a=0;a<this._parents.length;++a){var b=this._parents[a];b._sourceNode==this?b.sourceNode=null:b._dataflowNode==this?b.dataflowNode=null:b.removeChild(this)}this._children=[]};p.prototype.setPlatform=function(a){"string"===typeof a?"cl"===a?this._platform=g.PLATFORM.CL:"gl"===a?this._platform=g.PLATFORM.GLSL:"js"===a&&(this._platform=g.PLATFORM.JAVASCRIPT):this._platform=!isNaN(parseFloat(a))&&isFinite(a)?a:null;this.notify(g.RESULT_STATE.CHANGED_STRUCTURE);
k._flushResultCallbacks()};var q=/^([A-Za-z\s]*)\(([^()]+)\)$/;p.prototype.setFilter=function(a){var a=a||"",c=g.DATA_FILTER_TYPE.RENAME,d=null;if(a){var e=a.trim().match(q);if(e){a=e[1].trim();switch(a){case "keep":c=g.DATA_FILTER_TYPE.KEEP;break;case "remove":c=g.DATA_FILTER_TYPE.REMOVE;break;case "rename":c=g.DATA_FILTER_TYPE.RENAME;break;default:k.notifyError("Unknown filter type:"+a,this)}d=f.Mapping.parse(e[2],this)}else k.notifyError("Could not parse filter '"+a+"'",this)}d||(d=new f.OrderMapping);
b(this,"_filterMapping",d);this._filterType=c;this.notify(g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()};var o=/^(([^=]+)\=)?([^'(]+('[^']+')?[^'(]+)(\(([^()]*)?\))?$/,s=/^\(([^()]*)\)$/,u=/^dataflow\['([^']+)'\]$/;p.prototype.setCompute=function(a){var a=a||"",c="",d=null,e=null,h=a.trim().match(o);if(h){var a=h[2]?h[2].trim():"",c=h[3].trim(),i=h[6]?h[6].trim():"";if(h=a.match(s))a=h[1];i&&(d=f.Mapping.parse(i,this));a&&(e=f.Mapping.parse(a,this));(h=c.match(u))?(this._computeUsesDataflow=
!0,c=h[1]):this._computeUsesDataflow=!1;this._dataflowNode=null}else a&&k.notifyError("Error parsing Compute value '"+a+"'",this);b(this,"_computeInputMapping",d);b(this,"_computeOutputMapping",e);this._computeOperator=c;this.notify(g.RESULT_STATE.CHANGED_STRUCTURE);k._flushResultCallbacks()};p.prototype.notify=function(b,c){switch(b){case g.RESULT_STATE.CHANGED_STRUCTURE:this._globalParamNames=this._paramNames=null;this._channelNode.setStructureOutOfSync();for(var e in this._substitutionNodes)this._substitutionNodes[e].clear();
this._substitutionNodes={};d(this,b);break;case g.RESULT_STATE.IMAGE_LOAD_START:case g.RESULT_STATE.IMAGE_LOAD_END:a(this);c&&this._channelNode.notifyDataChange(c,b);break;case g.RESULT_STATE.CHANGED_DATA_VALUE:case g.RESULT_STATE.CHANGED_DATA_SIZE:c&&this._channelNode.notifyDataChange(c,b)}for(e=0;e<this._listeners.length;++e)this._listeners[e](b)};p.prototype.addListener=function(a){this._listeners.push(a)};p.prototype.removeListener=function(a){Array.erase(this._listeners,a)};p.prototype.addLoadListener=
function(a){this._loadListeners.push(a)};p.prototype.removeLoadListener=function(a){Array.erase(this._loadListeners,a)};p.prototype._callLoadListeners=function(a,b){for(var c=this._loadListeners.length,d=0;d<c;++d)this._loadListeners[d](this,a,b)};p.prototype.getOutputNames=function(){return e(this)._channelNode.getOutputNames()};p.prototype.getOutputChannelInfo=function(a){return e(this)._channelNode.getOutputChannelInfo(a)};p.prototype.getParamNames=function(){return this._getParamNames()};p.prototype._getResult=
function(a,b){return e(this,b)._channelNode.getResult(a,b)};p.prototype._getForwardNode=function(a){return e(this,a)};p.prototype._getParamNames=function(){if(!this._paramNames)if(this._paramNames=[],this._sourceNode)n.nameset.add(this._paramNames,this._sourceNode._getParamNames());else for(var a=0;a<this._children.length;++a)n.nameset.add(this._paramNames,this._children[a]._getParamNames());return this._paramNames};p.prototype._getGlobalParamNames=function(){if(!this._globalParamNames)if(this._globalParamNames=
[],this._dataflowNode&&n.nameset.add(this._globalParamNames,this._dataflowNode._getGlobalParamNames()),this._sourceNode)n.nameset.add(this._globalParamNames,this._sourceNode._getGlobalParamNames());else for(var a=0;a<this._children.length;++a)n.nameset.add(this._globalParamNames,this._children[a]._getGlobalParamNames());return this._globalParamNames};p.prototype._getOrCreateChannelNode=function(a){if(a){var b=a.getKey(this);this._substitutionNodes[b]?this._substitutionNodes[b].increaseRef():this._substitutionNodes[b]=
new i(this,a);return this._substitutionNodes[b]}return this._channelNode};p.prototype._removeSubstitutionNode=function(a){a=a.substitution.getKey(this);this._substitutionNodes[a]&&this._substitutionNodes[a].decreaseRef()&&delete this._substitutionNodes[a]};j.exports={InputNode:m,DataNode:p,getComputeDataflowUrl:function(a){return(a=(a||"").trim().match(o))&&(a=a[3].trim().match(u))?a[1]:null}}},{"../../utils/array.js":127,"../base.js":135,"../processing/channel-node.js":179,"../utils/utils.js":187,
"./../processing/mapping.js":183,"./constants.js":136}],139:[function(h,j){function e(a,b){a._result&&a._result._removeRequest(a);(a._result=b)&&b._addRequest(a);return b}function a(a,b,d){var a=a._getForwardNode(d),d=a.id+"|"+b.getKey(),e;(e=n[d])?k[e.id]++:(e=new c(!1),e.appendChild(a),e.computeOperator=b.getOperator(),e.computeInputMapping=null,e.computeOutputMapping=null,n[d]=e,k[e.id]=1,i[e.id]=d);return e}var d=h("../base.js"),b=h("./constants.js"),c=h("./graph.js").DataNode,g=function(a,b,
c){this._dataNode=a;this._filter=b?b.slice().sort():null;this._listener=c;this._result=null;this._dataNodeListener=this._onDataNodeChange.bind(this);this._dataNode.addListener(this._dataNodeListener)};Object.defineProperty(g.prototype,"dataNode",{set:function(){throw Error("dataNode is readonly");},get:function(){return this._dataNode}});Object.defineProperty(g.prototype,"filter",{set:function(){throw Error("filter is read-only");},get:function(){return this._filter}});g.prototype.clear=function(){this._listener=
null;this._result&&this._result._removeRequest(this);this._dataNode.removeListener(this._dataNodeListener)};g.prototype._onPostponedResultChanged=function(a){this._listener&&this._listener(this,a)};g.prototype._onDataNodeChange=function(a){d._queueResultCallback(this,a)};var f=function(a,b,c){g.call(this,a,b,c)};d.createClass(f,g);f.prototype.getResult=function(){return e(this,this._dataNode._getResult(b.RESULT_TYPE.COMPUTE,this._filter))};f.prototype._onResultChanged=function(a){this._onDataNodeChange(a)};
var k={},i={},n={},l=function(b,c,d){var e=c.getFilter();if(0==e.length)throw Error("vsConfig requires at least one attribute entry.");g.call(this,b,e,d);this._vsConfig=c;this._vsConnectNode=a(b,c)};d.createClass(l,g);l.prototype.getConfig=function(){return this._vsConfig};l.prototype.getResult=function(){return e(this,this._vsConnectNode._getResult(b.RESULT_TYPE.VS,this._filter))};l.prototype._onDataNodeChange=function(c){if(c==b.RESULT_STATE.CHANGED_STRUCTURE){var d=a(this._dataNode,this._vsConfig,
this._filter);if(d!=this._vsConnectNode){var e=this._vsConnectNode;k[e.id]--;k[e.id]||(n[i[e.id]]=null,e.clearChildren());this._vsConnectNode=d}}g.prototype._onDataNodeChange.call(this,c)};l.prototype.getVertexShader=function(){this.getResult();this._vertexShader||(this._vertexShader=this._result.getVertexShader(this._vsConfig));return this._vertexShader};l.prototype._onResultChanged=function(a,b){this._onDataNodeChange(b)};j.exports={ComputeRequest:f,VertexShaderRequest:l}},{"../base.js":135,"./constants.js":136,
"./graph.js":138}],140:[function(h,j){function e(a,b,c,d,e,f){this.program=a;this.cl=a.cl;this.name=b;this.type=d||null;this.isInput=!!f;this.hasMemObject=this.needsMemObject=!1;this.clFunctionParam=this.arg=this.memObjectSize=this.byteSize=null;this.xflowType=c;this.helperMap=null;this.helpers=[];this.entryValue=e||null;this.val=null;this.prepareParam();this.initHelperParams();this.initKernelArg();this.updateValue(this.entryValue)}function a(a,b,c,d,f,g){var h=f?f.getValue():null,f=b?c.kernelParamMap.inputs:
c.kernelParamMap.outputs;f[g]?f[g].updateValue(h):(f[g]=new e(c,a.name,a.type,null,h,b),d.push(f[g].clFunctionParam),f[g].helpers.forEach(function(a){d.push(a.clFunctionParam)}))}function d(a){var c=a.cl,d=c.kernelManager,e=c.cmdQueue,f={inputs:[],outputs:[]},h=b(a.kernelParamMap,f),i=g(a.kernelParamMap.inputs[0]),j=a.kernelProgram;return function(){var a,b,c,g,l=f.inputs,k=f.outputs;if(!j)return!1;g=h.map(function(a){return a.arg});d.setArgs.apply(null,[j].concat(g));try{b=l.length;for(a=0;a<b;a++)c=
l[a],e.enqueueWriteBuffer(c.arg,!1,0,c.memObjectSize,c.val,[]);e.enqueueNDRangeKernel(j,i[1].length,[],i[1],i[0]);b=k.length;for(a=0;a<b;a++)c=k[a],e.enqueueReadBuffer(c.arg,!1,0,c.memObjectSize,c.val,[]);e.finish()}catch(m){return!1}return!0}}function b(a,b){var d=a.inputs,e=[];a.outputs.forEach(function(a){c(a,e,b.outputs)});d.forEach(function(a){c(a,e,b.inputs)});return e}function c(a,b,c){b.push(a);a.hasMemObject&&(c.push(a),a.helpers.forEach(function(a){b.push(a)}))}function g(a){var b;b=a.entryValue;
if(a.xflowType===f.DATA_TYPE.TEXTURE)a=[16,4],b=[Math.ceil(b.width/a[0])*a[0],Math.ceil(b.height/a[1])*a[1]];else{var c=1;switch(a.xflowType){case f.DATA_TYPE.INT4:case f.DATA_TYPE.FLOAT4:c=4;break;case f.DATA_TYPE.FLOAT3:c=3;break;case f.DATA_TYPE.FLOAT4X4:c=16}a=[16];b=[Math.ceil(b.length/(a[0]*c))*a[0]]}return[a,b]}var f=h("../interface/constants.js"),k=function(a){if(this.cl=XML3D.webcl.cl)this.list=a,this.entry=a.entries[0],this.operator=this.entry.operator,this.kernelParamMap={inputs:[],outputs:[]},
this.kernelFunctionParams=[],this.mainProgram=this.kernelProgram=this.kernelCode=null},i={type:"uint",params:["width","height"]},n={type:"uint",params:["length"]};e.prototype={prepareParam:function(){var a,b=f.DATA_TYPE,c=[],d="",e="";if(!this.type){switch(this.xflowType){case b.TEXTURE:a=i;this.type="uchar4*";d="__global";this.needsMemObject=!0;break;case b.INT:this.type="int";break;case b.INT4:a=n;this.type="int4*";d="__global";this.needsMemObject=!0;break;case b.FLOAT:this.type="float";break;case b.FLOAT2:a=
n;this.type="float2*";d="__global";this.needsMemObject=!0;break;case b.FLOAT3:a=n;this.type="float*";d="__global";this.needsMemObject=!0;break;case b.FLOAT4:a=n;this.type="float4*";d="__global";this.needsMemObject=!0;break;case b.FLOAT4X4:a=n;this.type="float16*";d="__global";this.needsMemObject=!0;break;default:return}this.helperMap=a}d&&c.push(d);this.isInput&&(e="const");e&&c.push(e);c.push(this.type);c.push(this.name);this.clFunctionParam=c.join(" ")},initHelperParams:function(){var a,b=this,
c=this.helperMap;c&&this.isInput&&c.params.forEach(function(d){var g=b.name+"_"+d;if("width"===d)a=b.entryValue.width;else if("height"===d)a=b.entryValue.height;else if("length"===d)switch(a=b.entryValue.length,b.xflowType){case f.DATA_TYPE.FLOAT2:a/=2;break;case f.DATA_TYPE.FLOAT3:a/=3;break;case f.DATA_TYPE.FLOAT4:case f.DATA_TYPE.INT4:a/=4;break;case f.DATA_TYPE.FLOAT4X4:a/=16}b.helpers.push(new e(b.program,g,null,c.type,new Uint32Array([a])))})},initKernelArg:function(){this.needsMemObject?this.allocateMemObject():
this.arg=this.entryValue},allocateMemObject:function(){var a=this.cl.API,b=this.cl.ctx,c=this.type,d=parseInt(c.substring(c.length-2,c.length-1),10),c=this.isInput?"r":"w",e=this.entryValue;this.hasMemObject&&this.arg.release();this.byteSize=isNaN(d)?1:d;if(this.xflowType===f.DATA_TYPE.TEXTURE)d*=e.width*e.height,this.byteSize=4;else switch(this.xflowType){case f.DATA_TYPE.INT4:d=e.length*Int32Array.BYTES_PER_ELEMENT;break;case f.DATA_TYPE.FLOAT2:case f.DATA_TYPE.FLOAT3:case f.DATA_TYPE.FLOAT4:case f.DATA_TYPE.FLOAT4x4:d=
e.length*Float32Array.BYTES_PER_ELEMENT;break;default:d=4*e.length}a=a.createBuffer(d,c,b);this.memObjectSize=d;this.arg=a;this.hasMemObject=!0;this.needsMemObject=!1},updateValue:function(a){this.hasMemObject?(this.val=void 0===a.data?a:a.data,this.entryValue=a,this.checkEntrySize()):this.arg=this.entryValue=a},updateHelpers:function(){var a=this;this.helpers.forEach(function(b){var c=b.name;-1!==c.indexOf("width")?b.updateValue(new Uint32Array([a.entryValue.width])):-1!==c.indexOf("height")?b.updateValue(new Uint32Array([a.entryValue.height])):
-1!==c.indexOf("length")&&(c=a.entryValue.length,a.xflowType===f.DATA_TYPE.FLOAT4||a.xflowType===f.DATA_TYPE.INT4?c/=4:a.xflowType===f.DATA_TYPE.FLOAT4X4&&(c/=16),b.updateValue(new Uint32Array([c])))})},checkEntrySize:function(){var a=this.entryValue;if(this.memObjectSize!==(this.xflowType===f.DATA_TYPE.TEXTURE?a.width*a.height*this.byteSize:this.xflowType===f.DATA_TYPE.FLOAT2||this.xflowType===f.DATA_TYPE.FLOAT3||this.xflowType===f.DATA_TYPE.FLOAT4||this.xflowType===f.DATA_TYPE.FLOAT4X4?a.length*
Float32Array.BYTES_PER_ELEMENT:this.xflowType===f.DATA_TYPE.INT4?a.length*Int32Array.BYTES_PER_ELEMENT:a.length*this.byteSize))this.allocateMemObject(),this.updateHelpers(),this.program.mainProgram=null}};k.prototype.run=function(b){var c=this.list,e,f,g=b.operatorData[0],h=c.entries[0],i=h.operator.mapping;g.iterFlag={};for(f=0;f<i.length;++f)e=h.isTransferInput(f)||c.isInputIterate(h.getDirectInputIndex(f)),g.iterFlag[f]=e;g.iterateCount=c.getIterateCount(b);if(this.operator.evaluate&&this.operator.evaluate instanceof
Array){c=this.entry;e=this.kernelFunctionParams;i=this.operator.outputs;for(h=e.length=0;h<i.length;++h)f=i[h],g=b.outputs[c.getOutputIndex(h)].dataEntry,a(f,!!f.source,this,e,g,h);i=c.operator.mapping;for(h=0;h<i.length;++h)f=i[h],g=b.getDataEntry(c.getDirectInputIndex(h)),a(f,!!f.source,this,e,g,h);if(null===this.kernelCode)a:if(b=this.cl.kernelManager,e=this.operator.evaluate,c=this.kernelName=this.operator.name.split("xflow.")[1],e){f=[];f.push("__kernel void");f.push(c+"(");f.push(this.kernelFunctionParams.join(", "));
f.push(")");(f=f.join(" "))?(f+="{\n",g=[],h=this.kernelParamMap.inputs[0],"uchar4*"===h.type?(g.push("int x = get_global_id(0);"),g.push("int y = get_global_id(1);"),g.push("if (x >= "+h.name+"_width || y >= "+h.name+"_height) return;"),g.push("int "+h.name+"_i = y * "+h.name+"_width + x;")):(g.push("int "+h.name+"_i = get_global_id(0);"),g.push("if ("+h.name+"_i >= "+h.name+"_length) return;")),g=g.join("\n"))?(f=f+g+e.join("\n"),e=f+"\n}"):e=!1:e=!1;e=this.kernelCode=e;try{b.register(c,e)}catch(j){break a}this.kernelProgram=
b.getKernel(this.kernelName)}null===this.mainProgram&&(this.mainProgram=d(this));this.mainProgram()}};j.exports=k},{"../interface/constants.js":136}],141:[function(){Xflow.registerOperator("xflow.add",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value1"},{type:"float3",source:"value2"}],evaluate:function(){throw Error("Not used!");},evaluate_core:function(h,j,e){h[0]=j[0]+e[0];h[1]=j[1]+e[1];h[2]=j[2]+e[2]}})},{}],142:[function(){Xflow.registerOperator("xflow.bufferSelect",
{outputs:[{type:"float3",name:"result",noAlloc:!0}],params:[{type:"float3",source:"trueOption",array:!0},{type:"float3",source:"falseOption",array:!0},{type:"bool",source:"value",array:!0}],evaluate:function(h,j,e,a){h.assign=a[0]?e:j;return!0}})},{}],143:[function(){Xflow.registerOperator("xflow.clampImage",{outputs:[{type:"texture",name:"result",sizeof:"image",formatType:"ImageData"}],params:[{type:"texture",source:"image"},{type:"float",source:"min"},{type:"float",source:"max"}],evaluate:function(h,
j,e,a){for(var d=j.data,h=h.data,e=e[0],a=a[0],j=j.data.length,b=0;b<j;b++){var c=d[b];c<e&&(c=e);c>a&&(c=a);h[b]=c}return!0}})},{}],144:[function(){(function(){function h(h,e,a,d){for(var b=Math.round(Math.sqrt(a.length)),c=Math.floor(b/2),g=h.data,f=h.width,h=h.height,k=e.data,d=d?1:0,i=0;i<h;i++)for(var n=0;n<f;n++){for(var l=i,m=n,r=4*(i*f+n),p=0,q=0,o=0,s=0,u=0;u<b;u++)for(var t=0;t<b;t++){var v=l+u-c,w=m+t-c;0<=v&&v<h&&0<=w&&w<f&&(v=4*(v*f+w),w=a[u*b+t],p+=g[v]*w,q+=g[v+1]*w,o+=g[v+2]*w,s+=
g[v+3]*w)}k[r]=p;k[r+1]=q;k[r+2]=o;k[r+3]=s+d*(255-s)}return e}Xflow.registerOperator("xflow.convoluteImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"},{type:"float",source:"kernel"}],evaluate:function(j,e,a){h(e,j,a,!0);return!0}});Xflow.registerOperator("xflow.convoluteImageToFloat",{outputs:[{type:"texture",name:"result",sizeof:"image",formatType:"float32"}],params:[{type:"texture",source:"image"},{type:"float",source:"kernel"}],evaluate:function(j,
e,a){h(e,j,a,!0);return!0}})})()},{}],145:[function(){Xflow.registerOperator("xflow.createIGIndex",{outputs:[{type:"float2",name:"texcoord",customAlloc:!0}],params:[{type:"int",source:"vertexCount",optional:!1},{type:"texture",source:"positionTex",optional:!1}],alloc:function(h,j,e){h.texcoord=e.width*e.height},evaluate:function(h,j,e){for(var j=0.5/e.width,a=0.5/e.height,d=0,b=0,c=e.height;b<c;b++)for(var g=0,f=e.width;g<f;g++)h[d++]=g/f+j,h[d++]=1-(b/c+a);return!0}})},{}],146:[function(){Xflow.registerOperator("xflow.createTransform",
{outputs:[{type:"float4x4",name:"result"}],params:[{type:"float3",source:"translation",optional:!0},{type:"float4",source:"rotation",optional:!0},{type:"float3",source:"scale",optional:!0},{type:"float3",source:"center",optional:!0},{type:"float4",source:"scaleOrientation",optional:!0}],evaluate:function(h,j,e,a,d,b,c){for(var g=0;g<c.iterateCount;g++)XML3D.math.mat4.makeTransformXflow(j?j.subarray(c.iterFlag[0]?3*g:0):null,e?e.subarray(c.iterFlag[1]?4*g:0):null,a?a.subarray(c.iterFlag[2]?3*g:0):
null,d?d.subarray(c.iterFlag[3]?3*g:0):null,b?b.subarray(c.iterFlag[4]?4*g:0):null,h.subarray(16*g));return!0}})},{}],147:[function(){Xflow.registerOperator("xflow.createTransformInv",{outputs:[{type:"float4x4",name:"result"}],params:[{type:"float3",source:"translation",optional:!0},{type:"float4",source:"rotation",optional:!0},{type:"float3",source:"scale",optional:!0},{type:"float3",source:"center",optional:!0},{type:"float4",source:"scaleOrientation",optional:!0}],evaluate:function(h,j,e,a,d,b,
c){for(var g=0;g<c.iterateCount;g++)XML3D.math.mat4.makeTransformInvXflow(j?j.subarray(c.iterFlag[0]?3*g:0):null,e?e.subarray(c.iterFlag[1]?4*g:0):null,a?a.subarray(c.iterFlag[2]?3*g:0):null,d?d.subarray(c.iterFlag[3]?3*g:0):null,b?b.subarray(c.iterFlag[4]?4*g:0):null,h.subarray(16*g))}})},{}],148:[function(){(function(){var h=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,-1],[-1,-1,1],[-1,1,-1],[-1,1,1],[-1,-1,-1],[1,-1,-1],[-1,-1,1],[1,-1,1],[1,-1,-1],[1,1,-1],[1,-1,1],[1,1,1],[-1,1,-1],[1,1,
-1],[-1,1,1],[1,1,1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],j=[[0,0,-1],[0,0,-1],[0,0,-1],[0,0,-1],[-1,0,0],[-1,0,0],[-1,0,0],[-1,0,0],[0,-1,0],[0,-1,0],[0,-1,0],[0,-1,0],[1,0,0],[1,0,0],[1,0,0],[1,0,0],[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],e=[[0,1,2,1,2,3],[4,5,6,5,6,7],[8,9,10,9,10,11],[12,13,14,13,14,15],[16,17,18,17,18,19],[20,21,22,21,22,23]];Xflow.registerOperator("xflow.debug.createSkinCubes",{outputs:[{type:"int",name:"index",customAlloc:!0},{type:"float3",name:"position",
customAlloc:!0},{type:"float3",name:"normal",customAlloc:!0},{type:"int4",name:"boneIndices",customAlloc:!0},{type:"float4",name:"boneWeights",customAlloc:!0}],params:[{type:"float4x4",source:"bindTransforms",array:!0},{type:"float",source:"size",array:!0,optional:!0}],alloc:function(a,d){var b=d.length/16;a.position=24*b;a.normal=24*b;a.boneIndices=24*b;a.boneWeights=24*b;a.index=36*b},evaluate:function(a,d,b,c,g,f,k){for(var i=f.length/16,k=(k&&k[0]||1)/2,n=XML3D.math.vec3.create(),l=XML3D.math.vec3.create(),
m=0;m<i;++m)for(var r=0;6>r;++r){for(var p=0;4>p;p++){var q=4*r+p,o=24*m+q;XML3D.math.vec3.copy(n,h[q]);XML3D.math.vec3.scale(n,n,k);XML3D.math.mat4.multiplyOffsetVec3(f,16*m,n,0);XML3D.math.vec3.copy(l,j[q]);XML3D.math.mat4.multiplyOffsetDirection(f,16*m,l,0);d[3*o+0]=n[0];d[3*o+1]=n[1];d[3*o+2]=n[2];b[3*o+0]=l[0];b[3*o+1]=l[1];b[3*o+2]=l[2];c[4*o+0]=m;c[4*o+1]=c[4*o+2]=c[4*o+3]=0;g[4*o+0]=1;g[4*o+1]=g[4*o+2]=g[4*o+3]=0}q=36*m+6*r;for(p=0;6>p;++p)a[q+p]=24*m+e[r][p]}}})})()},{}],149:[function(){Xflow.registerOperator("xflow.flipNormal",
{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value"}],evaluate:function(h,j,e){for(var a=0;a<3*e.iterateCount;a++)h[a]=-j[a]}})},{}],150:[function(){Xflow.registerOperator("xflow.flipVerticalImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(h,j){for(var e=j.width,a=j.height,d=h.data,b=j.data,c=0;c<a;++c)for(var g=0;g<e;++g){var f=c*e,k=4*(f+g),f=4*(f+(e-1-g));d[f]=b[k];d[f+1]=b[k+1];d[f+2]=b[k+2];d[f+
3]=b[k+3]}return!0}})},{}],151:[function(){Xflow.registerOperator("xflow.forwardKinematics",{outputs:[{type:"float4x4",name:"result",customAlloc:!0}],params:[{type:"int",source:"parent",array:!0},{type:"float4x4",source:"xform",array:!0}],alloc:function(h,j,e){j=Math.min(j.length,e.length/16);h.result=j},evaluate:function(h,j,e){for(var a=h.length/16,d=[],b=0;b<a;){if(!d[b]){var c=j[b];if(0<=c)if(d[c])XML3D.math.mat4.multiplyOffset(h,16*b,e,16*b,h,16*c);else{for(;0<=j[c]&&!d[j[c]];)c=j[c];if(0<=j[c])XML3D.math.mat4.multiplyOffset(h,
16*c,e,16*c,h,16*j[c]);else for(var g=0;16>g;g++)h[16*c+g]=e[16*c+g];d[c]=!0;continue}else for(g=0;16>g;g++)h[16*b+g]=e[16*b+g];d[b]=!0}b++}}})},{}],152:[function(){Xflow.registerOperator("xflow.forwardKinematicsInv",{outputs:[{type:"float4x4",name:"result",customAlloc:!0}],params:[{type:"int",source:"parent",array:!0},{type:"float4x4",source:"xform",array:!0}],alloc:function(h,j,e){j=Math.min(j.length,e.length/16);h.result=j},evaluate:function(h,j,e){for(var a=e.length/16,d=[],b=0;b<a;){if(!d[b]){var c=
j[b];if(0<=c)if(d[c])XML3D.math.mat4.multiplyOffset(h,16*b,h,16*c,e,16*b);else{for(;0<=j[c]&&!d[j[c]];)c=j[c];if(0<=j[c])XML3D.math.mat4.multiplyOffset(h,16*c,h,16*j[c],e,16*c);else for(var g=0;16>g;g++)h[16*c+g]=e[16*c+g];d[c]=!0;continue}else for(g=0;16>g;g++)h[16*b+g]=e[16*b+g];d[b]=!0}b++}}})},{}],153:[function(){Xflow.registerOperator("xflow.funMirrorImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"},{type:"float",source:"time"}],evaluate:function(h,
j,e){for(var a=h.width,d=h.height,e=e[0],j=j.data,h=h.data,b=0;b<d;++b)for(var c=0;c<a;++c){var g=c/a,f=b/d,g=2*g-1,k=2*f-1,f=Math.sqrt(g*g+k*k),k=Math.atan2(k,g),f=Math.pow(f,1/1.8)*e,g=f*Math.cos(k),k=f*Math.sin(k),g=g/2+0.5,f=k/2+0.5,g=Math.round(g*a),g=4*(Math.round(f*d)*a+g),f=j[g],k=j[g+1],i=j[g+2],n=j[g+3],g=4*(b*a+c);h[g]=f;h[g+1]=k;h[g+2]=i;h[g+3]=n}return!0}})},{}],154:[function(){function h(h,e,a,d){for(var b=0;b<a.length;++b)for(var c=a[b]*d,g=d;g--;)h[b*d+g]=e[c+g]}Xflow.registerOperator("xflow.get",
{outputs:[{type:"float",name:"result"}],params:[{type:"float",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(j,e,a){h(j,e,a,1)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"float2",name:"result"}],params:[{type:"float2",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(j,e,a){h(j,e,a,2)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(j,
e,a){h(j,e,a,4)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"float4",name:"result"}],params:[{type:"float4",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(j,e,a){h(j,e,a,4)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"float4x4",name:"result"}],params:[{type:"float4x4",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(j,e,a){h(j,e,a,16)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"int",name:"result"}],params:[{type:"int",
source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(j,e,a){h(j,e,a,1)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"bool",name:"result"}],params:[{type:"bool",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(j,e,a){h(j,e,a,1)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"byte",name:"result"}],params:[{type:"byte",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(j,e,a){h(j,e,a,1)}});Xflow.registerOperator("xflow.get",
{outputs:[{type:"ubyte",name:"result"}],params:[{type:"ubyte",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(j,e,a){h(j,e,a,1)}})},{}],155:[function(){Xflow.registerOperator("xflow.grayscaleImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(h,j){for(var e=j.data,a=h.data,d=0;d<e.length;d+=4){var b=e[d+3];a[d]=a[d+1]=a[d+2]=0.2126*e[d]+0.7152*e[d+1]+0.0722*e[d+2];a[d+3]=b}return!0}})},{}],156:[function(h){h("./add.js");
h("./bufferSelect.js");h("./clampImage.js");h("./convoluteImage.js");h("./createIGIndex.js");h("./createTransform.js");h("./createTransformInv.js");h("./debug.js");h("./flipNormal.js");h("./flipVerticalImage.js");h("./forwardKinematics.js");h("./forwardKinematicsInv.js");h("./funMirrorImage.js");h("./get.js");h("./grayscaleImage.js");h("./lerp3seq.js");h("./magnitudeImage.js");h("./merge3.js");h("./morph3.js");h("./mul4x4.js");h("./noiseImage.js");h("./normalize3.js");h("./popartImage.js");h("./rgbePNGtoFloat.js");
h("./selectBool.js");h("./selectTransform.js");h("./sepiaImage.js");h("./skinDirection.js");h("./skinPosition.js");h("./slerpseq.js");h("./sobelImage.js");h("./sub3.js")},{"./add.js":141,"./bufferSelect.js":142,"./clampImage.js":143,"./convoluteImage.js":144,"./createIGIndex.js":145,"./createTransform.js":146,"./createTransformInv.js":147,"./debug.js":148,"./flipNormal.js":149,"./flipVerticalImage.js":150,"./forwardKinematics.js":151,"./forwardKinematicsInv.js":152,"./funMirrorImage.js":153,"./get.js":154,
"./grayscaleImage.js":155,"./lerp3seq.js":157,"./magnitudeImage.js":158,"./merge3.js":159,"./morph3.js":160,"./mul4x4.js":161,"./noiseImage.js":162,"./normalize3.js":163,"./popartImage.js":164,"./rgbePNGtoFloat.js":165,"./selectBool.js":166,"./selectTransform.js":167,"./sepiaImage.js":168,"./skinDirection.js":169,"./skinPosition.js":170,"./slerpseq.js":171,"./sobelImage.js":172,"./sub3.js":173}],157:[function(h){var j=h("../../utils/utils").binarySearch,h=h("../../interface/constants.js");Xflow.registerOperator("xflow.lerpSeq",
{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"sequence"},{type:"float",source:"key"}],mapping:[{name:"value1",source:"sequence",sequence:h.SEQUENCE.PREV_BUFFER,keySource:"key"},{name:"value2",source:"sequence",sequence:h.SEQUENCE.NEXT_BUFFER,keySource:"key"},{name:"weight",source:"sequence",sequence:h.SEQUENCE.LINEAR_WEIGHT,keySource:"key"}],evaluate_core:function(e,a,d,b){var c=1-b[0];e[0]=c*a[0]+b[0]*d[0];e[1]=c*a[1]+b[0]*d[1];e[2]=c*a[2]+b[0]*d[2]}});Xflow.registerOperator("xflow.lerpSeqAsync",
{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"sequence"},{type:"float",source:"key"}],mapping:[{name:"value1",source:"sequence",sequence:h.SEQUENCE.PREV_BUFFER,keySource:"key"},{name:"value2",source:"sequence",sequence:h.SEQUENCE.NEXT_BUFFER,keySource:"key"},{name:"weight",source:"sequence",sequence:h.SEQUENCE.LINEAR_WEIGHT,keySource:"key"}],evaluate_async:function(e,a,d,b,c,g){for(var f=c.iterateCount,h,i,j;f--;){h=3*(c.iterFlag[0]?f:0);i=3*(c.iterFlag[1]?f:0);j=c.iterFlag[2]?
f:0;var l=1-b[j];e[3*f]=l*a[h]+b[j]*d[i];e[3*f+1]=l*a[h+1]+b[j]*d[i+1];e[3*f+2]=l*a[h+2]+b[j]*d[i+2]}window.setTimeout(g,200)}});Xflow.registerOperator("xflow.lerpKeys",{outputs:[{type:"float3",name:"result"}],params:[{type:"float",source:"keys",array:!0},{type:"float3",source:"values",array:!0},{type:"float",source:"key"}],alloc:function(e){e.result=3},evaluate:function(e,a,d,b){var c=Math.min(a.length,Math.floor(d.length/3)),g=j(a,b[0],c);0>g||g==c-1?(g=Math.max(0,g),e[0]=d[3*g],e[1]=d[3*g+1],e[2]=
d[3*g+2]):(a=(b[0]-a[g])/(a[g+1]-a[g]),b=1-a,e[0]=b*d[3*g]+a*d[3*g+3],e[1]=b*d[3*g+1]+a*d[3*g+4],e[2]=b*d[3*g+2]+a*d[3*g+5])}})},{"../../interface/constants.js":136,"../../utils/utils":187}],158:[function(){Xflow.registerOperator("xflow.magnitudeImage",{outputs:[{type:"texture",name:"result",sizeof:"image1"}],params:[{type:"texture",source:"image1"},{type:"texture",source:"image2"}],evaluate:function(h,j,e){for(var j=j.data,e=e.data,h=h.data,a=j.length,d=0;d<a;d+=1){var b=j[d],c=e[d];h[d]=Math.sqrt(b*
b+c*c)}return!0}})},{}],159:[function(){Xflow.registerOperator("xflow.merge3",{outputs:[{name:"result",tupleSize:"16"}],params:["value1","value2","value3"],evaluate:function(h,j,e){if(!h||!j||!e)throw"Xflow::morph3: Not all parameters are set";var a=h.length+j.length+e.length;if(!this.tmp||this.tmp.length!=a)this.tmp=new Float32Array(a);this.tmp.set(h);this.tmp.set(j,h.length);this.tmp.set(e,h.length+j.length);this.result.result=this.tmp;return!0}});Xflow.registerOperator("xflow.merge8",{outputs:[{name:"result",
tupleSize:"16"}],params:"value1,value2,value3,value4,value5,value6,value7,value8".split(","),evaluate:function(h,j,e,a,d,b,c,g){if(!h||!j||!e||!a||!d||!b||!c||!g)throw"Xflow::morph3: Not all parameters are set";var f=h.length+j.length+e.length+a.length+d.length+b.length+c.length+g.length;if(!this.tmp||this.tmp.length!=f)this.tmp=new Float32Array(f);f=0;this.tmp.set(h,f);this.tmp.set(j,f+=h.length);this.tmp.set(e,f+=j.length);this.tmp.set(a,f+=e.length);this.tmp.set(d,f+=a.length);this.tmp.set(b,f+=
d.length);this.tmp.set(c,f+=b.length);this.tmp.set(g,f+c.length);this.result.result=this.tmp;return!0}})},{}],160:[function(){Xflow.registerOperator("xflow.morph",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value"},{type:"float3",source:"valueAdd"},{type:"float",source:"weight"}],evaluate:function(h,j,e,a,d){for(var b=0;b<d.iterateCount;b++){var c=a[d.iterFlag[2]?b:0];h[3*b]=j[d.iterFlag[0]?3*b:0]+c*e[d.iterFlag[1]?3*b:0];h[3*b+1]=j[d.iterFlag[0]?3*b+1:1]+c*e[d.iterFlag[1]?
3*b+1:1];h[3*b+2]=j[d.iterFlag[0]?3*b+2:2]+c*e[d.iterFlag[1]?3*b+2:2]}return!0},evaluate_core:function(h,j,e,a){h[0]=j[0]+a[0]*e[0];h[1]=j[1]+a[0]*e[1];h[2]=j[2]+a[0]*e[2]}})},{}],161:[function(){Xflow.registerOperator("xflow.mul",{outputs:[{type:"float4x4",name:"result"}],params:[{type:"float4x4",source:"value1"},{type:"float4x4",source:"value2"}],evaluate:function(h,j,e,a){for(var d=0;d<a.iterateCount;d++)XML3D.math.mat4.multiplyOffset(h,16*d,j,a.iterFlag[0]?16*d:0,e,a.iterFlag[1]?16*d:0)}})},{}],
162:[function(){Xflow.registerOperator("xflow.noiseImage",{outputs:[{type:"texture",name:"image",customAlloc:!0}],params:[{type:"int",source:"width"},{type:"int",source:"height"},{type:"float2",source:"scale"},{type:"float",source:"minFreq"},{type:"float",source:"maxFreq"}],alloc:function(h,j,e){var a=new Xflow.SamplerConfig;a.setDefaults();h.image={imageFormat:{width:j[0],height:e[0]},samplerConfig:a}},evaluate:function(h,j,e,a,d,b){for(var j=j[0],e=e[0],d=d[0],b=b[0],h=h.data,c=this.noise=this.noise||
new SimplexNoise,g=0!=d&&0!=b&&d<b,f=0;f<e;++f)for(var k=f/e*a[1],i=1/j,n=0;n<j;++n){var l=n*i*a[0],m;if(g){m=b;for(var r=k,p=0,q=d;q<m;q*=2)p+=Math.abs(c.noise(l*q,r*q))/q;m=p}else m=c.noise(l,k);l=4*(n*j+f);h[l]=Math.floor(255*m);h[l+1]=Math.floor(255*m);h[l+2]=Math.floor(255*m);h[l+3]=255}return!0}})},{}],163:[function(){Xflow.registerOperator("xflow.normalize",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value"}],evaluate:function(h,j,e){for(var a=0;a<e.iterateCount;a++){var d=
3*a,b=j[d],c=j[d+1],g=j[d+2],f=1/Math.sqrt(b*b+c*c+g*g);h[d]=b*f;h[d+1]=c*f;h[d+2]=g*f}}})},{}],164:[function(){Xflow.registerOperator("xflow.popartImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"},{type:"float",source:"time"}],evaluate:function(h,j){for(var e=j.data,a=h.data,d=0;d<e.length;d+=4){var b=0.3*(e[d]/255)+0.59*(e[d+1]/255)+0.11*(e[d+2]/255),b=0.3>b?0:0.6>b?0.5:1;0.5==b?(a[d]=204,a[d+1]=0):1==b?(a[d]=229.5,a[d+1]=229.5):(a[d]=0,a[d+
1]=0);a[d+2]=0;a[d+3]=e[d+3]}return!0}})},{}],165:[function(h){var j=h("../../interface/data.js").SamplerConfig,e=h("../../interface/constants.js");Xflow.registerOperator("xflow.rgbePNGtoFloat",{outputs:[{type:"texture",name:"result",customAlloc:!0}],params:[{type:"texture",source:"image"}],alloc:function(a,d){var b=new j;b.setDefaults();b.minFilter=e.TEX_FILTER_TYPE.NEAREST;b.magFilter=e.TEX_FILTER_TYPE.NEAREST;a.result={imageFormat:{width:d.width,height:d.height,texelType:e.TEXTURE_TYPE.FLOAT,texelFormat:e.TEXTURE_FORMAT.RGB},
samplerConfig:b}},evaluate:function(a,d){for(var b=0;b<d.data.length;b+=4){var c=d.data.subarray(b,b+4),e=0,f=c[3];0<f&&(e=Math.pow(2,f-136));f=new Float32Array(3);f[0]=c[0]*e;f[1]=c[1]*e;f[2]=c[2]*e;a.data.set(f,3*(b/4))}return!0}})},{"../../interface/constants.js":136,"../../interface/data.js":137}],166:[function(){Xflow.registerOperator("xflow.selectBool",{outputs:[{type:"bool",name:"result",customAlloc:!0}],params:[{type:"int",source:"index"},{type:"bool",source:"value"}],alloc:function(h){h.result=
1},evaluate:function(h,j,e){j=j[0];h[0]=j<e.length?e[j]:!1}})},{}],167:[function(){Xflow.registerOperator("xflow.selectTransform",{outputs:[{type:"float4x4",name:"result",customAlloc:!0}],params:[{type:"int",source:"index"},{type:"float4x4",source:"transform"}],alloc:function(h){h.result=1},evaluate:function(h,j,e){j=16*j[0];j<e.length&&j+15<e.length?(h[0]=e[j+0],h[1]=e[j+1],h[2]=e[j+2],h[3]=e[j+3],h[4]=e[j+4],h[5]=e[j+5],h[6]=e[j+6],h[7]=e[j+7],h[8]=e[j+8],h[9]=e[j+9],h[10]=e[j+10],h[11]=e[j+11],
h[12]=e[j+12],h[13]=e[j+13],h[14]=e[j+14],h[15]=e[j+15]):(h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1)}})},{}],168:[function(){Xflow.registerOperator("xflow.sepiaImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(h,j){for(var e=j.data,a=h.data,d=0,b=0,c=0,g=0;g<e.length;g+=4)d=0.393*e[g]+0.769*e[g+1]+0.189*e[g+2],b=0.349*e[g]+0.686*e[g+1]+0.168*e[g+2],c=
0.272*e[g]+0.534*e[g+1]+0.131*e[g+2],255<d&&(d=255),255<b&&(b=255),255<c&&(c=255),0>d&&(d=0),0>b&&(b=0),0>c&&(c=0),a[g]=d,a[g+1]=b,a[g+2]=c,a[g+3]=255;return!0}})},{}],169:[function(){Xflow.registerOperator("xflow.skinDirection",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"dir"},{type:"int4",source:"boneIdx"},{type:"float4",source:"boneWeight"},{type:"float4x4",source:"boneXform",array:!0}],evaluate:function(h,j,e,a,d,b){for(var c=XML3D.math.vec3,g=XML3D.math.mat4,f=c.create(),
k=c.create(),i=0;i<b.iterateCount;++i){for(var n=3*i,l=f[0]=f[1]=f[2]=0;4>l;l++){var m=a[b.iterFlag[2]?4*i+l:l];m&&(g.multiplyOffsetDirection(d,16*e[b.iterFlag[1]?4*i+l:l],j,n,k),c.scale(k,k,m),c.add(f,f,k))}c.normalize(f,f);h[n]=f[0];h[n+1]=f[1];h[n+2]=f[2]}}})},{}],170:[function(){Xflow.registerOperator("xflow.skinPosition",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"pos"},{type:"int4",source:"boneIdx"},{type:"float4",source:"boneWeight"},{type:"float4x4",source:"boneXform",
array:!0}],evaluate:function(h,j,e,a,d,b){for(var c=XML3D.math.vec3,g=XML3D.math.mat4,f=c.create(),k=c.create(),i=0;i<b.iterateCount;++i){for(var n=3*i,l=f[0]=f[1]=f[2]=0;4>l;l++){var m=a[b.iterFlag[2]?4*i+l:l];m&&(g.multiplyOffsetVec3(d,16*e[b.iterFlag[1]?4*i+l:l],j,n,k),c.scale(k,k,m),c.add(f,f,k))}h[n]=f[0];h[n+1]=f[1];h[n+2]=f[2]}}})},{}],171:[function(h){var j=h("../../utils/utils").binarySearch,h=h("../../interface/constants.js");Xflow.registerOperator("xflow.slerpSeq",{outputs:[{type:"float4",
name:"result"}],params:[{type:"float4",source:"sequence"},{type:"float",source:"key"}],mapping:[{name:"value1",source:"sequence",sequence:h.SEQUENCE.PREV_BUFFER,keySource:"key"},{name:"value2",source:"sequence",sequence:h.SEQUENCE.NEXT_BUFFER,keySource:"key"},{name:"weight",source:"sequence",sequence:h.SEQUENCE.LINEAR_WEIGHT,keySource:"key"}],evaluate:function(e,a,d,b,c){for(var g=0;g<c.iterateCount;++g)XML3D.math.quat.slerpOffset(a,c.iterFlag[0]?4*g:0,d,c.iterFlag[1]?4*g:0,b[0],e,4*g,!0)}});Xflow.registerOperator("xflow.slerpKeys",
{outputs:[{type:"float4",name:"result"}],params:[{type:"float",source:"keys",array:!0},{type:"float4",source:"values",array:!0},{type:"float",source:"key"}],alloc:function(e){e.result=4},evaluate:function(e,a,d,b){var c=Math.min(a.length,Math.floor(d.length/4)),g=j(a,b[0],c);0>g||g==c-1?(g=Math.max(0,g),e[0]=d[4*g],e[1]=d[4*g+1],e[2]=d[4*g+2],e[3]=d[4*g+3]):XML3D.math.quat.slerpOffset(d,4*g,d,4*(g+1),(b[0]-a[g])/(a[g+1]-a[g]),e,0,!0)}})},{"../../interface/constants.js":136,"../../utils/utils":187}],
172:[function(){function h(e,a,d,b){var c=new Float32Array(4);switch(arguments.length){case 0:c[0]=0;c[1]=0;c[2]=0;c[3]=0;break;case 1:c[0]=e;c[1]=e;c[2]=e;c[3]=e;break;case 2:c[0]=e;c[1]=a;c[2]=0;c[3]=0;break;case 3:c[0]=e;c[1]=a;c[2]=d;c[3]=0;break;default:c[0]=e,c[1]=a,c[2]=d,c[3]=b}return c}function j(e,a,d,b){d=4*(b*a.width+d);a=a.data;e[0]=a[d]/255;e[1]=a[d+1]/255;e[2]=a[d+2]/255;e[3]=a[d+3]/255;return e}(function(){Xflow.Filters={};var e=null,a=null;Xflow.Filters.createImageData=function(d,
b){e||(e=document.createElement("canvas"));a||(a=e.getContext("2d"));return a.createImageData(d,b)};Xflow.Filters.createImageDataFloat32=function(a,b){return{width:a,height:b,data:new Float32Array(4*a*b)}};Xflow.Filters.grayscale=function(a,b){for(var c=a.data,e=b.data,f=0;f<c.length;f+=4){var h=c[f+3];e[f]=e[f+1]=e[f+2]=0.2126*c[f]+0.7152*c[f+1]+0.0722*c[f+2];e[f+3]=h}return a};Xflow.Filters.convolute=function(a,b,c,e){for(var f=Math.round(Math.sqrt(c.length)),h=Math.floor(f/2),i=a.data,j=a.width,
a=a.height,l=b.data,e=e?1:0,m=0;m<a;m++)for(var r=0;r<j;r++){for(var p=m,q=r,o=4*(m*j+r),s=0,u=0,t=0,v=0,w=0;w<f;w++)for(var z=0;z<f;z++){var y=p+w-h,x=q+z-h;0<=y&&y<a&&0<=x&&x<j&&(y=4*(y*j+x),x=c[w*f+z],s+=i[y]*x,u+=i[y+1]*x,t+=i[y+2]*x,v+=i[y+3]*x)}l[o]=s;l[o+1]=u;l[o+2]=t;l[o+3]=v+e*(255-v)}return b}})();Xflow.registerOperator("xflow.sobelImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(e,a){for(var d=a.width,b=a.height,
c=h(0),g=h(0),f=h(),f=h(),k=h(),i=h(),n=h(),l=h(),m=h(),r=h(),p=h(),q=h(),o=h(),s=0;s<b;++s)for(var u=0;u<d;++u)if(1<=u&&u<d-1&&1<=s&&s<b-1){j(f,a,u-1,s-1);j(k,a,u,s-1);j(i,a,u+1,s-1);j(n,a,u-1,s);j(l,a,u,s);j(m,a,u+1,s);j(r,a,u-1,s+1);j(p,a,u,s+1);j(q,a,u+1,s+1);c[0]=f[0]+2*k[0]+i[0]-r[0]-2*p[0]-q[0];c[1]=f[1]+2*k[1]+i[1]-r[1]-2*p[1]-q[1];c[2]=f[2]+2*k[2]+i[2]-r[2]-2*p[2]-q[2];g[0]=f[0]-i[0]+2*n[0]-2*m[0]+r[0]-q[0];g[1]=f[1]-i[1]+2*n[1]-2*m[1]+r[1]-q[1];g[2]=f[2]-i[2]+2*n[2]-2*m[2]+r[2]-q[2];var t=
o,v=c,w=g;t[0]=Math.sqrt(v[0]*v[0]+w[0]*w[0]);t[1]=Math.sqrt(v[1]*v[1]+w[1]*w[1]);t[2]=Math.sqrt(v[2]*v[2]+w[2]*w[2]);t[3]=Math.sqrt(v[3]*v[3]+w[3]*w[3]);o[0]/=2;o[1]/=2;o[2]/=2;o[3]=1;t=o;v=4*(s*e.width+u);w=e.data;w[v]=255*t[0];w[v+1]=255*t[1];w[v+2]=255*t[2];w[v+3]=255*t[3]}return!0}})},{}],173:[function(){Xflow.registerOperator("xflow.sub",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value1"},{type:"float3",source:"value2"}],evaluate:function(){throw"Not used!";},evaluate_core:function(h,
j,e){h[0]=j[0]-e[0];h[1]=j[1]-e[1];h[2]=j[2]-e[2]}})},{}],174:[function(h,j){var e=function(a){this.index=0;this.operator=a;this.inputInfo=[];this.outputInfo=[]};e.prototype.isTransferInput=function(a){return void 0!==this.inputInfo[a].operatorIndex};e.prototype.getTransferInputOperatorIndex=function(a){return this.inputInfo[a].operatorIndex};e.prototype.getTransferInputOutputIndex=function(a){return this.inputInfo[a].outputIndex};e.prototype.getTransferInputId=function(a){a=this.inputInfo[a];return a.operatorIndex+
"_"+a.outputIndex};e.prototype.getTransferOutputId=function(a){return this.index+"_"+a};e.prototype.getInputMappingName=function(a){return this.inputInfo[a].mappedName};e.prototype.getDirectInputIndex=function(a){return this.inputInfo[a].inputIndex};e.prototype.getOutputIndex=function(a){return this.outputInfo[a].finalOut||this.outputInfo[a].lost||0};e.prototype.isFinalOutput=function(a){return this.outputInfo[a]&&void 0!==this.outputInfo[a].finalOut};e.prototype.isTransferOutput=function(a){return this.outputInfo[a]&&
this.outputInfo[a].transfer};e.prototype.isLostOutput=function(a){return this.outputInfo[a]&&void 0!==this.outputInfo[a].lost};e.prototype.setTransferInput=function(a,d,b){this.inputInfo[a]={operatorIndex:d,outputIndex:b}};e.prototype.setDirectInput=function(a,d,b){this.inputInfo[a]={inputIndex:d,mappedName:b}};e.prototype.setFinalOutput=function(a,d){this.outputInfo[a]={finalOut:d}};e.prototype.setTransferOutput=function(a){this.outputInfo[a]={transfer:!0}};e.prototype.setLostOutput=function(a,d){this.outputInfo[a]=
{lost:d}};e.prototype.getKey=function(){for(var a=this.operator.name+"*O",d=0;d<this.outputInfo.length;++d)var b=this.outputInfo[d],a=a+("*"+(b.transfer?"_":b.finalOut||b.lost+"?"));a+=NaN;for(d=0;d<this.inputInfo.length;++d)b=this.inputInfo[d],a+="*"+(b.inputIndex?b.inputInfo:b.operatorIndex+">"+b.outputIndex);return a};j.exports=e},{}],175:[function(h,j){var e=h("../interface/constants.js");h("../base.js");var a=function(a){this.platform=a;this.entries=[];this.inputInfo={}};a.prototype.addEntry=
function(a){a.index=this.entries.length;this.entries.push(a)};a.prototype.getKey=function(){for(var a=[],c=0;c<this.entries.length;++c)a.push(this.entries[c].getKey());a=this.platform+">"+a.join("!")+"|";for(c in this.inputInfo)a+=c+">"+(this.inputInfo[c].iterate||0)+"x"+(this.inputInfo[c].size||0);return a};a.prototype.setInputIterateType=function(a,c){this.inputInfo[a]||(this.inputInfo[a]={});this.inputInfo[a].iterate=c};a.prototype.setInputSize=function(a,c){this.inputInfo[a]||(this.inputInfo[a]=
{});this.inputInfo[a].size=c};a.prototype.isInputIterate=function(a){return this.inputInfo[a]&&this.inputInfo[a].iterate==e.ITERATION_TYPE.MANY};a.prototype.isInputUniform=function(a){return this.inputInfo[a]&&this.inputInfo[a].iterate==e.ITERATION_TYPE.ONE};a.prototype.isInputNull=function(a){return this.inputInfo[a]&&this.inputInfo[a].iterate==e.ITERATION_TYPE.NULL};a.prototype.getInputIterateType=function(a){return this.inputInfo[a]&&this.inputInfo[a].iterate};a.prototype.getInputSize=function(a){return this.inputInfo[a]&&
this.inputInfo[a].size||0};a.prototype.getIterateCount=function(a){for(var c=-1,d=0;d<a.inputs.length;++d)if(this.isInputIterate(d)){var e=a.getDataEntry(d);e&&e.getIterateCount&&(e=e.getIterateCount(),c=0>c?e:Math.min(e,c))}return 0>c?1:c};var d={};a.prototype.allocateOutput=function(a,c){for(var g=0;g<this.entries.length;++g){var f=this.entries[g],h=f.operator,i=a.operatorData[g],j=this.getIterateCount(a);if(h.alloc){for(var l=[d],m=l,r=f,p=a,q=r.operator.mapping,o=0;o<q.length;++o){var s=p.getDataEntry(r.getDirectInputIndex(o));
m.push(s?s.getValue():null)}l.push(j);h.alloc.apply(i,l)}for(i=0;i<h.outputs.length;++i)if(m=h.outputs[i],l=a.outputs[f.getOutputIndex(i)],l=c?l.asyncDataEntry:l.dataEntry,!m.noAlloc)if(l.type==e.DATA_TYPE.TEXTURE)if(m.customAlloc)m=d[m.name],r=m.imageFormat.width,p=m.imageFormat.height,q=m.imageFormat.texelType,o=m.imageFormat.texelFormat,m=m.samplerConfig,l._createImage(r,p,o,q,m);else if(m.sizeof){s=null;for(r=0;r<h.mapping.length;++r)if(h.mapping[r].source==m.sizeof){s=a.getDataEntry(f.getDirectInputIndex(r));
break}if(s)r=Math.max(s.width,1),p=Math.max(s.height,1),o=m.texelFormat||s.texelFormat,q=m.texelType||s.texelType,m=m.samplerConfig||s.getSamplerConfig(),l._createImage(r,p,o,q,m);else throw Error("Unknown texture input parameter '"+m.sizeof+"' in operator '"+h.name+"'");}else throw Error("Cannot create texture. Use customAlloc or sizeof parameter attribute");else if(m=(m.customAlloc?d[m.name]:j)*l.getTupleSize(),!l._value||l._value.length!=m)switch(l.type){case e.DATA_TYPE.FLOAT:case e.DATA_TYPE.FLOAT2:case e.DATA_TYPE.FLOAT3:case e.DATA_TYPE.FLOAT4:case e.DATA_TYPE.FLOAT4X4:l._setValue(new Float32Array(m));
break;case e.DATA_TYPE.INT:case e.DATA_TYPE.INT4:case e.DATA_TYPE.BOOL:l._setValue(new Int32Array(m));break;default:XML3D.debug.logWarning("Could not allocate output buffer of TYPE: "+l.type)}else l._notifyChanged()}};j.exports=a},{"../base.js":135,"../interface/constants.js":136}],176:[function(h,j){function e(b){for(var c={},d=0;d<b.outputs.length;++d)b.outputs[d].type=a.DATA_TYPE_MAP[b.outputs[d].type];for(d=0;d<b.params.length;++d)b.params[d].type=a.DATA_TYPE_MAP[b.params[d].type],c[b.params[d].source]=
d;b.mapping||(b.mapping=b.params);for(d=0;d<b.mapping.length;++d){var e=b.mapping[d],h=c[e.source];e.paramIdx=h;h=b.params[h].type;e.sequence&&(e.keyParamIdx=c[e.keySource]);e.sequence==a.SEQUENCE.LINEAR_WEIGHT&&(h=a.DATA_TYPE.FLOAT);e.internalType=h;e.name=e.name||e.source}b.platform=b.platform||a.PLATFORM.JAVASCRIPT}h("../base.js");var a=h("../interface/constants.js"),d={};j.exports={registerOperator:function(b,c){var g,f;e(c);d[b]||(d[b]={});f=c.platform||a.PLATFORM.JAVASCRIPT;g=d[b];b?c?(c.name=
b,g[f]||(g[f]=[]),g[f].push(c)):XML3D.logWarning("Xflow.registerOperator: Operator data undefined."):XML3D.logWarning("Xflow.registerOperator: Operator name undefined.")},initAnonymousOperator:function(a,c){e(c);c.name=a;return c},isOperatorAsync:function(a){return!!a.evaluate_async},getOperators:function(b,c){c=c||a.PLATFORM.JAVASCRIPT;return b&&!d[b]||!d[b][c]||0==d[b][c].length?null:d[b][c]}}},{"../base.js":135,"../interface/constants.js":136}],177:[function(h,j){function e(a,b,d,e){var f=c(a,
b,!0);f.push(d);f.push(function(){g(a,b,f,!0);e()});a.operator.evaluate_async.apply(d,f)}function a(a,c){var e="function (",f=d(a.evaluate_core),e=e+(f.args.join(",")+",__xflowMax) {\n"),e=e+"    var __xflowI = __xflowMax\n    while(__xflowI--){\n",g=f.body,g=b(g,f.args,a,c);return eval("("+(e+(g+"\n  }\n}"))+")")}function d(a){var b={},c=a.toString().match(q);if(!c)return f.notifyError("Xflow Internal: Could not parse function: "+a),null;b.args=c[2].split(",");for(var d in b.args)b.args[d]=b.args[d].trim();
b.body=c[3];return b}function b(a,b,c,d){for(var e="",f=0,g=a.indexOf("[",f);-1!=g;){var h=a.substr(f).match(o)[1],i=b.indexOf(h),h=!1,j=0;-1!=i&&(i<c.outputs.length?(h=!0,j=k.DATA_TYPE_TUPLE_SIZE[[c.outputs[i].type]]):(i-=c.outputs.length,h=d.iterFlag[i],j=k.DATA_TYPE_TUPLE_SIZE[c.mapping[i].internalType]));e+=a.substring(f,g)+"[";h&&(e+=j+"*__xflowI + ");f=g+1;g=a.indexOf("[",f)}return e+=a.substring(f)}function c(a,b,c){for(var d=[],e=a.operator.outputs,f=0;f<e.length;++f)if(e[f].noAlloc)d.push({assign:null});
else{var g=b.outputs[a.getOutputIndex(f)],g=c?g.asyncDataEntry:g.dataEntry;d.push(g?g.getValue():null)}c=a.operator.mapping;for(e=0;e<c.length;++e)f=b.getDataEntry(a.getDirectInputIndex(e)),d.push(f?f.getValue():null);return d}function g(a,b,c,d){for(var e=a.operator.outputs,f=0;f<e.length;++f){var g=b.outputs[a.getOutputIndex(f)];if(e[f].noAlloc){var h=d?g.asyncDataEntry:g.dataEntry;h.type==k.DATA_TYPE.TEXTURE?h._setImage(c[f].assign):h._setValue(c[f].assign)}d&&g.swapAsync()}}var f=h("../base.js"),
k=h("../interface/constants.js"),i=h("./vs-program.js"),n=h("./cl-program.js"),l=function(){this.inputs=[];this.outputs=[];this.operatorData=[]};l.prototype.getChannel=function(a){return this.inputs[a].channel};l.prototype.getDataEntry=function(a){var a=this.inputs[a],b=a.channel;if(!b)return null;var c=0;a.sequenceKeySourceChannel&&(c=(c=a.sequenceKeySourceChannel.getDataEntry())&&c._value?c._value[0]:0);return b.getDataEntry(a.sequenceAccessType,c)};var m=function(){this.channel=null;this.arrayAccess=
!1;this.sequenceAccessType=k.SEQUENCE.NO_ACCESS;this.sequenceKeySourceChannel=null};m.prototype.getKey=function(){return(this.channel?this.channel.id:"NULL")+";"+this.arrayAccess+";"+this.sequenceAccessType+";"+(this.sequenceKeySourceChannel?this.sequenceKeySourceChannel.id:"")};var r={},p=function(a){this.list=a;this.entry=a.entries[0];this.operator=this.entry.operator;this._inlineLoop=null};p.prototype.run=function(b,d){var f=this.list,h=b.operatorData[0],i=f.entries[0],j=i.operator.mapping;h.iterFlag=
{};for(var k=0;k<j.length;++k){var l=i.isTransferInput(k)||f.isInputIterate(i.getDirectInputIndex(k));h.iterFlag[k]=l}h.iterateCount=f.getIterateCount(b);h.customData||(h.customData={});d?e(this.entry,b,h,d):this.operator.evaluate_core?(f=c(this.entry,b),f.push(h.iterateCount),this._inlineLoop||(this._inlineLoop=a(this.operator,h)),this._inlineLoop.apply(h,f)):(f=this.entry,i=c(f,b),i.push(h),f.operator.evaluate.apply(h,i),g(f,b,i,!1))};var q=/function\s*([^(]*)\(([^)]*)\)\s*\{([\s\S]*)\}/,o=/([a-zA-Z_$][\w$]*)(\[)/;
j.exports={createProgram:function(a){var b;if(0===a.entries.length)return null;b=a.entries[0].operator;var c=a.getKey();r[c]||(a.platform===k.PLATFORM.GLSL?r[c]=new i(a):b.platform===k.PLATFORM.CL?r[c]=new n(a):b.platform===k.PLATFORM.JAVASCRIPT&&1===a.entries.length?r[c]=new p(a):f.notifyError("Could not create program from operatorList"));return r[c]},ProgramData:l,ProgramInputConnection:m}},{"../base.js":135,"../interface/constants.js":136,"./cl-program.js":140,"./vs-program.js":178}],178:[function(h,
j){function e(b,c,d,e,f){for(var g,h=c.operator;-1!=(g=b.indexOf("#I{"));){var j=b.indexOf("}",g),o;a:{o=b.substring(g+3,j);for(var s=0;s<h.mapping.length;++s)if(h.mapping[s].name==o){o=s;break a}throw Error("Invalid input name '"+o+"' inside of code fragment");}o=c.isTransferInput(o)?d[c.getTransferInputId(o)]:e[c.getDirectInputIndex(o)];b=b.substring(0,g)+o+b.substring(j+1)}for(;-1!=(g=b.indexOf("#O{"));){j=b.indexOf("}",g);a:{e=b.substring(g+3,j);for(o=0;o<h.outputs.length;++o)if(h.outputs[o].name==
e){e=o;break a}e=void 0}o=d[c.getTransferOutputId(e)];b=b.substring(0,g)+o+b.substring(j+1)}for(c=[];-1!=(g=b.indexOf("#L{"));)j=b.indexOf("}",g),d=b.substring(g+3,j),c[d]||(c[d]=a(d,f)),o=c[d],b=b.substring(0,g)+o+b.substring(j+1);for(;-1!=(g=b.indexOf("#G{"));)j=b.indexOf("}",g),o=b.substring(g+3,j),b=b.substring(0,g)+o+b.substring(j+1);return b}function a(a,b){for(var d=a,e=1;-1!=b.indexOf(d);)d=a+"_"+ ++e;c.nameset.add(b,d);return d}function d(a){switch(a){case b.DATA_TYPE.BOOL:return"bool";case b.DATA_TYPE.BYTE:return"uint";
case b.DATA_TYPE.FLOAT:return"float";case b.DATA_TYPE.FLOAT2:return"vec2";case b.DATA_TYPE.FLOAT3:return"vec3";case b.DATA_TYPE.FLOAT4:return"vec4";case b.DATA_TYPE.FLOAT3X3:return"mat3";case b.DATA_TYPE.FLOAT4X4:return"mat4";case b.DATA_TYPE.INT:return"int";case b.DATA_TYPE.INT4:return"ivec4"}throw Error("Type not supported for GLSL "+b.getTypeName(a));}h("../base.js");var b=h("../interface/constants.js"),c=h("../utils/utils.js"),g=h("../processing/vs-connect.js").VertexShader,f=function(a){this.list=
a;this._outputInfo={};for(var a=this.list,c=a.entries,c=c[c.length-1],d=c.operator,e=0;e<d.params.length;++e){var f=d.params[e],g=f.source,h=e,j=c.getDirectInputIndex(h);this._outputInfo[g]={type:f.type};this._outputInfo[g].iteration=c.isTransferInput(h)||a.isInputIterate(j)?b.ITERATION_TYPE.MANY:a.isInputUniform(j)?b.ITERATION_TYPE.ONE:b.ITERATION_TYPE.NULL}};f.prototype.getOutputNames=function(){return Object.keys(this._outputInfo)};f.prototype.getOutputType=function(a){return this._outputInfo[a].type};
f.prototype.isOutputUniform=function(a){return this._outputInfo[a].iteration==b.ITERATION_TYPE.ONE};f.prototype.isOutputNull=function(a){return this._outputInfo[a].iteration==b.ITERATION_TYPE.NULL};f.prototype.createVertexShader=function(f,h){var j=new g(f),l=this.list,m=l.entries,r=[],p={},q={},o=m[m.length-1],s=[],u=o.operator;if(!h)throw Error("Could not find vsConfig! Attempt to create vertex shader programm without VS operator?");c.nameset.add(r,h.getBlockedNames());var t;t="// OUTPUT\n";for(var v in h._addOutput){var w=
h._addOutput[v];t+="varying "+d(w.type)+" "+v+";\n";c.nameset.add(r,v)}var z=0;for(v in h._attributes){for(var w=h._attributes[v],y=o.getDirectInputIndex(z),x=0;x<w.channeling.length;++x){var C=w.channeling[x],J={type:w.type,iteration:0,index:0,sourceName:v},D=C.outputName;C.code||o.isTransferInput(z)||l.isInputIterate(y)?(s[z]=!0,J.iteration=b.ITERATION_TYPE.MANY,t+="varying "+d(u.outputs[z].type)+" "+D+";\n",c.nameset.add(r,D),q[o.getTransferOutputId(x)]=D):l.isInputUniform(y)?(J.iteration=b.ITERATION_TYPE.ONE,
J.index=y):J.iteration=b.ITERATION_TYPE.NULL;c.nameset.add(j._outputNames,D);j._outputInfo[D]=J}z++}t+="\n// INPUT\n";for(v in h._addInput)w=h._addInput[v],t+=(w.uniform?"uniform ":"attribute ")+d(w.type)+" "+v+";\n",c.nameset.add(r,v);for(x=0;x<m.length;++x){w=m[x];C=w.operator;for(D=0;D<C.mapping.length;++D)if((x<m.length-1||s[D])&&!w.isTransferInput(D)&&!p[w.getDirectInputIndex(D)])u=C.mapping[D],v=a(u.name,r),z=w.getDirectInputIndex(D),y=!l.isInputIterate(z),j._inputInfo[v]={index:z,uniform:y},
c.nameset.add(j._inputNames,v),p[z]=v,t+=(y?"uniform ":"attribute ")+d(u.internalType)+" "+v,u.array&&(t+="["+l.getInputSize(z)+"]"),t+=";\n"}t+="\n// CODE\nvoid main(void){\n";for(x=0;x<m.length;++x){w=m[x];C=w.operator;for(D=0;D<C.outputs.length;++D)w.isFinalOutput(D)||(v=a(C.outputs[D].name,r),q[w.getTransferOutputId(D)]=v,t+="\t"+d(C.outputs[D].type)+" "+v+";\n");l=e(C.evaluate_glsl,w,q,p,r);t+=l+"\n"}m=0;l="";for(v in h._attributes){w=h._attributes[v];for(x=0;x<w.channeling.length;++x)C=w.channeling[x],
D=C.outputName,j._outputInfo[D].iteration==b.ITERATION_TYPE.MANY&&(l=C.code?l+("\t"+C.code+"\n"):l+("\t"+D+" = #I{"+v+"};\n"));m++}for(x=0;x<h._codeFragments.length;++x)l+="\t"+h._codeFragments[x]+"\n";t+=e(l,o,q,p,r)+"\n";j._glslCode=t+"}\n";return j};j.exports=f},{"../base.js":135,"../interface/constants.js":136,"../processing/vs-connect.js":186,"../utils/utils.js":187}],179:[function(h,j){function e(a,c,d,e){var f,g;e&&(f=[],g=[]);for(var h=0;h<a.params.length;++h){var i=a.params[h],j=i.source,
k=c?c.getScriptInputName(h,j):j,l;e&&(l="For "+(h+1)+". argument '"+j+"': ",f.push(b.getTypeName(i.type)+" "+j+(i.optional?" [optional]":"")));if(k){j=d.getChannel(k);if(!j&&!i.optional)if(e)g.push(l+"DataEntry '"+k+"' does not exist");else return!1;if(j&&j.getType()!=i.type)if(e)g.push(l+"DataEntry '"+k+"' has wrong type '"+b.getTypeName(j.getType())+"'");else return!1}}e&&e.push(a.name+"("+f.join(", ")+")\n\t * "+g.join("\n\t * "));return!0}function a(a,b,c,d){var e=c.getChannel(d);a.addChannel(b,
e,c.getChildDataIndex(d))}var d=h("../base.js"),b=h("../interface/constants.js"),c=h("./channel.js"),g=h("./process-node.js").RequestNode,f=h("./process-node.js").ProcessNode,k=h("./data-slot.js"),i=h("../operator/operator.js"),n=c.ChannelMap,c=function(a,c){this.owner=a;this.platform=b.PLATFORM.JAVASCRIPT;this.substitution=c;this.loading=!1;this.inputSlots={};this.inputChannels=new n;this.computedChannels=new n;this.outputChannels=new n;this.processNode=this.dataflowChannelNode=this.operator=null;
this.requestNodes={};this.useCount=1;this.outOfSync=!0};c.prototype.synchronize=function(){if(this.outOfSync){var c=this.owner;this.owner._computeOperator&&(this.platform=null!==c._platform?c._platform:b.PLATFORM.JAVASCRIPT);c=this.owner;this.loading=c.isSubtreeLoading();this.substitution&&c._channelNode.synchronize();if(c._sourceNode)c._sourceNode._getOrCreateChannelNode(this.substitution).synchronize();else for(var g=0;g<c._children.length;++g)c._children[g]._getOrCreateChannelNode&&c._children[g]._getOrCreateChannelNode(this.substitution).synchronize();
c=this.owner;if(c._sourceNode)this.inputChannels.merge(c._sourceNode._getOrCreateChannelNode(this.substitution).outputChannels,0);else{c=c._children;for(g=0;g<c.length;++g)c[g]._getOrCreateChannelNode&&this.inputChannels.merge(c[g]._getOrCreateChannelNode(this.substitution).outputChannels,g);for(g=0;g<c.length;++g)if(!c[g]._getOrCreateChannelNode){var h=c[g],j=h._name+";"+h._key;if(this.substitution)h._paramName&&this.substitution.hasChannel(h._paramName)?this.inputChannels.addChannel(h._name,this.substitution.getChannel(h._paramName)):
this.inputChannels.addDataEntry(h._name,this.owner._channelNode.inputSlots[j]);else{var n=new k(h._data,h._key);this.inputSlots[j]=n;this.inputChannels.addDataEntry(h._name,n)}}}g=this.owner;this.computedChannels.merge(this.inputChannels);c=this.dataflowChannelNode;if(g._computeUsesDataflow&&g._dataflowNode){this.operator=null;var u=this.owner,g=new m(u._dataflowNode,this);this.dataflowChannelNode=u._dataflowNode._getOrCreateChannelNode(g);u=this.owner;if(this.dataflowChannelNode){g=this.dataflowChannelNode;
g.synchronize();h=g.outputChannels.getNames();for(j=0;j<h.length;++j){var t=n=h[j];u._computeOutputMapping&&(t=u._computeOutputMapping.getScriptOutputName(j,n));t&&this.computedChannels.addChannel(t,g.outputChannels.getChannel(n))}}}else if(!g._computeUsesDataflow&&g._computeOperator){this.dataflowChannelNode=null;h=this.owner;if(this.loading)this.operator=null;else if("string"==typeof h._computeOperator){g=h._computeOperator;j=null;if(g){a:{g=h._computeOperator;h=h._computeInputMapping;j=this.inputChannels;
(n=i.getOperators(g,this.platform)||i.getOperators(g,b.PLATFORM.JAVASCRIPT))||d.notifyError("No operator with name '"+g+"' found",this.owner);for(t=n.length;t--;)if(e(n[t],h,j)){j=n[t];break a}l.length=0;for(t=n.length;t--;)e(n[t],h,j,l);g="No operator '"+g+"' with matching type signature found:\n\n"+l.join("\n");d.notifyError(g,this.owner);j=null}j&&(this.platform=j.platform)}this.operator=j}else this.operator=h._computeOperator;g=this.owner;if(this.operator)for(u in h=this.processNode=new f(this),
j=0,h.outputDataSlots)n=u,g._computeOutputMapping&&(n=g._computeOutputMapping.getScriptOutputName(j,u)),n&&this.computedChannels.addOutputDataSlot(n,h.outputDataSlots[u],h),j++}c&&c!=this.dataflowChannelNode&&c.owner._removeSubstitutionNode(c);u=this.owner;u._filterMapping?u._filterMapping.applyFilterOnChannelMap(this.outputChannels,this.computedChannels,u._filterType,a):this.outputChannels.merge(this.computedChannels);this.outOfSync=!1}};c.prototype.clear=function(){this.useCount=0;this.inputChannels.clear();
this.outputChannels.clear();return!0};c.prototype.increaseRef=function(){this.useCount++};c.prototype.decreaseRef=function(){this.useCount--;return 0==this.useCount?(this.clear(),!0):!1};c.prototype.getOutputNames=function(){this.synchronize();return this.outputChannels.getNames()};c.prototype.getChildDataIndex=function(a){this.synchronize();return this.outputChannels.getChildDataIndexForFilter(a)};c.prototype.setStructureOutOfSync=function(){if(!this.outOfSync){this.outOfSync=!0;this.inputChannels.clear();
this.computedChannels.clear();this.outputChannels.clear();this.processNode&&this.processNode.clear();for(var a in this.requestNodes)this.requestNodes[a].setStructureOutOfSync()}};c.prototype.notifyDataChange=function(a,b){var c=a._name+";"+a._key;this.inputSlots[c]&&this.inputSlots[c].setDataEntry(a._data,b)};c.prototype.getResult=function(a,b){this.synchronize();var c=b?b.join(";"):"[null]";this.requestNodes[c]||(this.requestNodes[c]=new g(this,b));return this.requestNodes[c].getResult(a)};c.prototype.getOutputChannelInfo=
function(a){this.synchronize();var c=this.outputChannels.getChannel(a);if(!c)return null;var d={type:c.getType(),seqLength:c.getSequenceLength(),seqMinKey:c.getSequenceMinKey(),seqMaxKey:c.getSequenceMaxKey(),origin:0,originalName:""},a=this.owner._filterMapping?this.owner._filterMapping.getRenameSrcName(a):a,c=c.getDataEntry();if(this.dataflowChannelNode){var e=this.inputChannels.getChannel(a);if(!e||c!=e.getDataEntry())return d.origin=b.ORIGIN.PROTO,d.originalName=a,d}if(this.operator&&(e=this.inputChannels.getChannel(a),
!e||c!=e.getDataEntry()))return d.origin=b.ORIGIN.COMPUTE,d.originalName=this.owner._computeOutputMapping.getScriptOutputNameInv(a,this.operator.outputs),d;d.origin=b.ORIGIN.CHILD;d.originalName=a;return d};var l=[],m=function(a,b){this.map={};for(var c=b.owner,d=a._getGlobalParamNames(),e=0;e<d.length;++e)this.map[d[e]]=b.inputChannels.getChannel(d[e]);d=a._getParamNames();for(e=0;e<d.length;++e){var f=d[e],g=f;c._computeInputMapping&&(g=c._computeInputMapping.getScriptInputName(e,f));this.map[f]=
b.inputChannels.getChannel(g)}};m.prototype.hasChannel=function(a){return!!this.map[a]};m.prototype.getChannel=function(a){return this.map[a]};m.prototype.getKey=function(a){for(var b="",c=a._getGlobalParamNames(),d=0;d<c.length;++d)var e=this.map[c[d]],b=b+((e&&e.id||"-")+"!");a=a._getParamNames();for(d=0;d<a.length;++d)e=this.map[a[d]],b+=(e&&e.id||"-")+".";return b};j.exports={ChannelNode:c,Substitution:m}},{"../base.js":135,"../interface/constants.js":136,"../operator/operator.js":176,"./channel.js":180,
"./data-slot.js":181,"./process-node.js":184}],180:[function(h,j){function e(a,b){a.map[b]||(a.map[b]={channel:null,childDataIndex:void 0})}function a(a,b,c,g){e(a,b);var h=a.map[b].channel;if(!h||!h.willMergeWithDataSlot(c))return c=new f(a,c),a.map[b].channel=c,a.map[b].childDataIndex=g,c;h=d(a,h);h.addDataSlot(c);a.map[b].channel=h;a.map[b].childDataIndex=-1;return h}function d(a,b){if(b.map!=a){var c=new f(a);c.addChannelEntries(b);c.creatorProcessNode=b.creatorProcessNode;return c}return b}h("../base.js");
var b=h("../interface/constants.js"),c=h("../interface/data.js").BufferEntry,g=function(){this.map={}};g.prototype.getNames=function(){return Object.keys(this.map)};g.prototype.getChannel=function(a){return!this.map[a]?null:this.map[a].channel};g.prototype.getChildDataIndex=function(a){return!this.map[a]?void 0:this.map[a].childDataIndex};g.prototype.getChildDataIndexForFilter=function(a){for(var b,a=a||this.getNames(),c=0;c<a.length;++c){var d=this.getChildDataIndex(a[c]);void 0!=d&&(b=void 0!=b&&
b!=d?-1:d)}return b};g.prototype.merge=function(a,b){for(var c in a.map){var d=void 0==b?a.getChildDataIndex(c):b;this.addChannel(c,a.getChannel(c),d)}};g.prototype.addChannel=function(a,b,c){if(b){void 0==c&&(c=-1);e(this,a);var f=this.map[a].channel;!f||!f.willMergeWithChannel(b)?(this.map[a].channel=b,this.map[a].childDataIndex=c):(f=d(this,f),f.addChannelEntries(b),this.map[a].channel=f,this.map[a].childDataIndex=-1)}};g.prototype.addDataEntry=function(b,c){a(this,b,c,-1)};g.prototype.addOutputDataSlot=
function(b,c,d){a(this,b,c,-1).creatorProcessNode=d};g.prototype.clear=function(){for(var a in this.map){var b=this.map[a];b&&b.map==this&&b.clear()}this.map={}};var f=function(a,b){this.entries=[];this.map=a;this.id=++k;this.listeners=[];this.creatorProcessNode=null;b&&this.addDataSlot(b)};f.prototype.addDataSlot=function(a){a.addChannel(this);for(var c=0;c<this.entries.length;++c){var d=this.entries[c];if(d.key>=a.key-b.EPSILON){Math.abs(d.key-a.key)<=b.EPSILON?(d.removeChannel(this),this.entries.splice(c,
1,a)):this.entries.splice(c,0,a);break}}this.entries.push(a)};f.prototype.getSequenceLength=function(){return this.entries.length};f.prototype.getSequenceMinKey=function(){return this.entries[0].key};f.prototype.getSequenceMaxKey=function(){return this.entries[this.entries.length-1].key};f.prototype.getType=function(){return 0==this.entries.length?b.DATA_TYPE.UNKNOWN:this.entries[0].dataEntry._type};f.prototype.addChannelEntries=function(a){for(var b=0;b<a.entries.length;++b)this.addDataSlot(a.entries[b]);
a.creatorProcessNode&&(this.creatorProcessNode=a.creatorProcessNode)};f.prototype.getDataEntry=function(a,d){if(0==this.entries.length)return null;if(!a)return this.entries[0].dataEntry;for(var e=0,f=this.entries.length;e<f&&this.entries[e].key<d;)++e;if(a==b.SEQUENCE.PREV_BUFFER)return this.entries[e?e-1:0].dataEntry;if(a==b.SEQUENCE.NEXT_BUFFER)return this.entries[e<f?e:f-1].dataEntry;if(a==b.SEQUENCE.LINEAR_WEIGHT){var g=this.entries[e?e-1:0].key,e=this.entries[e<f?e:f-1].key,f=new Float32Array(1);
f[0]=e==g?0:(d-g)/(e-g);return new c(b.DATA_TYPE.FLOAT,f)}return null};f.prototype.willMergeWithChannel=function(a){if(this.entries.length!=a.entries.length)return!0;if(this.getType()!=a.getType())return!1;for(var c=0;c<this.entries.length;c++)if(Math.abs(this.entries[c].key-a.entries[c].key)>b.EPSILON)return!0;return!1};f.prototype.willMergeWithDataSlot=function(a){return 1<this.entries.length?!0:this.getType()!=a.dataEntry._type?!1:Math.abs(this.entries[0].key-a.key)>b.EPSILON};f.prototype.notifyOnChange=
function(a){for(var b=0;b<this.listeners.length;b++)this.listeners[b].onXflowChannelChange(this,a)};f.prototype.addListener=function(a){this.listeners.push(a)};f.prototype.removeListener=function(a){a=this.listeners.indexOf(a);-1!=a&&this.listeners.splice(a,1)};f.prototype.clear=function(){for(var a=0;a<this.entries.length;++a)this.entries[a].removeChannel(this)};var k=0;j.exports={Channel:f,ChannelMap:g}},{"../base.js":135,"../interface/constants.js":136,"../interface/data.js":137}],181:[function(h,
j){h("../base.js");var e=h("../interface/constants.js"),a=function(a,b){this.key=b||0;this.dataEntry=a;this.asyncDataEntry=null;this.parentChannels=[]};a.prototype.addChannel=function(a){this.parentChannels.push(a)};a.prototype.removeChannel=function(a){a=this.parentChannels.indexOf(a);-1!=a&&this.parentChannels.splice(a,1)};a.prototype.swapAsync=function(){var a=this.dataEntry;this.dataEntry=this.asyncDataEntry;this.asyncDataEntry=a};a.prototype.setDataEntry=function(a,b){this.dataEntry=a;this.notifyOnChange(b==
e.RESULT_STATE.CHANGED_DATA_VALUE?e.DATA_ENTRY_STATE.CHANGED_VALUE:e.DATA_ENTRY_STATE.CHANGED_SIZE)};a.prototype.notifyOnChange=function(a){for(var b=0;b<this.parentChannels.length;++b)this.parentChannels[b].notifyOnChange(a)};j.exports=a},{"../base.js":135,"../interface/constants.js":136}],182:[function(h,j){function e(b,c,g,h){if(-1==b.blockedNodes.indexOf(c)){if(c.operator){if(h||g!=f.PLATFORM.ASYNC&&n.isOperatorAsync(c.operator)||b.firstOperator&&!(g==f.PLATFORM.GLSL&&b.firstOperator.evaluate_glsl&&
c.operator.evaluate_glsl)){a(b,c);return}b.firstOperator||(b.firstOperator=c.operator);for(var i=c.operator.mapping,j=0;j<i.length;++j)i[j].sequence?(d(b,c,i[j].source),d(b,c,i[j].keySource)):i[j].array&&d(b,c,i[j].source)}for(j=0;j<c.children.length;++j)e(b,c.children[j],g,h)}}function a(b,c){if(-1==b.blockedNodes.indexOf(c)){b.blockedNodes.push(c);for(var d=0;d<c.children.length;++d)a(b,c.children[d])}}function d(b,c,d){(c=c.inputChannels[d])&&c.creatorProcessNode&&a(b,c.creatorProcessNode)}function b(a,
c,d){if(-1==a.doneNodes.indexOf(d))if(a.doneNodes.push(d),-1!=a.blockedNodes.indexOf(d))c.subNodes.push(d);else{for(var e=0;e<d.children.length;++e)b(a,c,d.children[e]);d.operator&&a.constructionOrder.push(d)}}function c(a){for(var b=a.programData.inputs,c=0;c<a.programData.inputs.length;++c){var d=a.programData.getDataEntry(c);(d=d?d.getIterateCount?d.getIterateCount():1:0)?!b[c].arrayAccess&&1<d?a.operatorList.setInputIterateType(c,f.ITERATION_TYPE.MANY):a.operatorList.setInputIterateType(c,f.ITERATION_TYPE.ONE):
a.operatorList.setInputIterateType(c,f.ITERATION_TYPE.NULL);b[c].arrayAccess&&a.platform==f.PLATFORM.GLSL&&a.operatorList.setInputSize(c,d)}}function g(a){for(var b=0;b<a.subNodes.length;++b)a.subNodes[b].process()}h("../base.js");var f=h("../interface/constants.js"),k=h("../operator/operator-list.js"),i=h("../utils/utils.js"),n=h("../operator/operator.js"),l=h("../operator/operator-entry.js"),m=h("../operator/program.js"),r=function(a,c){this.platform=c;this.mergedNodes=[];this.mergedOutputNodes=
[];this.subNodes=[];this.unprocessedDataNames=[];this.operatorList=new k(c);this.programData=new m.ProgramData;this.program=null;for(var d={blockedNodes:[],doneNodes:[],constructionOrder:[],inputSlots:{},finalOutput:null,firstOperator:null,finalOutput:{}},f=a.filter||a.owner.outputChannels.getNames(),g=0;g<f.length;++g){var h=f[g],j=a.owner.outputChannels.getChannel(h);j&&j.creatorProcessNode&&(d.finalOutput[h]=j.getDataEntry())}i.nameset.add(this.unprocessedDataNames,f);e(d,a,this.platform,!1);b(d,
this,a);for(f=0;f<d.constructionOrder.length;++f){for(var g=d.constructionOrder[f],j=h=new l(g.operator),n=d,r=g,y=r.operator.mapping,x=0;x<y.length;++x){var C=r.inputChannels[y[x].source],J;if(C&&C.creatorProcessNode&&-1!=(J=this.mergedNodes.indexOf(C.creatorProcessNode))){a:{for(var D=C.creatorProcessNode,H=D.operator.outputs,P=0;P<H.length;++P)if(C.getDataEntry()==D.outputDataSlots[H[P].name].dataEntry){C=P;break a}C=null}j.setTransferInput(x,J,C);D=this.operatorList.entries[J];D.isFinalOutput(C)||
D.setTransferOutput(C)}else{D=y[x].source;r.owner.owner._computeInputMapping&&(D=r.owner.owner._computeInputMapping.getScriptInputName(y[x].paramIdx,y[x].source));H=new m.ProgramInputConnection;H.channel=C;H.arrayAccess=y[x].array||!1;H.sequenceAccessType=y[x].sequence||0;H.sequenceAccessType&&(H.sequenceKeySourceChannel=r.inputChannels[y[x].keySource]);var P=H.getKey(),Q=n.inputSlots[P];C&&void 0!=Q||(Q=this.programData.inputs.length,n.inputSlots[P]=Q,this.programData.inputs.push(H));j.setDirectInput(x,
Q,D)}}j=h;n=d;r=g;y=r.operator.outputs;x=!0;for(C=0;C<y.length;++C){D=r.outputDataSlots[y[C].name];a:if(n.finalOutput){H=void 0;for(H in n.finalOutput)if(n.finalOutput[H]==D.dataEntry)break a;H=!1}else H=!0;H?(P=this.programData.outputs.length,this.programData.outputs.push(D),j.setFinalOutput(C,P),!0!==H&&i.nameset.remove(this.unprocessedDataNames,H)):x=!1}j=x;this.programData.operatorData.push({});this.operatorList.addEntry(h);this.mergedNodes.push(g);(j||f==d.constructionOrder.length-1)&&this.mergedOutputNodes.push(g)}for(J=
0;J<d.constructionOrder.length;++J){f=d.constructionOrder[J];g=this.operatorList.entries[J];h=f.operator.outputs;for(j=0;j<h.length;++j)!g.isFinalOutput(j)&&!g.isTransferOutput(j)&&(n=this.programData.outputs.length,this.programData.outputs.push(f.outputDataSlots[h[j].name]),g.setLostOutput(j,n))}};r.prototype.isProcessed=function(){for(var a=this.mergedOutputNodes.length;a--;)if(this.mergedOutputNodes[a].status!=f.PROCESS_STATE.PROCESSED)return!1;return!0};r.prototype.run=function(a){g(this);c(this);
if(this.program=m.createProgram(this.operatorList))this.operatorList.allocateOutput(this.programData,!!a),this.program.run(this.programData,a);if(this.platform!=f.PLATFORM.ASYNC)for(a=this.mergedOutputNodes.length;a--;)this.mergedOutputNodes[a].status=f.PROCESS_STATE.PROCESSED};r.prototype.getVertexShader=function(){g(this);c(this);return this.program=m.createProgram(this.operatorList)};j.exports=r},{"../base.js":135,"../interface/constants.js":136,"../operator/operator-entry.js":174,"../operator/operator-list.js":175,
"../operator/operator.js":176,"../operator/program.js":177,"../utils/utils.js":187}],183:[function(h,j){function e(b){for(var c=0;c<b._owners.length;++c)b._owners[c].notify(d.RESULT_STATE.CHANGED_STRUCTURE);a._flushResultCallbacks()}var a=h("../base.js"),d=h("./../interface/constants.js"),b=/^([^:,{}]+)(,[^:{},]+)*$/,c=/^\{(([^:,{}]+:[^:{},]+)(,[^:{},]+:[^:},]+)*)}$/,g=function(){this._owners=[]};g.parse=function(d,e){var d=d.trim(),g=d.trim().match(b);if(g)return f.parse(d,e);if(g=d.trim().match(c))return k.parse(g[1],
e);a.notifyError("Cannot parse name mapping '"+d+"'",e);return null};g.prototype._addOwner=function(a){-1==this._owners.indexOf(a)&&this._owners.push(a)};g.prototype._removeOwner=function(a){a=this._owners.indexOf(a);-1!=a&&this._owners.splice(a,-1)};var f=function(){this._owners=[];this._names=[]};a.createClass(f,g);f.parse=function(a,b){for(var c=new f(b),d=a.split(","),e=0;e<d.length;e++)c._names.push(d[e].trim());return c};Object.defineProperty(f.prototype,"length",{set:function(){throw Error("length is read-only");
},get:function(){return this._names.length}});f.prototype.getName=function(a){return this._names[a]};f.prototype.clear=function(){this._names=[];e(this)};f.prototype.setName=function(a,b){this._names[a]=b;e(this)};f.prototype.removeName=function(a){this._names.splice(a);e(this)};f.prototype.isEmpty=function(){return 0==this._names.length};f.prototype.applyFilterOnChannelMap=function(a,b,c,e){var f;if(c==d.DATA_FILTER_TYPE.KEEP)for(f=0;f<this._names.length;++f)c=this._names[f],b.map[c]&&e(a,c,b,c);
else for(f in b.map){var g=this._names.indexOf(f);(c==d.DATA_FILTER_TYPE.RENAME||c==d.DATA_FILTER_TYPE.REMOVE&&-1==g)&&e(a,f,b,f)}};f.prototype.getScriptInputName=function(a){return this._names[a]?this._names[a]:null};f.prototype.getScriptOutputName=function(a){return this._names[a]?this._names[a]:null};f.prototype.getScriptOutputNameInv=function(a,b){var c=this._names.indexOf(a);return-1==c?null:b[c].name};f.prototype.getRenameSrcName=function(a){return a};var k=function(){this._owners=[];this._destNames=
[];this._srcNames=[]};a.createClass(k,g);k.parse=function(a,b){for(var c=new k(b),d=a.split(","),e=0;e<d.length;e++){var f=d[e].split(":"),g=f[0].trim(),f=f[1].trim();c.setNamePair(g,f)}return c};Object.defineProperty(k.prototype,"length",{set:function(){throw Error("length is read-only");},get:function(){return this._srcNames.length}});k.prototype.getDestName=function(a){return this._destNames[a]};k.prototype.getSrcName=function(a){return this._srcNames[a]};k.prototype.getSrcNameFromDestName=function(a){a=
this._destNames.indexOf(a);return-1==a?null:this._srcNames[a]};k.prototype.getDestNameFromSrcName=function(a){a=this._srcNames.indexOf(a);return-1==a?null:this._destNames[a]};k.prototype.clear=function(){this._srcNames=[];this._destNames=[];e(this)};k.prototype.setNamePair=function(a,b){var c=this._destNames.indexOf(a);-1!=c&&(this._destNames.splice(c,1),this._srcNames.splice(c,1));this._destNames.push(a);this._srcNames.push(b);e(this)};k.prototype.removeNamePair=function(a){a=this._destNames.indexOf(a);
-1!=a&&(this._destNames.splice(a,1),this._srcNames.splice(a,1));e(this)};k.prototype.isEmpty=function(){return 0==this._destNames.length};k.prototype.applyFilterOnChannelMap=function(a,b,c,e){var f;if(c==d.DATA_FILTER_TYPE.REMOVE)for(f in b.map)-1==this._srcNames.indexOf(f)&&e(a,f,b,f);else{if(c==d.DATA_FILTER_TYPE.RENAME)for(f in b.map)-1==this._srcNames.indexOf(f)&&e(a,f,b,f);for(f in this._destNames)e(a,this._destNames[f],b,this._srcNames[f])}};k.prototype.getRenameSrcName=function(a){return this.getSrcNameFromDestName(a)||
a};k.prototype.getScriptInputName=function(a,b){return this.getSrcNameFromDestName(b)};k.prototype.getScriptOutputName=function(a,b){return this.getDestNameFromSrcName(b)};k.prototype.getScriptOutputNameInv=function(a){a=this._destNames.indexOf(a);return-1==a?null:this._srcNames[a]};j.exports={NameMapping:k,OrderMapping:f,Mapping:g}},{"../base.js":135,"./../interface/constants.js":136}],184:[function(h,j){function e(a,b,d){var e,f;for(f in d)if((e=d[f])&&e.creatorProcessNode)c.set.add(a,e.creatorProcessNode),
c.set.add(b,e.creatorProcessNode.descendants);c.set.remove(a,b);c.set.add(b,a)}function a(a,b){a.executers[b]||(a.executers[b]=new g(a,b));return a.executers[b]}var d=h("../base.js"),b=h("../interface/constants.js"),c=h("../utils/utils.js"),g=h("./executor.js"),f=h("./result.js"),k=h("../operator/operator.js"),i=h("../interface/data.js"),n=h("../processing/data-slot.js"),l=i.BufferEntry,m=i.TextureEntry,r=i.ImageDataTextureEntry,i=function(a){this.owner=a;this.operator=a.operator;this.inputChannels=
{};this.outputDataSlots={};this.status=b.PROCESS_STATE.MODIFIED;this.asyncProcessState=3;this.children=[];this.descendants=[];this._bindedAsyncCallback=null;this.executers=[];for(var c=this.operator,d=a.owner._computeInputMapping,f=0;f<c.params.length;++f){var g=c.params[f].source,h=d?d.getScriptInputName(f,g):g;h&&((h=a.inputChannels.getChannel(h))&&h.addListener(this),this.inputChannels[g]=h)}e(this.children,this.descendants,this.inputChannels);var a=this.operator,c=this.outputDataSlots,d=k.isOperatorAsync(a),
i;for(i in a.outputs){var f=a.outputs[i],j,h=f.type;h!=b.DATA_TYPE.TEXTURE?(g=new l(h,null),d&&(j=new l(h,null))):(g=window.document?new m(null):new r(null),d&&(j=window.document?new m(null):new r(null)));c[f.name]=new n(g,0);d&&(c[f.name].asyncDataEntry=j)}k.isOperatorAsync(this.operator)&&(this._bindedAsyncCallback=this.receiveAsyncProcessing.bind(this))};i.prototype.onXflowChannelChange=function(a,c){if(k.isOperatorAsync(this.operator)){if(this.status==b.PROCESS_STATE.LOADING||3!=this.asyncProcessState)this.status=
b.PROCESS_STATE.MODIFIED,this.updateState()}else this.status=c==b.DATA_ENTRY_STATE.CHANGED_VALUE&&this.status>b.PROCESS_STATE.UNPROCESSED?b.PROCESS_STATE.UNPROCESSED:b.PROCESS_STATE.MODIFIED,this.notifyOutputChanged(c)};i.prototype.startAsyncProcessing=function(){0==this.asyncProcessState||3==this.asyncProcessState?(this.asyncProcessState=1,a(this,b.PLATFORM.ASYNC).run(this._bindedAsyncCallback)):this.asyncProcessState=2};i.prototype.receiveAsyncProcessing=function(){this.status=b.PROCESS_STATE.PROCESSED;
this.notifyOutputChanged(b.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE);2==this.asyncProcessState?(this.asyncProcessState=0,this.status=b.PROCESS_STATE.MODIFIED,this.updateState()):this.asyncProcessState=0;d._flushResultCallbacks()};i.prototype.notifyOutputChanged=function(a){for(var b in this.outputDataSlots)this.outputDataSlots[b].notifyOnChange(a)};i.prototype.clear=function(){for(var a in this.inputChannels)this.inputChannels[a]&&this.inputChannels[a].removeListener(this)};i.prototype.updateState=function(){if(this.status==
b.PROCESS_STATE.MODIFIED)if(this.status=b.PROCESS_STATE.UNPROCESSED,XML3D.debug.assert(!this.owner.loading,"This should never happen"),this.owner.loading)this.status=b.PROCESS_STATE.LOADING;else{for(var a=0;a<this.children.length;++a)this.status=Math.min(this.status,this.children[a].updateState());if(a=this.status>b.PROCESS_STATE.LOADING)a:{var a=this.operator,c=this.inputChannels,e;for(e in a.params){var f=c[a.params[e].source];if(f&&(f=f.getDataEntry())&&f.isLoading&&f.isLoading()){a=!0;break a}}a=
!1}a&&(this.status=b.PROCESS_STATE.LOADING);if(e=this.status>b.PROCESS_STATE.INVALID){var g;a:{e=this.operator;a=this.owner.owner._computeInputMapping;c=this.inputChannels;f=this.owner.owner;for(g in e.params){var h=e.params[g],i=a?a.getScriptInputName(g,h.source):h.source;if(!h.optional&&!i){d.notifyError("Xflow: operator "+e.name+": Missing input argument for "+h.source,f);g=!1;break a}if(i){var j=c[h.source];if(!j){if(!a)continue;d.notifyError("Xflow: operator "+e.name+": Input of name '"+i+"' not found. Used for parameter "+
h.source,f);g=!1;break a}i=j.getDataEntry();if(!j.creatorProcessNode&&!h.optional&&(!i||i.isEmpty())){d.notifyError("Xflow: operator "+e.name+": Input for "+h.source+" contains no data.",f);g=!1;break a}if(i&&i.type!=h.type){d.notifyError("Xflow: operator "+e.name+": Input for "+h.source+" has wrong type. Expected: "+b.getTypeName(h.type)+", but got: "+b.getTypeName(i.type),f);g=!1;break a}}}g=!0}e=!g}e&&(this.status=b.PROCESS_STATE.INVALID);this.status==b.PROCESS_STATE.UNPROCESSED&&k.isOperatorAsync(this.operator)&&
(this.status=3==this.asyncProcessState?b.PROCESS_STATE.LOADING:b.PROCESS_STATE.PROCESSED,this.startAsyncProcessing())}return this.status};i.prototype.process=function(){this.status==b.PROCESS_STATE.UNPROCESSED&&(a(this,this.owner.platform).run(),this.status=b.PROCESS_STATE.PROCESSED)};var p=function(a,c){this.owner=a;this.filter=c;this.results={};this.status=b.PROCESS_STATE.MODIFIED;this.channels={};this.children=[];this.executers=[];this.outOfSync=!0};p.prototype.synchronize=function(){if(this.outOfSync){this.outOfSync=
!1;var a=this.owner,b=this.filter;b||(b=a.outputChannels.getNames());for(var c=0;c<b.length;++c){var d=b[c],f=a.outputChannels.getChannel(d);f&&(this.channels[d]=f,f.addListener(this))}e(this.children,[],this.channels)}};p.prototype.updateState=function(){this.synchronize();if(this.status==b.PROCESS_STATE.MODIFIED)if(this.status=b.PROCESS_STATE.UNPROCESSED,this.owner.loading)this.status=b.PROCESS_STATE.LOADING;else for(var a=0;a<this.children.length;++a)this.status=Math.min(this.status,this.children[a].updateState());
return this.status};p.prototype.getResult=function(c){this.updateState();if(this.status==b.PROCESS_STATE.UNPROCESSED){if(c==b.RESULT_TYPE.COMPUTE){var d=a(this,this.owner.platform);d.isProcessed()||d.run()}this.status=b.PROCESS_STATE.PROCESSED}d=null;if(c==b.RESULT_TYPE.COMPUTE){this.results[b.RESULT_TYPE.COMPUTE]||(this.results[b.RESULT_TYPE.COMPUTE]=new f.ComputeResult);c=this.results[b.RESULT_TYPE.COMPUTE];c._dataEntries={};c._outputNames=[];for(var e in this.channels)d=this.channels[e].getDataEntry(),
c._dataEntries[e]=d&&!d.isEmpty()?d:null,c._outputNames.push(e);d=c}else c==b.RESULT_TYPE.VS&&(e=a(this,b.PLATFORM.GLSL),this.results[b.RESULT_TYPE.VS]||(this.results[b.RESULT_TYPE.VS]=new f.VSDataResult),c=this.results[b.RESULT_TYPE.VS],d=e.getVertexShader(),c._program=d,c._programData=e.programData,d=c);d.loading=this.status==b.PROCESS_STATE.LOADING;return d};p.prototype.setStructureOutOfSync=function(){this.outOfSync=!0;this.status=b.PROCESS_STATE.MODIFIED;for(var a in this.results)this.results[a]._notifyChanged(b.RESULT_STATE.CHANGED_STRUCTURE);
for(var c in this.channels)this.channels[c].removeListener(this);this.channels=[];this.children=[];this.executers=[]};p.prototype.onXflowChannelChange=function(a,c){a.creatorProcessNode&&(this.status=b.PROCESS_STATE.MODIFIED);var d=c==b.DATA_ENTRY_STATE.CHANGED_VALUE?b.RESULT_STATE.CHANGED_DATA_VALUE:b.RESULT_STATE.CHANGED_DATA_SIZE,e;for(e in this.results)this.results[e]._notifyChanged(d)};j.exports={RequestNode:p,ProcessNode:i}},{"../base.js":135,"../interface/constants.js":136,"../interface/data.js":137,
"../operator/operator.js":176,"../processing/data-slot.js":181,"../utils/utils.js":187,"./executor.js":182,"./result.js":185}],185:[function(h,j){var e=h("../base.js");h("../../utils/array.js");var a=e._queueResultCallback,d=function(){this.valid=this.loading=!1;this._listeners=[];this._requests=[]};d.prototype.addListener=function(a){this._listeners.push(a)};d.prototype.removeListener=function(a){Array.erase(this._listeners,a)};d.prototype._addRequest=function(a){this._requests.push(a)};d.prototype._removeRequest=
function(a){Array.erase(this._requests,a)};d.prototype._notifyChanged=function(b){this.valid=!1;for(var c=0;c<this._requests.length;++c)this._requests[c]._onResultChanged(b);a(this,b)};d.prototype._onPostponedResultChanged=function(a){for(var b=0;b<this._listeners.length;++b)this._listeners[b](this,a)};var b=function(){d.call(this);this._outputNames=[];this._dataEntries={}};e.createClass(b,d);Object.defineProperty(b.prototype,"outputNames",{set:function(){throw Error("outputNames is readonly");},
get:function(){return this._outputNames}});b.prototype.getOutputData=function(a){return this._dataEntries[a]};b.prototype.getOutputMap=function(){return this._dataEntries};var c=function(){d.call(this);this._programData=this._program=null};e.createClass(c,d);Object.defineProperty(c.prototype,"outputNames",{set:function(){throw Error("shaderOutputNames is readonly");},get:function(){return this._program.getOutputNames()}});c.prototype.isOutputUniform=function(a){return this._program.isOutputUniform(a)};
c.prototype.isOutputNull=function(a){return this._program.isOutputNull(a)};c.prototype.getOutputType=function(a){return this._program.getOutputType(a)};c.prototype.getVertexShader=function(a){return this._program.createVertexShader(this._programData,a)};j.exports={ComputeResult:b,VSDataResult:c}},{"../../utils/array.js":127,"../base.js":135}],186:[function(h,j){h("../base.js");var e=h("./../interface/constants.js"),a=h("../operator/operator.js").initAnonymousOperator,d={};d[e.SHADER_CONSTANT_KEY.OBJECT_ID]=
"objectID";d[e.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM]="screenTransform";d[e.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM_NORMAL]="screenTransformNormal";d[e.SHADER_CONSTANT_KEY.VIEW_TRANSFORM]="viewTransform";d[e.SHADER_CONSTANT_KEY.VIEW_TRANSFORM_NORMAL]="viewTransformNormal";d[e.SHADER_CONSTANT_KEY.WORLD_TRANSFORM]="worldTransform";d[e.SHADER_CONSTANT_KEY.WORLD_TRANSFORM_NORMAL]="worldTransformNormal";var b=function(){this._attributes={};this._blockedNames=[];this._addInput={};this._addOutput={};this._codeFragments=
[];this._outputChanneling={}};b.prototype.addAttribute=function(a,b,c){if(this._attributes[b]){if(this._attributes[b].type!=a)throw Error("Tries to add two attributes with different types of name '"+b+'"');this._attributes[b].optional=this._attributes[b].optional&&c}else this._attributes[b]={type:a,optional:c,channeling:[]}};b.prototype.channelAttribute=function(a,b,c){this._attributes[a].channeling.push({outputName:b,code:c})};b.prototype.addInputParameter=function(a,b,c){this._addInput[b]||(this._addInput[b]=
{type:a,uniform:c},this._blockedNames.push(b))};b.prototype.addOutputParameter=function(a,b){this._addOutput[b]||(this._addOutput[b]={type:a},this._blockedNames.push(b))};b.prototype.addCodeFragment=function(a){this._codeFragments.push(a)};b.prototype.addBlockedName=function(a){this._blockedNames.push(a)};b.prototype.getBlockedNames=function(){return this._blockedNames};b.prototype.getFilter=function(){return Object.keys(this._attributes)};b.prototype.getKey=function(){var a="",b;for(b in this._attributes)var c=
this._attributes[b],a=a+(";"+c.type+","+b+","+c.optional);return a};var c={};b.prototype.getOperator=function(){var b=this.getKey();if(c[b])return c[b];var d=[],g=[],h="VSConnect",h;for(h in this._attributes){var j=this._attributes[h],m=e.getTypeName(j.type);d.push({type:m,name:h});g.push({type:m,source:h,optional:j.optional});h+="T"+m+"N"+h+"O"+j.optional+"."}d=a(h,{outputs:d,params:g,evaluate_glsl:"\t// VS Connector\n"});return c[b]=d};var g=function(a){this._programData=a;this._glslCode=null;this._inputNames=
[];this._outputNames=[];this._inputInfo={};this._outputInfo={}};Object.defineProperty(g.prototype,"inputNames",{set:function(){throw Error("inputNames is readonly");},get:function(){return this._inputNames}});Object.defineProperty(g.prototype,"outputNames",{set:function(){throw Error("outputNames is readonly");},get:function(){return this._outputNames}});g.prototype.isInputUniform=function(a){return this._inputInfo[a].uniform};g.prototype.getInputData=function(a){return this._programData.getDataEntry(this._inputInfo[a].index)};
g.prototype.isOutputNull=function(a){return this._outputInfo[a].iteration==e.ITERATION_TYPE.NULL};g.prototype.isOutputFragmentUniform=function(a){return this._outputInfo[a].iteration==e.ITERATION_TYPE.ONE};g.prototype.getUniformOutputData=function(a){return this._programData.getDataEntry(this._outputInfo[a].index)};g.prototype.getOutputType=function(a){return this._outputInfo[a].type};g.prototype.getOutputSourceName=function(a){return this._outputInfo[a].sourceName};g.prototype.getGLSLCode=function(){return this._glslCode};
j.exports={shaderConstant:d,setShaderConstant:function(a,b){d[a]=b},VSConfig:b,VertexShader:g}},{"../base.js":135,"../operator/operator.js":176,"./../interface/constants.js":136}],187:[function(h,j){h("../../utils/array.js");j.exports={set:{add:function(e,a){if(Array.isArray(a))for(var d=0;d<a.length;++d)-1==e.indexOf(a[d])&&e.push(a[d]);else-1==e.indexOf(a)&&e.push(a)},remove:function(e,a){var d;if(Array.isArray(a))for(var b=0;b<a.length;++b)-1!=(d=e.indexOf(a[b]))&&e.splice(d,1);else-1!=(d=e.indexOf(a))&&
e.splice(d,1)},intersection:function(e,a,d){for(var b=a.length,c=0;c<b;++c)-1!=d.indexOf(a[c])&&e.push(a[c])},isIntersecting:function(e,a){for(var d=e.length;d--;)if(-1!=a.indexOf(e[d]))return!0;return!1},isSubset:function(e,a){for(var d=e.length;d--;)if(-1==a.indexOf(e[d]))return!1;return!0}},nameset:{add:function(e,a){if(a)if("string"==typeof a)-1==e.indexOf(a)&&e.push(a);else for(var d=0;d<a.length;++d)-1==e.indexOf(a[d])&&e.push(a[d])},remove:function(e,a){if(a)if("string"==typeof a){var d=e.indexOf(a);
-1!=d&&e.splice(d,1)}else for(var b=0;b<a.length;++b)d=e.indexOf(a[b]),-1!=d&&e.splice(d,1)},intersection:function(e,a){for(var d=e.length;d--;)-1==a.indexOf(e[d])&&e.splice(d,1)}},binarySearch:function(e,a,d){for(var b=0,d=d-1;b<=d;){var c=Math.floor((b+d)/2);if(e[c]==a)return c;e[c]<a?b=c+1:d=c-1}return d}}},{"../../utils/array.js":127}],188:[function(h,j){j.exports=h("./init.js")},{"./init.js":30}]},{},[188]);
